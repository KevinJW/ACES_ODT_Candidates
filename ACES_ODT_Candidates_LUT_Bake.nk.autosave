#! /Applications/Nuke13.0v3/Nuke13.0v3.app/Contents/MacOS/libnuke-13.0.3.dylib -nx
version 13.0 v3
define_window_layout_xml {<?xml version="1.0" encoding="UTF-8"?>
<layout version="1.0">
    <window x="0" y="25" w="2560" h="1470" maximized="1" screen="0">
        <splitter orientation="1">
            <split size="40"/>
            <dock id="" hideTitles="1" activePageId="Toolbar.1">
                <page id="Toolbar.1"/>
            </dock>
            <split size="1897" stretch="1"/>
            <splitter orientation="2">
                <split size="851"/>
                <dock id="" activePageId="Viewer.1">
                    <page id="Viewer.1"/>
                </dock>
                <split size="599"/>
                <dock id="" activePageId="DAG.1">
                    <page id="DAG.1"/>
                    <page id="Curve Editor.1"/>
                    <page id="DopeSheet.1"/>
                </dock>
            </splitter>
            <split size="615"/>
            <dock id="" activePageId="Properties.1">
                <page id="Properties.1"/>
                <page id="uk.co.thefoundry.backgroundrenderview.1"/>
            </dock>
        </splitter>
    </window>
</layout>
}
Root {
 inputs 0
 name /Users/afry/GitHub/ACES_ODT_Candidates/ACES_ODT_Candidates_LUT_Bake.nk
 project_directory "\[python \{nuke.script_directory()\}]"
 lock_range true
 format "2048 1556 0 0 2048 1556 1 2K_Super_35(full-ap)"
 proxy_type scale
 proxy_format "1024 778 0 0 1024 778 1 1K_Super_35(full-ap)"
 colorManagement Nuke
 OCIO_config custom
 customOCIOConfigPath /Users/afry/Documents/GitHub/OpenColorIO-Configs/aces_1.2/config.ocio
 workingSpaceLUT linear
 monitorLut sRGB
 monitorOutLUT rec709
 int8Lut sRGB
 int16Lut sRGB
 logLut Cineon
 floatLut linear
}
BackdropNode {
 inputs 0
 name BackdropNode1
 tile_color 0x388e8e00
 label "Candidate A\nSSTS tuneup"
 note_font_size 42
 xpos -29
 ypos 138
 bdwidth 236
 bdheight 364
}
BackdropNode {
 inputs 0
 name BackdropNode2
 tile_color 0x388e8e00
 label "Candidate B\nOpen DRT"
 note_font_size 42
 xpos 293
 ypos 135
 bdwidth 236
 bdheight 364
}
BackdropNode {
 inputs 0
 name BackdropNode3
 tile_color 0x388e8e00
 label "Candidate C\nDRT ZCAM IzMh"
 note_font_size 42
 xpos 612
 ypos 132
 bdwidth 236
 bdheight 364
}
Read {
 inputs 0
 file_type exr
 file /Users/afry/Documents/ACES/images/ACES/SonyF35.StillLife.exr
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 origset true
 version 1
 name Read146
 xpos 280
 ypos -109
}
CMSTestPattern {
 inputs 0
 cube_size 65
 name CMSTestPattern1
 xpos -19
 ypos -120
}
OCIOColorSpace {
 in_colorspace "ACES - ACEScct"
 out_colorspace scene_linear
 name OCIOColorSpace1
 xpos -19
 ypos -33
}
Dot {
 name Dot1
 xpos 15
 ypos 24
}
set N14e99c00 [stack 0]
Reformat {
 type scale
 scale 0.1428571429
 filter impulse
 name Reformat1
 xpos 615
 ypos 278
}
set N4bf3c800 [stack 0]
Group {
 name DRT_ZCAM_IzMh_v07_Blink1
 label "\[value colorspace_out]/\[value illuminant_out]/\[value primary_out]\n\[value ssts_luminance.2]Cd/sqm"
 note_font "Bitstream Vera Sans"
 xpos 615
 ypos 313
 addUserKnob {20 User}
 addUserKnob {26 div_input l Input}
 addUserKnob {41 colorspace_in l colorspace T Colorspace1.colorspace_in}
 addUserKnob {41 illuminant_in l "" -STARTLINE T Colorspace1.illuminant_in}
 addUserKnob {41 primary_in l "" -STARTLINE T Colorspace1.primary_in}
 addUserKnob {26 div_ssts l SSTS}
 addUserKnob {78 ssts_luminance l luminance n 3}
 ssts_luminance {0.0001 10 100}
 addUserKnob {26 ssts_label l "" -STARTLINE T "  min / mid / peak"}
 addUserKnob {26 div_gamutmap l "Gamut Mapping"}
 addUserKnob {41 white T ZCAM_GamutBoundaryBlink1.boundaryWhite}
 addUserKnob {41 gamut -STARTLINE T ZCAM_GamutBoundaryBlink1.boundaryGamut}
 addUserKnob {78 compression n 3}
 compression {0.8 1.3 1.2}
 addUserKnob {26 compression_label l "" -STARTLINE T " threshold / limit / power"}
 addUserKnob {7 desatHighlights l "de-sat highlights" R 0 5}
 desatHighlights 2.5
 addUserKnob {3 lut_size_Iz l "LUT size Iz"}
 lut_size_Iz 512
 addUserKnob {3 lut_size_m l M -STARTLINE}
 lut_size_m 512
 addUserKnob {3 lut_size_h l h -STARTLINE}
 lut_size_h 512
 addUserKnob {26 lut_size_label l "" -STARTLINE T " (for gamut boundary)"}
 addUserKnob {26 div_output l Output}
 addUserKnob {41 colorspace_out l colorspace T Colorspace3.colorspace_out}
 addUserKnob {41 illuminant_out l "" -STARTLINE T Colorspace3.illuminant_out}
 addUserKnob {41 primary_out l "" -STARTLINE T Colorspace3.primary_out}
 addUserKnob {41 viewingConditions_1 l viewingConditions T ZCAM_JMh_Blink1.viewingConditions}
 addUserKnob {78 reference_luminance l "luminance reference" -STARTLINE n 1}
 reference_luminance 100
 addUserKnob {78 background_luminance l background -STARTLINE n 1}
 background_luminance 10
 addUserKnob {26 direction}
 addUserKnob {6 invert +STARTLINE}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  label "Generate\nGamut Boundary\n2D LUT"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -777
  ypos -704
  bdwidth 237
  bdheight 931
 }
 BackdropNode {
  inputs 0
  name BackdropNode10
  label "Convert J component to linearised Iz component\nand apply inverse ACES SSTS\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -416
  ypos -388
  bdwidth 829
  bdheight 599
 }
 BackdropNode {
  inputs 0
  name BackdropNode11
  label "IzMh (ZCAM) to Output\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -413
  ypos 233
  bdwidth 822
  bdheight 269
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  label "Compress Colourfulness (M) to Target Gamut\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1364
  ypos -76
  bdwidth 577
  bdheight 299
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  label "Apply ACES SSTS to linearised Iz component\nand convert to J component"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1366
  ypos -703
  bdwidth 576
  bdheight 620
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  label "Input to IzMh (ZCAM)\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1366
  ypos -983
  bdwidth 822
  bdheight 269
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "JMh (ZCAM) to Output\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1363
  ypos 236
  bdwidth 822
  bdheight 269
 }
 BackdropNode {
  inputs 0
  name BackdropNode6
  label "Very handwavy attempt at basing \na highlight de-sat on tonescale"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1750
  ypos -699
  bdwidth 364
  bdheight 908
 }
 BackdropNode {
  inputs 0
  name BackdropNode7
  label "Input to JMh (ZCAM)\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -417
  ypos -990
  bdwidth 822
  bdheight 269
 }
 BackdropNode {
  inputs 0
  name BackdropNode8
  label "Very handwavy attempt at basing \na highlight de-sat on tonescale"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos 432
  ypos -705
  bdwidth 462
  bdheight 913
 }
 BackdropNode {
  inputs 0
  name BackdropNode9
  label "Un-Compress Colourfulness (M) from Target Gamut\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -416
  ypos -704
  bdwidth 822
  bdheight 299
 }
 Constant {
  inputs 0
  format "256 256 0 0 256 256 1 square_256"
  name Constant1
  xpos -693
  ypos -607
 }
 Reformat {
  type "to box"
  box_width {{Expression2.lookupResolution.y}}
  box_height {{Expression2.lookupResolution.x}}
  box_fixed true
  resize distort
  name Reformat1
  label "To Lookup Resolution"
  xpos -693
  ypos -535
 }
 Expression {
  temp_name0 vx
  temp_expr0 x/(input.width-1)
  temp_name1 vy
  temp_expr1 y/(input.height-1)
  expr0 vy
  expr1 vx
  expr2 1
  expr3 0
  name Expression1
  label "Generate Ramps"
  note_font "Bitstream Vera Sans"
  xpos -693
  ypos -497
 }
 Multiply {
  channels rgb
  value {{Expression2.lookupNormJ} {Expression2.lookupNormM} 1 1}
  name Multiply3
  label "Scale IzMh"
  xpos -693
  ypos -459
 }
 Group {
  name ZCAM_GamutBoundaryBlink1
  note_font "Bitstream Vera Sans"
  xpos -693
  ypos -421
  addUserKnob {20 User}
  addUserKnob {7 boundaryLuminance R 0 1000}
  boundaryLuminance {{parent.ssts_luminance.2}}
  addUserKnob {41 boundaryWhite T XYZ_to_RGB.illuminant_out}
  addUserKnob {41 boundaryGamut -STARTLINE T XYZ_to_RGB.primary_out}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  viewingConditions {{parent.ZCAM_JMh_Blink1.viewingConditions}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 275
   bdheight 249
  }
  Constant {
   inputs 0
   format "3 1 0 0 3 1 1 3x1px"
   name Constant1
   label "3x1 px"
   note_font "Bitstream Vera Sans"
   xpos 1138
   ypos 184
  }
  Expression {
   expr0 "x == 0 ? 1 : 0"
   expr1 "x == 1 ? 1 : 0"
   expr2 "x == 2 ? 1 : 0"
   name Expression1
   label "RGB pix"
   note_font "Bitstream Vera Sans"
   xpos 1138
   ypos 268
  }
  Colorspace {
   colorspace_in CIE-XYZ
   name XYZ_to_RGB
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 268
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N4be8d800 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 144
  }
set N4be8d400 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N4be8d400
  Colorspace {
   illuminant_in {{parent.parent.white}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N4be8d800
  BlinkScript {
   inputs 4
   recompileCount 90
   ProgramGroup 1
   KernelDescription "2 \"Gamut_Boundary_Kernel\" iterate pixelWise 1d613777f9e0e67c6d1ddfd0df86eb37910738072e0122d56fd6adb0aa37af1b 5 \"src\" Read Random \"refWhite\" Read Point \"d65White\" Read Point \"XYZtoRGB\" Read Random \"dst\" Write Random 11 \"boundaryLuminance\" Float 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"boundaryLuminance\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 8 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA== \"boundaryRGB\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel Gamut_Boundary_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eRead, eAccessRandom, eEdgeClamped> XYZtoRGB; // RGB values of X, Y & Z to sample matrix values from\n  Image<eWrite, eAccessRandom> dst; // the output image\n\n  param:\n    float boundaryLuminance;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n    float boundaryRGB;\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n    boundaryRGB = boundaryLuminance / referenceLuminance;\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_JMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 JMh = 0.0f;\n\n    JMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float Qz = 2700.0f * pow(Izazbz.x, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    JMh.x = 100.0f * (Qz / Qzw);\n    JMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return JMh;\n  \}\n\n\n  float3 JMh_to_Izazbz( float3 JMh, float refWhiteIz)\n  \{\n    float Qzm = pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * Qzm;\n    float Izp = pow(F_b, 0.12f) / (1.6f * F_s);\n    float Izd = 2700.0f * 100.0f * Qzm;\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float hzr = radians(JMh.z);\n    float Czp = pow((JMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( pow((JMh.x * Qzw) / Izd, Izp), Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 ZCAM_JMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(JMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process(int2 pos)\n  \{\n    // All the work will be done in the first pixel of each scanline.\n    if( pos.x != src.bounds.x1)\n    \{\n      return;\n    \}\n\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3x3 XYZ_to_RGB;\n    for( int x = 0; x < 3; x++)\n    \{\n      SampleType(XYZtoRGB) inputXYZtoRGB = XYZtoRGB(x,0);\n      XYZ_to_RGB\[0]\[x] = inputXYZtoRGB.x;\n      XYZ_to_RGB\[1]\[x] = inputXYZtoRGB.y;\n      XYZ_to_RGB\[2]\[x] = inputXYZtoRGB.z;\n    \}\n\n\n    int width = src.bounds.x2 - src.bounds.x1;\n\n    for( int x = src.bounds.x1; x < src.bounds.x2; x++)\n    \{\n      float J = 0.0f;\n      float maxM = 0.0f;\n      float h = float(x-src.bounds.x1)/float(width-1) * 360.0f;\n\n      for( int xx = src.bounds.x1; xx < src.bounds.x2; xx++)\n      \{\n        SampleType(src) input = src(xx, pos.y);\n        float3 JMh = float3(input.x, input.y, h);\n        J = JMh.x;\n        float3 XYZ = ZCAM_JMh_to_XYZ( JMh, float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z) );\n        // Luminance to Linear\n        XYZ = XYZ / referenceLuminance;\n        float3 RGB = vector_dot(XYZ_to_RGB, XYZ);\n\n        float minRGB = min(RGB.x, min(RGB.y, RGB.z));\n        float maxRGB = max(RGB.x, max(RGB.y, RGB.z));\n\n        if( minRGB >= 0.0f && maxRGB <= boundaryRGB )\n        \{\n          maxM = max(maxM, JMh.y);\n        \}\n      \}\n\n      float3 boundaryXYZ = ZCAM_JMh_to_XYZ( float3(J, maxM, h), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z) );\n      float3 boundaryRGB = vector_dot(XYZ_to_RGB, boundaryXYZ);\n\n      \n      \n      \n      dst(x, pos.y) = float4(boundaryRGB.x, boundaryRGB.y, boundaryRGB.z, maxM); \n    \}\n  \}\n\};\n"
   rebuild ""
   Gamut_Boundary_Kernel_boundaryLuminance {{parent.boundaryLuminance}}
   Gamut_Boundary_Kernel_referenceLuminance {{parent.referenceLuminance}}
   Gamut_Boundary_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   Gamut_Boundary_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   Gamut_Boundary_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   Gamut_Boundary_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   Gamut_Boundary_Kernel_F_L {{"0.171*pow(Gamut_Boundary_Kernel_L_A, 1/3) * (1-exp(-48/9*Gamut_Boundary_Kernel_L_A))"}}
   Gamut_Boundary_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : Gamut_Boundary_Kernel_F * (1 - (1 / 3.6) * exp((-Gamut_Boundary_Kernel_L_A - 42) / 92))"}}
   Gamut_Boundary_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   Gamut_Boundary_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   Gamut_Boundary_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   selected true
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Toe2 {
  channels alpha
  lift 1
  name Toe1
  label "avoid compressing M to zero\nto preserve invertibility\n"
  note_font "Bitstream Vera Sans"
  xpos -693
  ypos -397
 }
 Dot {
  name Dot23
  note_font "Bitstream Vera Sans"
  xpos -659
  ypos -211
 }
set N4be27800 [stack 0]
 Dot {
  name Dot24
  note_font "Bitstream Vera Sans"
  xpos -484
  ypos -211
 }
 Dot {
  name Dot25
  note_font "Bitstream Vera Sans"
  xpos -484
  ypos -561
 }
 Input {
  inputs 0
  name Input
  xpos -516
  ypos -1216
 }
 Dot {
  name Dot15
  note_font "Bitstream Vera Sans"
  xpos -482
  ypos -1035
 }
set N4be26800 [stack 0]
 Dot {
  name Dot17
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos -1035
 }
 Colorspace {
  colorspace_in {{Colorspace3.colorspace_out}}
  illuminant_in {{Colorspace3.illuminant_out}}
  primary_in {{Colorspace3.primary_out}}
  colorspace_out CIE-XYZ
  name Colorspace2
  label "XYZ to Output\ninverse"
  xpos 120
  ypos -896
 }
 Multiply {
  channels rgb
  value 100
  name Multiply13
  label "Lum to Linear\ninverse"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos -854
  disable {{Colorspace2.colorspace_in==31}}
 }
 Group {
  name ZCAM_JMh_Blink2
  label "JMh to XYZ\ninverse"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos -806
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  viewingConditions {{ZCAM_JMh_Blink1.viewingConditions}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {6 invert +STARTLINE}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 146
   bdheight 250
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N4be25400 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   selected true
   xpos 1015
   ypos 144
  }
set N4be25000 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N4be25000
  Colorspace {
   illuminant_in {{parent.parent.white}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N4be25400
  BlinkScript {
   inputs 3
   recompileCount 66
   ProgramGroup 1
   KernelDescription "2 \"ZCAM_JMh_Kernel\" iterate pixelWise ac1327942f16c15a4b75f54f652a97dc0f54381ec18fc95d13cdfae2cd779b6b 4 \"src\" Read Point \"refWhite\" Read Point \"d65White\" Read Point \"dst\" Write Point 11 \"direction\" Int 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"direction\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 7 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel ZCAM_JMh_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eWrite> dst; // the output image\n\n  param:\n    int direction;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_JMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 JMh = 0.0f;\n\n    JMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float Qz = 2700.0f * pow(Izazbz.x, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    JMh.x = 100.0f * (Qz / Qzw);\n    JMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return JMh;\n  \}\n\n\n  float3 JMh_to_Izazbz( float3 JMh, float refWhiteIz)\n  \{\n    float Qzm = pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * Qzm;\n    float Izp = pow(F_b, 0.12f) / (1.6f * F_s);\n    float Izd = 2700.0f * 100.0f * Qzm;\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float hzr = radians(JMh.z);\n    float Czp = pow((JMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( pow((JMh.x * Qzw) / Izd, Izp), Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 XYZ_to_ZCAM_JMh( float3 XYZ, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return Izazbz_to_JMh(XYZ_to_Izazbz(CAT_Zhai2018(XYZ, refWhite, d65White, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS)), refWhiteIzazbz.x);\n  \}\n\n\n  float3 ZCAM_JMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(JMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3 output = 0.0f;\n\n    if( direction == 0 )\n    \{\n      output = XYZ_to_ZCAM_JMh(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n    else\n    \{\n       output = ZCAM_JMh_to_XYZ(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n\n    dst() = float4(output.x, output.y, output.z, input.w);\n  \}\n\};\n"
   rebuild ""
   ZCAM_JMh_Kernel_direction {{parent.invert}}
   ZCAM_JMh_Kernel_referenceLuminance {{parent.referenceLuminance}}
   ZCAM_JMh_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   ZCAM_JMh_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   ZCAM_JMh_Kernel_F_L {{"0.171*pow(ZCAM_JMh_Kernel_L_A, 1/3) * (1-exp(-48/9*ZCAM_JMh_Kernel_L_A))"}}
   ZCAM_JMh_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : ZCAM_JMh_Kernel_F * (1 - (1 / 3.6) * exp((-ZCAM_JMh_Kernel_L_A - 42) / 92))"}}
   ZCAM_JMh_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   ZCAM_JMh_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   ZCAM_JMh_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Dot {
  name Dot19
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos -634
 }
set N4bdbf800 [stack 0]
 Dot {
  name Dot20
  note_font "Bitstream Vera Sans"
  xpos -70
  ypos -634
 }
set N4bdbf400 [stack 0]
 Dot {
  name Dot21
  note_font "Bitstream Vera Sans"
  xpos -209
  ypos -634
 }
 Expression {
  temp_name0 posX
  temp_expr0 b/360*(lookupResolution.z-1)
  temp_name1 posY
  temp_expr1 r/lookupNormJ*(lookupResolution.x-1)
  temp_name2 fractX
  temp_expr2 posX-floor(posX)
  temp_name3 fractY
  temp_expr3 posY-floor(posY)
  expr0 posX
  expr1 fractX
  expr2 posY
  expr3 fractY
  name Expression3
  label "calculate lookup coordinates"
  note_font "Bitstream Vera Sans"
  xpos -243
  ypos -609
  addUserKnob {20 User}
  addUserKnob {13 lookupResolution}
  lookupResolution {{parent.lut_size_Iz} {parent.lut_size_m} {parent.lut_size_h}}
  addUserKnob {7 lookupNormJ R 0 500}
  lookupNormJ {{pow(log(parent.ssts_luminance.2)/log(2),1.7)*4.5}}
  addUserKnob {7 lookupNormM R 0 200}
  lookupNormM 80
 }
 MergeExpression {
  inputs 2
  temp_name0 blPix
  temp_expr0 Aa(floor(Br),floor(Bb))
  temp_name1 brPix
  temp_expr1 Aa(ceil(Br),floor(Bb))
  temp_name2 trPix
  temp_expr2 Aa(ceil(Br),ceil(Bb))
  temp_name3 tlPix
  temp_expr3 Aa(floor(Br),ceil(Bb))
  channel0 none
  expr1 "lerp( lerp(blPix, brPix, Bg), lerp(tlPix, trPix, Bg), Ba)"
  channel2 none
  channel3 none
  name MergeExpression3
  label "Bilinear Interploation"
  xpos -243
  ypos -568
 }
set N4bdbe800 [stack 0]
 Dot {
  name Dot22
  note_font "Bitstream Vera Sans"
  xpos -209
  ypos -483
 }
push $N4bdbf400
push $N4bdbe800
 Merge2 {
  inputs 2
  operation divide
  name Merge7
  xpos -104
  ypos -564
 }
 Expression {
  expr0 (r<thr.r||lim.r<1.0001||r>thr.r+s.r)?r:thr.r+s.r*pow(-(pow((r-thr.r)/s.r,p)/(pow((r-thr.r)/s.r,p)-1)),1/p)
  expr1 (g<thr.g||lim.g<1.0001||g>thr.g+s.g)?g:thr.g+s.g*pow(-(pow((g-thr.g)/s.g,p)/(pow((g-thr.g)/s.g,p)-1)),1/p)
  expr2 (b<thr.b||lim.b<1.0001||b>thr.b+s.b)?b:thr.b+s.b*pow(-(pow((b-thr.b)/s.b,p)/(pow((b-thr.b)/s.b,p)-1)),1/p)
  name UnCompress1
  label Power(P)
  xpos -104
  ypos -529
  addUserKnob {20 Params_tab l Params}
  addUserKnob {18 thr}
  thr {{parent.compression.0}}
  addUserKnob {6 thr_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 lim}
  lim {{parent.compression.1}}
  addUserKnob {6 lim_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 s}
  s {{(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)} {(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)} {(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)}}
  addUserKnob {6 s_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 p R 1 5}
  p {{parent.compression.2}}
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge8
  xpos -104
  ypos -486
 }
push $N4bdbf800
 ShuffleCopy {
  inputs 2
  green green
  alpha alpha2
  name ShuffleCopy3
  label "Apply Compressed\nColourfulness (M)"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos -498
 }
 Dot {
  name Dot37
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos -363
 }
set N4bdbd000 [stack 0]
 Group {
  name Group2
  label "Re-Generate Iz\nfrom J"
  xpos -47
  ypos -375
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite -STARTLINE T Colorspace2.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 10000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 200}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {20 Factors}
  addUserKnob {7 F}
  F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
  addUserKnob {7 F_s}
  F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
  addUserKnob {7 L_A}
  L_A {{"referenceLuminance * backgroundLuminance / 100"}}
  addUserKnob {7 F_b}
  F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
  addUserKnob {7 F_L}
  F_L {{"0.171*pow(L_A, 1/3) * (1-exp(-48/9*L_A))"}}
 }
  BackdropNode {
   inputs 0
   name BackdropNode7
   tile_color 0x666666ff
   label "Reference White"
   note_font_size 20
   xpos 27
   ypos -149
   bdwidth 177
   bdheight 144
  }
  Input {
   inputs 0
   name Input
   xpos -66
   ypos -264
  }
  Dot {
   name Dot1
   xpos -32
   ypos -184
  }
set N4bdbc800 [stack 0]
  Dot {
   name Dot11
   xpos 114
   ypos -184
  }
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   xpos 80
   ypos -112
  }
  Colorspace {
   illuminant_in {{parent.parent.illuminant_in}}
   colorspace_out CIE-XYZ
   name Colorspace2
   xpos 80
   ypos -76
  }
  Expression {
   temp_name0 gain
   temp_expr0 parent.referenceLuminance/g
   expr0 r*gain
   expr1 g*gain
   expr2 b*gain
   name Expression0
   xpos 80
   ypos -50
  }
  Group {
   name XYZ_w_to_Izazbz
   xpos 80
   ypos -26
  }
   Input {
    inputs 0
    name Input1
    xpos 148
    ypos 197
   }
   Expression {
    temp_name0 cb
    temp_expr0 1.15
    temp_name1 cg
    temp_expr1 0.66
    expr0 "(cb*r) - ((cb-1)*b)"
    expr1 "(cg*g) - ((cg-1)*r)"
    expr2 b
    name Expression1
    label "XYZ (D65)\nto\nX'Y'Z (D65)"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 237
   }
   ColorMatrix {
    matrix {
        {0.41478972 0.579999 0.014648}
        {-0.20151 1.120649 0.0531008}
        {-0.0166008 0.2648 0.6684799}
      }
    name ColorMatrix1
    label "X'Y'Z (D65)\nto\nLMS"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 297
   }
   Expression {
    temp_name0 c1
    temp_expr0 "3424 / pow(2,12)"
    temp_name1 c2
    temp_expr1 "2413 / pow(2,7)"
    temp_name2 c3
    temp_expr2 "2392 / pow(2,7)"
    temp_name3 n
    temp_expr3 2610/pow(2,14)
    expr0 "pow( ( c1 + c2 * pow((r/10000),n) ) / ( 1 + c3 * pow((r/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    expr1 "pow( ( c1 + c2 * pow((g/10000),n) ) / ( 1 + c3 * pow((g/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    expr2 "pow( ( c1 + c2 * pow((b/10000),n) ) / ( 1 + c3 * pow((b/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    name Expression2
    label "LMS\nto\nL'M'S'"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 357
   }
   ColorMatrix {
    matrix {
        {0 {1-epsilon} 0}
        {3.524 -4.066708 0.542708}
        {0.199076 1.096799 -1.295875}
      }
    name ColorMatrix2
    label "L'M'S\nto\nIzazbz"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 417
    addUserKnob {20 User}
    addUserKnob {7 epsilon}
    epsilon 3.703522621e-11
   }
   Output {
    name Output1
    xpos 148
    ypos 517
   }
  end_group
  Dot {
   name Dot2
   xpos 114
   ypos 53
  }
push $N4bdbc800
  MergeExpression {
   inputs 2
   temp_name0 Qzm
   temp_expr0 "pow(parent.F_s, 2.2) * pow(parent.F_b, 0.5) * pow(parent.F_L, 0.2)"
   temp_name1 Qzw
   temp_expr1 "2700 * pow(Ar, (1.6 * parent.F_s) / pow(parent.F_b, 0.12)) * Qzm"
   temp_name2 Izp
   temp_expr2 "pow(parent.F_b, 0.12) / (1.6 * parent.F_s)"
   temp_name3 Izd
   temp_expr3 "2700 * 100 * Qzm"
   expr0 "pow((r * Qzw) / Izd, Izp)"
   channel1 none
   channel2 none
   channel3 none
   name MergeExpression3
   selected true
   xpos -66
   ypos 50
  }
  Output {
   name Output
   xpos -66
   ypos 117
  }
 end_group
 Dot {
  name Dot9
  note_font "Bitstream Vera Sans"
  xpos -13
  ypos -324
 }
set N4bd5cc00 [stack 0]
 Group {
  name st2048_6
  label "Lum to PQ (ZCAM)\ninverse"
  xpos -47
  ypos -288
  addUserKnob {20 User}
  addUserKnob {4 direction M {"Luminance (Cd/sqm) -> ST.2048" "ST.2048 -> Luminance (Cd/sqm)"}}
  direction "ST.2048 -> Luminance (Cd/sqm)"
  addUserKnob {7 peakLuminance R 0 10000}
  peakLuminance 10000
  addUserKnob {26 ""}
  addUserKnob {26 m2_override_desc l "" +STARTLINE T "ZCAM uses a different exponent (rho) in its PQ function than ST.2084 (m2)"}
  addUserKnob {7 m2_override R 0 200}
  m2_override {{"1.7 * 2523 / pow(2,5)"}}
 }
  Input {
   inputs 0
   name Input1
   xpos 829
   ypos 200
  }
  Dot {
   name Dot17
   xpos 863
   ypos 240
  }
set N4bd5c400 [stack 0]
  Dot {
   name Dot27
   xpos 916
   ypos 240
  }
  Expression {
   temp_name0 V_pr
   temp_expr0 "pow(r, 1/m_2)"
   temp_name1 V_pg
   temp_expr1 "pow(g, 1/m_2)"
   temp_name2 V_pb
   temp_expr2 "pow(b, 1/m_2)"
   expr0 "pow((max(0.0, V_pr - c_1) / (c_2 - c_3 * V_pr)), 1/m_1)*L_p"
   expr1 "pow((max(0.0, V_pg - c_1) / (c_2 - c_3 * V_pg)), 1/m_1)*L_p"
   expr2 "pow((max(0.0, V_pb - c_1) / (c_2 - c_3 * V_pb)), 1/m_1)*L_p"
   channel3 none
   name from_st2048
   selected true
   xpos 882
   ypos 285
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
push $N4bd5c400
  Dot {
   name Dot26
   xpos 810
   ypos 240
  }
  Expression {
   temp_name0 Y_pr
   temp_expr0 "pow(r / L_p, m_1)"
   temp_name1 Y_pg
   temp_expr1 "pow(g / L_p, m_1)"
   temp_name2 Y_pb
   temp_expr2 "pow(b / L_p, m_1)"
   expr0 "pow((c_1 + c_2 * Y_pr) / (c_3 * Y_pr + 1), m_2)"
   expr1 "pow((c_1 + c_2 * Y_pg) / (c_3 * Y_pg + 1), m_2)"
   expr2 "pow((c_1 + c_2 * Y_pb) / (c_3 * Y_pb + 1), m_2)"
   channel3 none
   name to_st2084
   xpos 776
   ypos 286
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   xpos 835
   ypos 347
  }
  Output {
   name Output1
   xpos 835
   ypos 447
  }
 end_group
 Multiply {
  channels rgb
  value 1.028552621
  name Multiply16
  label "re-apply luminance shift\nfrom cone fundamentals matrix\ninverse"
  note_font "Bitstream Vera Sans"
  xpos -47
  ypos -246
 }
set N4bd06800 [stack 0]
 BlinkScript {
  recompileCount 35
  ProgramGroup 1
  KernelDescription "2 \"SSTSKernel\" iterate pixelWise 3292521f65973146de9ba2803e15c81b8610684f8dcbef3a3fc1382de44823f8 2 \"src\" Read Point \"dst\" Write Point 8 \"lumMid\" Float 1 AAAAAA== \"defaultMin\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"defaultMid\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"defaultMax\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"coefsLow\" Float 6 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA= \"coefsHigh\" Float 6 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA= \"M1\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"inverse\" Int 1 AAAAAA== 8 \"lumMid\" 1 1 \"defaultMin\" 3 1 \"defaultMid\" 3 1 \"defaultMax\" 3 1 \"coefsLow\" 1 6 \"coefsHigh\" 1 6 \"M1\" 9 1 \"inverse\" 1 1 4 \"expShift\" Float 1 1 AAAAAA== \"paramMin\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA== \"paramMid\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA== \"paramMax\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA=="
  kernelSource "kernel SSTSKernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eWrite> dst; // the output image\n\n  param:\n    float lumMid;\n    float3 defaultMin;\n    float3 defaultMid;\n    float3 defaultMax;\n    float coefsLow\[6];\n    float coefsHigh\[6];\n    float3x3 M1;\n    int inverse;\n\n  local:\n    float expShift;\n    float3 paramMin;\n    float3 paramMid;\n    float3 paramMax;\n\n  \n  void define()\n  \{\n\n  \}\n\n  float3 vector_dot( float3 v, float3x3 m)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float dot( float3 a, float3 b)\n  \{\n    return (a.x*b.x) + (a.y*b.y) + (a.z*b.z);\n  \}\n\n  \n  float ssts(float x, float3 minPt, float3 midPt, float3 maxPt)\n  \{\n    float HALF_MIN = 0.0000000596046448;\n\n    // Check for negatives or zero before taking the log. If negative or zero,\n    // set to HALF_MIN.\n    float logx = log10( max(x, HALF_MIN )); \n\n    float logy;\n\n    if( logx <= log10(minPt.x) )\n    \{ \n        logy = logx * minPt.z + ( log10(minPt.y) - minPt.z * log10(minPt.x) );\n    \}\n    else if(( logx > log10(minPt.x) ) && ( logx < log10(midPt.x) ))\n    \{\n        float knot_coord = 3.0f * (logx-log10(minPt.x)) / (log10(midPt.x) - log10(minPt.x));\n        int j = knot_coord;\n        float t = knot_coord - float(j);\n        float3 cf(coefsLow\[j], coefsLow\[j + 1], coefsLow\[j + 2]);\n        float3 monomials( t * t, t, 1.0f );\n        logy = dot(monomials, vector_dot( cf, M1));\n    \}\n    else if(( logx >= log10(midPt.x) ) && ( logx < log10(maxPt.x) ))\n    \{\n        float knot_coord = 3.0f * (logx-log10(midPt.x)) / (log10(maxPt.x) - log10(midPt.x));\n        int j = knot_coord;\n        float t = knot_coord - float(j);\n        float3 cf(coefsHigh\[j], coefsHigh\[j + 1], coefsHigh\[j + 2]); \n        float3 monomials(t * t, t, 1.0f);\n        logy = dot(monomials, vector_dot( cf, M1));\n    \}\n    else\n    \{\n        logy = logx * maxPt.z + ( log10(maxPt.y) - maxPt.z * log10(maxPt.x) );\n    \}\n\n    return pow(10.0f,logy);\n  \}\n\n  \n  float inv_ssts(float y, float3 minPt, float3 midPt, float3 maxPt)\n  \{\n    float KNOT_INC_LOW  = (log10(midPt.x) - log10(minPt.x)) / 3.0f;\n    float KNOT_INC_HIGH = (log10(maxPt.x) - log10(midPt.x)) / 3.0f;\n\n    // KNOT_Y is luminance of the spline at each knot\n    float KNOT_Y_LOW\[4];\n\n   for( int i = 0; i < 4; i++ )\n    \{\n      KNOT_Y_LOW\[i] = ( coefsLow\[i] + coefsLow\[i+1]) / 2.0f;\n    \};\n\n    float KNOT_Y_HIGH\[ 4];\n\n    for( int i = 0; i < 4; i++ )\n    \{\n      KNOT_Y_HIGH\[i] = ( coefsHigh\[i] + coefsHigh\[i+1]) / 2.0f;\n    \};\n\n    float logy = log10( max(y, 0.0000000001f));\n\n    float logx;\n\n    if( logy <= log10(minPt.y) )\n    \{\n        logx = log10(minPt.x);\n\n    \}\n    else if( (logy > log10(minPt.y)) && (logy <= log10(midPt.y)) )\n    \{\n        int j;\n        float3 cf = 0.0f;\n\n        if( logy > KNOT_Y_LOW\[0] && logy <= KNOT_Y_LOW\[1])\n        \{\n          cf.x = coefsLow\[0];\n          cf.y = coefsLow\[1];\n          cf.z = coefsLow\[2];\n          j = 0;\n        \}\n        else if( logy > KNOT_Y_LOW\[1] && logy <= KNOT_Y_LOW\[2])\n        \{\n          cf.x = coefsLow\[1];\n          cf.y = coefsLow\[2];\n          cf.z = coefsLow\[3];\n          j = 1;\n        \}\n        else if( logy > KNOT_Y_LOW\[2] && logy <= KNOT_Y_LOW\[3])\n        \{\n          cf.x = coefsLow\[2];\n          cf.y = coefsLow\[3];\n          cf.z = coefsLow\[4];\n          j = 2;\n        \} \n\n        float3 tmp = vector_dot( cf, M1 );\n\n        float a = tmp.x;\n        float b = tmp.y;\n        float c = tmp.z;\n        c = c - logy;\n\n        float d = sqrt( b * b - 4.0f * a * c);\n\n        float t = ( 2.0f * c) / ( -d - b);\n\n        logx = log10(minPt.x) + ( t + j) * KNOT_INC_LOW;\n\n    \}\n    else if( (logy > log10(midPt.y)) && (logy < log10(maxPt.y)) )\n    \{\n        int j;\n        float3 cf = 0.0f;\n\n        if( logy >= KNOT_Y_HIGH\[0] && logy <= KNOT_Y_HIGH\[1])\n        \{\n          cf.x = coefsHigh\[0];\n          cf.y = coefsHigh\[1];\n          cf.z = coefsHigh\[2];\n          j = 0;\n        \}\n        else if( logy > KNOT_Y_HIGH\[1] && logy <= KNOT_Y_HIGH\[2])\n        \{\n          cf.x = coefsHigh\[1];\n          cf.y = coefsHigh\[2];\n          cf.z = coefsHigh\[3];\n          j = 1;\n        \}\n        else if( logy > KNOT_Y_HIGH\[2] && logy <= KNOT_Y_HIGH\[3])\n        \{\n          cf.x = coefsHigh\[2];\n          cf.y = coefsHigh\[3];\n          cf.z = coefsHigh\[4];\n          j = 2;\n        \} \n\n        float3 tmp = vector_dot( cf, M1);\n\n        float a = tmp.x;\n        float b = tmp.y;\n        float c = tmp.z;\n        c = c - logy;\n\n        float d = sqrt( b * b - 4.0f * a * c);\n\n        float t = ( 2.0f * c) / ( -d - b);\n\n        logx = log10(midPt.x) + ( t + j) * KNOT_INC_HIGH;\n\n    \}\n    else\n    \{\n        logx = log10(maxPt.x);\n\n    \}\n\n    return pow(10.0f, logx);\n  \}\n\n\n  void init()\n  \{\n    paramMin = defaultMin;\n    paramMid = defaultMid;\n    paramMax = defaultMax;\n    expShift = log2(inv_ssts(lumMid, defaultMin, paramMid, defaultMax)) - log2(0.18f);\n    paramMin.x = pow(2.0f, (log(paramMin.x) / log(2.0f) - expShift));\n    paramMid.x = pow(2.0f, (log(0.18f     ) / log(2.0f) - expShift));\n    paramMax.x = pow(2.0f, (log(paramMax.x) / log(2.0f) - expShift));\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    float3 srcPixel(input.x, input.y, input.z);\n    float3 tsPixel = 0.0f;\n\n    if( inverse )\n    \{\n      tsPixel.x = inv_ssts(srcPixel.x, paramMin, paramMid, paramMax);\n      tsPixel.y = inv_ssts(srcPixel.y, paramMin, paramMid, paramMax);\n      tsPixel.z = inv_ssts(srcPixel.z, paramMin, paramMid, paramMax);\n    \}\n    else\n    \{\n      tsPixel.x = ssts(srcPixel.x, paramMin, paramMid, paramMax);\n      tsPixel.y = ssts(srcPixel.y, paramMin, paramMid, paramMax);\n      tsPixel.z = ssts(srcPixel.z, paramMin, paramMid, paramMax);\n    \}\n\n    dst() = float4(tsPixel.x, tsPixel.y, tsPixel.z, input.w);\n  \}\n\};\n"
  rebuild ""
  SSTSKernel_lumMid {{luminances.y}}
  SSTSKernel_defaultMin {{pow(2.,(log(MIN_PT.x)/log(2)))} {MIN_PT.y} {MIN_PT.z}}
  SSTSKernel_defaultMid {{pow(2.,(log(0.18)/log(2)))} {MID_PT.y} {MID_PT.z}}
  SSTSKernel_defaultMax {{pow(2.,(log(MAX_PT.x)/log(2)))} {MAX_PT.y} {MAX_PT.z}}
  SSTSKernel_coefsLow {{"(MIN_PT.z * (log10(MIN_PT.x)-0.5*knotIncLow)) + ( log10(MIN_PT.y) - MIN_PT.z * log10(MIN_PT.x))"} {"(MIN_PT.z * (log10(MIN_PT.x)+0.5*knotIncLow)) + ( log10(MIN_PT.y) - MIN_PT.z * log10(MIN_PT.x))"} {"log10(MIN_PT.y) + pctLow*(log10(MID_PT.y)-log10(MIN_PT.y))"} {"(MID_PT.z * (log10(MID_PT.x)-0.5*knotIncLow)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"(MID_PT.z * (log10(MID_PT.x)+0.5*knotIncLow)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {SSTSKernel_coefsLow.4}}
  SSTSKernel_coefsHigh {{"(MID_PT.z * (log10(MID_PT.x)-0.5*knotIncHigh)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"(MID_PT.z * (log10(MID_PT.x)+0.5*knotIncHigh)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"log10(MID_PT.y) + pctHigh*(log10(MAX_PT.y)-log10(MID_PT.y))"} {"(MAX_PT.z * (log10(MAX_PT.x)-0.5*knotIncHigh)) + ( log10(MAX_PT.y) - MAX_PT.z * log10(MAX_PT.x))"} {"(MAX_PT.z * (log10(MAX_PT.x)+0.5*knotIncHigh)) + ( log10(MAX_PT.y) - MAX_PT.z * log10(MAX_PT.x))"} {SSTSKernel_coefsHigh.4}}
  SSTSKernel_M1 {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  SSTSKernel_inverse {{direction}}
  rebuild_finalise ""
  name SSTS_Blink3
  label inverse
  note_font "Bitstream Vera Sans"
  xpos -47
  ypos -186
  addUserKnob {20 User}
  addUserKnob {13 luminances}
  luminances {{parent.ssts_luminance.0} {parent.ssts_luminance.1} {parent.ssts_luminance.2}}
  addUserKnob {4 direction M {forward inverse}}
  direction inverse
  addUserKnob {20 SSTSParams}
  addUserKnob {13 MIN_PT}
  MIN_PT {{0.18*pow(2,minTable(log10(luminances.x)))} {luminances.x} 0}
  addUserKnob {13 MID_PT}
  MID_PT {0.18 4.8 1.55}
  addUserKnob {13 MAX_PT}
  MAX_PT {{0.18*pow(2,maxTable(log10(luminances.z)))} {luminances.z} 0}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(MID_PT.x) - log10(MIN_PT.x)) / 3"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(MAX_PT.x) - log10(MID_PT.x)) / 3"}}
  addUserKnob {7 pctLow}
  pctLow {{bendsLow(log(MIN_PT.x/0.18)/log(2))}}
  addUserKnob {7 pctHigh}
  pctHigh {{bendsHigh(log(MAX_PT.x/0.18)/log(2))}}
  addUserKnob {20 Tables}
  addUserKnob {7 minTable}
  minTable {{curve L l x-4 -15 x-1.69896996 -6.5}}
  addUserKnob {7 maxTable}
  maxTable {{curve L l x1.681241274 6.5 x4 18}}
  addUserKnob {7 bendsLow}
  bendsLow {{curve L l x-15 0.18 x-6.5 0.35}}
  addUserKnob {7 bendsHigh}
  bendsHigh {{curve l x6.5 0.89 x18 0.9}}
  addUserKnob {20 Constants}
  addUserKnob {7 MIN_STOP_SDR R -10 10}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -10 10}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 200}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
 }
 Multiply {
  channels rgb
  value {{parent.reference_luminance}}
  name Multiply15
  label "1/\[value parent.reference_luminance]\nLum to Exp\ninverse"
  note_font "Bitstream Vera Sans"
  xpos -47
  ypos -138
 }
 Multiply {
  channels rgb
  value 0.9722396415
  name Multiply14
  label "remove luminance shift\nfrom cone fundamentals matrix\ninverse"
  note_font "Bitstream Vera Sans"
  xpos -47
  ypos -78
 }
 Group {
  name st2048_5
  label "PQ (ZCAM) to Lum\ninverse"
  xpos -47
  ypos -18
  addUserKnob {20 User}
  addUserKnob {4 direction M {"Luminance (Cd/sqm) -> ST.2048" "ST.2048 -> Luminance (Cd/sqm)"}}
  addUserKnob {7 peakLuminance R 0 10000}
  peakLuminance 10000
  addUserKnob {26 ""}
  addUserKnob {26 m2_override_desc l "" +STARTLINE T "ZCAM uses a different exponent (rho) in its PQ function than ST.2084 (m2)"}
  addUserKnob {7 m2_override R 0 200}
  m2_override {{"1.7 * 2523 / pow(2,5)"}}
 }
  Input {
   inputs 0
   name Input1
   xpos 829
   ypos 200
  }
  Dot {
   name Dot17
   xpos 863
   ypos 240
  }
set N4bd05400 [stack 0]
  Dot {
   name Dot27
   xpos 916
   ypos 240
  }
  Expression {
   temp_name0 V_pr
   temp_expr0 "pow(r, 1/m_2)"
   temp_name1 V_pg
   temp_expr1 "pow(g, 1/m_2)"
   temp_name2 V_pb
   temp_expr2 "pow(b, 1/m_2)"
   expr0 "pow((max(0.0, V_pr - c_1) / (c_2 - c_3 * V_pr)), 1/m_1)*L_p"
   expr1 "pow((max(0.0, V_pg - c_1) / (c_2 - c_3 * V_pg)), 1/m_1)*L_p"
   expr2 "pow((max(0.0, V_pb - c_1) / (c_2 - c_3 * V_pb)), 1/m_1)*L_p"
   channel3 none
   name from_st2048
   selected true
   xpos 882
   ypos 285
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
push $N4bd05400
  Dot {
   name Dot26
   xpos 810
   ypos 240
  }
  Expression {
   temp_name0 Y_pr
   temp_expr0 "pow(r / L_p, m_1)"
   temp_name1 Y_pg
   temp_expr1 "pow(g / L_p, m_1)"
   temp_name2 Y_pb
   temp_expr2 "pow(b / L_p, m_1)"
   expr0 "pow((c_1 + c_2 * Y_pr) / (c_3 * Y_pr + 1), m_2)"
   expr1 "pow((c_1 + c_2 * Y_pg) / (c_3 * Y_pg + 1), m_2)"
   expr2 "pow((c_1 + c_2 * Y_pb) / (c_3 * Y_pb + 1), m_2)"
   channel3 none
   name to_st2084
   xpos 776
   ypos 286
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   xpos 835
   ypos 347
  }
  Output {
   name Output1
   xpos 835
   ypos 447
  }
 end_group
push $N4bdbd000
 ShuffleCopy {
  inputs 2
  red red
  alpha alpha2
  name ShuffleCopy4
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos -9
 }
 Dot {
  name Dot38
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos 36
 }
set N4c083400 [stack 0]
push $N4bd06800
 Add {
  channels rgb
  value {{-parent.ssts_luminance.1}}
  name Add2
  label "mids to zero"
  note_font "Bitstream Vera Sans"
  xpos 520
  ypos -234
 }
 Multiply {
  channels rgb
  value {{1/parent.ssts_luminance.1}}
  name Multiply20
  label "1/\[value parent.ssts_luminance.1]\nnormalise mids"
  note_font "Bitstream Vera Sans"
  xpos 520
  ypos -196
 }
 Clamp {
  channels rgb
  name Clamp3
  label 0-1
  note_font "Bitstream Vera Sans"
  xpos 520
  ypos -146
 }
push $N4c083400
 Dot {
  name Dot6
  note_font "Bitstream Vera Sans"
  xpos 477
  ypos 36
 }
 Dot {
  name Dot36
  note_font "Bitstream Vera Sans"
  xpos 477
  ypos -597
 }
 Dot {
  name Dot32
  note_font "Bitstream Vera Sans"
  xpos 782
  ypos -597
 }
push $N4bd5cc00
 Dot {
  name Dot10
  note_font "Bitstream Vera Sans"
  xpos 638
  ypos -324
 }
 Dot {
  name Dot12
  note_font "Bitstream Vera Sans"
  xpos 638
  ypos -173
 }
 Merge2 {
  inputs 2
  operation minus
  name Merge9
  label "diff tonescale"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos -182
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge10
  label "remove toe"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos -146
 }
 Multiply {
  channels rgb
  value {{parent.desatHighlights}}
  name Multiply22
  label "desat scale"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos -106
 }
 Group {
  name SoftclipExpression1
  label "avoid divide by zero"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos -33
  addUserKnob {20 User}
  addUserKnob {18 clip_to}
  clip_to 0.9
  addUserKnob {6 clip_to_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 clip_to_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 clip_to_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 threshold}
  threshold 0.8
  addUserKnob {6 threshold_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {7 mix}
  mix 1
 }
  Input {
   inputs 0
   name Input1
   xpos -284
   ypos 135
  }
  Multiply {
   value {{1/parent.clip_to.r} {1/parent.clip_to.g} {1/parent.clip_to.b} 1}
   name Multiply1
   note_font "Bitstream Vera Sans"
   xpos -284
   ypos 159
  }
set N4c037c00 [stack 0]
  Expression {
   temp_name0 one_minus_e
   temp_expr0 "1 - pow(10,-15)"
   temp_name1 maxr
   temp_expr1 "(pow(threshold.r, 2) - 2 * threshold.r * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   temp_name2 maxg
   temp_expr2 "(pow(threshold.g, 2) - 2 * threshold.g * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   temp_name3 maxb
   temp_expr3 "(pow(threshold.b, 2) - 2 * threshold.b * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   expr0 " threshold.r < 1 ? r >= 1 ? maxr : r > threshold.r ? (pow(threshold.r, 2) - 2 * threshold.r * r + r ) / ( 1 - r ) : r : r"
   expr1 " threshold.g < 1 ? g >= 1 ? maxg : g > threshold.g ? (pow(threshold.g, 2) - 2 * threshold.g * g + g ) / ( 1 - g ) : g : g"
   expr2 " threshold.b < 1 ? b >= 1 ? maxb : b > threshold.b ? (pow(threshold.b, 2) - 2 * threshold.b * b + b ) / ( 1 - b ) : b : b"
   expr3 a
   mix {{parent.mix}}
   name Expression2
   label inverse
   xpos -222
   ypos 257
   addUserKnob {20 User}
   addUserKnob {18 threshold}
   threshold {{parent.threshold.r} {parent.threshold.g} {parent.threshold.b}}
   addUserKnob {6 threshold_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  }
push $N4c037c00
  Expression {
   expr0 "threshold.r < 1 ? r > threshold.r ? ( -1 / (( r - threshold.r ) / ( 1 - threshold.r ) +1 ) +1 ) * ( 1 - threshold.r ) + threshold.r : r : r"
   expr1 "threshold.g < 1 ? g > threshold.g ? ( -1 / (( g - threshold.g ) / ( 1 - threshold.g ) +1 ) +1 ) * ( 1 - threshold.g ) + threshold.g : g : g"
   expr2 "threshold.b < 1 ? b > threshold.b ? ( -1 / (( b - threshold.b ) / ( 1 - threshold.b ) +1 ) +1 ) * ( 1 - threshold.b ) + threshold.b : b : b"
   expr3 a
   mix {{parent.mix}}
   name Expression1
   label forward
   xpos -349
   ypos 258
   addUserKnob {20 User}
   addUserKnob {18 threshold_1 l threshold}
   threshold_1 {{parent.threshold.r} {parent.threshold.g} {parent.threshold.b}}
   addUserKnob {6 threshold_1_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   note_font "Bitstream Vera Sans"
   xpos -287
   ypos 356
  }
  Multiply {
   value {{parent.clip_to.r} {parent.clip_to.g} {parent.clip_to.b} 1}
   name Multiply2
   note_font "Bitstream Vera Sans"
   xpos -287
   ypos 380
  }
  Output {
   name Output1
   xpos -287
   ypos 463
  }
 end_group
 Invert {
  channels rgb
  name Invert2
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos 8
 }
 Shuffle {
  red white
  green red
  blue white
  alpha white
  name Shuffle1
  label "\[value in]-->\[value out]"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos 32
 }
 Dot {
  name Dot39
  note_font "Bitstream Vera Sans"
  xpos 782
  ypos 166
 }
 Merge2 {
  inputs 2
  operation divide
  name Merge12
  label "highlight de-sat\ninverse"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos 151
 }
 Group {
  name ZCAM_IzMh_Blink2
  label "XYZ to IzMh\ninverse"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos 325
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {6 invert +STARTLINE}
  invert true
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 146
   bdheight 250
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N4c035400 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 144
  }
set N4c035000 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N4c035000
  Colorspace {
   illuminant_in {{parent.parent.illuminant_in}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N4c035400
  BlinkScript {
   inputs 3
   recompileCount 69
   ProgramGroup 1
   KernelDescription "2 \"ZCAM_JMh_Kernel\" iterate pixelWise 7a6b681048dc899573cfa509e7d53e05469125c187c95579679329797bfbd64a 4 \"src\" Read Point \"refWhite\" Read Point \"d65White\" Read Point \"dst\" Write Point 11 \"direction\" Int 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"direction\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 7 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel ZCAM_JMh_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eWrite> dst; // the output image\n\n  param:\n    int direction;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_IzMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 IzMh = 0.0f;\n\n    IzMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+IzMh.z));\n    IzMh.x = Izazbz.x;\n    IzMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return IzMh;\n  \}\n\n\n  float3 IzMh_to_Izazbz( float3 IzMh, float refWhiteIz)\n  \{\n    float ez = 1.015f + cos(radians(89.038f+IzMh.z));\n    float hzr = radians(IzMh.z);\n    float Czp = pow((IzMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( IzMh.x, Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 XYZ_to_ZCAM_IzMh( float3 XYZ, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return Izazbz_to_IzMh(XYZ_to_Izazbz(CAT_Zhai2018(XYZ, refWhite, d65White, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS)), refWhiteIzazbz.x);\n  \}\n\n\n  float3 ZCAM_IzMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(IzMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3 output = 0.0f;\n\n    if( direction == 0 )\n    \{\n      output = XYZ_to_ZCAM_IzMh(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n    else\n    \{\n       output = ZCAM_IzMh_to_XYZ(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n\n    dst() = float4(output.x, output.y, output.z, input.w);\n  \}\n\};\n"
   rebuild ""
   ZCAM_JMh_Kernel_direction {{parent.invert}}
   ZCAM_JMh_Kernel_referenceLuminance {{parent.referenceLuminance}}
   ZCAM_JMh_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   ZCAM_JMh_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   ZCAM_JMh_Kernel_F_L {{"0.171*pow(ZCAM_JMh_Kernel_L_A, 1/3) * (1-exp(-48/9*ZCAM_JMh_Kernel_L_A))"}}
   ZCAM_JMh_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : ZCAM_JMh_Kernel_F * (1 - (1 / 3.6) * exp((-ZCAM_JMh_Kernel_L_A - 42) / 92))"}}
   ZCAM_JMh_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   ZCAM_JMh_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   ZCAM_JMh_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Multiply {
  channels rgb
  value {{1/parent.reference_luminance}}
  name Multiply17
  label "x\[value parent.reference_luminance]\nRel. Exp. to Cd/sqm\ninverse"
  xpos 120
  ypos 398
  disable {{"Colorspace4.colorspace_out == 31"}}
 }
 Colorspace {
  colorspace_in CIE-XYZ
  colorspace_out {{Colorspace1.colorspace_in}}
  illuminant_out {{Colorspace1.illuminant_in}}
  primary_out {{Colorspace1.primary_in}}
  name Colorspace4
  label "Input -> XYZ"
  xpos 120
  ypos 450
 }
 Dot {
  name Dot30
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos 549
 }
 Dot {
  name Dot29
  note_font "Bitstream Vera Sans"
  xpos -461
  ypos 549
 }
push $N4be27800
 Dot {
  name Dot18
  note_font "Bitstream Vera Sans"
  xpos -659
  ypos 109
 }
push $N4be26800
 Dot {
  name Dot16
  note_font "Bitstream Vera Sans"
  xpos -1114
  ypos -1035
 }
 Clamp {
  channels rgb
  minimum -65504
  minimum_enable false
  maximum 65504
  name Clamp1
  label "Clamp inf to\n+/-half max"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos -909
 }
 Colorspace {
  illuminant_in ACES
  primary_in ACES
  colorspace_out CIE-XYZ
  name Colorspace1
  label "Input -> XYZ"
  xpos -1148
  ypos -859
 }
 Multiply {
  channels rgb
  value {{parent.reference_luminance}}
  name Multiply1
  label "x\[value parent.reference_luminance]\nRel. Exp. to Cd/sqm"
  xpos -1148
  ypos -818
  disable {{"Colorspace1.colorspace_in == 31"}}
 }
 Group {
  name ZCAM_IzMh_Blink1
  label "XYZ to IzMh"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos -768
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {6 invert +STARTLINE}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 146
   bdheight 250
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N4c6b9000 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   selected true
   xpos 1015
   ypos 144
  }
set N4c6b8c00 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N4c6b8c00
  Colorspace {
   illuminant_in {{parent.parent.illuminant_in}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N4c6b9000
  BlinkScript {
   inputs 3
   recompileCount 69
   ProgramGroup 1
   KernelDescription "2 \"ZCAM_JMh_Kernel\" iterate pixelWise 7a6b681048dc899573cfa509e7d53e05469125c187c95579679329797bfbd64a 4 \"src\" Read Point \"refWhite\" Read Point \"d65White\" Read Point \"dst\" Write Point 11 \"direction\" Int 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"direction\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 7 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel ZCAM_JMh_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eWrite> dst; // the output image\n\n  param:\n    int direction;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_IzMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 IzMh = 0.0f;\n\n    IzMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+IzMh.z));\n    IzMh.x = Izazbz.x;\n    IzMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return IzMh;\n  \}\n\n\n  float3 IzMh_to_Izazbz( float3 IzMh, float refWhiteIz)\n  \{\n    float ez = 1.015f + cos(radians(89.038f+IzMh.z));\n    float hzr = radians(IzMh.z);\n    float Czp = pow((IzMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( IzMh.x, Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 XYZ_to_ZCAM_IzMh( float3 XYZ, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return Izazbz_to_IzMh(XYZ_to_Izazbz(CAT_Zhai2018(XYZ, refWhite, d65White, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS)), refWhiteIzazbz.x);\n  \}\n\n\n  float3 ZCAM_IzMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(IzMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3 output = 0.0f;\n\n    if( direction == 0 )\n    \{\n      output = XYZ_to_ZCAM_IzMh(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n    else\n    \{\n       output = ZCAM_IzMh_to_XYZ(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n\n    dst() = float4(output.x, output.y, output.z, input.w);\n  \}\n\};\n"
   rebuild ""
   ZCAM_JMh_Kernel_direction {{parent.invert}}
   ZCAM_JMh_Kernel_referenceLuminance {{parent.referenceLuminance}}
   ZCAM_JMh_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   ZCAM_JMh_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   ZCAM_JMh_Kernel_F_L {{"0.171*pow(ZCAM_JMh_Kernel_L_A, 1/3) * (1-exp(-48/9*ZCAM_JMh_Kernel_L_A))"}}
   ZCAM_JMh_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : ZCAM_JMh_Kernel_F * (1 - (1 / 3.6) * exp((-ZCAM_JMh_Kernel_L_A - 42) / 92))"}}
   ZCAM_JMh_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   ZCAM_JMh_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   ZCAM_JMh_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Dot {
  name Dot5
  note_font "Bitstream Vera Sans"
  xpos -1114
  ypos -603
 }
set N4c667400 [stack 0]
 Dot {
  name Dot11
  note_font "Bitstream Vera Sans"
  xpos -1224
  ypos -603
 }
set N4c667000 [stack 0]
 Group {
  name st2048_3
  label "PQ (ZCAM) to Lum"
  xpos -1258
  ypos -480
  addUserKnob {20 User}
  addUserKnob {4 direction M {"Luminance (Cd/sqm) -> ST.2048" "ST.2048 -> Luminance (Cd/sqm)"}}
  direction "ST.2048 -> Luminance (Cd/sqm)"
  addUserKnob {7 peakLuminance R 0 10000}
  peakLuminance 10000
  addUserKnob {26 ""}
  addUserKnob {26 m2_override_desc l "" +STARTLINE T "ZCAM uses a different exponent (rho) in its PQ function than ST.2084 (m2)"}
  addUserKnob {7 m2_override R 0 200}
  m2_override {{"1.7 * 2523 / pow(2,5)"}}
 }
  Input {
   inputs 0
   name Input1
   xpos 829
   ypos 200
  }
  Dot {
   name Dot17
   xpos 863
   ypos 240
  }
set N4c666800 [stack 0]
  Dot {
   name Dot27
   xpos 916
   ypos 240
  }
  Expression {
   temp_name0 V_pr
   temp_expr0 "pow(r, 1/m_2)"
   temp_name1 V_pg
   temp_expr1 "pow(g, 1/m_2)"
   temp_name2 V_pb
   temp_expr2 "pow(b, 1/m_2)"
   expr0 "pow((max(0.0, V_pr - c_1) / (c_2 - c_3 * V_pr)), 1/m_1)*L_p"
   expr1 "pow((max(0.0, V_pg - c_1) / (c_2 - c_3 * V_pg)), 1/m_1)*L_p"
   expr2 "pow((max(0.0, V_pb - c_1) / (c_2 - c_3 * V_pb)), 1/m_1)*L_p"
   channel3 none
   name from_st2048
   selected true
   xpos 882
   ypos 285
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
push $N4c666800
  Dot {
   name Dot26
   xpos 810
   ypos 240
  }
  Expression {
   temp_name0 Y_pr
   temp_expr0 "pow(r / L_p, m_1)"
   temp_name1 Y_pg
   temp_expr1 "pow(g / L_p, m_1)"
   temp_name2 Y_pb
   temp_expr2 "pow(b / L_p, m_1)"
   expr0 "pow((c_1 + c_2 * Y_pr) / (c_3 * Y_pr + 1), m_2)"
   expr1 "pow((c_1 + c_2 * Y_pg) / (c_3 * Y_pg + 1), m_2)"
   expr2 "pow((c_1 + c_2 * Y_pb) / (c_3 * Y_pb + 1), m_2)"
   channel3 none
   name to_st2084
   xpos 776
   ypos 286
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   xpos 835
   ypos 347
  }
  Output {
   name Output1
   xpos 835
   ypos 447
  }
 end_group
 Multiply {
  channels rgb
  value 1.028552621
  name Multiply10
  label "remove luminance shift\nfrom cone fundamentals matrix"
  note_font "Bitstream Vera Sans"
  xpos -1258
  ypos -448
 }
 Multiply {
  channels rgb
  value {{1/parent.reference_luminance}}
  name Multiply11
  label "1/\[value parent.reference_luminance]\nLum to Exp"
  note_font "Bitstream Vera Sans"
  xpos -1258
  ypos -400
 }
 BlinkScript {
  recompileCount 35
  ProgramGroup 1
  KernelDescription "2 \"SSTSKernel\" iterate pixelWise 3292521f65973146de9ba2803e15c81b8610684f8dcbef3a3fc1382de44823f8 2 \"src\" Read Point \"dst\" Write Point 8 \"lumMid\" Float 1 AAAAAA== \"defaultMin\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"defaultMid\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"defaultMax\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"coefsLow\" Float 6 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA= \"coefsHigh\" Float 6 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA= \"M1\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"inverse\" Int 1 AAAAAA== 8 \"lumMid\" 1 1 \"defaultMin\" 3 1 \"defaultMid\" 3 1 \"defaultMax\" 3 1 \"coefsLow\" 1 6 \"coefsHigh\" 1 6 \"M1\" 9 1 \"inverse\" 1 1 4 \"expShift\" Float 1 1 AAAAAA== \"paramMin\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA== \"paramMid\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA== \"paramMax\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA=="
  kernelSource "kernel SSTSKernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eWrite> dst; // the output image\n\n  param:\n    float lumMid;\n    float3 defaultMin;\n    float3 defaultMid;\n    float3 defaultMax;\n    float coefsLow\[6];\n    float coefsHigh\[6];\n    float3x3 M1;\n    int inverse;\n\n  local:\n    float expShift;\n    float3 paramMin;\n    float3 paramMid;\n    float3 paramMax;\n\n  \n  void define()\n  \{\n\n  \}\n\n  float3 vector_dot( float3 v, float3x3 m)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float dot( float3 a, float3 b)\n  \{\n    return (a.x*b.x) + (a.y*b.y) + (a.z*b.z);\n  \}\n\n  \n  float ssts(float x, float3 minPt, float3 midPt, float3 maxPt)\n  \{\n    float HALF_MIN = 0.0000000596046448;\n\n    // Check for negatives or zero before taking the log. If negative or zero,\n    // set to HALF_MIN.\n    float logx = log10( max(x, HALF_MIN )); \n\n    float logy;\n\n    if( logx <= log10(minPt.x) )\n    \{ \n        logy = logx * minPt.z + ( log10(minPt.y) - minPt.z * log10(minPt.x) );\n    \}\n    else if(( logx > log10(minPt.x) ) && ( logx < log10(midPt.x) ))\n    \{\n        float knot_coord = 3.0f * (logx-log10(minPt.x)) / (log10(midPt.x) - log10(minPt.x));\n        int j = knot_coord;\n        float t = knot_coord - float(j);\n        float3 cf(coefsLow\[j], coefsLow\[j + 1], coefsLow\[j + 2]);\n        float3 monomials( t * t, t, 1.0f );\n        logy = dot(monomials, vector_dot( cf, M1));\n    \}\n    else if(( logx >= log10(midPt.x) ) && ( logx < log10(maxPt.x) ))\n    \{\n        float knot_coord = 3.0f * (logx-log10(midPt.x)) / (log10(maxPt.x) - log10(midPt.x));\n        int j = knot_coord;\n        float t = knot_coord - float(j);\n        float3 cf(coefsHigh\[j], coefsHigh\[j + 1], coefsHigh\[j + 2]); \n        float3 monomials(t * t, t, 1.0f);\n        logy = dot(monomials, vector_dot( cf, M1));\n    \}\n    else\n    \{\n        logy = logx * maxPt.z + ( log10(maxPt.y) - maxPt.z * log10(maxPt.x) );\n    \}\n\n    return pow(10.0f,logy);\n  \}\n\n  \n  float inv_ssts(float y, float3 minPt, float3 midPt, float3 maxPt)\n  \{\n    float KNOT_INC_LOW  = (log10(midPt.x) - log10(minPt.x)) / 3.0f;\n    float KNOT_INC_HIGH = (log10(maxPt.x) - log10(midPt.x)) / 3.0f;\n\n    // KNOT_Y is luminance of the spline at each knot\n    float KNOT_Y_LOW\[4];\n\n   for( int i = 0; i < 4; i++ )\n    \{\n      KNOT_Y_LOW\[i] = ( coefsLow\[i] + coefsLow\[i+1]) / 2.0f;\n    \};\n\n    float KNOT_Y_HIGH\[ 4];\n\n    for( int i = 0; i < 4; i++ )\n    \{\n      KNOT_Y_HIGH\[i] = ( coefsHigh\[i] + coefsHigh\[i+1]) / 2.0f;\n    \};\n\n    float logy = log10( max(y, 0.0000000001f));\n\n    float logx;\n\n    if( logy <= log10(minPt.y) )\n    \{\n        logx = log10(minPt.x);\n\n    \}\n    else if( (logy > log10(minPt.y)) && (logy <= log10(midPt.y)) )\n    \{\n        int j;\n        float3 cf = 0.0f;\n\n        if( logy > KNOT_Y_LOW\[0] && logy <= KNOT_Y_LOW\[1])\n        \{\n          cf.x = coefsLow\[0];\n          cf.y = coefsLow\[1];\n          cf.z = coefsLow\[2];\n          j = 0;\n        \}\n        else if( logy > KNOT_Y_LOW\[1] && logy <= KNOT_Y_LOW\[2])\n        \{\n          cf.x = coefsLow\[1];\n          cf.y = coefsLow\[2];\n          cf.z = coefsLow\[3];\n          j = 1;\n        \}\n        else if( logy > KNOT_Y_LOW\[2] && logy <= KNOT_Y_LOW\[3])\n        \{\n          cf.x = coefsLow\[2];\n          cf.y = coefsLow\[3];\n          cf.z = coefsLow\[4];\n          j = 2;\n        \} \n\n        float3 tmp = vector_dot( cf, M1 );\n\n        float a = tmp.x;\n        float b = tmp.y;\n        float c = tmp.z;\n        c = c - logy;\n\n        float d = sqrt( b * b - 4.0f * a * c);\n\n        float t = ( 2.0f * c) / ( -d - b);\n\n        logx = log10(minPt.x) + ( t + j) * KNOT_INC_LOW;\n\n    \}\n    else if( (logy > log10(midPt.y)) && (logy < log10(maxPt.y)) )\n    \{\n        int j;\n        float3 cf = 0.0f;\n\n        if( logy >= KNOT_Y_HIGH\[0] && logy <= KNOT_Y_HIGH\[1])\n        \{\n          cf.x = coefsHigh\[0];\n          cf.y = coefsHigh\[1];\n          cf.z = coefsHigh\[2];\n          j = 0;\n        \}\n        else if( logy > KNOT_Y_HIGH\[1] && logy <= KNOT_Y_HIGH\[2])\n        \{\n          cf.x = coefsHigh\[1];\n          cf.y = coefsHigh\[2];\n          cf.z = coefsHigh\[3];\n          j = 1;\n        \}\n        else if( logy > KNOT_Y_HIGH\[2] && logy <= KNOT_Y_HIGH\[3])\n        \{\n          cf.x = coefsHigh\[2];\n          cf.y = coefsHigh\[3];\n          cf.z = coefsHigh\[4];\n          j = 2;\n        \} \n\n        float3 tmp = vector_dot( cf, M1);\n\n        float a = tmp.x;\n        float b = tmp.y;\n        float c = tmp.z;\n        c = c - logy;\n\n        float d = sqrt( b * b - 4.0f * a * c);\n\n        float t = ( 2.0f * c) / ( -d - b);\n\n        logx = log10(midPt.x) + ( t + j) * KNOT_INC_HIGH;\n\n    \}\n    else\n    \{\n        logx = log10(maxPt.x);\n\n    \}\n\n    return pow(10.0f, logx);\n  \}\n\n\n  void init()\n  \{\n    paramMin = defaultMin;\n    paramMid = defaultMid;\n    paramMax = defaultMax;\n    expShift = log2(inv_ssts(lumMid, defaultMin, paramMid, defaultMax)) - log2(0.18f);\n    paramMin.x = pow(2.0f, (log(paramMin.x) / log(2.0f) - expShift));\n    paramMid.x = pow(2.0f, (log(0.18f     ) / log(2.0f) - expShift));\n    paramMax.x = pow(2.0f, (log(paramMax.x) / log(2.0f) - expShift));\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    float3 srcPixel(input.x, input.y, input.z);\n    float3 tsPixel = 0.0f;\n\n    if( inverse )\n    \{\n      tsPixel.x = inv_ssts(srcPixel.x, paramMin, paramMid, paramMax);\n      tsPixel.y = inv_ssts(srcPixel.y, paramMin, paramMid, paramMax);\n      tsPixel.z = inv_ssts(srcPixel.z, paramMin, paramMid, paramMax);\n    \}\n    else\n    \{\n      tsPixel.x = ssts(srcPixel.x, paramMin, paramMid, paramMax);\n      tsPixel.y = ssts(srcPixel.y, paramMin, paramMid, paramMax);\n      tsPixel.z = ssts(srcPixel.z, paramMin, paramMid, paramMax);\n    \}\n\n    dst() = float4(tsPixel.x, tsPixel.y, tsPixel.z, input.w);\n  \}\n\};\n"
  rebuild ""
  SSTSKernel_lumMid {{luminances.y}}
  SSTSKernel_defaultMin {{pow(2.,(log(MIN_PT.x)/log(2)))} {MIN_PT.y} {MIN_PT.z}}
  SSTSKernel_defaultMid {{pow(2.,(log(0.18)/log(2)))} {MID_PT.y} {MID_PT.z}}
  SSTSKernel_defaultMax {{pow(2.,(log(MAX_PT.x)/log(2)))} {MAX_PT.y} {MAX_PT.z}}
  SSTSKernel_coefsLow {{"(MIN_PT.z * (log10(MIN_PT.x)-0.5*knotIncLow)) + ( log10(MIN_PT.y) - MIN_PT.z * log10(MIN_PT.x))"} {"(MIN_PT.z * (log10(MIN_PT.x)+0.5*knotIncLow)) + ( log10(MIN_PT.y) - MIN_PT.z * log10(MIN_PT.x))"} {"log10(MIN_PT.y) + pctLow*(log10(MID_PT.y)-log10(MIN_PT.y))"} {"(MID_PT.z * (log10(MID_PT.x)-0.5*knotIncLow)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"(MID_PT.z * (log10(MID_PT.x)+0.5*knotIncLow)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {SSTSKernel_coefsLow.4}}
  SSTSKernel_coefsHigh {{"(MID_PT.z * (log10(MID_PT.x)-0.5*knotIncHigh)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"(MID_PT.z * (log10(MID_PT.x)+0.5*knotIncHigh)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"log10(MID_PT.y) + pctHigh*(log10(MAX_PT.y)-log10(MID_PT.y))"} {"(MAX_PT.z * (log10(MAX_PT.x)-0.5*knotIncHigh)) + ( log10(MAX_PT.y) - MAX_PT.z * log10(MAX_PT.x))"} {"(MAX_PT.z * (log10(MAX_PT.x)+0.5*knotIncHigh)) + ( log10(MAX_PT.y) - MAX_PT.z * log10(MAX_PT.x))"} {SSTSKernel_coefsHigh.4}}
  SSTSKernel_M1 {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  SSTSKernel_inverse {{direction}}
  rebuild_finalise ""
  name SSTS_Blink2
  note_font "Bitstream Vera Sans"
  xpos -1258
  ypos -352
  addUserKnob {20 User}
  addUserKnob {13 luminances}
  luminances {{parent.ssts_luminance.0} {parent.ssts_luminance.1} {parent.ssts_luminance.2}}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {20 SSTSParams}
  addUserKnob {13 MIN_PT}
  MIN_PT {{0.18*pow(2,minTable(log10(luminances.x)))} {luminances.x} 0}
  addUserKnob {13 MID_PT}
  MID_PT {0.18 4.8 1.55}
  addUserKnob {13 MAX_PT}
  MAX_PT {{0.18*pow(2,maxTable(log10(luminances.z)))} {luminances.z} 0}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(MID_PT.x) - log10(MIN_PT.x)) / 3"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(MAX_PT.x) - log10(MID_PT.x)) / 3"}}
  addUserKnob {7 pctLow}
  pctLow {{bendsLow(log(MIN_PT.x/0.18)/log(2))}}
  addUserKnob {7 pctHigh}
  pctHigh {{bendsHigh(log(MAX_PT.x/0.18)/log(2))}}
  addUserKnob {20 Tables}
  addUserKnob {7 minTable}
  minTable {{curve L l x-4 -15 x-1.69896996 -6.5}}
  addUserKnob {7 maxTable}
  maxTable {{curve L l x1.681241274 6.5 x4 18}}
  addUserKnob {7 bendsLow}
  bendsLow {{curve L l x-15 0.18 x-6.5 0.35}}
  addUserKnob {7 bendsHigh}
  bendsHigh {{curve l x6.5 0.89 x18 0.9}}
  addUserKnob {20 Constants}
  addUserKnob {7 MIN_STOP_SDR R -10 10}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -10 10}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 200}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
 }
set N4c664800 [stack 0]
 Add {
  channels rgb
  value {{-parent.ssts_luminance.1}}
  name Add1
  label "mids to zero"
  note_font "Bitstream Vera Sans"
  xpos -1529
  ypos -352
 }
 Multiply {
  channels rgb
  value {{1/parent.ssts_luminance.1}}
  name Multiply7
  label "1/\[value parent.ssts_luminance.1]\nnormalise mids"
  note_font "Bitstream Vera Sans"
  xpos -1529
  ypos -314
 }
 Clamp {
  channels rgb
  name Clamp2
  label 0-1
  note_font "Bitstream Vera Sans"
  xpos -1529
  ypos -264
 }
 Dot {
  name Dot8
  note_font "Bitstream Vera Sans"
  xpos -1495
  ypos -188
 }
 Dot {
  name Dot14
  note_font "Bitstream Vera Sans"
  xpos -1605
  ypos -188
 }
push $N4c667000
 Dot {
  name Dot7
  note_font "Bitstream Vera Sans"
  xpos -1614
  ypos -603
 }
push $N4c664800
 Multiply {
  channels rgb
  value 0.9722396415
  name Multiply12
  label "re-apply luminance shift\nfrom cone fundamentals matrix"
  note_font "Bitstream Vera Sans"
  xpos -1258
  ypos -316
 }
 Group {
  name st2048_4
  label "Lum to PQ (ZCAM)"
  xpos -1258
  ypos -268
  addUserKnob {20 User}
  addUserKnob {4 direction M {"Luminance (Cd/sqm) -> ST.2048" "ST.2048 -> Luminance (Cd/sqm)"}}
  addUserKnob {7 peakLuminance R 0 10000}
  peakLuminance 10000
  addUserKnob {26 ""}
  addUserKnob {26 m2_override_desc l "" +STARTLINE T "ZCAM uses a different exponent (rho) in its PQ function than ST.2084 (m2)"}
  addUserKnob {7 m2_override R 0 200}
  m2_override {{"1.7 * 2523 / pow(2,5)"}}
 }
  Input {
   inputs 0
   name Input1
   xpos 829
   ypos 200
  }
  Dot {
   name Dot17
   xpos 863
   ypos 240
  }
set N4c5fa000 [stack 0]
  Dot {
   name Dot27
   xpos 916
   ypos 240
  }
  Expression {
   temp_name0 V_pr
   temp_expr0 "pow(r, 1/m_2)"
   temp_name1 V_pg
   temp_expr1 "pow(g, 1/m_2)"
   temp_name2 V_pb
   temp_expr2 "pow(b, 1/m_2)"
   expr0 "pow((max(0.0, V_pr - c_1) / (c_2 - c_3 * V_pr)), 1/m_1)*L_p"
   expr1 "pow((max(0.0, V_pg - c_1) / (c_2 - c_3 * V_pg)), 1/m_1)*L_p"
   expr2 "pow((max(0.0, V_pb - c_1) / (c_2 - c_3 * V_pb)), 1/m_1)*L_p"
   channel3 none
   name from_st2048
   selected true
   xpos 882
   ypos 285
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
push $N4c5fa000
  Dot {
   name Dot26
   xpos 810
   ypos 240
  }
  Expression {
   temp_name0 Y_pr
   temp_expr0 "pow(r / L_p, m_1)"
   temp_name1 Y_pg
   temp_expr1 "pow(g / L_p, m_1)"
   temp_name2 Y_pb
   temp_expr2 "pow(b / L_p, m_1)"
   expr0 "pow((c_1 + c_2 * Y_pr) / (c_3 * Y_pr + 1), m_2)"
   expr1 "pow((c_1 + c_2 * Y_pg) / (c_3 * Y_pg + 1), m_2)"
   expr2 "pow((c_1 + c_2 * Y_pb) / (c_3 * Y_pb + 1), m_2)"
   channel3 none
   name to_st2084
   xpos 776
   ypos 286
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   xpos 835
   ypos 347
  }
  Output {
   name Output1
   xpos 835
   ypos 447
  }
 end_group
 Dot {
  name Dot40
  note_font "Bitstream Vera Sans"
  xpos -1224
  ypos -226
 }
set N4c5f8800 [stack 0]
 Merge2 {
  inputs 2
  operation minus
  name Merge3
  label "diff tonescale"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -235
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge6
  label "remove toe"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -197
 }
 Multiply {
  channels rgb
  value {{parent.desatHighlights}}
  name Multiply4
  label "desat scale"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -159
 }
 Group {
  name SoftclipExpression2
  label "avoid negative values for M"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -88
  addUserKnob {20 User}
  addUserKnob {18 clip_to}
  clip_to 0.9
  addUserKnob {6 clip_to_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 clip_to_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 clip_to_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 threshold}
  threshold 0.8
  addUserKnob {6 threshold_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {7 mix}
  mix 1
 }
  Input {
   inputs 0
   name Input1
   xpos -284
   ypos 135
  }
  Multiply {
   value {{1/parent.clip_to.r} {1/parent.clip_to.g} {1/parent.clip_to.b} 1}
   name Multiply1
   note_font "Bitstream Vera Sans"
   xpos -284
   ypos 159
  }
set N4c59f000 [stack 0]
  Expression {
   temp_name0 one_minus_e
   temp_expr0 "1 - pow(10,-15)"
   temp_name1 maxr
   temp_expr1 "(pow(threshold.r, 2) - 2 * threshold.r * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   temp_name2 maxg
   temp_expr2 "(pow(threshold.g, 2) - 2 * threshold.g * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   temp_name3 maxb
   temp_expr3 "(pow(threshold.b, 2) - 2 * threshold.b * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   expr0 " threshold.r < 1 ? r >= 1 ? maxr : r > threshold.r ? (pow(threshold.r, 2) - 2 * threshold.r * r + r ) / ( 1 - r ) : r : r"
   expr1 " threshold.g < 1 ? g >= 1 ? maxg : g > threshold.g ? (pow(threshold.g, 2) - 2 * threshold.g * g + g ) / ( 1 - g ) : g : g"
   expr2 " threshold.b < 1 ? b >= 1 ? maxb : b > threshold.b ? (pow(threshold.b, 2) - 2 * threshold.b * b + b ) / ( 1 - b ) : b : b"
   expr3 a
   mix {{parent.mix}}
   name Expression2
   label inverse
   xpos -222
   ypos 257
   addUserKnob {20 User}
   addUserKnob {18 threshold}
   threshold {{parent.threshold.r} {parent.threshold.g} {parent.threshold.b}}
   addUserKnob {6 threshold_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  }
push $N4c59f000
  Expression {
   expr0 "threshold.r < 1 ? r > threshold.r ? ( -1 / (( r - threshold.r ) / ( 1 - threshold.r ) +1 ) +1 ) * ( 1 - threshold.r ) + threshold.r : r : r"
   expr1 "threshold.g < 1 ? g > threshold.g ? ( -1 / (( g - threshold.g ) / ( 1 - threshold.g ) +1 ) +1 ) * ( 1 - threshold.g ) + threshold.g : g : g"
   expr2 "threshold.b < 1 ? b > threshold.b ? ( -1 / (( b - threshold.b ) / ( 1 - threshold.b ) +1 ) +1 ) * ( 1 - threshold.b ) + threshold.b : b : b"
   expr3 a
   mix {{parent.mix}}
   name Expression1
   label forward
   xpos -349
   ypos 258
   addUserKnob {20 User}
   addUserKnob {18 threshold_1 l threshold}
   threshold_1 {{parent.threshold.r} {parent.threshold.g} {parent.threshold.b}}
   addUserKnob {6 threshold_1_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   note_font "Bitstream Vera Sans"
   xpos -287
   ypos 356
  }
  Multiply {
   value {{parent.clip_to.r} {parent.clip_to.g} {parent.clip_to.b} 1}
   name Multiply2
   note_font "Bitstream Vera Sans"
   xpos -287
   ypos 380
  }
  Output {
   name Output1
   xpos -287
   ypos 463
  }
 end_group
 Invert {
  channels rgb
  name Invert1
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -52
 }
 Shuffle {
  red white
  green red
  blue white
  alpha white
  name Shuffle2
  label "\[value in]-->\[value out]"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -21
 }
push $N4c5f8800
 Group {
  name Group1
  label "Re-Generate J\nfrom Iz"
  xpos -1258
  ypos -181
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite -STARTLINE T Colorspace2.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 10000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 200}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {20 Factors}
  addUserKnob {7 F}
  F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
  addUserKnob {7 F_s}
  F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
  addUserKnob {7 L_A}
  L_A {{"referenceLuminance * backgroundLuminance / 100"}}
  addUserKnob {7 F_b}
  F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
  addUserKnob {7 F_L}
  F_L {{"0.171*pow(L_A, 1/3) * (1-exp(-48/9*L_A))"}}
 }
  BackdropNode {
   inputs 0
   name BackdropNode7
   tile_color 0x666666ff
   label "Reference White"
   note_font_size 20
   xpos 27
   ypos -149
   bdwidth 177
   bdheight 144
  }
  Input {
   inputs 0
   name Input
   xpos -66
   ypos -264
  }
  Dot {
   name Dot1
   xpos -32
   ypos -184
  }
set N4c59d000 [stack 0]
  Dot {
   name Dot11
   xpos 114
   ypos -184
  }
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   xpos 80
   ypos -112
  }
  Colorspace {
   illuminant_in {{parent.parent.illuminant_in}}
   colorspace_out CIE-XYZ
   name Colorspace2
   xpos 80
   ypos -76
  }
  Expression {
   temp_name0 gain
   temp_expr0 parent.referenceLuminance/g
   expr0 r*gain
   expr1 g*gain
   expr2 b*gain
   name Expression0
   xpos 80
   ypos -50
  }
  Group {
   name XYZ_w_to_Izazbz
   xpos 80
   ypos -26
  }
   Input {
    inputs 0
    name Input1
    xpos 148
    ypos 197
   }
   Expression {
    temp_name0 cb
    temp_expr0 1.15
    temp_name1 cg
    temp_expr1 0.66
    expr0 "(cb*r) - ((cb-1)*b)"
    expr1 "(cg*g) - ((cg-1)*r)"
    expr2 b
    name Expression1
    label "XYZ (D65)\nto\nX'Y'Z (D65)"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 237
   }
   ColorMatrix {
    matrix {
        {0.41478972 0.579999 0.014648}
        {-0.20151 1.120649 0.0531008}
        {-0.0166008 0.2648 0.6684799}
      }
    name ColorMatrix1
    label "X'Y'Z (D65)\nto\nLMS"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 297
   }
   Expression {
    temp_name0 c1
    temp_expr0 "3424 / pow(2,12)"
    temp_name1 c2
    temp_expr1 "2413 / pow(2,7)"
    temp_name2 c3
    temp_expr2 "2392 / pow(2,7)"
    temp_name3 n
    temp_expr3 2610/pow(2,14)
    expr0 "pow( ( c1 + c2 * pow((r/10000),n) ) / ( 1 + c3 * pow((r/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    expr1 "pow( ( c1 + c2 * pow((g/10000),n) ) / ( 1 + c3 * pow((g/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    expr2 "pow( ( c1 + c2 * pow((b/10000),n) ) / ( 1 + c3 * pow((b/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    name Expression2
    label "LMS\nto\nL'M'S'"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 357
   }
   ColorMatrix {
    matrix {
        {0 {1-epsilon} 0}
        {3.524 -4.066708 0.542708}
        {0.199076 1.096799 -1.295875}
      }
    name ColorMatrix2
    label "L'M'S\nto\nIzazbz"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 417
    addUserKnob {20 User}
    addUserKnob {7 epsilon}
    epsilon 3.703522621e-11
   }
   Output {
    name Output1
    xpos 148
    ypos 517
   }
  end_group
  Dot {
   name Dot2
   xpos 114
   ypos 53
  }
push $N4c59d000
add_layer {zcam_1d zcam_1d.J zcam_1d.C zcam_1d.h zcam_1d.Q zcam_1d.M zcam_1d.H}
  MergeExpression {
   inputs 2
   temp_name0 Qz
   temp_expr0 "2700 * pow(Br, (1.6 * parent.F_s) / pow(parent.F_b, 0.12)) * pow(parent.F_s, 2.2) * pow(parent.F_b, 0.5) * pow(parent.F_L, 0.2)"
   temp_name1 Qzw
   temp_expr1 "2700 * pow(Ar, (1.6 * parent.F_s) / pow(parent.F_b, 0.12)) * pow(parent.F_s, 2.2) * pow(parent.F_b, 0.5) * pow(parent.F_L, 0.2)"
   temp_name2 j
   temp_expr2 100*(Qz/Qzw)
   channel0 {zcam_1d.J -zcam_1d.C -zcam_1d.h none}
   expr0 j
   channel1 {rgba.red -rgba.green -rgba.blue none}
   expr1 j
   channel2 none
   channel3 none
   name MergeExpression1
   selected true
   xpos -66
   ypos 50
  }
  Output {
   name Output
   xpos -66
   ypos 117
  }
 end_group
push $N4c667400
 ShuffleCopy {
  inputs 2
  red red
  alpha alpha2
  name ShuffleCopy1
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos -172
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge4
  label "highlight de-sat"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos -21
 }
 Dot {
  name Dot1
  note_font "Bitstream Vera Sans"
  xpos -1114
  ypos 34
 }
set N4c52cc00 [stack 0]
 Dot {
  name Dot2
  note_font "Bitstream Vera Sans"
  xpos -994
  ypos 34
 }
set N4c52c800 [stack 0]
 Dot {
  name Dot3
  note_font "Bitstream Vera Sans"
  xpos -878
  ypos 34
 }
 Expression {
  temp_name0 posX
  temp_expr0 b/360*(lookupResolution.z-1)
  temp_name1 posY
  temp_expr1 r/lookupNormJ*(lookupResolution.x-1)
  temp_name2 fractX
  temp_expr2 posX-floor(posX)
  temp_name3 fractY
  temp_expr3 posY-floor(posY)
  expr0 posX
  expr1 fractX
  expr2 posY
  expr3 fractY
  name Expression2
  label "calculate lookup coordinates"
  note_font "Bitstream Vera Sans"
  xpos -912
  ypos 61
  addUserKnob {20 User}
  addUserKnob {13 lookupResolution}
  lookupResolution {{parent.lut_size_Iz} {parent.lut_size_m} {parent.lut_size_h}}
  addUserKnob {7 lookupNormJ R 0 500}
  lookupNormJ {{pow(log(parent.ssts_luminance.2)/log(2),1.7)*4.5}}
  addUserKnob {7 lookupNormM R 0 200}
  lookupNormM 80
 }
 MergeExpression {
  inputs 2
  temp_name0 blPix
  temp_expr0 Aa(floor(Br),floor(Bb))
  temp_name1 brPix
  temp_expr1 Aa(ceil(Br),floor(Bb))
  temp_name2 trPix
  temp_expr2 Aa(ceil(Br),ceil(Bb))
  temp_name3 tlPix
  temp_expr3 Aa(floor(Br),ceil(Bb))
  channel0 none
  expr1 "lerp( lerp(blPix, brPix, Bg), lerp(tlPix, trPix, Bg), Ba)"
  channel2 none
  channel3 none
  name MergeExpression1
  label "Bilinear Interploation"
  xpos -912
  ypos 102
 }
set N4c1ab800 [stack 0]
 Dot {
  name Dot4
  note_font "Bitstream Vera Sans"
  xpos -878
  ypos 174
 }
push $N4c52c800
push $N4c1ab800
 Merge2 {
  inputs 2
  operation divide
  name Merge1
  xpos -1028
  ypos 106
 }
 Expression {
  expr0 (r<thr.r||lim.r<1.0001)?r:thr.r+s.r*((r-thr.r)/s.r)/(pow(1+pow((r-thr.r)/s.r,p),1/p))
  expr1 (g<thr.g||lim.g<1.0001)?g:thr.g+s.g*((g-thr.g)/s.g)/(pow(1+pow((g-thr.g)/s.g,p),1/p))
  expr2 (b<thr.b||lim.b<1.0001)?b:thr.b+s.b*((b-thr.b)/s.b)/(pow(1+pow((b-thr.b)/s.b,p),1/p))
  name Compress
  label Power(P)
  xpos -1028
  ypos 130
  addUserKnob {20 Params_tab l Params}
  addUserKnob {18 thr}
  thr {{parent.compression.0}}
  addUserKnob {6 thr_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 lim}
  lim {{parent.compression.1}}
  addUserKnob {6 lim_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 s}
  s {{(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)} {(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)} {(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)}}
  addUserKnob {6 s_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 p R 1 5}
  p {{parent.compression.2}}
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge2
  xpos -1028
  ypos 171
 }
push $N4c52cc00
 ShuffleCopy {
  inputs 2
  green green
  alpha alpha2
  name ShuffleCopy2
  label "Apply Compressed\nColourfulness (M)"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos 159
 }
 Group {
  name ZCAM_JMh_Blink1
  label "JMh to XYZ"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos 340
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {6 invert +STARTLINE}
  invert true
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 146
   bdheight 250
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N4c1a9c00 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   selected true
   xpos 1015
   ypos 144
  }
set N4c1a9800 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N4c1a9800
  Colorspace {
   illuminant_in {{parent.parent.white}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N4c1a9c00
  BlinkScript {
   inputs 3
   recompileCount 66
   ProgramGroup 1
   KernelDescription "2 \"ZCAM_JMh_Kernel\" iterate pixelWise ac1327942f16c15a4b75f54f652a97dc0f54381ec18fc95d13cdfae2cd779b6b 4 \"src\" Read Point \"refWhite\" Read Point \"d65White\" Read Point \"dst\" Write Point 11 \"direction\" Int 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"direction\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 7 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel ZCAM_JMh_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eWrite> dst; // the output image\n\n  param:\n    int direction;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_JMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 JMh = 0.0f;\n\n    JMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float Qz = 2700.0f * pow(Izazbz.x, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    JMh.x = 100.0f * (Qz / Qzw);\n    JMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return JMh;\n  \}\n\n\n  float3 JMh_to_Izazbz( float3 JMh, float refWhiteIz)\n  \{\n    float Qzm = pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * Qzm;\n    float Izp = pow(F_b, 0.12f) / (1.6f * F_s);\n    float Izd = 2700.0f * 100.0f * Qzm;\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float hzr = radians(JMh.z);\n    float Czp = pow((JMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( pow((JMh.x * Qzw) / Izd, Izp), Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 XYZ_to_ZCAM_JMh( float3 XYZ, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return Izazbz_to_JMh(XYZ_to_Izazbz(CAT_Zhai2018(XYZ, refWhite, d65White, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS)), refWhiteIzazbz.x);\n  \}\n\n\n  float3 ZCAM_JMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(JMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3 output = 0.0f;\n\n    if( direction == 0 )\n    \{\n      output = XYZ_to_ZCAM_JMh(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n    else\n    \{\n       output = ZCAM_JMh_to_XYZ(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n\n    dst() = float4(output.x, output.y, output.z, input.w);\n  \}\n\};\n"
   rebuild ""
   ZCAM_JMh_Kernel_direction {{parent.invert}}
   ZCAM_JMh_Kernel_referenceLuminance {{parent.referenceLuminance}}
   ZCAM_JMh_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   ZCAM_JMh_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   ZCAM_JMh_Kernel_F_L {{"0.171*pow(ZCAM_JMh_Kernel_L_A, 1/3) * (1-exp(-48/9*ZCAM_JMh_Kernel_L_A))"}}
   ZCAM_JMh_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : ZCAM_JMh_Kernel_F * (1 - (1 / 3.6) * exp((-ZCAM_JMh_Kernel_L_A - 42) / 92))"}}
   ZCAM_JMh_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   ZCAM_JMh_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   ZCAM_JMh_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Multiply {
  channels rgb
  value 0.01
  name Multiply5
  label "Lum to Linear"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos 376
  disable {{Colorspace3.colorspace_out==31}}
 }
 Colorspace {
  colorspace_in CIE-XYZ
  colorspace_out BT1886
  name Colorspace3
  label "XYZ to Output"
  xpos -1148
  ypos 412
 }
 Clamp {
  channels rgb
  name Clamp6
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos 444
 }
 Dot {
  name Dot26
  note_font "Bitstream Vera Sans"
  xpos -1114
  ypos 549
 }
 Dot {
  name Dot27
  note_font "Bitstream Vera Sans"
  xpos -502
  ypos 549
 }
 Switch {
  inputs 2
  which {{parent.invert}}
  name Switch1
  note_font "Bitstream Vera Sans"
  xpos -516
  ypos 588
 }
 Output {
  name Output
  xpos -516
  ypos 714
 }
end_group
Reformat {
 type scale
 scale 7
 filter impulse
 name Reformat2
 xpos 615
 ypos 372
}
Group {
 name Write_ResolveACES_ODT_LUT4
 label "\[python nuke.thisNode().knob('file').value().split('/').pop(-1)]"
 xpos 615
 ypos 457
 addUserKnob {20 User}
 addUserKnob {41 file l "output file" T GenerateLUT1.file}
 addUserKnob {41 generate l "Generate and Write LUT File" +INVISIBLE T GenerateLUT1.generate}
 addUserKnob {22 writeCubeDCTL l "Write Cube and DCTL" T "import os\n\nnode = nuke.thisNode()\n\ntemplatePath = os.path.join(nuke.script_directory(),node.knob('dctlTemplate').evaluate())\ncubePath = os.path.join(nuke.script_directory(),node.knob('file').evaluate())\ndctlPath = cubePath.replace('.cube','.dctl')\ncubeName = cubePath.split('/').pop(-1)\n\nnode.knob('generate').execute()\n\nwith open(templatePath) as f:\n    lines = f.readlines()\nnewLines = \[x.replace('replace.cube',cubeName) for x in lines]\n\nwith open(dctlPath, 'w') as f:\n    f.write('\\n'.join(newLines))" +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {2 dctlTemplate}
 dctlTemplate "DaVinci Resolve/ACES_ApplyLUT_Template.dctl"
}
 Input {
  inputs 0
  name Input1
  xpos 411
  ypos 213
 }
 GenerateLUT {
  file "DaVinci Resolve/ACES Transforms/ODT/ACES2.0 Candidates rev001/ACES2.0 CandidateC rev001 Rec709.cube"
  file_type .cube
  name GenerateLUT1
  selected true
  xpos 411
  ypos 267
 }
 Output {
  name Output1
  xpos 411
  ypos 353
 }
end_group
push $N4bf3c800
Group {
 name DRT_ZCAM_IzMh_v07_Blink2
 label "\[value colorspace_out]/\[value illuminant_out]/\[value primary_out]\n\[value ssts_luminance.2]Cd/sqm"
 note_font "Bitstream Vera Sans"
 xpos 759
 ypos 311
 addUserKnob {20 User}
 addUserKnob {26 div_input l Input}
 addUserKnob {41 colorspace_in l colorspace T Colorspace1.colorspace_in}
 addUserKnob {41 illuminant_in l "" -STARTLINE T Colorspace1.illuminant_in}
 addUserKnob {41 primary_in l "" -STARTLINE T Colorspace1.primary_in}
 addUserKnob {26 div_ssts l SSTS}
 addUserKnob {78 ssts_luminance l luminance n 3}
 ssts_luminance {0.0001 15 1000}
 addUserKnob {26 ssts_label l "" -STARTLINE T "  min / mid / peak"}
 addUserKnob {26 div_gamutmap l "Gamut Mapping"}
 addUserKnob {41 white T ZCAM_GamutBoundaryBlink1.boundaryWhite}
 addUserKnob {41 gamut -STARTLINE T ZCAM_GamutBoundaryBlink1.boundaryGamut}
 addUserKnob {78 compression n 3}
 compression {0.8 1.3 1.2}
 addUserKnob {26 compression_label l "" -STARTLINE T " threshold / limit / power"}
 addUserKnob {7 desatHighlights l "de-sat highlights" R 0 5}
 desatHighlights 2.5
 addUserKnob {3 lut_size_Iz l "LUT size Iz"}
 lut_size_Iz 512
 addUserKnob {3 lut_size_m l M -STARTLINE}
 lut_size_m 512
 addUserKnob {3 lut_size_h l h -STARTLINE}
 lut_size_h 512
 addUserKnob {26 lut_size_label l "" -STARTLINE T " (for gamut boundary)"}
 addUserKnob {26 div_output l Output}
 addUserKnob {41 colorspace_out l colorspace T Colorspace3.colorspace_out}
 addUserKnob {41 illuminant_out l "" -STARTLINE T Colorspace3.illuminant_out}
 addUserKnob {41 primary_out l "" -STARTLINE T Colorspace3.primary_out}
 addUserKnob {41 viewingConditions_1 l viewingConditions T ZCAM_JMh_Blink1.viewingConditions}
 addUserKnob {78 reference_luminance l "luminance reference" -STARTLINE n 1}
 reference_luminance 100
 addUserKnob {78 background_luminance l background -STARTLINE n 1}
 background_luminance 10
 addUserKnob {26 direction}
 addUserKnob {6 invert +STARTLINE}
}
 BackdropNode {
  inputs 0
  name BackdropNode1
  label "Generate\nGamut Boundary\n2D LUT"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -777
  ypos -704
  bdwidth 237
  bdheight 931
 }
 BackdropNode {
  inputs 0
  name BackdropNode10
  label "Convert J component to linearised Iz component\nand apply inverse ACES SSTS\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -416
  ypos -388
  bdwidth 829
  bdheight 599
 }
 BackdropNode {
  inputs 0
  name BackdropNode11
  label "IzMh (ZCAM) to Output\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -413
  ypos 233
  bdwidth 822
  bdheight 269
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  label "Compress Colourfulness (M) to Target Gamut\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1364
  ypos -76
  bdwidth 577
  bdheight 299
 }
 BackdropNode {
  inputs 0
  name BackdropNode3
  label "Apply ACES SSTS to linearised Iz component\nand convert to J component"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1366
  ypos -703
  bdwidth 576
  bdheight 620
 }
 BackdropNode {
  inputs 0
  name BackdropNode4
  label "Input to IzMh (ZCAM)\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1366
  ypos -983
  bdwidth 822
  bdheight 269
 }
 BackdropNode {
  inputs 0
  name BackdropNode5
  label "JMh (ZCAM) to Output\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1363
  ypos 236
  bdwidth 822
  bdheight 269
 }
 BackdropNode {
  inputs 0
  name BackdropNode6
  label "Very handwavy attempt at basing \na highlight de-sat on tonescale"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -1750
  ypos -699
  bdwidth 364
  bdheight 908
 }
 BackdropNode {
  inputs 0
  name BackdropNode7
  label "Input to JMh (ZCAM)\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -417
  ypos -990
  bdwidth 822
  bdheight 269
 }
 BackdropNode {
  inputs 0
  name BackdropNode8
  label "Very handwavy attempt at basing \na highlight de-sat on tonescale"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos 432
  ypos -705
  bdwidth 462
  bdheight 913
 }
 BackdropNode {
  inputs 0
  name BackdropNode9
  label "Un-Compress Colourfulness (M) from Target Gamut\n"
  note_font "Bitstream Vera Sans"
  note_font_size 20
  xpos -416
  ypos -704
  bdwidth 822
  bdheight 299
 }
 Constant {
  inputs 0
  format "256 256 0 0 256 256 1 square_256"
  name Constant1
  xpos -693
  ypos -607
 }
 Reformat {
  type "to box"
  box_width {{Expression2.lookupResolution.y}}
  box_height {{Expression2.lookupResolution.x}}
  box_fixed true
  resize distort
  name Reformat1
  label "To Lookup Resolution"
  xpos -693
  ypos -535
 }
 Expression {
  temp_name0 vx
  temp_expr0 x/(input.width-1)
  temp_name1 vy
  temp_expr1 y/(input.height-1)
  expr0 vy
  expr1 vx
  expr2 1
  expr3 0
  name Expression1
  label "Generate Ramps"
  note_font "Bitstream Vera Sans"
  xpos -693
  ypos -497
 }
 Multiply {
  channels rgb
  value {{Expression2.lookupNormJ} {Expression2.lookupNormM} 1 1}
  name Multiply3
  label "Scale IzMh"
  xpos -693
  ypos -459
 }
 Group {
  name ZCAM_GamutBoundaryBlink1
  note_font "Bitstream Vera Sans"
  xpos -693
  ypos -421
  addUserKnob {20 User}
  addUserKnob {7 boundaryLuminance R 0 1000}
  boundaryLuminance {{parent.ssts_luminance.2}}
  addUserKnob {41 boundaryWhite T XYZ_to_RGB.illuminant_out}
  addUserKnob {41 boundaryGamut -STARTLINE T XYZ_to_RGB.primary_out}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  viewingConditions {{parent.ZCAM_JMh_Blink1.viewingConditions}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 275
   bdheight 249
  }
  Constant {
   inputs 0
   format "3 1 0 0 3 1 1 3x1px"
   name Constant1
   label "3x1 px"
   note_font "Bitstream Vera Sans"
   xpos 1138
   ypos 184
  }
  Expression {
   expr0 "x == 0 ? 1 : 0"
   expr1 "x == 1 ? 1 : 0"
   expr2 "x == 2 ? 1 : 0"
   name Expression1
   label "RGB pix"
   note_font "Bitstream Vera Sans"
   xpos 1138
   ypos 268
  }
  Colorspace {
   colorspace_in CIE-XYZ
   name XYZ_to_RGB
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 268
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N69b9a800 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 144
  }
set N69b9a400 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N69b9a400
  Colorspace {
   illuminant_in {{parent.parent.white}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N69b9a800
  BlinkScript {
   inputs 4
   recompileCount 90
   ProgramGroup 1
   KernelDescription "2 \"Gamut_Boundary_Kernel\" iterate pixelWise 1d613777f9e0e67c6d1ddfd0df86eb37910738072e0122d56fd6adb0aa37af1b 5 \"src\" Read Random \"refWhite\" Read Point \"d65White\" Read Point \"XYZtoRGB\" Read Random \"dst\" Write Random 11 \"boundaryLuminance\" Float 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"boundaryLuminance\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 8 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA== \"boundaryRGB\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel Gamut_Boundary_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessRandom, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eRead, eAccessRandom, eEdgeClamped> XYZtoRGB; // RGB values of X, Y & Z to sample matrix values from\n  Image<eWrite, eAccessRandom> dst; // the output image\n\n  param:\n    float boundaryLuminance;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n    float boundaryRGB;\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n    boundaryRGB = boundaryLuminance / referenceLuminance;\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_JMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 JMh = 0.0f;\n\n    JMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float Qz = 2700.0f * pow(Izazbz.x, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    JMh.x = 100.0f * (Qz / Qzw);\n    JMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return JMh;\n  \}\n\n\n  float3 JMh_to_Izazbz( float3 JMh, float refWhiteIz)\n  \{\n    float Qzm = pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * Qzm;\n    float Izp = pow(F_b, 0.12f) / (1.6f * F_s);\n    float Izd = 2700.0f * 100.0f * Qzm;\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float hzr = radians(JMh.z);\n    float Czp = pow((JMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( pow((JMh.x * Qzw) / Izd, Izp), Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 ZCAM_JMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(JMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process(int2 pos)\n  \{\n    // All the work will be done in the first pixel of each scanline.\n    if( pos.x != src.bounds.x1)\n    \{\n      return;\n    \}\n\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3x3 XYZ_to_RGB;\n    for( int x = 0; x < 3; x++)\n    \{\n      SampleType(XYZtoRGB) inputXYZtoRGB = XYZtoRGB(x,0);\n      XYZ_to_RGB\[0]\[x] = inputXYZtoRGB.x;\n      XYZ_to_RGB\[1]\[x] = inputXYZtoRGB.y;\n      XYZ_to_RGB\[2]\[x] = inputXYZtoRGB.z;\n    \}\n\n\n    int width = src.bounds.x2 - src.bounds.x1;\n\n    for( int x = src.bounds.x1; x < src.bounds.x2; x++)\n    \{\n      float J = 0.0f;\n      float maxM = 0.0f;\n      float h = float(x-src.bounds.x1)/float(width-1) * 360.0f;\n\n      for( int xx = src.bounds.x1; xx < src.bounds.x2; xx++)\n      \{\n        SampleType(src) input = src(xx, pos.y);\n        float3 JMh = float3(input.x, input.y, h);\n        J = JMh.x;\n        float3 XYZ = ZCAM_JMh_to_XYZ( JMh, float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z) );\n        // Luminance to Linear\n        XYZ = XYZ / referenceLuminance;\n        float3 RGB = vector_dot(XYZ_to_RGB, XYZ);\n\n        float minRGB = min(RGB.x, min(RGB.y, RGB.z));\n        float maxRGB = max(RGB.x, max(RGB.y, RGB.z));\n\n        if( minRGB >= 0.0f && maxRGB <= boundaryRGB )\n        \{\n          maxM = max(maxM, JMh.y);\n        \}\n      \}\n\n      float3 boundaryXYZ = ZCAM_JMh_to_XYZ( float3(J, maxM, h), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z) );\n      float3 boundaryRGB = vector_dot(XYZ_to_RGB, boundaryXYZ);\n\n      \n      \n      \n      dst(x, pos.y) = float4(boundaryRGB.x, boundaryRGB.y, boundaryRGB.z, maxM); \n    \}\n  \}\n\};\n"
   rebuild ""
   Gamut_Boundary_Kernel_boundaryLuminance {{parent.boundaryLuminance}}
   Gamut_Boundary_Kernel_referenceLuminance {{parent.referenceLuminance}}
   Gamut_Boundary_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   Gamut_Boundary_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   Gamut_Boundary_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   Gamut_Boundary_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   Gamut_Boundary_Kernel_F_L {{"0.171*pow(Gamut_Boundary_Kernel_L_A, 1/3) * (1-exp(-48/9*Gamut_Boundary_Kernel_L_A))"}}
   Gamut_Boundary_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : Gamut_Boundary_Kernel_F * (1 - (1 / 3.6) * exp((-Gamut_Boundary_Kernel_L_A - 42) / 92))"}}
   Gamut_Boundary_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   Gamut_Boundary_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   Gamut_Boundary_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   selected true
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Toe2 {
  channels alpha
  lift 1
  name Toe1
  label "avoid compressing M to zero\nto preserve invertibility\n"
  note_font "Bitstream Vera Sans"
  xpos -693
  ypos -397
 }
 Dot {
  name Dot23
  note_font "Bitstream Vera Sans"
  xpos -659
  ypos -211
 }
set N69b98c00 [stack 0]
 Dot {
  name Dot24
  note_font "Bitstream Vera Sans"
  xpos -484
  ypos -211
 }
 Dot {
  name Dot25
  note_font "Bitstream Vera Sans"
  xpos -484
  ypos -561
 }
 Input {
  inputs 0
  name Input
  xpos -516
  ypos -1216
 }
 Dot {
  name Dot15
  note_font "Bitstream Vera Sans"
  xpos -482
  ypos -1035
 }
set N69b43800 [stack 0]
 Dot {
  name Dot17
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos -1035
 }
 Colorspace {
  colorspace_in {{Colorspace3.colorspace_out}}
  illuminant_in {{Colorspace3.illuminant_out}}
  primary_in {{Colorspace3.primary_out}}
  colorspace_out CIE-XYZ
  name Colorspace2
  label "XYZ to Output\ninverse"
  xpos 120
  ypos -896
 }
 Multiply {
  channels rgb
  value 100
  name Multiply13
  label "Lum to Linear\ninverse"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos -854
  disable {{Colorspace2.colorspace_in==31}}
 }
 Group {
  name ZCAM_JMh_Blink2
  label "JMh to XYZ\ninverse"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos -806
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  viewingConditions {{ZCAM_JMh_Blink1.viewingConditions}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {6 invert +STARTLINE}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 146
   bdheight 250
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N69b42400 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   selected true
   xpos 1015
   ypos 144
  }
set N69b42000 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N69b42000
  Colorspace {
   illuminant_in {{parent.parent.white}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N69b42400
  BlinkScript {
   inputs 3
   recompileCount 66
   ProgramGroup 1
   KernelDescription "2 \"ZCAM_JMh_Kernel\" iterate pixelWise ac1327942f16c15a4b75f54f652a97dc0f54381ec18fc95d13cdfae2cd779b6b 4 \"src\" Read Point \"refWhite\" Read Point \"d65White\" Read Point \"dst\" Write Point 11 \"direction\" Int 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"direction\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 7 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel ZCAM_JMh_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eWrite> dst; // the output image\n\n  param:\n    int direction;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_JMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 JMh = 0.0f;\n\n    JMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float Qz = 2700.0f * pow(Izazbz.x, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    JMh.x = 100.0f * (Qz / Qzw);\n    JMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return JMh;\n  \}\n\n\n  float3 JMh_to_Izazbz( float3 JMh, float refWhiteIz)\n  \{\n    float Qzm = pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * Qzm;\n    float Izp = pow(F_b, 0.12f) / (1.6f * F_s);\n    float Izd = 2700.0f * 100.0f * Qzm;\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float hzr = radians(JMh.z);\n    float Czp = pow((JMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( pow((JMh.x * Qzw) / Izd, Izp), Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 XYZ_to_ZCAM_JMh( float3 XYZ, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return Izazbz_to_JMh(XYZ_to_Izazbz(CAT_Zhai2018(XYZ, refWhite, d65White, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS)), refWhiteIzazbz.x);\n  \}\n\n\n  float3 ZCAM_JMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(JMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3 output = 0.0f;\n\n    if( direction == 0 )\n    \{\n      output = XYZ_to_ZCAM_JMh(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n    else\n    \{\n       output = ZCAM_JMh_to_XYZ(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n\n    dst() = float4(output.x, output.y, output.z, input.w);\n  \}\n\};\n"
   rebuild ""
   ZCAM_JMh_Kernel_direction {{parent.invert}}
   ZCAM_JMh_Kernel_referenceLuminance {{parent.referenceLuminance}}
   ZCAM_JMh_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   ZCAM_JMh_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   ZCAM_JMh_Kernel_F_L {{"0.171*pow(ZCAM_JMh_Kernel_L_A, 1/3) * (1-exp(-48/9*ZCAM_JMh_Kernel_L_A))"}}
   ZCAM_JMh_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : ZCAM_JMh_Kernel_F * (1 - (1 / 3.6) * exp((-ZCAM_JMh_Kernel_L_A - 42) / 92))"}}
   ZCAM_JMh_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   ZCAM_JMh_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   ZCAM_JMh_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Dot {
  name Dot19
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos -634
 }
set N69b40c00 [stack 0]
 Dot {
  name Dot20
  note_font "Bitstream Vera Sans"
  xpos -70
  ypos -634
 }
set N69b40800 [stack 0]
 Dot {
  name Dot21
  note_font "Bitstream Vera Sans"
  xpos -209
  ypos -634
 }
 Expression {
  temp_name0 posX
  temp_expr0 b/360*(lookupResolution.z-1)
  temp_name1 posY
  temp_expr1 r/lookupNormJ*(lookupResolution.x-1)
  temp_name2 fractX
  temp_expr2 posX-floor(posX)
  temp_name3 fractY
  temp_expr3 posY-floor(posY)
  expr0 posX
  expr1 fractX
  expr2 posY
  expr3 fractY
  name Expression3
  label "calculate lookup coordinates"
  note_font "Bitstream Vera Sans"
  xpos -243
  ypos -609
  addUserKnob {20 User}
  addUserKnob {13 lookupResolution}
  lookupResolution {{parent.lut_size_Iz} {parent.lut_size_m} {parent.lut_size_h}}
  addUserKnob {7 lookupNormJ R 0 500}
  lookupNormJ {{pow(log(parent.ssts_luminance.2)/log(2),1.7)*4.5}}
  addUserKnob {7 lookupNormM R 0 200}
  lookupNormM 80
 }
 MergeExpression {
  inputs 2
  temp_name0 blPix
  temp_expr0 Aa(floor(Br),floor(Bb))
  temp_name1 brPix
  temp_expr1 Aa(ceil(Br),floor(Bb))
  temp_name2 trPix
  temp_expr2 Aa(ceil(Br),ceil(Bb))
  temp_name3 tlPix
  temp_expr3 Aa(floor(Br),ceil(Bb))
  channel0 none
  expr1 "lerp( lerp(blPix, brPix, Bg), lerp(tlPix, trPix, Bg), Ba)"
  channel2 none
  channel3 none
  name MergeExpression3
  label "Bilinear Interploation"
  xpos -243
  ypos -568
 }
set N69aeb800 [stack 0]
 Dot {
  name Dot22
  note_font "Bitstream Vera Sans"
  xpos -209
  ypos -483
 }
push $N69b40800
push $N69aeb800
 Merge2 {
  inputs 2
  operation divide
  name Merge7
  xpos -104
  ypos -564
 }
 Expression {
  expr0 (r<thr.r||lim.r<1.0001||r>thr.r+s.r)?r:thr.r+s.r*pow(-(pow((r-thr.r)/s.r,p)/(pow((r-thr.r)/s.r,p)-1)),1/p)
  expr1 (g<thr.g||lim.g<1.0001||g>thr.g+s.g)?g:thr.g+s.g*pow(-(pow((g-thr.g)/s.g,p)/(pow((g-thr.g)/s.g,p)-1)),1/p)
  expr2 (b<thr.b||lim.b<1.0001||b>thr.b+s.b)?b:thr.b+s.b*pow(-(pow((b-thr.b)/s.b,p)/(pow((b-thr.b)/s.b,p)-1)),1/p)
  name UnCompress1
  label Power(P)
  xpos -104
  ypos -529
  addUserKnob {20 Params_tab l Params}
  addUserKnob {18 thr}
  thr {{parent.compression.0}}
  addUserKnob {6 thr_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 lim}
  lim {{parent.compression.1}}
  addUserKnob {6 lim_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 s}
  s {{(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)} {(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)} {(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)}}
  addUserKnob {6 s_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 p R 1 5}
  p {{parent.compression.2}}
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge8
  xpos -104
  ypos -486
 }
push $N69b40c00
 ShuffleCopy {
  inputs 2
  green green
  alpha alpha2
  name ShuffleCopy3
  label "Apply Compressed\nColourfulness (M)"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos -498
 }
 Dot {
  name Dot37
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos -363
 }
set N69aea000 [stack 0]
 Group {
  name Group2
  label "Re-Generate Iz\nfrom J"
  xpos -47
  ypos -375
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite -STARTLINE T Colorspace2.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 10000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 200}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {20 Factors}
  addUserKnob {7 F}
  F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
  addUserKnob {7 F_s}
  F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
  addUserKnob {7 L_A}
  L_A {{"referenceLuminance * backgroundLuminance / 100"}}
  addUserKnob {7 F_b}
  F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
  addUserKnob {7 F_L}
  F_L {{"0.171*pow(L_A, 1/3) * (1-exp(-48/9*L_A))"}}
 }
  BackdropNode {
   inputs 0
   name BackdropNode7
   tile_color 0x666666ff
   label "Reference White"
   note_font_size 20
   xpos 27
   ypos -149
   bdwidth 177
   bdheight 144
  }
  Input {
   inputs 0
   name Input
   xpos -66
   ypos -264
  }
  Dot {
   name Dot1
   xpos -32
   ypos -184
  }
set N69ae9800 [stack 0]
  Dot {
   name Dot11
   xpos 114
   ypos -184
  }
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   xpos 80
   ypos -112
  }
  Colorspace {
   illuminant_in {{parent.parent.illuminant_in}}
   colorspace_out CIE-XYZ
   name Colorspace2
   xpos 80
   ypos -76
  }
  Expression {
   temp_name0 gain
   temp_expr0 parent.referenceLuminance/g
   expr0 r*gain
   expr1 g*gain
   expr2 b*gain
   name Expression0
   xpos 80
   ypos -50
  }
  Group {
   name XYZ_w_to_Izazbz
   xpos 80
   ypos -26
  }
   Input {
    inputs 0
    name Input1
    xpos 148
    ypos 197
   }
   Expression {
    temp_name0 cb
    temp_expr0 1.15
    temp_name1 cg
    temp_expr1 0.66
    expr0 "(cb*r) - ((cb-1)*b)"
    expr1 "(cg*g) - ((cg-1)*r)"
    expr2 b
    name Expression1
    label "XYZ (D65)\nto\nX'Y'Z (D65)"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 237
   }
   ColorMatrix {
    matrix {
        {0.41478972 0.579999 0.014648}
        {-0.20151 1.120649 0.0531008}
        {-0.0166008 0.2648 0.6684799}
      }
    name ColorMatrix1
    label "X'Y'Z (D65)\nto\nLMS"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 297
   }
   Expression {
    temp_name0 c1
    temp_expr0 "3424 / pow(2,12)"
    temp_name1 c2
    temp_expr1 "2413 / pow(2,7)"
    temp_name2 c3
    temp_expr2 "2392 / pow(2,7)"
    temp_name3 n
    temp_expr3 2610/pow(2,14)
    expr0 "pow( ( c1 + c2 * pow((r/10000),n) ) / ( 1 + c3 * pow((r/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    expr1 "pow( ( c1 + c2 * pow((g/10000),n) ) / ( 1 + c3 * pow((g/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    expr2 "pow( ( c1 + c2 * pow((b/10000),n) ) / ( 1 + c3 * pow((b/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    name Expression2
    label "LMS\nto\nL'M'S'"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 357
   }
   ColorMatrix {
    matrix {
        {0 {1-epsilon} 0}
        {3.524 -4.066708 0.542708}
        {0.199076 1.096799 -1.295875}
      }
    name ColorMatrix2
    label "L'M'S\nto\nIzazbz"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 417
    addUserKnob {20 User}
    addUserKnob {7 epsilon}
    epsilon 3.703522621e-11
   }
   Output {
    name Output1
    xpos 148
    ypos 517
   }
  end_group
  Dot {
   name Dot2
   xpos 114
   ypos 53
  }
push $N69ae9800
  MergeExpression {
   inputs 2
   temp_name0 Qzm
   temp_expr0 "pow(parent.F_s, 2.2) * pow(parent.F_b, 0.5) * pow(parent.F_L, 0.2)"
   temp_name1 Qzw
   temp_expr1 "2700 * pow(Ar, (1.6 * parent.F_s) / pow(parent.F_b, 0.12)) * Qzm"
   temp_name2 Izp
   temp_expr2 "pow(parent.F_b, 0.12) / (1.6 * parent.F_s)"
   temp_name3 Izd
   temp_expr3 "2700 * 100 * Qzm"
   expr0 "pow((r * Qzw) / Izd, Izp)"
   channel1 none
   channel2 none
   channel3 none
   name MergeExpression3
   selected true
   xpos -66
   ypos 50
  }
  Output {
   name Output
   xpos -66
   ypos 117
  }
 end_group
 Dot {
  name Dot9
  note_font "Bitstream Vera Sans"
  xpos -13
  ypos -324
 }
set N69a6dc00 [stack 0]
 Group {
  name st2048_6
  label "Lum to PQ (ZCAM)\ninverse"
  xpos -47
  ypos -288
  addUserKnob {20 User}
  addUserKnob {4 direction M {"Luminance (Cd/sqm) -> ST.2048" "ST.2048 -> Luminance (Cd/sqm)"}}
  direction "ST.2048 -> Luminance (Cd/sqm)"
  addUserKnob {7 peakLuminance R 0 10000}
  peakLuminance 10000
  addUserKnob {26 ""}
  addUserKnob {26 m2_override_desc l "" +STARTLINE T "ZCAM uses a different exponent (rho) in its PQ function than ST.2084 (m2)"}
  addUserKnob {7 m2_override R 0 200}
  m2_override {{"1.7 * 2523 / pow(2,5)"}}
 }
  Input {
   inputs 0
   name Input1
   xpos 829
   ypos 200
  }
  Dot {
   name Dot17
   xpos 863
   ypos 240
  }
set N69a6d400 [stack 0]
  Dot {
   name Dot27
   xpos 916
   ypos 240
  }
  Expression {
   temp_name0 V_pr
   temp_expr0 "pow(r, 1/m_2)"
   temp_name1 V_pg
   temp_expr1 "pow(g, 1/m_2)"
   temp_name2 V_pb
   temp_expr2 "pow(b, 1/m_2)"
   expr0 "pow((max(0.0, V_pr - c_1) / (c_2 - c_3 * V_pr)), 1/m_1)*L_p"
   expr1 "pow((max(0.0, V_pg - c_1) / (c_2 - c_3 * V_pg)), 1/m_1)*L_p"
   expr2 "pow((max(0.0, V_pb - c_1) / (c_2 - c_3 * V_pb)), 1/m_1)*L_p"
   channel3 none
   name from_st2048
   selected true
   xpos 882
   ypos 285
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
push $N69a6d400
  Dot {
   name Dot26
   xpos 810
   ypos 240
  }
  Expression {
   temp_name0 Y_pr
   temp_expr0 "pow(r / L_p, m_1)"
   temp_name1 Y_pg
   temp_expr1 "pow(g / L_p, m_1)"
   temp_name2 Y_pb
   temp_expr2 "pow(b / L_p, m_1)"
   expr0 "pow((c_1 + c_2 * Y_pr) / (c_3 * Y_pr + 1), m_2)"
   expr1 "pow((c_1 + c_2 * Y_pg) / (c_3 * Y_pg + 1), m_2)"
   expr2 "pow((c_1 + c_2 * Y_pb) / (c_3 * Y_pb + 1), m_2)"
   channel3 none
   name to_st2084
   xpos 776
   ypos 286
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   xpos 835
   ypos 347
  }
  Output {
   name Output1
   xpos 835
   ypos 447
  }
 end_group
 Multiply {
  channels rgb
  value 1.028552621
  name Multiply16
  label "re-apply luminance shift\nfrom cone fundamentals matrix\ninverse"
  note_font "Bitstream Vera Sans"
  xpos -47
  ypos -246
 }
set N6a60b800 [stack 0]
 BlinkScript {
  recompileCount 35
  ProgramGroup 1
  KernelDescription "2 \"SSTSKernel\" iterate pixelWise 3292521f65973146de9ba2803e15c81b8610684f8dcbef3a3fc1382de44823f8 2 \"src\" Read Point \"dst\" Write Point 8 \"lumMid\" Float 1 AAAAAA== \"defaultMin\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"defaultMid\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"defaultMax\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"coefsLow\" Float 6 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA= \"coefsHigh\" Float 6 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA= \"M1\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"inverse\" Int 1 AAAAAA== 8 \"lumMid\" 1 1 \"defaultMin\" 3 1 \"defaultMid\" 3 1 \"defaultMax\" 3 1 \"coefsLow\" 1 6 \"coefsHigh\" 1 6 \"M1\" 9 1 \"inverse\" 1 1 4 \"expShift\" Float 1 1 AAAAAA== \"paramMin\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA== \"paramMid\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA== \"paramMax\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA=="
  kernelSource "kernel SSTSKernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eWrite> dst; // the output image\n\n  param:\n    float lumMid;\n    float3 defaultMin;\n    float3 defaultMid;\n    float3 defaultMax;\n    float coefsLow\[6];\n    float coefsHigh\[6];\n    float3x3 M1;\n    int inverse;\n\n  local:\n    float expShift;\n    float3 paramMin;\n    float3 paramMid;\n    float3 paramMax;\n\n  \n  void define()\n  \{\n\n  \}\n\n  float3 vector_dot( float3 v, float3x3 m)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float dot( float3 a, float3 b)\n  \{\n    return (a.x*b.x) + (a.y*b.y) + (a.z*b.z);\n  \}\n\n  \n  float ssts(float x, float3 minPt, float3 midPt, float3 maxPt)\n  \{\n    float HALF_MIN = 0.0000000596046448;\n\n    // Check for negatives or zero before taking the log. If negative or zero,\n    // set to HALF_MIN.\n    float logx = log10( max(x, HALF_MIN )); \n\n    float logy;\n\n    if( logx <= log10(minPt.x) )\n    \{ \n        logy = logx * minPt.z + ( log10(minPt.y) - minPt.z * log10(minPt.x) );\n    \}\n    else if(( logx > log10(minPt.x) ) && ( logx < log10(midPt.x) ))\n    \{\n        float knot_coord = 3.0f * (logx-log10(minPt.x)) / (log10(midPt.x) - log10(minPt.x));\n        int j = knot_coord;\n        float t = knot_coord - float(j);\n        float3 cf(coefsLow\[j], coefsLow\[j + 1], coefsLow\[j + 2]);\n        float3 monomials( t * t, t, 1.0f );\n        logy = dot(monomials, vector_dot( cf, M1));\n    \}\n    else if(( logx >= log10(midPt.x) ) && ( logx < log10(maxPt.x) ))\n    \{\n        float knot_coord = 3.0f * (logx-log10(midPt.x)) / (log10(maxPt.x) - log10(midPt.x));\n        int j = knot_coord;\n        float t = knot_coord - float(j);\n        float3 cf(coefsHigh\[j], coefsHigh\[j + 1], coefsHigh\[j + 2]); \n        float3 monomials(t * t, t, 1.0f);\n        logy = dot(monomials, vector_dot( cf, M1));\n    \}\n    else\n    \{\n        logy = logx * maxPt.z + ( log10(maxPt.y) - maxPt.z * log10(maxPt.x) );\n    \}\n\n    return pow(10.0f,logy);\n  \}\n\n  \n  float inv_ssts(float y, float3 minPt, float3 midPt, float3 maxPt)\n  \{\n    float KNOT_INC_LOW  = (log10(midPt.x) - log10(minPt.x)) / 3.0f;\n    float KNOT_INC_HIGH = (log10(maxPt.x) - log10(midPt.x)) / 3.0f;\n\n    // KNOT_Y is luminance of the spline at each knot\n    float KNOT_Y_LOW\[4];\n\n   for( int i = 0; i < 4; i++ )\n    \{\n      KNOT_Y_LOW\[i] = ( coefsLow\[i] + coefsLow\[i+1]) / 2.0f;\n    \};\n\n    float KNOT_Y_HIGH\[ 4];\n\n    for( int i = 0; i < 4; i++ )\n    \{\n      KNOT_Y_HIGH\[i] = ( coefsHigh\[i] + coefsHigh\[i+1]) / 2.0f;\n    \};\n\n    float logy = log10( max(y, 0.0000000001f));\n\n    float logx;\n\n    if( logy <= log10(minPt.y) )\n    \{\n        logx = log10(minPt.x);\n\n    \}\n    else if( (logy > log10(minPt.y)) && (logy <= log10(midPt.y)) )\n    \{\n        int j;\n        float3 cf = 0.0f;\n\n        if( logy > KNOT_Y_LOW\[0] && logy <= KNOT_Y_LOW\[1])\n        \{\n          cf.x = coefsLow\[0];\n          cf.y = coefsLow\[1];\n          cf.z = coefsLow\[2];\n          j = 0;\n        \}\n        else if( logy > KNOT_Y_LOW\[1] && logy <= KNOT_Y_LOW\[2])\n        \{\n          cf.x = coefsLow\[1];\n          cf.y = coefsLow\[2];\n          cf.z = coefsLow\[3];\n          j = 1;\n        \}\n        else if( logy > KNOT_Y_LOW\[2] && logy <= KNOT_Y_LOW\[3])\n        \{\n          cf.x = coefsLow\[2];\n          cf.y = coefsLow\[3];\n          cf.z = coefsLow\[4];\n          j = 2;\n        \} \n\n        float3 tmp = vector_dot( cf, M1 );\n\n        float a = tmp.x;\n        float b = tmp.y;\n        float c = tmp.z;\n        c = c - logy;\n\n        float d = sqrt( b * b - 4.0f * a * c);\n\n        float t = ( 2.0f * c) / ( -d - b);\n\n        logx = log10(minPt.x) + ( t + j) * KNOT_INC_LOW;\n\n    \}\n    else if( (logy > log10(midPt.y)) && (logy < log10(maxPt.y)) )\n    \{\n        int j;\n        float3 cf = 0.0f;\n\n        if( logy >= KNOT_Y_HIGH\[0] && logy <= KNOT_Y_HIGH\[1])\n        \{\n          cf.x = coefsHigh\[0];\n          cf.y = coefsHigh\[1];\n          cf.z = coefsHigh\[2];\n          j = 0;\n        \}\n        else if( logy > KNOT_Y_HIGH\[1] && logy <= KNOT_Y_HIGH\[2])\n        \{\n          cf.x = coefsHigh\[1];\n          cf.y = coefsHigh\[2];\n          cf.z = coefsHigh\[3];\n          j = 1;\n        \}\n        else if( logy > KNOT_Y_HIGH\[2] && logy <= KNOT_Y_HIGH\[3])\n        \{\n          cf.x = coefsHigh\[2];\n          cf.y = coefsHigh\[3];\n          cf.z = coefsHigh\[4];\n          j = 2;\n        \} \n\n        float3 tmp = vector_dot( cf, M1);\n\n        float a = tmp.x;\n        float b = tmp.y;\n        float c = tmp.z;\n        c = c - logy;\n\n        float d = sqrt( b * b - 4.0f * a * c);\n\n        float t = ( 2.0f * c) / ( -d - b);\n\n        logx = log10(midPt.x) + ( t + j) * KNOT_INC_HIGH;\n\n    \}\n    else\n    \{\n        logx = log10(maxPt.x);\n\n    \}\n\n    return pow(10.0f, logx);\n  \}\n\n\n  void init()\n  \{\n    paramMin = defaultMin;\n    paramMid = defaultMid;\n    paramMax = defaultMax;\n    expShift = log2(inv_ssts(lumMid, defaultMin, paramMid, defaultMax)) - log2(0.18f);\n    paramMin.x = pow(2.0f, (log(paramMin.x) / log(2.0f) - expShift));\n    paramMid.x = pow(2.0f, (log(0.18f     ) / log(2.0f) - expShift));\n    paramMax.x = pow(2.0f, (log(paramMax.x) / log(2.0f) - expShift));\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    float3 srcPixel(input.x, input.y, input.z);\n    float3 tsPixel = 0.0f;\n\n    if( inverse )\n    \{\n      tsPixel.x = inv_ssts(srcPixel.x, paramMin, paramMid, paramMax);\n      tsPixel.y = inv_ssts(srcPixel.y, paramMin, paramMid, paramMax);\n      tsPixel.z = inv_ssts(srcPixel.z, paramMin, paramMid, paramMax);\n    \}\n    else\n    \{\n      tsPixel.x = ssts(srcPixel.x, paramMin, paramMid, paramMax);\n      tsPixel.y = ssts(srcPixel.y, paramMin, paramMid, paramMax);\n      tsPixel.z = ssts(srcPixel.z, paramMin, paramMid, paramMax);\n    \}\n\n    dst() = float4(tsPixel.x, tsPixel.y, tsPixel.z, input.w);\n  \}\n\};\n"
  rebuild ""
  SSTSKernel_lumMid {{luminances.y}}
  SSTSKernel_defaultMin {{pow(2.,(log(MIN_PT.x)/log(2)))} {MIN_PT.y} {MIN_PT.z}}
  SSTSKernel_defaultMid {{pow(2.,(log(0.18)/log(2)))} {MID_PT.y} {MID_PT.z}}
  SSTSKernel_defaultMax {{pow(2.,(log(MAX_PT.x)/log(2)))} {MAX_PT.y} {MAX_PT.z}}
  SSTSKernel_coefsLow {{"(MIN_PT.z * (log10(MIN_PT.x)-0.5*knotIncLow)) + ( log10(MIN_PT.y) - MIN_PT.z * log10(MIN_PT.x))"} {"(MIN_PT.z * (log10(MIN_PT.x)+0.5*knotIncLow)) + ( log10(MIN_PT.y) - MIN_PT.z * log10(MIN_PT.x))"} {"log10(MIN_PT.y) + pctLow*(log10(MID_PT.y)-log10(MIN_PT.y))"} {"(MID_PT.z * (log10(MID_PT.x)-0.5*knotIncLow)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"(MID_PT.z * (log10(MID_PT.x)+0.5*knotIncLow)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {SSTSKernel_coefsLow.4}}
  SSTSKernel_coefsHigh {{"(MID_PT.z * (log10(MID_PT.x)-0.5*knotIncHigh)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"(MID_PT.z * (log10(MID_PT.x)+0.5*knotIncHigh)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"log10(MID_PT.y) + pctHigh*(log10(MAX_PT.y)-log10(MID_PT.y))"} {"(MAX_PT.z * (log10(MAX_PT.x)-0.5*knotIncHigh)) + ( log10(MAX_PT.y) - MAX_PT.z * log10(MAX_PT.x))"} {"(MAX_PT.z * (log10(MAX_PT.x)+0.5*knotIncHigh)) + ( log10(MAX_PT.y) - MAX_PT.z * log10(MAX_PT.x))"} {SSTSKernel_coefsHigh.4}}
  SSTSKernel_M1 {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  SSTSKernel_inverse {{direction}}
  rebuild_finalise ""
  name SSTS_Blink3
  label inverse
  note_font "Bitstream Vera Sans"
  xpos -47
  ypos -186
  addUserKnob {20 User}
  addUserKnob {13 luminances}
  luminances {{parent.ssts_luminance.0} {parent.ssts_luminance.1} {parent.ssts_luminance.2}}
  addUserKnob {4 direction M {forward inverse}}
  direction inverse
  addUserKnob {20 SSTSParams}
  addUserKnob {13 MIN_PT}
  MIN_PT {{0.18*pow(2,minTable(log10(luminances.x)))} {luminances.x} 0}
  addUserKnob {13 MID_PT}
  MID_PT {0.18 4.8 1.55}
  addUserKnob {13 MAX_PT}
  MAX_PT {{0.18*pow(2,maxTable(log10(luminances.z)))} {luminances.z} 0}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(MID_PT.x) - log10(MIN_PT.x)) / 3"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(MAX_PT.x) - log10(MID_PT.x)) / 3"}}
  addUserKnob {7 pctLow}
  pctLow {{bendsLow(log(MIN_PT.x/0.18)/log(2))}}
  addUserKnob {7 pctHigh}
  pctHigh {{bendsHigh(log(MAX_PT.x/0.18)/log(2))}}
  addUserKnob {20 Tables}
  addUserKnob {7 minTable}
  minTable {{curve L l x-4 -15 x-1.69896996 -6.5}}
  addUserKnob {7 maxTable}
  maxTable {{curve L l x1.681241274 6.5 x4 18}}
  addUserKnob {7 bendsLow}
  bendsLow {{curve L l x-15 0.18 x-6.5 0.35}}
  addUserKnob {7 bendsHigh}
  bendsHigh {{curve l x6.5 0.89 x18 0.9}}
  addUserKnob {20 Constants}
  addUserKnob {7 MIN_STOP_SDR R -10 10}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -10 10}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 200}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
 }
 Multiply {
  channels rgb
  value {{parent.reference_luminance}}
  name Multiply15
  label "1/\[value parent.reference_luminance]\nLum to Exp\ninverse"
  note_font "Bitstream Vera Sans"
  xpos -47
  ypos -138
 }
 Multiply {
  channels rgb
  value 0.9722396415
  name Multiply14
  label "remove luminance shift\nfrom cone fundamentals matrix\ninverse"
  note_font "Bitstream Vera Sans"
  xpos -47
  ypos -78
 }
 Group {
  name st2048_5
  label "PQ (ZCAM) to Lum\ninverse"
  xpos -47
  ypos -18
  addUserKnob {20 User}
  addUserKnob {4 direction M {"Luminance (Cd/sqm) -> ST.2048" "ST.2048 -> Luminance (Cd/sqm)"}}
  addUserKnob {7 peakLuminance R 0 10000}
  peakLuminance 10000
  addUserKnob {26 ""}
  addUserKnob {26 m2_override_desc l "" +STARTLINE T "ZCAM uses a different exponent (rho) in its PQ function than ST.2084 (m2)"}
  addUserKnob {7 m2_override R 0 200}
  m2_override {{"1.7 * 2523 / pow(2,5)"}}
 }
  Input {
   inputs 0
   name Input1
   xpos 829
   ypos 200
  }
  Dot {
   name Dot17
   xpos 863
   ypos 240
  }
set N6a60a400 [stack 0]
  Dot {
   name Dot27
   xpos 916
   ypos 240
  }
  Expression {
   temp_name0 V_pr
   temp_expr0 "pow(r, 1/m_2)"
   temp_name1 V_pg
   temp_expr1 "pow(g, 1/m_2)"
   temp_name2 V_pb
   temp_expr2 "pow(b, 1/m_2)"
   expr0 "pow((max(0.0, V_pr - c_1) / (c_2 - c_3 * V_pr)), 1/m_1)*L_p"
   expr1 "pow((max(0.0, V_pg - c_1) / (c_2 - c_3 * V_pg)), 1/m_1)*L_p"
   expr2 "pow((max(0.0, V_pb - c_1) / (c_2 - c_3 * V_pb)), 1/m_1)*L_p"
   channel3 none
   name from_st2048
   selected true
   xpos 882
   ypos 285
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
push $N6a60a400
  Dot {
   name Dot26
   xpos 810
   ypos 240
  }
  Expression {
   temp_name0 Y_pr
   temp_expr0 "pow(r / L_p, m_1)"
   temp_name1 Y_pg
   temp_expr1 "pow(g / L_p, m_1)"
   temp_name2 Y_pb
   temp_expr2 "pow(b / L_p, m_1)"
   expr0 "pow((c_1 + c_2 * Y_pr) / (c_3 * Y_pr + 1), m_2)"
   expr1 "pow((c_1 + c_2 * Y_pg) / (c_3 * Y_pg + 1), m_2)"
   expr2 "pow((c_1 + c_2 * Y_pb) / (c_3 * Y_pb + 1), m_2)"
   channel3 none
   name to_st2084
   xpos 776
   ypos 286
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   xpos 835
   ypos 347
  }
  Output {
   name Output1
   xpos 835
   ypos 447
  }
 end_group
push $N69aea000
 ShuffleCopy {
  inputs 2
  red red
  alpha alpha2
  name ShuffleCopy4
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos -9
 }
 Dot {
  name Dot38
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos 36
 }
set N6a608800 [stack 0]
push $N6a60b800
 Add {
  channels rgb
  value {{-parent.ssts_luminance.1}}
  name Add2
  label "mids to zero"
  note_font "Bitstream Vera Sans"
  xpos 520
  ypos -234
 }
 Multiply {
  channels rgb
  value {{1/parent.ssts_luminance.1}}
  name Multiply20
  label "1/\[value parent.ssts_luminance.1]\nnormalise mids"
  note_font "Bitstream Vera Sans"
  xpos 520
  ypos -196
 }
 Clamp {
  channels rgb
  name Clamp3
  label 0-1
  note_font "Bitstream Vera Sans"
  xpos 520
  ypos -146
 }
push $N6a608800
 Dot {
  name Dot6
  note_font "Bitstream Vera Sans"
  xpos 477
  ypos 36
 }
 Dot {
  name Dot36
  note_font "Bitstream Vera Sans"
  xpos 477
  ypos -597
 }
 Dot {
  name Dot32
  note_font "Bitstream Vera Sans"
  xpos 782
  ypos -597
 }
push $N69a6dc00
 Dot {
  name Dot10
  note_font "Bitstream Vera Sans"
  xpos 638
  ypos -324
 }
 Dot {
  name Dot12
  note_font "Bitstream Vera Sans"
  xpos 638
  ypos -173
 }
 Merge2 {
  inputs 2
  operation minus
  name Merge9
  label "diff tonescale"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos -182
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge10
  label "remove toe"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos -146
 }
 Multiply {
  channels rgb
  value {{parent.desatHighlights}}
  name Multiply22
  label "desat scale"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos -106
 }
 Group {
  name SoftclipExpression1
  label "avoid divide by zero"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos -33
  addUserKnob {20 User}
  addUserKnob {18 clip_to}
  clip_to 0.9
  addUserKnob {6 clip_to_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 clip_to_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 clip_to_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 threshold}
  threshold 0.8
  addUserKnob {6 threshold_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {7 mix}
  mix 1
 }
  Input {
   inputs 0
   name Input1
   xpos -284
   ypos 135
  }
  Multiply {
   value {{1/parent.clip_to.r} {1/parent.clip_to.g} {1/parent.clip_to.b} 1}
   name Multiply1
   note_font "Bitstream Vera Sans"
   xpos -284
   ypos 159
  }
set N6a599000 [stack 0]
  Expression {
   temp_name0 one_minus_e
   temp_expr0 "1 - pow(10,-15)"
   temp_name1 maxr
   temp_expr1 "(pow(threshold.r, 2) - 2 * threshold.r * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   temp_name2 maxg
   temp_expr2 "(pow(threshold.g, 2) - 2 * threshold.g * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   temp_name3 maxb
   temp_expr3 "(pow(threshold.b, 2) - 2 * threshold.b * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   expr0 " threshold.r < 1 ? r >= 1 ? maxr : r > threshold.r ? (pow(threshold.r, 2) - 2 * threshold.r * r + r ) / ( 1 - r ) : r : r"
   expr1 " threshold.g < 1 ? g >= 1 ? maxg : g > threshold.g ? (pow(threshold.g, 2) - 2 * threshold.g * g + g ) / ( 1 - g ) : g : g"
   expr2 " threshold.b < 1 ? b >= 1 ? maxb : b > threshold.b ? (pow(threshold.b, 2) - 2 * threshold.b * b + b ) / ( 1 - b ) : b : b"
   expr3 a
   mix {{parent.mix}}
   name Expression2
   label inverse
   xpos -222
   ypos 257
   addUserKnob {20 User}
   addUserKnob {18 threshold}
   threshold {{parent.threshold.r} {parent.threshold.g} {parent.threshold.b}}
   addUserKnob {6 threshold_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  }
push $N6a599000
  Expression {
   expr0 "threshold.r < 1 ? r > threshold.r ? ( -1 / (( r - threshold.r ) / ( 1 - threshold.r ) +1 ) +1 ) * ( 1 - threshold.r ) + threshold.r : r : r"
   expr1 "threshold.g < 1 ? g > threshold.g ? ( -1 / (( g - threshold.g ) / ( 1 - threshold.g ) +1 ) +1 ) * ( 1 - threshold.g ) + threshold.g : g : g"
   expr2 "threshold.b < 1 ? b > threshold.b ? ( -1 / (( b - threshold.b ) / ( 1 - threshold.b ) +1 ) +1 ) * ( 1 - threshold.b ) + threshold.b : b : b"
   expr3 a
   mix {{parent.mix}}
   name Expression1
   label forward
   xpos -349
   ypos 258
   addUserKnob {20 User}
   addUserKnob {18 threshold_1 l threshold}
   threshold_1 {{parent.threshold.r} {parent.threshold.g} {parent.threshold.b}}
   addUserKnob {6 threshold_1_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   note_font "Bitstream Vera Sans"
   xpos -287
   ypos 356
  }
  Multiply {
   value {{parent.clip_to.r} {parent.clip_to.g} {parent.clip_to.b} 1}
   name Multiply2
   note_font "Bitstream Vera Sans"
   xpos -287
   ypos 380
  }
  Output {
   name Output1
   xpos -287
   ypos 463
  }
 end_group
 Invert {
  channels rgb
  name Invert2
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos 8
 }
 Shuffle {
  red white
  green red
  blue white
  alpha white
  name Shuffle1
  label "\[value in]-->\[value out]"
  note_font "Bitstream Vera Sans"
  xpos 748
  ypos 32
 }
 Dot {
  name Dot39
  note_font "Bitstream Vera Sans"
  xpos 782
  ypos 166
 }
 Merge2 {
  inputs 2
  operation divide
  name Merge12
  label "highlight de-sat\ninverse"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos 151
 }
 Group {
  name ZCAM_IzMh_Blink2
  label "XYZ to IzMh\ninverse"
  note_font "Bitstream Vera Sans"
  xpos 120
  ypos 325
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {6 invert +STARTLINE}
  invert true
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 146
   bdheight 250
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N6a532400 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 144
  }
set N6a532000 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N6a532000
  Colorspace {
   illuminant_in {{parent.parent.illuminant_in}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N6a532400
  BlinkScript {
   inputs 3
   recompileCount 69
   ProgramGroup 1
   KernelDescription "2 \"ZCAM_JMh_Kernel\" iterate pixelWise 7a6b681048dc899573cfa509e7d53e05469125c187c95579679329797bfbd64a 4 \"src\" Read Point \"refWhite\" Read Point \"d65White\" Read Point \"dst\" Write Point 11 \"direction\" Int 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"direction\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 7 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel ZCAM_JMh_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eWrite> dst; // the output image\n\n  param:\n    int direction;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_IzMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 IzMh = 0.0f;\n\n    IzMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+IzMh.z));\n    IzMh.x = Izazbz.x;\n    IzMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return IzMh;\n  \}\n\n\n  float3 IzMh_to_Izazbz( float3 IzMh, float refWhiteIz)\n  \{\n    float ez = 1.015f + cos(radians(89.038f+IzMh.z));\n    float hzr = radians(IzMh.z);\n    float Czp = pow((IzMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( IzMh.x, Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 XYZ_to_ZCAM_IzMh( float3 XYZ, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return Izazbz_to_IzMh(XYZ_to_Izazbz(CAT_Zhai2018(XYZ, refWhite, d65White, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS)), refWhiteIzazbz.x);\n  \}\n\n\n  float3 ZCAM_IzMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(IzMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3 output = 0.0f;\n\n    if( direction == 0 )\n    \{\n      output = XYZ_to_ZCAM_IzMh(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n    else\n    \{\n       output = ZCAM_IzMh_to_XYZ(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n\n    dst() = float4(output.x, output.y, output.z, input.w);\n  \}\n\};\n"
   rebuild ""
   ZCAM_JMh_Kernel_direction {{parent.invert}}
   ZCAM_JMh_Kernel_referenceLuminance {{parent.referenceLuminance}}
   ZCAM_JMh_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   ZCAM_JMh_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   ZCAM_JMh_Kernel_F_L {{"0.171*pow(ZCAM_JMh_Kernel_L_A, 1/3) * (1-exp(-48/9*ZCAM_JMh_Kernel_L_A))"}}
   ZCAM_JMh_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : ZCAM_JMh_Kernel_F * (1 - (1 / 3.6) * exp((-ZCAM_JMh_Kernel_L_A - 42) / 92))"}}
   ZCAM_JMh_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   ZCAM_JMh_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   ZCAM_JMh_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Multiply {
  channels rgb
  value {{1/parent.reference_luminance}}
  name Multiply17
  label "x\[value parent.reference_luminance]\nRel. Exp. to Cd/sqm\ninverse"
  xpos 120
  ypos 398
  disable {{"Colorspace4.colorspace_out == 31"}}
 }
 Colorspace {
  colorspace_in CIE-XYZ
  colorspace_out {{Colorspace1.colorspace_in}}
  illuminant_out {{Colorspace1.illuminant_in}}
  primary_out {{Colorspace1.primary_in}}
  name Colorspace4
  label "Input -> XYZ"
  xpos 120
  ypos 450
 }
 Dot {
  name Dot30
  note_font "Bitstream Vera Sans"
  xpos 154
  ypos 549
 }
 Dot {
  name Dot29
  note_font "Bitstream Vera Sans"
  xpos -461
  ypos 549
 }
push $N69b98c00
 Dot {
  name Dot18
  note_font "Bitstream Vera Sans"
  xpos -659
  ypos 109
 }
push $N69b43800
 Dot {
  name Dot16
  note_font "Bitstream Vera Sans"
  xpos -1114
  ypos -1035
 }
 Clamp {
  channels rgb
  minimum -65504
  minimum_enable false
  maximum 65504
  name Clamp1
  label "Clamp inf to\n+/-half max"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos -909
 }
 Colorspace {
  illuminant_in ACES
  primary_in ACES
  colorspace_out CIE-XYZ
  name Colorspace1
  label "Input -> XYZ"
  xpos -1148
  ypos -859
 }
 Multiply {
  channels rgb
  value {{parent.reference_luminance}}
  name Multiply1
  label "x\[value parent.reference_luminance]\nRel. Exp. to Cd/sqm"
  xpos -1148
  ypos -818
  disable {{"Colorspace1.colorspace_in == 31"}}
 }
 Group {
  name ZCAM_IzMh_Blink1
  label "XYZ to IzMh"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos -768
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {6 invert +STARTLINE}
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 146
   bdheight 250
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N6a4d2000 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   selected true
   xpos 1015
   ypos 144
  }
set N6a4d1c00 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N6a4d1c00
  Colorspace {
   illuminant_in {{parent.parent.illuminant_in}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N6a4d2000
  BlinkScript {
   inputs 3
   recompileCount 69
   ProgramGroup 1
   KernelDescription "2 \"ZCAM_JMh_Kernel\" iterate pixelWise 7a6b681048dc899573cfa509e7d53e05469125c187c95579679329797bfbd64a 4 \"src\" Read Point \"refWhite\" Read Point \"d65White\" Read Point \"dst\" Write Point 11 \"direction\" Int 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"direction\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 7 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel ZCAM_JMh_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eWrite> dst; // the output image\n\n  param:\n    int direction;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_IzMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 IzMh = 0.0f;\n\n    IzMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+IzMh.z));\n    IzMh.x = Izazbz.x;\n    IzMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return IzMh;\n  \}\n\n\n  float3 IzMh_to_Izazbz( float3 IzMh, float refWhiteIz)\n  \{\n    float ez = 1.015f + cos(radians(89.038f+IzMh.z));\n    float hzr = radians(IzMh.z);\n    float Czp = pow((IzMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( IzMh.x, Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 XYZ_to_ZCAM_IzMh( float3 XYZ, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return Izazbz_to_IzMh(XYZ_to_Izazbz(CAT_Zhai2018(XYZ, refWhite, d65White, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS)), refWhiteIzazbz.x);\n  \}\n\n\n  float3 ZCAM_IzMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(IzMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3 output = 0.0f;\n\n    if( direction == 0 )\n    \{\n      output = XYZ_to_ZCAM_IzMh(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n    else\n    \{\n       output = ZCAM_IzMh_to_XYZ(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n\n    dst() = float4(output.x, output.y, output.z, input.w);\n  \}\n\};\n"
   rebuild ""
   ZCAM_JMh_Kernel_direction {{parent.invert}}
   ZCAM_JMh_Kernel_referenceLuminance {{parent.referenceLuminance}}
   ZCAM_JMh_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   ZCAM_JMh_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   ZCAM_JMh_Kernel_F_L {{"0.171*pow(ZCAM_JMh_Kernel_L_A, 1/3) * (1-exp(-48/9*ZCAM_JMh_Kernel_L_A))"}}
   ZCAM_JMh_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : ZCAM_JMh_Kernel_F * (1 - (1 / 3.6) * exp((-ZCAM_JMh_Kernel_L_A - 42) / 92))"}}
   ZCAM_JMh_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   ZCAM_JMh_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   ZCAM_JMh_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Dot {
  name Dot5
  note_font "Bitstream Vera Sans"
  xpos -1114
  ypos -603
 }
set N6a4d0800 [stack 0]
 Dot {
  name Dot11
  note_font "Bitstream Vera Sans"
  xpos -1224
  ypos -603
 }
set N6a4d0400 [stack 0]
 Group {
  name st2048_3
  label "PQ (ZCAM) to Lum"
  xpos -1258
  ypos -480
  addUserKnob {20 User}
  addUserKnob {4 direction M {"Luminance (Cd/sqm) -> ST.2048" "ST.2048 -> Luminance (Cd/sqm)"}}
  direction "ST.2048 -> Luminance (Cd/sqm)"
  addUserKnob {7 peakLuminance R 0 10000}
  peakLuminance 10000
  addUserKnob {26 ""}
  addUserKnob {26 m2_override_desc l "" +STARTLINE T "ZCAM uses a different exponent (rho) in its PQ function than ST.2084 (m2)"}
  addUserKnob {7 m2_override R 0 200}
  m2_override {{"1.7 * 2523 / pow(2,5)"}}
 }
  Input {
   inputs 0
   name Input1
   xpos 829
   ypos 200
  }
  Dot {
   name Dot17
   xpos 863
   ypos 240
  }
set N6a46b800 [stack 0]
  Dot {
   name Dot27
   xpos 916
   ypos 240
  }
  Expression {
   temp_name0 V_pr
   temp_expr0 "pow(r, 1/m_2)"
   temp_name1 V_pg
   temp_expr1 "pow(g, 1/m_2)"
   temp_name2 V_pb
   temp_expr2 "pow(b, 1/m_2)"
   expr0 "pow((max(0.0, V_pr - c_1) / (c_2 - c_3 * V_pr)), 1/m_1)*L_p"
   expr1 "pow((max(0.0, V_pg - c_1) / (c_2 - c_3 * V_pg)), 1/m_1)*L_p"
   expr2 "pow((max(0.0, V_pb - c_1) / (c_2 - c_3 * V_pb)), 1/m_1)*L_p"
   channel3 none
   name from_st2048
   selected true
   xpos 882
   ypos 285
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
push $N6a46b800
  Dot {
   name Dot26
   xpos 810
   ypos 240
  }
  Expression {
   temp_name0 Y_pr
   temp_expr0 "pow(r / L_p, m_1)"
   temp_name1 Y_pg
   temp_expr1 "pow(g / L_p, m_1)"
   temp_name2 Y_pb
   temp_expr2 "pow(b / L_p, m_1)"
   expr0 "pow((c_1 + c_2 * Y_pr) / (c_3 * Y_pr + 1), m_2)"
   expr1 "pow((c_1 + c_2 * Y_pg) / (c_3 * Y_pg + 1), m_2)"
   expr2 "pow((c_1 + c_2 * Y_pb) / (c_3 * Y_pb + 1), m_2)"
   channel3 none
   name to_st2084
   xpos 776
   ypos 286
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   xpos 835
   ypos 347
  }
  Output {
   name Output1
   xpos 835
   ypos 447
  }
 end_group
 Multiply {
  channels rgb
  value 1.028552621
  name Multiply10
  label "remove luminance shift\nfrom cone fundamentals matrix"
  note_font "Bitstream Vera Sans"
  xpos -1258
  ypos -448
 }
 Multiply {
  channels rgb
  value {{1/parent.reference_luminance}}
  name Multiply11
  label "1/\[value parent.reference_luminance]\nLum to Exp"
  note_font "Bitstream Vera Sans"
  xpos -1258
  ypos -400
 }
 BlinkScript {
  recompileCount 35
  ProgramGroup 1
  KernelDescription "2 \"SSTSKernel\" iterate pixelWise 3292521f65973146de9ba2803e15c81b8610684f8dcbef3a3fc1382de44823f8 2 \"src\" Read Point \"dst\" Write Point 8 \"lumMid\" Float 1 AAAAAA== \"defaultMin\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"defaultMid\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"defaultMax\" Float 3 AAAAAAAAAAAAAAAAAAAAAA== \"coefsLow\" Float 6 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA= \"coefsHigh\" Float 6 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA= \"M1\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"inverse\" Int 1 AAAAAA== 8 \"lumMid\" 1 1 \"defaultMin\" 3 1 \"defaultMid\" 3 1 \"defaultMax\" 3 1 \"coefsLow\" 1 6 \"coefsHigh\" 1 6 \"M1\" 9 1 \"inverse\" 1 1 4 \"expShift\" Float 1 1 AAAAAA== \"paramMin\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA== \"paramMid\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA== \"paramMax\" Float 3 1 AAAAAAAAAAAAAAAAAAAAAA=="
  kernelSource "kernel SSTSKernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eWrite> dst; // the output image\n\n  param:\n    float lumMid;\n    float3 defaultMin;\n    float3 defaultMid;\n    float3 defaultMax;\n    float coefsLow\[6];\n    float coefsHigh\[6];\n    float3x3 M1;\n    int inverse;\n\n  local:\n    float expShift;\n    float3 paramMin;\n    float3 paramMid;\n    float3 paramMax;\n\n  \n  void define()\n  \{\n\n  \}\n\n  float3 vector_dot( float3 v, float3x3 m)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float dot( float3 a, float3 b)\n  \{\n    return (a.x*b.x) + (a.y*b.y) + (a.z*b.z);\n  \}\n\n  \n  float ssts(float x, float3 minPt, float3 midPt, float3 maxPt)\n  \{\n    float HALF_MIN = 0.0000000596046448;\n\n    // Check for negatives or zero before taking the log. If negative or zero,\n    // set to HALF_MIN.\n    float logx = log10( max(x, HALF_MIN )); \n\n    float logy;\n\n    if( logx <= log10(minPt.x) )\n    \{ \n        logy = logx * minPt.z + ( log10(minPt.y) - minPt.z * log10(minPt.x) );\n    \}\n    else if(( logx > log10(minPt.x) ) && ( logx < log10(midPt.x) ))\n    \{\n        float knot_coord = 3.0f * (logx-log10(minPt.x)) / (log10(midPt.x) - log10(minPt.x));\n        int j = knot_coord;\n        float t = knot_coord - float(j);\n        float3 cf(coefsLow\[j], coefsLow\[j + 1], coefsLow\[j + 2]);\n        float3 monomials( t * t, t, 1.0f );\n        logy = dot(monomials, vector_dot( cf, M1));\n    \}\n    else if(( logx >= log10(midPt.x) ) && ( logx < log10(maxPt.x) ))\n    \{\n        float knot_coord = 3.0f * (logx-log10(midPt.x)) / (log10(maxPt.x) - log10(midPt.x));\n        int j = knot_coord;\n        float t = knot_coord - float(j);\n        float3 cf(coefsHigh\[j], coefsHigh\[j + 1], coefsHigh\[j + 2]); \n        float3 monomials(t * t, t, 1.0f);\n        logy = dot(monomials, vector_dot( cf, M1));\n    \}\n    else\n    \{\n        logy = logx * maxPt.z + ( log10(maxPt.y) - maxPt.z * log10(maxPt.x) );\n    \}\n\n    return pow(10.0f,logy);\n  \}\n\n  \n  float inv_ssts(float y, float3 minPt, float3 midPt, float3 maxPt)\n  \{\n    float KNOT_INC_LOW  = (log10(midPt.x) - log10(minPt.x)) / 3.0f;\n    float KNOT_INC_HIGH = (log10(maxPt.x) - log10(midPt.x)) / 3.0f;\n\n    // KNOT_Y is luminance of the spline at each knot\n    float KNOT_Y_LOW\[4];\n\n   for( int i = 0; i < 4; i++ )\n    \{\n      KNOT_Y_LOW\[i] = ( coefsLow\[i] + coefsLow\[i+1]) / 2.0f;\n    \};\n\n    float KNOT_Y_HIGH\[ 4];\n\n    for( int i = 0; i < 4; i++ )\n    \{\n      KNOT_Y_HIGH\[i] = ( coefsHigh\[i] + coefsHigh\[i+1]) / 2.0f;\n    \};\n\n    float logy = log10( max(y, 0.0000000001f));\n\n    float logx;\n\n    if( logy <= log10(minPt.y) )\n    \{\n        logx = log10(minPt.x);\n\n    \}\n    else if( (logy > log10(minPt.y)) && (logy <= log10(midPt.y)) )\n    \{\n        int j;\n        float3 cf = 0.0f;\n\n        if( logy > KNOT_Y_LOW\[0] && logy <= KNOT_Y_LOW\[1])\n        \{\n          cf.x = coefsLow\[0];\n          cf.y = coefsLow\[1];\n          cf.z = coefsLow\[2];\n          j = 0;\n        \}\n        else if( logy > KNOT_Y_LOW\[1] && logy <= KNOT_Y_LOW\[2])\n        \{\n          cf.x = coefsLow\[1];\n          cf.y = coefsLow\[2];\n          cf.z = coefsLow\[3];\n          j = 1;\n        \}\n        else if( logy > KNOT_Y_LOW\[2] && logy <= KNOT_Y_LOW\[3])\n        \{\n          cf.x = coefsLow\[2];\n          cf.y = coefsLow\[3];\n          cf.z = coefsLow\[4];\n          j = 2;\n        \} \n\n        float3 tmp = vector_dot( cf, M1 );\n\n        float a = tmp.x;\n        float b = tmp.y;\n        float c = tmp.z;\n        c = c - logy;\n\n        float d = sqrt( b * b - 4.0f * a * c);\n\n        float t = ( 2.0f * c) / ( -d - b);\n\n        logx = log10(minPt.x) + ( t + j) * KNOT_INC_LOW;\n\n    \}\n    else if( (logy > log10(midPt.y)) && (logy < log10(maxPt.y)) )\n    \{\n        int j;\n        float3 cf = 0.0f;\n\n        if( logy >= KNOT_Y_HIGH\[0] && logy <= KNOT_Y_HIGH\[1])\n        \{\n          cf.x = coefsHigh\[0];\n          cf.y = coefsHigh\[1];\n          cf.z = coefsHigh\[2];\n          j = 0;\n        \}\n        else if( logy > KNOT_Y_HIGH\[1] && logy <= KNOT_Y_HIGH\[2])\n        \{\n          cf.x = coefsHigh\[1];\n          cf.y = coefsHigh\[2];\n          cf.z = coefsHigh\[3];\n          j = 1;\n        \}\n        else if( logy > KNOT_Y_HIGH\[2] && logy <= KNOT_Y_HIGH\[3])\n        \{\n          cf.x = coefsHigh\[2];\n          cf.y = coefsHigh\[3];\n          cf.z = coefsHigh\[4];\n          j = 2;\n        \} \n\n        float3 tmp = vector_dot( cf, M1);\n\n        float a = tmp.x;\n        float b = tmp.y;\n        float c = tmp.z;\n        c = c - logy;\n\n        float d = sqrt( b * b - 4.0f * a * c);\n\n        float t = ( 2.0f * c) / ( -d - b);\n\n        logx = log10(midPt.x) + ( t + j) * KNOT_INC_HIGH;\n\n    \}\n    else\n    \{\n        logx = log10(maxPt.x);\n\n    \}\n\n    return pow(10.0f, logx);\n  \}\n\n\n  void init()\n  \{\n    paramMin = defaultMin;\n    paramMid = defaultMid;\n    paramMax = defaultMax;\n    expShift = log2(inv_ssts(lumMid, defaultMin, paramMid, defaultMax)) - log2(0.18f);\n    paramMin.x = pow(2.0f, (log(paramMin.x) / log(2.0f) - expShift));\n    paramMid.x = pow(2.0f, (log(0.18f     ) / log(2.0f) - expShift));\n    paramMax.x = pow(2.0f, (log(paramMax.x) / log(2.0f) - expShift));\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    float3 srcPixel(input.x, input.y, input.z);\n    float3 tsPixel = 0.0f;\n\n    if( inverse )\n    \{\n      tsPixel.x = inv_ssts(srcPixel.x, paramMin, paramMid, paramMax);\n      tsPixel.y = inv_ssts(srcPixel.y, paramMin, paramMid, paramMax);\n      tsPixel.z = inv_ssts(srcPixel.z, paramMin, paramMid, paramMax);\n    \}\n    else\n    \{\n      tsPixel.x = ssts(srcPixel.x, paramMin, paramMid, paramMax);\n      tsPixel.y = ssts(srcPixel.y, paramMin, paramMid, paramMax);\n      tsPixel.z = ssts(srcPixel.z, paramMin, paramMid, paramMax);\n    \}\n\n    dst() = float4(tsPixel.x, tsPixel.y, tsPixel.z, input.w);\n  \}\n\};\n"
  rebuild ""
  SSTSKernel_lumMid {{luminances.y}}
  SSTSKernel_defaultMin {{pow(2.,(log(MIN_PT.x)/log(2)))} {MIN_PT.y} {MIN_PT.z}}
  SSTSKernel_defaultMid {{pow(2.,(log(0.18)/log(2)))} {MID_PT.y} {MID_PT.z}}
  SSTSKernel_defaultMax {{pow(2.,(log(MAX_PT.x)/log(2)))} {MAX_PT.y} {MAX_PT.z}}
  SSTSKernel_coefsLow {{"(MIN_PT.z * (log10(MIN_PT.x)-0.5*knotIncLow)) + ( log10(MIN_PT.y) - MIN_PT.z * log10(MIN_PT.x))"} {"(MIN_PT.z * (log10(MIN_PT.x)+0.5*knotIncLow)) + ( log10(MIN_PT.y) - MIN_PT.z * log10(MIN_PT.x))"} {"log10(MIN_PT.y) + pctLow*(log10(MID_PT.y)-log10(MIN_PT.y))"} {"(MID_PT.z * (log10(MID_PT.x)-0.5*knotIncLow)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"(MID_PT.z * (log10(MID_PT.x)+0.5*knotIncLow)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {SSTSKernel_coefsLow.4}}
  SSTSKernel_coefsHigh {{"(MID_PT.z * (log10(MID_PT.x)-0.5*knotIncHigh)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"(MID_PT.z * (log10(MID_PT.x)+0.5*knotIncHigh)) + ( log10(MID_PT.y) - MID_PT.z * log10(MID_PT.x))"} {"log10(MID_PT.y) + pctHigh*(log10(MAX_PT.y)-log10(MID_PT.y))"} {"(MAX_PT.z * (log10(MAX_PT.x)-0.5*knotIncHigh)) + ( log10(MAX_PT.y) - MAX_PT.z * log10(MAX_PT.x))"} {"(MAX_PT.z * (log10(MAX_PT.x)+0.5*knotIncHigh)) + ( log10(MAX_PT.y) - MAX_PT.z * log10(MAX_PT.x))"} {SSTSKernel_coefsHigh.4}}
  SSTSKernel_M1 {
      {0.5 -1 0.5}
      {-1 1 0}
      {0.5 0.5 0}
    }
  SSTSKernel_inverse {{direction}}
  rebuild_finalise ""
  name SSTS_Blink2
  note_font "Bitstream Vera Sans"
  xpos -1258
  ypos -352
  addUserKnob {20 User}
  addUserKnob {13 luminances}
  luminances {{parent.ssts_luminance.0} {parent.ssts_luminance.1} {parent.ssts_luminance.2}}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {20 SSTSParams}
  addUserKnob {13 MIN_PT}
  MIN_PT {{0.18*pow(2,minTable(log10(luminances.x)))} {luminances.x} 0}
  addUserKnob {13 MID_PT}
  MID_PT {0.18 4.8 1.55}
  addUserKnob {13 MAX_PT}
  MAX_PT {{0.18*pow(2,maxTable(log10(luminances.z)))} {luminances.z} 0}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(MID_PT.x) - log10(MIN_PT.x)) / 3"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(MAX_PT.x) - log10(MID_PT.x)) / 3"}}
  addUserKnob {7 pctLow}
  pctLow {{bendsLow(log(MIN_PT.x/0.18)/log(2))}}
  addUserKnob {7 pctHigh}
  pctHigh {{bendsHigh(log(MAX_PT.x/0.18)/log(2))}}
  addUserKnob {20 Tables}
  addUserKnob {7 minTable}
  minTable {{curve L l x-4 -15 x-1.69896996 -6.5}}
  addUserKnob {7 maxTable}
  maxTable {{curve L l x1.681241274 6.5 x4 18}}
  addUserKnob {7 bendsLow}
  bendsLow {{curve L l x-15 0.18 x-6.5 0.35}}
  addUserKnob {7 bendsHigh}
  bendsHigh {{curve l x6.5 0.89 x18 0.9}}
  addUserKnob {20 Constants}
  addUserKnob {7 MIN_STOP_SDR R -10 10}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -10 10}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 200}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
 }
set N6a469800 [stack 0]
 Add {
  channels rgb
  value {{-parent.ssts_luminance.1}}
  name Add1
  label "mids to zero"
  note_font "Bitstream Vera Sans"
  xpos -1529
  ypos -352
 }
 Multiply {
  channels rgb
  value {{1/parent.ssts_luminance.1}}
  name Multiply7
  label "1/\[value parent.ssts_luminance.1]\nnormalise mids"
  note_font "Bitstream Vera Sans"
  xpos -1529
  ypos -314
 }
 Clamp {
  channels rgb
  name Clamp2
  label 0-1
  note_font "Bitstream Vera Sans"
  xpos -1529
  ypos -264
 }
 Dot {
  name Dot8
  note_font "Bitstream Vera Sans"
  xpos -1495
  ypos -188
 }
 Dot {
  name Dot14
  note_font "Bitstream Vera Sans"
  xpos -1605
  ypos -188
 }
push $N6a4d0400
 Dot {
  name Dot7
  note_font "Bitstream Vera Sans"
  xpos -1614
  ypos -603
 }
push $N6a469800
 Multiply {
  channels rgb
  value 0.9722396415
  name Multiply12
  label "re-apply luminance shift\nfrom cone fundamentals matrix"
  note_font "Bitstream Vera Sans"
  xpos -1258
  ypos -316
 }
 Group {
  name st2048_4
  label "Lum to PQ (ZCAM)"
  xpos -1258
  ypos -268
  addUserKnob {20 User}
  addUserKnob {4 direction M {"Luminance (Cd/sqm) -> ST.2048" "ST.2048 -> Luminance (Cd/sqm)"}}
  addUserKnob {7 peakLuminance R 0 10000}
  peakLuminance 10000
  addUserKnob {26 ""}
  addUserKnob {26 m2_override_desc l "" +STARTLINE T "ZCAM uses a different exponent (rho) in its PQ function than ST.2084 (m2)"}
  addUserKnob {7 m2_override R 0 200}
  m2_override {{"1.7 * 2523 / pow(2,5)"}}
 }
  Input {
   inputs 0
   name Input1
   xpos 829
   ypos 200
  }
  Dot {
   name Dot17
   xpos 863
   ypos 240
  }
set N6a3ff000 [stack 0]
  Dot {
   name Dot27
   xpos 916
   ypos 240
  }
  Expression {
   temp_name0 V_pr
   temp_expr0 "pow(r, 1/m_2)"
   temp_name1 V_pg
   temp_expr1 "pow(g, 1/m_2)"
   temp_name2 V_pb
   temp_expr2 "pow(b, 1/m_2)"
   expr0 "pow((max(0.0, V_pr - c_1) / (c_2 - c_3 * V_pr)), 1/m_1)*L_p"
   expr1 "pow((max(0.0, V_pg - c_1) / (c_2 - c_3 * V_pg)), 1/m_1)*L_p"
   expr2 "pow((max(0.0, V_pb - c_1) / (c_2 - c_3 * V_pb)), 1/m_1)*L_p"
   channel3 none
   name from_st2048
   selected true
   xpos 882
   ypos 285
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
push $N6a3ff000
  Dot {
   name Dot26
   xpos 810
   ypos 240
  }
  Expression {
   temp_name0 Y_pr
   temp_expr0 "pow(r / L_p, m_1)"
   temp_name1 Y_pg
   temp_expr1 "pow(g / L_p, m_1)"
   temp_name2 Y_pb
   temp_expr2 "pow(b / L_p, m_1)"
   expr0 "pow((c_1 + c_2 * Y_pr) / (c_3 * Y_pr + 1), m_2)"
   expr1 "pow((c_1 + c_2 * Y_pg) / (c_3 * Y_pg + 1), m_2)"
   expr2 "pow((c_1 + c_2 * Y_pb) / (c_3 * Y_pb + 1), m_2)"
   channel3 none
   name to_st2084
   xpos 776
   ypos 286
   addUserKnob {20 User}
   addUserKnob {7 m_1}
   m_1 {{"2610 / 4096 * (1 / 4)"}}
   addUserKnob {7 m_2}
   m_2 {{parent.m2_override}}
   addUserKnob {7 c_1}
   c_1 {{"3424 / 4096"}}
   addUserKnob {7 c_2}
   c_2 {{"2413 / 4096 * 32"}}
   addUserKnob {7 c_3}
   c_3 {{"2392 / 4096 * 32"}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.peakLuminance}}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   xpos 835
   ypos 347
  }
  Output {
   name Output1
   xpos 835
   ypos 447
  }
 end_group
 Dot {
  name Dot40
  note_font "Bitstream Vera Sans"
  xpos -1224
  ypos -226
 }
set N6a3fd800 [stack 0]
 Merge2 {
  inputs 2
  operation minus
  name Merge3
  label "diff tonescale"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -235
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge6
  label "remove toe"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -197
 }
 Multiply {
  channels rgb
  value {{parent.desatHighlights}}
  name Multiply4
  label "desat scale"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -159
 }
 Group {
  name SoftclipExpression2
  label "avoid negative values for M"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -88
  addUserKnob {20 User}
  addUserKnob {18 clip_to}
  clip_to 0.9
  addUserKnob {6 clip_to_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 clip_to_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 clip_to_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 threshold}
  threshold 0.8
  addUserKnob {6 threshold_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {4 direction M {forward inverse}}
  addUserKnob {7 mix}
  mix 1
 }
  Input {
   inputs 0
   name Input1
   xpos -284
   ypos 135
  }
  Multiply {
   value {{1/parent.clip_to.r} {1/parent.clip_to.g} {1/parent.clip_to.b} 1}
   name Multiply1
   note_font "Bitstream Vera Sans"
   xpos -284
   ypos 159
  }
set N6a3fc400 [stack 0]
  Expression {
   temp_name0 one_minus_e
   temp_expr0 "1 - pow(10,-15)"
   temp_name1 maxr
   temp_expr1 "(pow(threshold.r, 2) - 2 * threshold.r * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   temp_name2 maxg
   temp_expr2 "(pow(threshold.g, 2) - 2 * threshold.g * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   temp_name3 maxb
   temp_expr3 "(pow(threshold.b, 2) - 2 * threshold.b * one_minus_e + one_minus_e ) / ( 1 - one_minus_e )"
   expr0 " threshold.r < 1 ? r >= 1 ? maxr : r > threshold.r ? (pow(threshold.r, 2) - 2 * threshold.r * r + r ) / ( 1 - r ) : r : r"
   expr1 " threshold.g < 1 ? g >= 1 ? maxg : g > threshold.g ? (pow(threshold.g, 2) - 2 * threshold.g * g + g ) / ( 1 - g ) : g : g"
   expr2 " threshold.b < 1 ? b >= 1 ? maxb : b > threshold.b ? (pow(threshold.b, 2) - 2 * threshold.b * b + b ) / ( 1 - b ) : b : b"
   expr3 a
   mix {{parent.mix}}
   name Expression2
   label inverse
   xpos -222
   ypos 257
   addUserKnob {20 User}
   addUserKnob {18 threshold}
   threshold {{parent.threshold.r} {parent.threshold.g} {parent.threshold.b}}
   addUserKnob {6 threshold_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  }
push $N6a3fc400
  Expression {
   expr0 "threshold.r < 1 ? r > threshold.r ? ( -1 / (( r - threshold.r ) / ( 1 - threshold.r ) +1 ) +1 ) * ( 1 - threshold.r ) + threshold.r : r : r"
   expr1 "threshold.g < 1 ? g > threshold.g ? ( -1 / (( g - threshold.g ) / ( 1 - threshold.g ) +1 ) +1 ) * ( 1 - threshold.g ) + threshold.g : g : g"
   expr2 "threshold.b < 1 ? b > threshold.b ? ( -1 / (( b - threshold.b ) / ( 1 - threshold.b ) +1 ) +1 ) * ( 1 - threshold.b ) + threshold.b : b : b"
   expr3 a
   mix {{parent.mix}}
   name Expression1
   label forward
   xpos -349
   ypos 258
   addUserKnob {20 User}
   addUserKnob {18 threshold_1 l threshold}
   threshold_1 {{parent.threshold.r} {parent.threshold.g} {parent.threshold.b}}
   addUserKnob {6 threshold_1_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
   addUserKnob {6 threshold_1_panelDropped_1_1_1_1_1_1_1_1_1_1_1_1 l "panel dropped state" -STARTLINE +HIDDEN}
  }
  Switch {
   inputs 2
   which {{parent.direction}}
   name Switch2
   note_font "Bitstream Vera Sans"
   xpos -287
   ypos 356
  }
  Multiply {
   value {{parent.clip_to.r} {parent.clip_to.g} {parent.clip_to.b} 1}
   name Multiply2
   note_font "Bitstream Vera Sans"
   xpos -287
   ypos 380
  }
  Output {
   name Output1
   xpos -287
   ypos 463
  }
 end_group
 Invert {
  channels rgb
  name Invert1
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -52
 }
 Shuffle {
  red white
  green red
  blue white
  alpha white
  name Shuffle2
  label "\[value in]-->\[value out]"
  note_font "Bitstream Vera Sans"
  xpos -1648
  ypos -21
 }
push $N6a3fd800
 Group {
  name Group1
  label "Re-Generate J\nfrom Iz"
  xpos -1258
  ypos -181
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite -STARTLINE T Colorspace2.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 10000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 200}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {20 Factors}
  addUserKnob {7 F}
  F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
  addUserKnob {7 F_s}
  F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
  addUserKnob {7 L_A}
  L_A {{"referenceLuminance * backgroundLuminance / 100"}}
  addUserKnob {7 F_b}
  F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
  addUserKnob {7 F_L}
  F_L {{"0.171*pow(L_A, 1/3) * (1-exp(-48/9*L_A))"}}
 }
  BackdropNode {
   inputs 0
   name BackdropNode7
   tile_color 0x666666ff
   label "Reference White"
   note_font_size 20
   xpos 27
   ypos -149
   bdwidth 177
   bdheight 144
  }
  Input {
   inputs 0
   name Input
   xpos -66
   ypos -264
  }
  Dot {
   name Dot1
   xpos -32
   ypos -184
  }
set N6a3aa000 [stack 0]
  Dot {
   name Dot11
   xpos 114
   ypos -184
  }
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   xpos 80
   ypos -112
  }
  Colorspace {
   illuminant_in {{parent.parent.illuminant_in}}
   colorspace_out CIE-XYZ
   name Colorspace2
   xpos 80
   ypos -76
  }
  Expression {
   temp_name0 gain
   temp_expr0 parent.referenceLuminance/g
   expr0 r*gain
   expr1 g*gain
   expr2 b*gain
   name Expression0
   xpos 80
   ypos -50
  }
  Group {
   name XYZ_w_to_Izazbz
   xpos 80
   ypos -26
  }
   Input {
    inputs 0
    name Input1
    xpos 148
    ypos 197
   }
   Expression {
    temp_name0 cb
    temp_expr0 1.15
    temp_name1 cg
    temp_expr1 0.66
    expr0 "(cb*r) - ((cb-1)*b)"
    expr1 "(cg*g) - ((cg-1)*r)"
    expr2 b
    name Expression1
    label "XYZ (D65)\nto\nX'Y'Z (D65)"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 237
   }
   ColorMatrix {
    matrix {
        {0.41478972 0.579999 0.014648}
        {-0.20151 1.120649 0.0531008}
        {-0.0166008 0.2648 0.6684799}
      }
    name ColorMatrix1
    label "X'Y'Z (D65)\nto\nLMS"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 297
   }
   Expression {
    temp_name0 c1
    temp_expr0 "3424 / pow(2,12)"
    temp_name1 c2
    temp_expr1 "2413 / pow(2,7)"
    temp_name2 c3
    temp_expr2 "2392 / pow(2,7)"
    temp_name3 n
    temp_expr3 2610/pow(2,14)
    expr0 "pow( ( c1 + c2 * pow((r/10000),n) ) / ( 1 + c3 * pow((r/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    expr1 "pow( ( c1 + c2 * pow((g/10000),n) ) / ( 1 + c3 * pow((g/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    expr2 "pow( ( c1 + c2 * pow((b/10000),n) ) / ( 1 + c3 * pow((b/10000),n) ), (1.7 * 2523 / pow(2,5)))"
    name Expression2
    label "LMS\nto\nL'M'S'"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 357
   }
   ColorMatrix {
    matrix {
        {0 {1-epsilon} 0}
        {3.524 -4.066708 0.542708}
        {0.199076 1.096799 -1.295875}
      }
    name ColorMatrix2
    label "L'M'S\nto\nIzazbz"
    note_font "Bitstream Vera Sans"
    xpos 148
    ypos 417
    addUserKnob {20 User}
    addUserKnob {7 epsilon}
    epsilon 3.703522621e-11
   }
   Output {
    name Output1
    xpos 148
    ypos 517
   }
  end_group
  Dot {
   name Dot2
   xpos 114
   ypos 53
  }
push $N6a3aa000
  MergeExpression {
   inputs 2
   temp_name0 Qz
   temp_expr0 "2700 * pow(Br, (1.6 * parent.F_s) / pow(parent.F_b, 0.12)) * pow(parent.F_s, 2.2) * pow(parent.F_b, 0.5) * pow(parent.F_L, 0.2)"
   temp_name1 Qzw
   temp_expr1 "2700 * pow(Ar, (1.6 * parent.F_s) / pow(parent.F_b, 0.12)) * pow(parent.F_s, 2.2) * pow(parent.F_b, 0.5) * pow(parent.F_L, 0.2)"
   temp_name2 j
   temp_expr2 100*(Qz/Qzw)
   channel0 {zcam_1d.J -zcam_1d.C -zcam_1d.h none}
   expr0 j
   channel1 {rgba.red -rgba.green -rgba.blue none}
   expr1 j
   channel2 none
   channel3 none
   name MergeExpression1
   selected true
   xpos -66
   ypos 50
  }
  Output {
   name Output
   xpos -66
   ypos 117
  }
 end_group
push $N6a4d0800
 ShuffleCopy {
  inputs 2
  red red
  alpha alpha2
  name ShuffleCopy1
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos -172
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge4
  label "highlight de-sat"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos -21
 }
 Dot {
  name Dot1
  note_font "Bitstream Vera Sans"
  xpos -1114
  ypos 34
 }
set N6a329c00 [stack 0]
 Dot {
  name Dot2
  note_font "Bitstream Vera Sans"
  xpos -994
  ypos 34
 }
set N6a329800 [stack 0]
 Dot {
  name Dot3
  note_font "Bitstream Vera Sans"
  xpos -878
  ypos 34
 }
 Expression {
  temp_name0 posX
  temp_expr0 b/360*(lookupResolution.z-1)
  temp_name1 posY
  temp_expr1 r/lookupNormJ*(lookupResolution.x-1)
  temp_name2 fractX
  temp_expr2 posX-floor(posX)
  temp_name3 fractY
  temp_expr3 posY-floor(posY)
  expr0 posX
  expr1 fractX
  expr2 posY
  expr3 fractY
  name Expression2
  label "calculate lookup coordinates"
  note_font "Bitstream Vera Sans"
  xpos -912
  ypos 61
  addUserKnob {20 User}
  addUserKnob {13 lookupResolution}
  lookupResolution {{parent.lut_size_Iz} {parent.lut_size_m} {parent.lut_size_h}}
  addUserKnob {7 lookupNormJ R 0 500}
  lookupNormJ {{pow(log(parent.ssts_luminance.2)/log(2),1.7)*4.5}}
  addUserKnob {7 lookupNormM R 0 200}
  lookupNormM 80
 }
 MergeExpression {
  inputs 2
  temp_name0 blPix
  temp_expr0 Aa(floor(Br),floor(Bb))
  temp_name1 brPix
  temp_expr1 Aa(ceil(Br),floor(Bb))
  temp_name2 trPix
  temp_expr2 Aa(ceil(Br),ceil(Bb))
  temp_name3 tlPix
  temp_expr3 Aa(floor(Br),ceil(Bb))
  channel0 none
  expr1 "lerp( lerp(blPix, brPix, Bg), lerp(tlPix, trPix, Bg), Ba)"
  channel2 none
  channel3 none
  name MergeExpression1
  label "Bilinear Interploation"
  xpos -912
  ypos 102
 }
set N6a328c00 [stack 0]
 Dot {
  name Dot4
  note_font "Bitstream Vera Sans"
  xpos -878
  ypos 174
 }
push $N6a329800
push $N6a328c00
 Merge2 {
  inputs 2
  operation divide
  name Merge1
  xpos -1028
  ypos 106
 }
 Expression {
  expr0 (r<thr.r||lim.r<1.0001)?r:thr.r+s.r*((r-thr.r)/s.r)/(pow(1+pow((r-thr.r)/s.r,p),1/p))
  expr1 (g<thr.g||lim.g<1.0001)?g:thr.g+s.g*((g-thr.g)/s.g)/(pow(1+pow((g-thr.g)/s.g,p),1/p))
  expr2 (b<thr.b||lim.b<1.0001)?b:thr.b+s.b*((b-thr.b)/s.b)/(pow(1+pow((b-thr.b)/s.b,p),1/p))
  name Compress
  label Power(P)
  xpos -1028
  ypos 130
  addUserKnob {20 Params_tab l Params}
  addUserKnob {18 thr}
  thr {{parent.compression.0}}
  addUserKnob {6 thr_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 lim}
  lim {{parent.compression.1}}
  addUserKnob {6 lim_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {18 s}
  s {{(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)} {(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)} {(lim-thr)/pow(pow((1-thr)/(lim-thr),-p)-1,1/p)}}
  addUserKnob {6 s_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  addUserKnob {7 p R 1 5}
  p {{parent.compression.2}}
 }
 Merge2 {
  inputs 2
  operation multiply
  name Merge2
  xpos -1028
  ypos 171
 }
push $N6a329c00
 ShuffleCopy {
  inputs 2
  green green
  alpha alpha2
  name ShuffleCopy2
  label "Apply Compressed\nColourfulness (M)"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos 159
 }
 Group {
  name ZCAM_JMh_Blink1
  label "JMh to XYZ"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos 340
  addUserKnob {20 User}
  addUserKnob {41 referenceWhite T RefWhite.illuminant_in}
  addUserKnob {7 referenceLuminance -STARTLINE R 0 1000}
  referenceLuminance {{parent.reference_luminance}}
  addUserKnob {4 viewingConditions M {dark dim average}}
  addUserKnob {7 backgroundLuminance -STARTLINE R 0 100}
  backgroundLuminance {{parent.background_luminance}}
  addUserKnob {6 discountIlluminant +STARTLINE}
  addUserKnob {6 invert +STARTLINE}
  invert true
 }
  BackdropNode {
   inputs 0
   name BackdropNode1
   label "Helper Nodes"
   note_font "Bitstream Vera Sans"
   note_font_size 20
   xpos 991
   ypos 100
   bdwidth 146
   bdheight 250
  }
  Input {
   inputs 0
   name Input1
   xpos 828
   ypos 71
  }
  Dot {
   name Dot1
   note_font "Bitstream Vera Sans"
   xpos 862
   ypos 153
  }
set N6a2dac00 [stack 0]
  Shuffle {
   red white
   green white
   blue white
   alpha white
   name Shuffle2
   label "\[value in]-->\[value out]"
   note_font "Bitstream Vera Sans"
   selected true
   xpos 1015
   ypos 144
  }
set N6a2da800 [stack 0]
  Colorspace {
   colorspace_out CIE-XYZ
   name D65White
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 243
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{colormatrix.0+colormatrix.1+colormatrix.2} {colormatrix.3+colormatrix.4+colormatrix.5} {colormatrix.6+colormatrix.7+colormatrix.8}}
  }
push $N6a2da800
  Colorspace {
   illuminant_in {{parent.parent.white}}
   colorspace_out CIE-XYZ
   name RefWhite
   note_font "Bitstream Vera Sans"
   xpos 1015
   ypos 216
   addUserKnob {20 User}
   addUserKnob {13 value}
   value {{"\[python nuke.thisNode().knob('colormatrix').getValue(0)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(1)\\ +\\ nuke.thisNode().knob('colormatrix').getValue(2)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(3) + nuke.thisNode().knob('colormatrix').getValue(4) + nuke.thisNode().knob('colormatrix').getValue(5)]"} {"\[python nuke.thisNode().knob('colormatrix').getValue(6) + nuke.thisNode().knob('colormatrix').getValue(7) + nuke.thisNode().knob('colormatrix').getValue(8)]"}}
  }
push $N6a2dac00
  BlinkScript {
   inputs 3
   recompileCount 66
   ProgramGroup 1
   KernelDescription "2 \"ZCAM_JMh_Kernel\" iterate pixelWise ac1327942f16c15a4b75f54f652a97dc0f54381ec18fc95d13cdfae2cd779b6b 4 \"src\" Read Point \"refWhite\" Read Point \"d65White\" Read Point \"dst\" Write Point 11 \"direction\" Int 1 AAAAAA== \"referenceLuminance\" Float 1 AAAAAA== \"F\" Float 1 AAAAAA== \"F_s\" Float 1 AAAAAA== \"L_A\" Float 1 AAAAAA== \"F_b\" Float 1 AAAAAA== \"F_L\" Float 1 AAAAAA== \"adaptDegree\" Float 1 AAAAAA== \"CAT02_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_XYZ_to_LMS\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \"ZCAM_LMS_to_Izazbz\" Float 9 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 11 \"direction\" 1 1 \"referenceLuminance\" 1 1 \"F\" 1 1 \"F_s\" 1 1 \"L_A\" 1 1 \"F_b\" 1 1 \"F_L\" 1 1 \"adaptDegree\" 1 1 \"CAT02_XYZ_to_LMS\" 9 1 \"ZCAM_XYZ_to_LMS\" 9 1 \"ZCAM_LMS_to_Izazbz\" 9 1 7 \"cb\" Float 1 1 AAAAAA== \"cg\" Float 1 1 AAAAAA== \"c1\" Float 1 1 AAAAAA== \"c2\" Float 1 1 AAAAAA== \"c3\" Float 1 1 AAAAAA== \"eta\" Float 1 1 AAAAAA== \"rho\" Float 1 1 AAAAAA=="
   kernelSource "\nkernel ZCAM_JMh_Kernel : ImageComputationKernel<ePixelWise>\n\{\n  Image<eRead, eAccessPoint, eEdgeClamped> src; // the input image\n  Image<eRead, eAccessPoint, eEdgeClamped> refWhite; // reference white image\n  Image<eRead, eAccessPoint, eEdgeClamped> d65White; // D65 white image\n  Image<eWrite> dst; // the output image\n\n  param:\n    int direction;\n    float referenceLuminance;\n    float F;\n    float F_s;\n    float L_A;\n    float F_b;\n    float F_L;\n    float adaptDegree;\n    float3x3 CAT02_XYZ_to_LMS;\n    float3x3 ZCAM_XYZ_to_LMS;\n    float3x3 ZCAM_LMS_to_Izazbz;\n\n  local:\n    float cb;\n    float cg;\n    float c1;\n    float c2;\n    float c3;\n    float eta;\n    float rho;\n\n\n  void define()\n  \{\n\n  \}\n\n\n  void init()\n  \{\n    cb  = 1.15f;\n    cg  = 0.66f;\n    c1  = 3424.0f / pow(2.0f,12.0f);\n    c2  = 2413.0f / pow(2.0f, 7.0f);\n    c3  = 2392.0f / pow(2.0f, 7.0f);\n    eta = 2610.0f / pow(2.0f,14.0f);\n    rho = 1.7f * 2523.0f / pow(2.0f,5.0f);\n  \}\n\n\n  float3 vector_dot( float3x3 m, float3 v)\n  \{\n    float3 r = 1.0f;\n    for(int c = 0; c<3; c++)\n    \{\n      r\[c] = m\[c]\[0]*v.x + m\[c]\[1]*v.y + m\[c]\[2]*v.z;\n    \}\n\n    return r;\n  \}\n\n\n  float3 CAT_Zhai2018( float3 XYZ_b, float3 XYZ_wb, float3 XYZ_wd, float D_b, float D_d, float3x3 M)\n  \{\n    float3 XYZ_wo = 100.0f;\n    float3 RGB_b = vector_dot(M, XYZ_b);\n    float3 RGB_wb = vector_dot(M, XYZ_wb);\n    float3 RGB_wd = vector_dot(M, XYZ_wd);\n    float3 RGB_wo = vector_dot(M, XYZ_wo);\n    \n    float3 D_RGB_b = D_b * (XYZ_wb.y / XYZ_wo.y) * (RGB_wo / RGB_wb) + 1 - D_b;\n    float3 D_RGB_d = D_d * (XYZ_wd.y / XYZ_wo.y) * (RGB_wo / RGB_wd) + 1 - D_d;\n    float3 D_RGB = D_RGB_b / D_RGB_d;\n    \n    float3 RGB_d = D_RGB * RGB_b;\n    float3 XYZ_d = vector_dot(M.invert(), RGB_d);\n    \n    return XYZ_d;\n  \}\n\n\n  float3 XYZ_to_Izazbz( float3 XYZD65 )\n  \{\n    float3 XYZpD65 = XYZD65;\n    XYZpD65.x = cb * XYZD65.x - (cb - 1.0f) * XYZD65.z;\n    XYZpD65.y = cg * XYZD65.y - (cg - 1.0f) * XYZD65.x;\n    float3 LMS = vector_dot(ZCAM_XYZ_to_LMS, XYZpD65);\n    float3 LMSp = 0.0f;\n    LMSp.x = pow( ( c1 + c2 * pow((LMS.x/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.x/10000.0f),eta) ), rho);\n    LMSp.y = pow( ( c1 + c2 * pow((LMS.y/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.y/10000.0f),eta) ), rho);\n    LMSp.z = pow( ( c1 + c2 * pow((LMS.z/10000.0f),eta) ) / ( 1.0f + c3 * pow((LMS.z/10000.0f),eta) ), rho);\n    float3 Izazbz = vector_dot(ZCAM_LMS_to_Izazbz, LMSp);\n    return Izazbz;\n  \}\n\n\n  float degrees( float radians )\n  \{\n    return radians * 180.0f / PI;\n  \}\n\n\n  float radians( float degrees )\n  \{\n    return degrees / 180.0f * PI;\n  \}\n\n\n  float3 Izazbz_to_JMh( float3 Izazbz, float refWhiteIz )\n  \{\n    float3 JMh = 0.0f;\n\n    JMh.z = fmod(degrees(atan2(Izazbz.z,Izazbz.y))+360.0f,360.0f);\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float Qz = 2700.0f * pow(Izazbz.x, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    JMh.x = 100.0f * (Qz / Qzw);\n    JMh.y = 100.0f * pow((pow(Izazbz.y, 2.0f) + pow(Izazbz.z, 2.0f)), 0.37f) * ((pow(ez, 0.068f) * pow(F_L, 0.2f)) / (pow(F_b, 0.1f) * pow(refWhiteIz, 0.78f)));\n\n    return JMh;\n  \}\n\n\n  float3 JMh_to_Izazbz( float3 JMh, float refWhiteIz)\n  \{\n    float Qzm = pow(F_s, 2.2f) * pow(F_b, 0.5f) * pow(F_L, 0.2f);\n    float Qzw = 2700.0f * pow(refWhiteIz, (1.6f * F_s) / pow(F_b, 0.12f)) * Qzm;\n    float Izp = pow(F_b, 0.12f) / (1.6f * F_s);\n    float Izd = 2700.0f * 100.0f * Qzm;\n    float ez = 1.015f + cos(radians(89.038f+JMh.z));\n    float hzr = radians(JMh.z);\n    float Czp = pow((JMh.y * pow(refWhiteIz, 0.78f) * pow(F_b, 0.1f)) / (100.0f * pow(ez, 0.068f) * pow(F_L, 0.2f)), 50.0f / 37.0f);\n\n    return float3( pow((JMh.x * Qzw) / Izd, Izp), Czp * cos(hzr), Czp * sin(hzr));\n  \}\n\n\n  float3 Izazbz_to_XYZ( float3 Izazbz )\n  \{\n    float3 LMSp = vector_dot(ZCAM_LMS_to_Izazbz.invert(), Izazbz);\n    float3 LMS = 0.0f;\n    LMS.x = 10000.0f*pow((c1-pow(LMSp.x,1.0f/rho)) / (c3*pow(LMSp.x,1.0f/rho)-c2),1.0f/eta);\n    LMS.y = 10000.0f*pow((c1-pow(LMSp.y,1.0f/rho)) / (c3*pow(LMSp.y,1.0f/rho)-c2),1.0f/eta);\n    LMS.z = 10000.0f*pow((c1-pow(LMSp.z,1.0f/rho)) / (c3*pow(LMSp.z,1.0f/rho)-c2),1.0f/eta);\n    float3 XYZpD65 = vector_dot(ZCAM_XYZ_to_LMS.invert(), LMS);\n    float3 XYZD65 = XYZpD65;\n    XYZD65.x = (XYZpD65.x+(cb-1.0f)*XYZpD65.z)/cb;\n    XYZD65.y = (XYZpD65.y+(cg-1.0f)*XYZD65.x)/cg;\n    return XYZD65;\n  \}\n\n\n  float3 XYZ_to_ZCAM_JMh( float3 XYZ, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return Izazbz_to_JMh(XYZ_to_Izazbz(CAT_Zhai2018(XYZ, refWhite, d65White, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS)), refWhiteIzazbz.x);\n  \}\n\n\n  float3 ZCAM_JMh_to_XYZ( float3 JMh, float3 refWhite, float3 d65White )\n  \{\n    float3 refWhiteIzazbz = XYZ_to_Izazbz(refWhite*referenceLuminance/refWhite.y);\n    return CAT_Zhai2018(Izazbz_to_XYZ(JMh_to_Izazbz(JMh, refWhiteIzazbz.x)), d65White, refWhite, adaptDegree, adaptDegree, CAT02_XYZ_to_LMS);\n  \}\n\n\n  void process()\n  \{\n    SampleType(src) input = src();\n    SampleType(refWhite) inputRefWhite = refWhite();\n    SampleType(d65White) inputD65White = d65White();\n\n    float3 output = 0.0f;\n\n    if( direction == 0 )\n    \{\n      output = XYZ_to_ZCAM_JMh(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n    else\n    \{\n       output = ZCAM_JMh_to_XYZ(float3(input.x, input.y, input.z), float3(inputRefWhite.x, inputRefWhite.y, inputRefWhite.z), float3(inputD65White.x, inputD65White.y, inputD65White.z));\n    \}\n\n    dst() = float4(output.x, output.y, output.z, input.w);\n  \}\n\};\n"
   rebuild ""
   ZCAM_JMh_Kernel_direction {{parent.invert}}
   ZCAM_JMh_Kernel_referenceLuminance {{parent.referenceLuminance}}
   ZCAM_JMh_Kernel_F {{"\[python (0.8, 0.9, 1.0)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_F_s {{"\[python (0.525, 0.59, 0.69)\\\[\[numvalue viewingConditions]\\]]"}}
   ZCAM_JMh_Kernel_L_A {{"referenceLuminance * backgroundLuminance / 100"}}
   ZCAM_JMh_Kernel_F_b {{sqrt(backgroundLuminance/referenceLuminance)}}
   ZCAM_JMh_Kernel_F_L {{"0.171*pow(ZCAM_JMh_Kernel_L_A, 1/3) * (1-exp(-48/9*ZCAM_JMh_Kernel_L_A))"}}
   ZCAM_JMh_Kernel_adaptDegree {{"parent.discountIlluminant ? 1 : ZCAM_JMh_Kernel_F * (1 - (1 / 3.6) * exp((-ZCAM_JMh_Kernel_L_A - 42) / 92))"}}
   ZCAM_JMh_Kernel_CAT02_XYZ_to_LMS {
       {0.7328 0.4296 -0.1624}
       {-0.7036 1.6975 0.0061}
       {0.003 0.0136 0.9834}
     }
   ZCAM_JMh_Kernel_ZCAM_XYZ_to_LMS {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   ZCAM_JMh_Kernel_ZCAM_LMS_to_Izazbz {
       {0 {1-epsilon} 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   rebuild_finalise ""
   name BlinkScript1
   note_font "Bitstream Vera Sans"
   xpos 828
   ypos 221
   addUserKnob {20 User}
   addUserKnob {7 epsilon}
   epsilon 3.703522621e-11
  }
  Output {
   name Output1
   xpos 828
   ypos 335
  }
 end_group
 Multiply {
  channels rgb
  value 0.01
  name Multiply5
  label "Lum to Linear"
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos 376
  disable {{Colorspace3.colorspace_out==31}}
 }
 Colorspace {
  colorspace_in CIE-XYZ
  colorspace_out BT1886
  name Colorspace3
  label "XYZ to Output"
  xpos -1148
  ypos 412
 }
 Clamp {
  channels rgb
  name Clamp6
  note_font "Bitstream Vera Sans"
  xpos -1148
  ypos 444
 }
 Dot {
  name Dot26
  note_font "Bitstream Vera Sans"
  xpos -1114
  ypos 549
 }
 Dot {
  name Dot27
  note_font "Bitstream Vera Sans"
  xpos -502
  ypos 549
 }
 Switch {
  inputs 2
  which {{parent.invert}}
  name Switch1
  note_font "Bitstream Vera Sans"
  xpos -516
  ypos 588
 }
 Output {
  name Output
  xpos -516
  ypos 714
 }
end_group
Reformat {
 type scale
 scale 7
 filter impulse
 name Reformat3
 xpos 759
 ypos 367
}
set N6a263800 [stack 0]
Viewer {
 inputs 2
 frame_range 1-100
 gl_buffer_depth half-float
 viewerProcess None
 name Viewer1
 xpos -203
 ypos 82
}
Read {
 inputs 0
 file_type exr
 file "/Users/afry/Working/VWG_ODT_Exports/ACES2.0 CandidateA rev001 Rec709/ACES2.0 CandidateA rev001 Rec709_########.exr"
 format "1920 1080 0 0 1920 1080 1 HD_1080"
 first 86400
 last 86403
 origfirst 86400
 origlast 86403
 origset true
 name Read1
 xpos 400
 ypos -111
}
Retime {
 input.first 86400
 input.first_lock true
 input.last 86403
 output.first_lock true
 output.last 4
 time ""
 name Retime1
 xpos 400
 ypos -31
}
push $N14e99c00
Dot {
 name Dot2
 xpos 15
 ypos 261
}
set N14e99800 [stack 0]
Group {
 name ACES_OutputTransform_v1_2_1
 tile_color 0xa57aaaff
 label "Rec2020_ST2084_1000nits_15nits\nno glow_module\nno red_modifier\nno global desat"
 xpos 117
 ypos 314
 addUserKnob {20 ACES_OutputTransform_tab l "ACES OutputTransform"}
 addUserKnob {41 gamut l "input gamut" T GamutToXYZ_lite.gamut}
 addUserKnob {26 ""}
 addUserKnob {35 presets t "display output presets." M {display/sRGB "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 0 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"sRGB\"\}" "display/sRGB D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 0 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"sRGB D60 sim.\"\}" display/Rec.709 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 1 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.709\"\}" "display/Rec.709 D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 1 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.709 D60 sim.\"\}" display/Rec.2020 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 1 limiting_pri 1 eotf 1 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.2020\"\}" display/P3D60 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 4 limiting_pri 4 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D60\"\}" display/P3D65 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 2 limiting_pri 2 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65\"\}" "display/P3D65 D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 2 limiting_pri 2 eotf 4 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 D60 sim.\"\}" display/P3DCI "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3DCI\"\}" "display/P3DCI D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3DCI D60 sim.\"\}" "display/P3DCI D65 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 1 dark_to_dim 0 legal_range 0 label \"P3DCI D65 sim.\"\}" display/DCDM "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 7 limiting_pri 7 eotf 5 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"DCDM\"\}" "display/P3D65 ST2084 108nits 7.2nits" "knobs this \{lum \{0.0001 7.2 108\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 108nits 7.2nits\"\}" "display/P3D65 ST2084 1000nits 15nits" "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 1000nits 15nits\"\}" "display/P3D65 ST2084 2000nits 15nits" "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 2000nits 15nits\"\}" "display/P3D65 ST2084 2000nits 15nits" "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 2000nits 15nits\"\}" "display/P3D65 ST2084 4000nits 15nits" "knobs this \{lum \{0.0001 15 4000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 4000nits 15nits\"\}" display/Rec2020_HLG_1000nits_15nits "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 7 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_HLG_1000nits_15nits\"\}" display/Rec2020_ST2084_1000nits_15nits "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_1000nits_15nits\"\}" display/Rec2020_ST2084_2000nits_15nits "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_2000nits_15nits\"\}" display/Rec2020_ST2084_4000nits_15nits "knobs this \{lum \{0.0001 15 4000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_4000nits_15nits\"\}" display/OCES "knobs this \{lum \{0.0001 4.8 10000\} override_ssts_params 0 use_c9 0 display_pri 6 limiting_pri 6 eotf 9 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"OCES\"\}" "" ""}}
 addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
 addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
 lum {0.0001 15 1000}
 addUserKnob {20 ssts_params_grp l "SSTS Parameters" n 1}
 addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
 addUserKnob {35 presets_ssts_param l presets t "If you want to override the default SSTS parameters and play around, here are some useful starting points." M {contrast/default "knobs this \{override_ssts_params 0 pctLow 0.35 pctHigh 0.89 slope \{0 1.5 0.\} exposure 0.0 use_c9 0\}" contrast/sdr "knobs this \{override_ssts_params 1 pctLow 0.35 pctHigh 0.89 slope \{0.1 1.6 0.01\} exposure 0.0 use_c9 0\}" contrast/high "knobs this \{override_ssts_params 1 pctLow 0.2 pctHigh 0.89 slope \{0.28 1.75 0.01\} exposure 0.0 use_c9 0\}" contrast/med "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.89 slope \{0.38 1.3 0.01\} exposure 0.0 use_c9 0\}" contrast/med-low "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.80 slope \{0.38 1.42 0.01\} exposure 0.0 use_c9 0\}" contrast/low "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.80 slope \{0.38 1.2 0.01\} exposure 0.0 use_c9 0\}" ""}}
 addUserKnob {7 exposure R -5 5}
 addUserKnob {7 pctLow l knee}
 pctLow 0.35
 addUserKnob {7 pctHigh l shoulder}
 pctHigh 0.89
 addUserKnob {78 slope n 3}
 slope {0.38 1.501 0.01}
 addUserKnob {20 endGroup n -1}
 addUserKnob {6 use_c9 l "use SegmentedSpline_c9" t "In ACES 1.1 the Output Transform was re-written for HDR tonescales. \n\nIn ACES 1.1, HDR transforms use the new SSTS (Single Stage Tone Scale), while SDR transforms continue to use the old SegmentedSpline_c5 -> OCES -> SegmentedSpline_c9 -> ODT transform.\n\nIf this is enabled, the SegmentedSpline_c9 transform is used to maintain compatibility with the ACES SDR output transforms and enable a 1:1 match with the AMPAS CTL.\n\nIf you are curious, turn use_c9 off and play around with the SSTS Parameters." +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {4 display_pri l "display pri" t "Display encoding primaries." M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
 display_pri Rec2020
 addUserKnob {4 limiting_pri l "limiting pri" t "Limiting primaries for the output transform." -STARTLINE M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
 limiting_pri P3D65
 addUserKnob {4 eotf l EOTF t "Electrical to Optical Transfer Function of the monitor." M {sRGB BT.1886 "Gamma 2.2" "Gamma 2.4" "Gamma 2.6" DCDM "ST-2084 (PQ)" HLG Linear OCES ""}}
 eotf "ST-2084 (PQ)"
 addUserKnob {6 stretch_black l "stretch black" t "For hdr outputs: stretch black luminance to a PQ code value of 0" +STARTLINE}
 stretch_black true
 addUserKnob {6 d60_sim l "d60 sim" t "d60 whitepoint simulation." +STARTLINE}
 addUserKnob {6 force_d65_cat l "force d60 to d65 cat" -STARTLINE}
 addUserKnob {6 dark_to_dim l "dark to dim surround" t "Apply gamma adjustment to compensate for \"Dark to Dim\" surround. For SDR outputs only." +STARTLINE}
 addUserKnob {6 legal_range l "legal range" t "Output legal range." +STARTLINE}
}
 BackdropNode {
  inputs 0
  name Electrical_Optical_Transfer_Function
  tile_color 0x151515ff
  label "ACESlib.OutputTransforms.ctl : 185\n// EOTF"
  note_font_size 12
  xpos -2025
  ypos 2294
  bdwidth 3391
  bdheight 740
  z_order -10
 }
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x272727ff
  label "HDR EOTFs"
  note_font_size 42
  xpos 425
  ypos 2379
  bdwidth 910
  bdheight 617
  z_order -5
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x272727ff
  label "SDR EOTFs"
  note_font_size 42
  xpos -1158
  ypos 2384
  bdwidth 1436
  bdheight 608
  z_order -5
 }
 BackdropNode {
  inputs 0
  name AP1_to_XYZ
  tile_color 0x555b5cff
  label "ACESlib.OutputTransforms.ctl : 90\n// Rendering primaries to XYZ\n"
  note_font_size 12
  xpos -1400
  ypos 906
  bdwidth 380
  bdheight 156
 }
 BackdropNode {
  inputs 0
  name AP1_to_XYZ1
  tile_color 0x555a5cff
  label "// Apply desaturation to compensate for luminance difference\nlinearCV = mult_f3_f33( linearCV, ODT_SAT_MAT);\n( SDR only)"
  note_font_size 12
  xpos -1412
  ypos 669
  bdwidth 439
  bdheight 186
 }
 BackdropNode {
  inputs 0
  name D60_whitepoint_simulation
  tile_color 0x232323ff
  label "ACESlib.OutputTransforms.ctl : 150\n// Scale to avoid clipping when device calibration is different from D60. \n// To simulate D60, unequal code values are sent to the display.\n"
  note_font_size 12
  xpos -1399
  ypos 176
  bdwidth 818
  bdheight 463
 }
 BackdropNode {
  inputs 0
  name Luminance_to_Linear_Code_Values
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 87\n/*  Scale absolute luminance to linear code value  */\n"
  note_font_size 12
  xpos -1367
  ypos -50
  bdwidth 315
  bdheight 148
 }
 BackdropNode {
  inputs 0
  name Output_Color_Encoding_Specification
  tile_color 0x1d1d1dff
  label "<font size=12>OCES\n<font size=0.1>\n- ACES Output Output Color Encoding Specification \n- An idealized reference display with 0.0001 / 4.8 / 10000 luma\n w/ ACES AP0 Primaries."
  note_font_size 27.4
  xpos -1833
  ypos 2379
  bdwidth 367
  bdheight 377
 }
 BackdropNode {
  inputs 0
  name Output_Legal_Range
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 216\n"
  note_font_size 12
  xpos -1369
  ypos 3128
  bdwidth 318
  bdheight 176
 }
 BackdropNode {
  inputs 0
  name Single_Stage_Tone_Scale
  tile_color 0x272727ff
  label "<b>Single Stage Tone Scale : ACESlib.OutputTransforms.ctl : 82</b><pre>// Apply the tonescale independently in rendering-space RGB\nfloat rgbPost\[3] = ssts_f3( rgbPre, PARAMS);\n\nIf output is SDR, output OCES from SSTS and use SegmentedSpline_c9."
  note_font_size 12
  xpos -1502
  ypos -653
  bdwidth 609
  bdheight 533
 }
 BackdropNode {
  inputs 0
  name clamp_negatives
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 174\n// Clip values < 0 (i.e. projecting outside the display primaries)\nNote: Also clamping values > 1 here."
  note_font_size 12
  xpos -1393
  ypos 2087
  bdwidth 386
  bdheight 120
 }
 BackdropNode {
  inputs 0
  name dim_surround_gamma_adjustment
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 92\n// Apply gamma adjustment to compensate for dim surround\n"
  note_font_size 12
  xpos -1407
  ypos 1063
  bdwidth 395
  bdheight 258
 }
 BackdropNode {
  inputs 0
  name limit_primaries
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 130\n// Gamut limit to limiting primaries\n"
  note_font_size 12
  xpos -1408
  ypos 1655
  bdwidth 396
  bdheight 194
 }
 BackdropNode {
  inputs 0
  name limit_primaries1
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 144\n// CIE XYZ to display encoding primaries\n"
  note_font_size 12
  xpos -1402
  ypos 1892
  bdwidth 384
  bdheight 151
 }
 BackdropNode {
  inputs 0
  name limit_primaries2
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 130\n    // Apply CAT from ACES white point to assumed observer adapted white point\n    // TODO: Needs to expand from just supporting D60 sim to allow for any\n    // observer adapted white point.\n"
  note_font_size 12
  xpos -1407
  ypos 1337
  bdwidth 467
  bdheight 301
 }
 BackdropNode {
  inputs 0
  name rrt_sweeteners_
  tile_color 0x555a5cff
  label "<b>RRT Sweeteners : ACESlib.OutputTransforms.ctl : 79</b><pre>// RRT sweeteners\nfloat rgbPre\[3] = rrt_sweeteners( in);\n"
  note_font_size 18
  xpos -1469
  ypos -1234
  bdwidth 519
  bdheight 548
 }
 Input {
  inputs 0
  name Input
  xpos -1250
  ypos -1450
 }
 AddChannels {
  channels rgba
  name AddChannels
  xpos -1250
  ypos -1415
 }
 Group {
  name GamutToXYZ_lite
  xpos -1250
  ypos -1373
  addUserKnob {20 GamutToXYZ_lite_tab l GamutToXYZ_lite}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut ACES
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {20 chromaticities_grp l "" +STARTLINE n 1}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {20 endGroup n -1}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 ColorMatrix {
  matrix {
      {1.049811006 0 -9.748453158e-05}
      {-0.4959030151 1.373313069 0.09824004024}
      {4.020908051e-08 0 0.9912520051}
    }
  name ColorMatrix4
  label "XYZ to ACES"
  note_font Helvetica
  xpos -1250
  ypos -1338
 }
 Dot {
  name Dot7
  label " ACES 2065-1 IN"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -1268
 }
 Group {
  name glow_module1
  note_font Helvetica
  xpos -1250
  ypos -1089
  disable true
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 RRT_GLOW_GAIN}
  RRT_GLOW_GAIN 0.05
  addUserKnob {7 RRT_GLOW_MID}
  RRT_GLOW_MID 0.08
  addUserKnob {6 invert +STARTLINE}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -562
  }
  Dot {
   name Dot2
   xpos -6
   ypos -510
  }
set N14dfb000 [stack 0]
  Dot {
   name Dot4
   xpos -116
   ypos -510
  }
set N14dfac00 [stack 0]
  Expression {
   temp_name0 chroma
   temp_expr0 sqrt(b*(b-g)+g*(g-r)+r*(r-b))
   temp_name1 ycRadiusWeight
   temp_expr1 1.75
   channel0 {-rgba.red rgba.green -rgba.blue none}
   expr0 "( b + g + r + ycRadiusWeight * chroma) / 3.0"
   channel1 {rgba.red -rgba.green -rgba.blue none}
   expr1 0
   expr2 0
   name rgb_2_yc1
   xpos -150
   ypos -466
  }
push 0
push $N14dfac00
  Dot {
   name Dot3
   xpos -226
   ypos -510
  }
  Expression {
   temp_name0 TINY
   temp_expr0 1e-10
   temp_name1 min_f3
   temp_expr1 min(r,min(g,b))
   temp_name2 max_f3
   temp_expr2 max(r,max(g,b))
   expr0 "(max( max_f3, TINY) - max( min_f3, TINY)) / max( max_f3, 1e-2)"
   expr1 0
   expr2 0
   name rgb_2_saturation1
   xpos -260
   ypos -466
  }
set N14dfa000 [stack 0]
  Expression {
   channel0 {rgba.red rgba.green rgba.blue none}
   expr0 "(r - 0.4) / 0.2"
   name Expression1
   xpos -370
   ypos -466
  }
  Expression {
   temp_name0 t
   temp_expr0 "max( 1.0 - fabs( r / 2.0), 0.0)"
   temp_name1 sign
   temp_expr1 r>0?1:r<0?-1:0
   temp_name2 valy
   temp_expr2 "1.0 + sign * (1.0 - t * t)"
   channel0 {-rgba.red -rgba.green rgba.blue none}
   expr0 "valy / 2"
   channel1 {rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red rgba.green rgba.blue none}
   expr2 0
   name sigmoid_shaper1
   xpos -370
   ypos -442
  }
push $N14dfa000
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   note_font Helvetica
   xpos -260
   ypos -393
  }
set N14df9400 [stack 0]
  Expression {
   temp_name0 ycOut
   temp_expr0 g
   temp_name1 glowGainIn
   temp_expr1 "RRT_GLOW_GAIN * b"
   temp_name2 glowMid
   temp_expr2 RRT_GLOW_MID
   channel0 rgb
   expr0 "1 + ((ycOut <= ((1 + glowGainIn) * 2./3. * glowMid)) ? -glowGainIn / (1 + glowGainIn) : ( ycOut >= (2. * glowMid)) ? 0 : glowGainIn * (glowMid / ycOut - 1./2.) / (glowGainIn / 2. - 1.))"
   channel1 none
   channel2 none
   name glow_inv
   xpos -150
   ypos -346
  }
push $N14df9400
  Expression {
   temp_name0 ycIn
   temp_expr0 g
   temp_name1 glowGainIn
   temp_expr1 "RRT_GLOW_GAIN * b"
   temp_name2 glowMid
   temp_expr2 RRT_GLOW_MID
   channel0 rgb
   expr0 "1 + ( ycIn <= 2./3. * glowMid ? glowGainIn : ycIn >= 2. * glowMid ? 0 : glowGainIn * (glowMid / ycIn - 1./2.) )"
   channel1 none
   channel2 none
   name glow_fwd
   xpos -370
   ypos -346
  }
  Switch {
   inputs 2
   which {{parent.invert}}
   name Switch_direction
   note_font Helvetica
   xpos -260
   ypos -297
  }
  Dot {
   name Dot5
   xpos -226
   ypos -246
  }
push $N14dfb000
  Merge2 {
   inputs 2
   operation multiply
   bbox B
   output rgb
   name Merge3
   note_font Helvetica
   xpos -40
   ypos -249
  }
  Output {
   name Output
   xpos -40
   ypos -178
  }
 end_group
 Group {
  name red_modifier1
  note_font Helvetica
  xpos -1250
  ypos -1041
  disable true
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 RRT_RED_SCALE}
  RRT_RED_SCALE 0.82
  addUserKnob {7 RRT_RED_PIVOT}
  RRT_RED_PIVOT 0.03
  addUserKnob {7 RRT_RED_HUE}
  addUserKnob {7 RRT_RED_WIDTH R 0 360}
  RRT_RED_WIDTH 135
  addUserKnob {6 invert +STARTLINE}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  Dot {
   name Dot1
   xpos -6
   ypos 42
  }
set N14d8f400 [stack 0]
  Dot {
   name Dot2
   xpos -226
   ypos 42
  }
set N14d8f000 [stack 0]
  Expression {
   temp_name0 TINY
   temp_expr0 1e-10
   temp_name1 min_f3
   temp_expr1 min(r,min(g,b))
   temp_name2 max_f3
   temp_expr2 max(r,max(g,b))
   channel0 rgb
   expr0 "(max( max_f3, TINY) - max( min_f3, TINY)) / max( max_f3, 1e-2)"
   channel1 none
   expr1 0
   channel2 none
   expr2 0
   name rgb_2_saturation
   xpos -260
   ypos 86
  }
push $N14d8f000
  Dot {
   name Dot3
   xpos -336
   ypos 42
  }
  Expression {
   temp_name0 hue
   temp_expr0 "(r==g&&g==b)?0:(180/pi) * atan2( sqrt(3)*(g-b), 2*r-g-b)"
   channel0 {rgba.red -rgba.green -rgba.blue -rgba.alpha}
   expr0 "hue < 0 ? hue + 360 : hue"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   expr2 0
   name rgb_2_hue
   xpos -370
   ypos 86
  }
  Expression {
   temp_name0 hue
   temp_expr0 r
   temp_name1 centerH
   temp_expr1 RRT_RED_HUE
   temp_name2 hueCentered
   temp_expr2 hue-centerH
   channel0 {-rgba.red rgba.green -rgba.blue -rgba.alpha}
   expr0 "hueCentered < -180.0 ? hueCentered + 360.0 : (hueCentered > 180.0) ? hueCentered - 360.0 : hueCentered"
   name center_hue
   xpos -370
   ypos 134
  }
  Expression {
   temp_name0 centeredHue
   temp_expr0 g
   temp_name1 knot_coord
   temp_expr1 "(centeredHue - knots.0) * 4.0/w"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   channel0 {rgba.red -rgba.green -rgba.blue -rgba.alpha}
   expr0 "(min((centeredHue > knots.0?1:0) , (centeredHue < knots.4?1:0)) ? j == 3 ? t*t*t * -1./6 + t*t * 3./6 +  t * -3./6 + 1 * 1./6 : j == 2 ? t*t*t * 3./6 + t*t * -6./6 + t * 0./6 + 1. *4./6 : j == 1 ? t*t*t * -3./6 + t*t * 3./6 + t * 3./6 + 1. * 1./6 : j == 0 ? t*t*t * 1./6 + t*t * 0./6 + t * 0./6 + 1. * 0./6 : 0 : 0) * 3/2"
   channel1 none
   channel2 none
   name cubic_basis_shaper
   xpos -370
   ypos 182
   addUserKnob {20 param}
   addUserKnob {7 w R 0 360}
   w {{parent.RRT_RED_WIDTH}}
   addUserKnob {78 knots n 5}
   knots {{-w/2} {-w/4} 0 {w/4} {w/2}}
  }
  Dot {
   name Dot4
   xpos -336
   ypos 234
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy4
   note_font Helvetica
   xpos -260
   ypos 226
  }
  Dot {
   name Dot6
   label " r : hueWeight\n g : centeredHue\n b : saturation"
   note_font "Helvetica \[pyrs]"
   note_font_size 12
   note_font_color 0xff
   xpos -226
   ypos 282
  }
  Dot {
   name Dot7
   xpos -226
   ypos 330
  }
set N14d8cc00 [stack 0]
push $N14d8f400
  Dot {
   name Dot8
   xpos -6
   ypos 258
  }
set N14d8c800 [stack 0]
  MergeExpression {
   inputs 2
   temp_name0 minChan
   temp_expr0 "Ag < 0 ? Bg : Bb"
   temp_name1 a_
   temp_expr1 "Ar * (1. - RRT_RED_SCALE) - 1."
   temp_name2 b
   temp_expr2 "Br - Ar* (RRT_RED_PIVOT + minChan) * (1. - RRT_RED_SCALE)"
   temp_name3 c
   temp_expr3 "Ar * RRT_RED_PIVOT * minChan * (1. - RRT_RED_SCALE)"
   expr0 "( -b - sqrt( b * b - 4. * a_ * c)) / ( 2. * a_)"
   name red_modifier_rev
   note_font Helvetica
   xpos -150
   ypos 351
  }
push $N14d8cc00
push $N14d8c800
  MergeExpression {
   inputs 2
   expr0 "r + Ar * Ab * (RRT_RED_PIVOT - r) * (1. - RRT_RED_SCALE)"
   name red_modifier_fwd
   note_font Helvetica
   xpos -40
   ypos 327
  }
  Switch {
   inputs 2
   which {{parent.invert}}
   name Switch_direction
   note_font Helvetica
   xpos -40
   ypos 423
  }
  Output {
   name Output
   xpos -40
   ypos 494
  }
 end_group
 Clamp {
  channels rgb
  maximum_enable false
  name clamp_f3_min
  label "Clamp Negative Values"
  xpos -1250
  ypos -976
 }
 ColorMatrix {
  matrix {
      {1.451439381 -0.2365107685 -0.2149285674}
      {-0.07655383646 1.176229835 -0.09967593104}
      {0.008316127583 -0.0060324613 0.997716248}
    }
  name ColorMatrix15
  label "ACES to ACEScg"
  xpos -1250
  ypos -928
 }
 Clamp {
  channels rgb
  maximum 65535
  name clamp_f3_
  label "clamp to HALF_MAX"
  xpos -1250
  ypos -880
 }
 ColorMatrix {
  matrix {
      {{"(1.0 - sat) * rgb2Y.x + sat"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y + sat"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z + sat"}}
    }
  name ColorMatrix
  label "// --- Global desaturation --- //\nrgbPre = mult_f3_f33( rgbPre, RRT_SAT_MAT);"
  selected true
  xpos -1250
  ypos -790
  disable true
  addUserKnob {20 params}
  addUserKnob {13 rgb2Y}
  rgb2Y {0.27222875 0.67408174 0.05368952}
  addUserKnob {7 sat}
  sat 0.96
 }
 Dot {
  name Dot29
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xff
  xpos -1216
  ypos -558
 }
set N15032400 [stack 0]
 Group {
  name ssts
  xpos -1250
  ypos -514
  addUserKnob {20 ssts_tab l ssts}
  addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
  addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
  lum {{"use_c9 ? 0.0001 : parent.lum"} {parent.lum} {"use_c9 ? 10000 : parent.lum"}}
  addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
  override_ssts_params {{parent.override_ssts_params}}
  addUserKnob {7 exposure R -5 5}
  exposure {{parent.exposure}}
  addUserKnob {7 knee}
  knee {{parent.pctLow}}
  addUserKnob {7 shoulder}
  shoulder {{parent.pctHigh}}
  addUserKnob {78 slope n 3}
  slope {{parent.slope} {parent.slope} {parent.slope}}
  addUserKnob {20 TsParams_tab l TsParams}
  addUserKnob {7 mid_lum l "mid lum" R 0 20}
  mid_lum {{parent.lum.1}}
  addUserKnob {7 expShift R -4 4}
  expShift {{"(parent.override_ssts_params ? exposure : 0) + (mid_lum<= 4.8 ? 0 : \[sample parent.expShift r 0 0] )"}}
  addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  minPoint {{"pow(2, log(0.18*pow(2, MIN_STOP_RRT+((MIN_STOP_SDR-MIN_STOP_RRT)/(log10(MIN_LUM_SDR)-log10(MIN_LUM_RRT)))*(log10(minPoint.y)-log10(MIN_LUM_RRT))))/log(2)-expShift)"} {lum.0} {override_ssts_params?slope.0:0}}
  addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  midPoint {{"pow(2, ((log(0.18)/log(2)-expShift)))"} 4.8 {override_ssts_params?slope.1:1.55}}
  addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  maxPoint {{"pow(2, log(0.18*pow(2, (MAX_STOP_SDR + (MAX_STOP_RRT-MAX_STOP_SDR) / (log10(MAX_LUM_RRT)-log10(MAX_LUM_SDR)) * (log10(maxPoint.y)-log10(MAX_LUM_SDR)))))/log(2)-expShift)"} {lum.2} {override_ssts_params?slope.2:0}}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(midPoint.x) - log10(minPoint.x)) / 3.0"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(maxPoint.x) - log10(midPoint.x)) / 3.0"}}
  addUserKnob {7 pctLow}
  pctLow {{0.18+(0.35-0.18)/(MIN_STOP_SDR-MIN_STOP_RRT)*(log(minPoint.x/0.18)/log(2)-MIN_STOP_RRT)}}
  addUserKnob {7 pctHigh}
  pctHigh {{0.89+(0.90-0.89)/(MAX_STOP_SDR-MAX_STOP_RRT)*(log(maxPoint.x/0.89)/log(2)-MAX_STOP_RRT)}}
  addUserKnob {78 coefsLow n 5}
  coefsLow {{"(minPoint.z * (log10(minPoint.x)-0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {"(minPoint.z * (log10(minPoint.x)+0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {log10(minPoint.y)+pctLow*(log10(midPoint.y)-log10(minPoint.y))} {"(midPoint.z * (log10(midPoint.x)-0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"}}
  addUserKnob {78 coefsHigh n 5}
  coefsHigh {{"(midPoint.z * (log10(midPoint.x)-0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {log10(midPoint.y)+pctHigh*(log10(maxPoint.y)-log10(midPoint.y))} {"(maxPoint.z * (log10(maxPoint.x)-0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"} {"(maxPoint.z * (log10(maxPoint.x)+0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"}}
  addUserKnob {20 Constants_tab l const}
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
  addUserKnob {7 MIN_STOP_SDR R -20 20}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -20 20}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR R 0 0.1}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 100}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT R 0 0.1}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N15031c00 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N15031c00
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N15031400 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N15031000 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N15030c00 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N15030800 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr <= log10(minPoint.x)"
   expr1 "logg <= log10(minPoint.x)"
   expr2 "logb <= log10(minPoint.x)"
   name segment_bottom
   xpos -590
   ypos -178
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N15030800
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N14fd3800 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr1 "logg * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr2 "logb* minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr3 1
   name Expression
   xpos -370
   ypos -178
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N15030c00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
   expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
   expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
   name segment_low
   xpos -700
   ypos -178
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N14fd3800
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N14fd2000 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -198
  }
set N14fd1c00 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -198
  }
set N14fd1800 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -198
  }
  Dot {
   name Dot12
   label " "
   xpos 434
   ypos -78
  }
set N14fd1000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression5
   xpos 290
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix3
   label "mult_f3_f33( cf, M)"
   xpos 290
   ypos 8
  }
push $N14fd1000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression6
   xpos 400
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f2
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 400
   ypos 8
  }
push 0
push $N14fd1800
  Dot {
   name Dot11
   label " "
   xpos 214
   ypos -78
  }
set N14f87800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression3
   xpos 70
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix1
   label "mult_f3_f33( cf, M)"
   xpos 70
   ypos 8
  }
push $N14f87800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression4
   xpos 180
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f7
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 180
   ypos 8
  }
push $N14fd1c00
  Dot {
   name Dot10
   label " "
   xpos -6
   ypos -78
  }
set N14f86400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression1
   xpos -150
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix2
   label "mult_f3_f33( cf, M)"
   xpos -150
   ypos 8
  }
push $N14f86400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression2
   xpos -40
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f1
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos -40
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 180
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N15031000
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
   expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
   expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
   name segment_high
   xpos -810
   ypos -178
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N14fd2000
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N2a07f800 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -198
  }
set N2a07f400 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -198
  }
set N2a07f000 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -198
  }
  Dot {
   name Dot19
   label " "
   xpos 1204
   ypos -78
  }
set N2a07e800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression11
   xpos 1060
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix6
   label "mult_f3_f33( cf, M)"
   xpos 1060
   ypos 8
  }
push $N2a07e800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression12
   xpos 1170
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f6
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 1170
   ypos 8
  }
push 0
push $N2a07f000
  Dot {
   name Dot18
   label " "
   xpos 984
   ypos -78
  }
set N2a07d400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression9
   xpos 840
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix5
   label "mult_f3_f33( cf, M)"
   xpos 840
   ypos 8
  }
push $N2a07d400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression10
   xpos 950
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f5
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 950
   ypos 8
  }
push $N2a07f400
  Dot {
   name Dot16
   label " "
   xpos 764
   ypos -78
  }
set N2a027c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression7
   xpos 620
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix4
   label "mult_f3_f33( cf, M)"
   xpos 620
   ypos 8
  }
push $N2a027c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression8
   xpos 730
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f4
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 730
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   xpos 950
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N15031400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -178
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N2a07f800
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr1 "logg * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr2 "logb* maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -160
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Dot {
   name Dot30
   xpos 1534
   ypos 810
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
 Dot {
  name Dot23
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -462
 }
set N2a9eb000 [stack 0]
 Dot {
  name Dot22
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1656
  ypos -462
 }
 ColorMatrix {
  matrix {
      {0.6954522133 0.1406786889 0.163869068}
      {0.04479461163 0.8596711159 0.09553432465}
      {-0.005525866989 0.004025223665 1.001500726}
    }
  name ColorMatrix7
  label "ACEScg to ACES"
  note_font Helvetica
  xpos -1690
  ypos -398
 }
 Dot {
  name Dot21
  label " OCES"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1656
  ypos 2658
 }
push $N2a9eb000
 Dot {
  name Dot28
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -342
 }
set N2a9ea000 [stack 0]
 Group {
  name segmented_spline_c9_fwd
  xpos -1140
  ypos -346
  addUserKnob {20 SegmentedSplineParams_c9_tab l SegmentedSplineParams_c9}
  addUserKnob {78 coefsLow n 10}
  coefsLow {-1.698970004 -1.698970004 -1.4779 -1.2291 -0.8648 -0.448 0.00518 0.4511080334 0.9113744414 0.9113744414}
  addUserKnob {78 coefsHigh n 10}
  coefsHigh {0.5154386965 0.8470437783 1.1358 1.3802 1.5197 1.5985 1.6467 1.674609136 1.687873339 1.687873339}
  addUserKnob {12 minPoint}
  minPoint {0.0028799 0.02}
  addUserKnob {12 midPoint}
  midPoint {4.79999924 4.8}
  addUserKnob {12 maxPoint}
  maxPoint {1005.719116 48}
  addUserKnob {7 slopeLow}
  addUserKnob {7 slopeHigh}
  slopeHigh 0.04
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 8
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 8
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N2a9e9800 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N2a9e9800
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N2a9e9000 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N2a9e8c00 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N2a9e8800 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N2a9e8400 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr <= log10(minPoint.x)"
   expr1 "logg <= log10(minPoint.x)"
   expr2 "logb <= log10(minPoint.x)"
   name segment_bottom
   xpos -590
   ypos -178
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N2a9e8400
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N2a9a3400 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr1 "logg * slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr2 "logb* slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr3 1
   name Expression
   xpos -370
   ypos -178
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N2a9e8800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
   expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
   expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
   name segment_low
   xpos -700
   ypos -178
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N2a9a3400
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N2a9a1c00 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -198
  }
set N2a9a1800 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -198
  }
set N2a9a1400 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -198
  }
  Dot {
   name Dot12
   label " "
   xpos 434
   ypos -78
  }
set N2a9a0c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression15
   xpos 290
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix3
   label "mult_f3_f33( cf, M)"
   xpos 290
   ypos 8
  }
push $N2a9a0c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression6
   xpos 400
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f2
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 400
   ypos 8
  }
push 0
push $N2a9a1400
  Dot {
   name Dot11
   label " "
   xpos 214
   ypos -78
  }
set N2a953400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression14
   xpos 70
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix1
   label "mult_f3_f33( cf, M)"
   xpos 70
   ypos 8
  }
push $N2a953400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression4
   xpos 180
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f7
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 180
   ypos 8
  }
push $N2a9a1800
  Dot {
   name Dot10
   label " "
   xpos -6
   ypos -78
  }
set N2a952000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression1
   xpos -150
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix2
   label "mult_f3_f33( cf, M)"
   xpos -150
   ypos 8
  }
push $N2a952000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression2
   xpos -40
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f1
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos -40
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 180
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N2a9e8c00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
   expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
   expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
   name segment_high
   xpos -810
   ypos -178
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N2a9a1c00
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N2a8e7400 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -198
  }
set N2a8e7000 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -198
  }
set N2a8e6c00 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -198
  }
  Dot {
   name Dot19
   label " "
   xpos 1204
   ypos -78
  }
set N2a8e6400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression3
   xpos 1060
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix6
   label "mult_f3_f33( cf, M)"
   xpos 1060
   ypos 8
  }
push $N2a8e6400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression12
   xpos 1170
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f6
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 1170
   ypos 8
  }
push 0
push $N2a8e6c00
  Dot {
   name Dot18
   label " "
   xpos 984
   ypos -78
  }
set N2a8e5000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression5
   xpos 840
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix5
   label "mult_f3_f33( cf, M)"
   xpos 840
   ypos 8
  }
push $N2a8e5000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression10
   xpos 950
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f5
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 950
   ypos 8
  }
push $N2a8e7000
  Dot {
   name Dot16
   label " "
   xpos 764
   ypos -78
  }
set N2a88f800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression16
   xpos 620
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix4
   label "mult_f3_f33( cf, M)"
   xpos 620
   ypos 8
  }
push $N2a88f800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression8
   xpos 730
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f4
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 730
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   xpos 950
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N2a9e9000
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -178
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N2a8e7400
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr1 "logg * slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr2 "logb* slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -202
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
push $N2a9ea000
 Switch {
  inputs 2
  which {{parent.use_c9}}
  name Switch_c9
  xpos -1250
  ypos -298
 }
 Expression {
  expr0 "(r - Ymin) / (Ymax - Ymin)"
  expr1 "(g - Ymin) / (Ymax - Ymin)"
  expr2 "(b - Ymin) / (Ymax - Ymin)"
  expr3 1
  name Y_2_linCV_f3_
  xpos -1250
  ypos 38
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  Ymin {{parent.lum.0}}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
 Dot {
  name Dot12
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 282
 }
set N2a826c00 [stack 0]
 Dot {
  name Dot15
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 282
 }
set N2a826800 [stack 0]
 Dot {
  name Dot13
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 282
 }
 Dot {
  name Dot16
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 354
 }
set N2a826000 [stack 0]
 Expression {
  temp_name0 tr
  temp_expr0 "(-r - c_x_0) / (c_x_1 - c_x_0)"
  temp_name1 tg
  temp_expr1 "(-g - c_x_0) / (c_x_1 - c_x_0)"
  temp_name2 tb
  temp_expr2 "(-b - c_x_0) / (c_x_1 - c_x_0)"
  expr0 "tr < 0.0 ? -(tr * c_b + c_c) : tr > 1.0 ? r : -(( tr * c_a + c_b) * tr + c_c)"
  expr1 "tg < 0.0 ? -(tg * c_b + c_c) : tg > 1.0 ? g : -(( tg * c_a + c_b) * tg + c_c)"
  expr2 "tb < 0.0 ? -(tb * c_b + c_c) : tb > 1.0 ? b : -(( tb * c_a + c_b) * tb + c_c)"
  name roll_white_fwd_1
  xpos -920
  ypos 398
  addUserKnob {20 Params}
  addUserKnob {7 new_wht}
  new_wht 0.918
  addUserKnob {7 c_width}
  c_width 0.5
  addUserKnob {7 c_x_0 +DISABLED}
  c_x_0 -1
  addUserKnob {7 c_x_1 +DISABLED}
  c_x_1 {{"c_x_0 + c_width"}}
  addUserKnob {7 c_y0 +DISABLED}
  c_y0 {{-new_wht}}
  addUserKnob {7 c_y1 +DISABLED}
  c_y1 {{c_x_1}}
  addUserKnob {7 c_m1 +DISABLED}
  c_m1 {{"(c_x_1 - c_x_0)"}}
  addUserKnob {7 c_a +DISABLED}
  c_a {{"c_y0 - c_y1 + c_m1"}}
  addUserKnob {7 c_b +DISABLED}
  c_b {{"2 * (c_y1 - c_y0) - c_m1"}}
  addUserKnob {7 c_c +DISABLED}
  c_c {{c_y0}}
 }
 Expression {
  temp_name0 SCALE
  temp_expr0 0.96
  temp_name1 NEW_WHT
  temp_expr1 0.918
  expr0 "min( r, NEW_WHT) * SCALE"
  expr1 "min( g, NEW_WHT) * SCALE"
  expr2 "min( b, NEW_WHT) * SCALE"
  name Expression2
  label "// Scale and clamp white to avoid casted highlights due to D60 simulation"
  xpos -920
  ypos 440
 }
 Dot {
  name Dot11
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 498
 }
push $N2a826000
 Expression {
  temp_name0 SCALE
  temp_expr0 0.96362
  expr0 "r * SCALE"
  expr1 "g * SCALE"
  expr2 "b * SCALE"
  name mult_f_f3_
  label D65
  xpos -1030
  ypos 344
 }
push $N2a826800
 Switch {
  inputs 2
  which {{"parent.display_pri < 3"}}
  name switch_wp_is_d65_
  xpos -1140
  ypos 350
 }
 Dot {
  name Dot14
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 426
 }
push $N2a826c00
 Switch {
  inputs 2
  which {{parent.d60_sim}}
  name d60_sim_switch1
  xpos -1250
  ypos 422
 }
 Switch {
  inputs 2
  which {{"parent.display_pri == 3"}}
  name switch_wp_is_dci_
  xpos -1250
  ypos 494
 }
 Dot {
  name Dot26
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 762
 }
set N2a824800 [stack 0]
 ColorMatrix {
  matrix {
      {{"(1.0 - sat) * rgb2Y.x + sat"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y + sat"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z + sat"}}
    }
  name ColorMatrix3
  label "// Apply desaturation to compensate \nfor luminance difference"
  xpos -1140
  ypos 746
  addUserKnob {20 params}
  addUserKnob {13 rgb2Y}
  rgb2Y {0.27222875 0.67408174 0.05368952}
  addUserKnob {7 sat}
  sat 0.93
 }
push $N2a824800
 Switch {
  inputs 2
  which {{"parent.eotf < 5 && display_pri < 2"}}
  name Switch_eotf
  label "Use if output is SDR"
  xpos -1250
  ypos 800
 }
 ColorMatrix {
  matrix {
      {0.6624541879 0.1340042055 0.1561876982}
      {0.2722287476 0.6740817428 0.05368951708}
      {-0.005574660841 0.004060741514 1.010339141}
    }
  name ColorMatrix1
  label "ACES AP1 to XYZ"
  xpos -1250
  ypos 968
 }
 Dot {
  name Dot8
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 1146
 }
set N2aaab800 [stack 0]
 Colorspace {
  colorspace_in CIE-XYZ
  colorspace_out CIE-Yxy
  name Colorspace2
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1140
  ypos 1136
 }
 Clamp {
  channels {rgba.red -rgba.green -rgba.blue none}
  maximum_enable false
  name ClampMin4
  xpos -1140
  ypos 1190
 }
 Expression {
  expr0 "pow(r, DIM_SURROUND_GAMMA)"
  expr1 g
  expr2 b
  channel3 none
  name dark_to_dim3
  xpos -1140
  ypos 1214
  addUserKnob {20 Params}
  addUserKnob {7 DIM_SURROUND_GAMMA}
  DIM_SURROUND_GAMMA 0.9811
 }
 Colorspace {
  colorspace_in CIE-Yxy
  colorspace_out CIE-XYZ
  name Colorspace4
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1140
  ypos 1256
 }
push $N2aaab800
 Switch {
  inputs 2
  which {{"(parent.eotf <= 4) ? parent.dark_to_dim : 0"}}
  name DarkToDim_Switch
  label "enable if sdr\nand dark_to_dim enabled"
  xpos -1250
  ypos 1250
 }
 Dot {
  name Dot19
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 1434
 }
set N2aaaa400 [stack 0]
 Dot {
  name Dot9
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 1434
 }
set N2aaaa000 [stack 0]
 ColorMatrix {
  matrix {
      {0.9872254133 -0.006114810705 0.01592640579}
      {-0.007603884675 1.001874804 0.005322027951}
      {0.003066040576 -0.005084238946 1.081519246}
    }
  name ColorMatrix2
  label "CAT: Bradford\n D60 to D65"
  xpos -1140
  ypos 1466
 }
set N2aaa9c00 [stack 0]
push $N2aaaa000
 Dot {
  name Dot10
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -996
  ypos 1434
 }
push $N2aaa9c00
 Switch {
  inputs 2
  which {{parent.d60_sim}}
  name d60_sim_switch
  xpos -1140
  ypos 1550
 }
push $N2aaaa400
 Switch {
  inputs 2
  which {{"parent.display_pri < 3"}}
  name switch_wp_is_d65_1
  xpos -1250
  ypos 1550
 }
 Switch {
  inputs 2
  which {{parent.force_d65_cat}}
  name switch_force_d65_cat
  xpos -1250
  ypos 1598
 }
 Group {
  name limit_to_primaries
  label "Only enabled when display_pri != limiting_pri"
  xpos -1250
  ypos 1760
  disable {{"!(parent.display_pri != parent.limiting_pri)"}}
  addUserKnob {20 limit_to_primaries}
  addUserKnob {4 limiting_pri l "limiting pri" M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
  limiting_pri {{parent.limiting_pri}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -298
  }
  Dot {
   name Dot1
   label " XYZ to limiting primaries"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos -198
  }
set N2aaa9000 [stack 0]
push $N2aaa9000
  ColorMatrix {
   matrix {
       {1.049811006 0 -9.748453158e-05}
       {-0.4959030151 1.373313069 0.09824004024}
       {4.020908051e-08 0 0.9912520051}
     }
   name ColorMatrix5
   label "XYZ to ACES"
   xpos 730
   ypos -136
  }
push $N2aaa9000
  ColorMatrix {
   matrix {
       {1.641023397 -0.3248033226 -0.2364246994}
       {-0.6636629701 1.615331769 0.01675636508}
       {0.01172191743 -0.008284457959 0.9883947968}
     }
   name ColorMatrix21
   label "XYZ to ACEScg"
   xpos 620
   ypos -136
  }
push $N2aaa9000
  ColorMatrix {
   matrix {
       {2.402741432 -0.8974840641 -0.3880533576}
       {-0.8325796723 1.769231915 0.02371272631}
       {0.03882339597 -0.08249972761 1.036368608}
     }
   name ColorMatrix15
   label "XYZ to P3D60"
   xpos 510
   ypos -136
  }
push $N2aaa9000
  ColorMatrix {
   matrix {
       {2.725393534 -1.018002748 -0.4401631057}
       {-0.795167923 1.689731717 0.02264718339}
       {0.04124190658 -0.0876390487 1.100929499}
     }
   name ColorMatrix19
   label "XYZ to P3DCI"
   xpos 400
   ypos -136
  }
push $N2aaa9000
  ColorMatrix {
   matrix {
       {2.493496418 -0.9313833117 -0.4027107358}
       {-0.8294888139 1.762663841 0.02362467349}
       {0.03584583849 -0.07617240399 0.9568845034}
     }
   name ColorMatrix17
   label "XYZ to P3D65"
   xpos 290
   ypos -136
  }
push $N2aaa9000
  ColorMatrix {
   matrix {
       {1.71665132 -0.3556708097 -0.2533662617}
       {-0.6666844487 1.616481304 0.01576855592}
       {0.01763986237 -0.04277062416 0.9421030879}
     }
   name ColorMatrix12
   label "XYZ to Rec2020"
   xpos 180
   ypos -136
  }
push $N2aaa9000
  ColorMatrix {
   matrix {
       {3.240970135 -1.537383318 -0.4986107945}
       {-0.9692437053 1.875967622 0.04155509174}
       {0.0556300357 -0.2039768547 1.056971431}
     }
   name ColorMatrix2
   label "XYZ to Rec709"
   xpos 70
   ypos -136
  }
  Switch {
   inputs 8
   which {{parent.limiting_pri}}
   name limiting_primary_switch
   xpos -40
   ypos -34
  }
  Clamp {
   channels rgb
   name clamp_f3
   label "Clip any values outside the limiting primaries"
   xpos -40
   ypos 56
  }
  Dot {
   name Dot2
   label " Convert limited RGB to XYZ"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos 162
  }
set N2aa3a800 [stack 0]
push $N2aa3a800
  ColorMatrix {
   matrix {
       {0.9525524378 0 9.367863095e-05}
       {0.3439664543 0.7281661034 -0.07213255018}
       {-3.863927134e-08 0 1.008825183}
     }
   name ColorMatrix4
   label "ACES to XYZ"
   xpos 730
   ypos 224
  }
push $N2aa3a800
  ColorMatrix {
   matrix {
       {0.6624541879 0.1340042055 0.1561876982}
       {0.2722287476 0.6740817428 0.05368951708}
       {-0.005574660841 0.004060741514 1.010339141}
     }
   name ColorMatrix20
   label "ACEScg to XYZ"
   xpos 620
   ypos 224
  }
push $N2aa3a800
  ColorMatrix {
   matrix {
       {0.5049495697 0.2646814585 0.1830150485}
       {0.237623319 0.6891706586 0.07320601493}
       {0 0.0449459292 0.9638792276}
     }
   name ColorMatrix13
   label "P3D60 to XYZ"
   xpos 510
   ypos 224
  }
push $N2aa3a800
  ColorMatrix {
   matrix {
       {0.4451698363 0.2771343887 0.1722826511}
       {0.209491685 0.7215952873 0.06891305745}
       {0 0.04706057906 0.9073553085}
     }
   name ColorMatrix18
   label "P3DCI to XYZ"
   xpos 400
   ypos 224
  }
push $N2aa3a800
  ColorMatrix {
   matrix {
       {0.4865709841 0.2656676769 0.1982172877}
       {0.2289745659 0.6917385459 0.07928691059}
       {0 0.04511339962 1.043944359}
     }
   name ColorMatrix16
   label "P3D65 to XYZ"
   xpos 290
   ypos 224
  }
push $N2aa3a800
  ColorMatrix {
   matrix {
       {0.6369580626 0.1446169019 0.1688809693}
       {0.2627002299 0.6779980659 0.05930171534}
       {0 0.0280726999 1.060985088}
     }
   name ColorMatrix3
   label "Rec2020 to XYZ"
   xpos 180
   ypos 224
  }
push $N2aa3a800
  ColorMatrix {
   matrix {
       {0.4123907983 0.3575843275 0.180480808}
       {0.2126390189 0.7151686549 0.07219231874}
       {0.01933082007 0.1191947311 0.950532198}
     }
   name ColorMatrix1
   label "Rec709 to XYZ"
   xpos 70
   ypos 224
  }
  Switch {
   inputs 8
   which {{parent.limiting_pri}}
   name limiting_primary_switch1
   xpos -40
   ypos 326
  }
  Output {
   name Output
   xpos -40
   ypos 446
  }
 end_group
 Group {
  name XYZ_2_DISPLAY_PRI
  label "CIE XYZ to display encoding primaries"
  xpos -1250
  ypos 1976
  addUserKnob {20 XYZ_2_DISPLAY_PRI_tab l XYZ_2_DISPLAY_PRI}
  addUserKnob {4 display_pri l "display pri" M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
  display_pri {{parent.display_pri}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -298
  }
  Dot {
   name Dot1
   label " XYZ to display primaries"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos -198
  }
set N2adc7c00 [stack 0]
push $N2adc7c00
  ColorMatrix {
   matrix {
       {1.049811006 0 -9.748453158e-05}
       {-0.4959030151 1.373313069 0.09824004024}
       {4.020908051e-08 0 0.9912520051}
     }
   name ColorMatrix3
   label "XYZ to ACES"
   xpos 730
   ypos -136
  }
push $N2adc7c00
  ColorMatrix {
   matrix {
       {1.641023397 -0.3248033226 -0.2364246994}
       {-0.6636629701 1.615331769 0.01675636508}
       {0.01172191743 -0.008284457959 0.9883947968}
     }
   name ColorMatrix21
   label "XYZ to ACEScg"
   xpos 620
   ypos -136
  }
push $N2adc7c00
  ColorMatrix {
   matrix {
       {2.402741432 -0.8974840641 -0.3880533576}
       {-0.8325796723 1.769231915 0.02371272631}
       {0.03882339597 -0.08249972761 1.036368608}
     }
   name ColorMatrix15
   label "XYZ to P3D60"
   xpos 510
   ypos -136
  }
push $N2adc7c00
  ColorMatrix {
   matrix {
       {2.725393534 -1.018002748 -0.4401631057}
       {-0.795167923 1.689731717 0.02264718339}
       {0.04124190658 -0.0876390487 1.100929499}
     }
   name ColorMatrix19
   label "XYZ to P3DCI"
   xpos 400
   ypos -136
  }
push $N2adc7c00
  ColorMatrix {
   matrix {
       {2.493496418 -0.9313833117 -0.4027107358}
       {-0.8294888139 1.762663841 0.02362467349}
       {0.03584583849 -0.07617240399 0.9568845034}
     }
   name ColorMatrix17
   label "XYZ to P3D65"
   xpos 290
   ypos -136
  }
push $N2adc7c00
  ColorMatrix {
   matrix {
       {1.71665132 -0.3556708097 -0.2533662617}
       {-0.6666844487 1.616481304 0.01576855592}
       {0.01763986237 -0.04277062416 0.9421030879}
     }
   name ColorMatrix12
   label "XYZ to Rec2020"
   xpos 180
   ypos -136
  }
push $N2adc7c00
  ColorMatrix {
   matrix {
       {3.240970135 -1.537383318 -0.4986107945}
       {-0.9692437053 1.875967622 0.04155509174}
       {0.0556300357 -0.2039768547 1.056971431}
     }
   name ColorMatrix2
   label "XYZ to Rec709"
   xpos 70
   ypos -136
  }
  Switch {
   inputs 8
   which {{parent.display_pri}}
   name limiting_primary_switch
   xpos -40
   ypos -34
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Clamp {
  channels rgb
  name clamp_f3_all
  xpos -1250
  ypos 2164
 }
 Dot {
  name Dot1
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 2514
 }
set N2adc5400 [stack 0]
push $N2adc5400
 Dot {
  name Dot3
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 2514
 }
set N2adc5000 [stack 0]
 Dot {
  name Dot4
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -666
  ypos 2514
 }
set N2adc4c00 [stack 0]
 Dot {
  name Dot6
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -446
  ypos 2514
 }
set N2adc4800 [stack 0]
 Dot {
  name Dot18
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -226
  ypos 2514
 }
set N2adc4400 [stack 0]
 Dot {
  name Dot20
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -6
  ypos 2514
 }
set N2ad6bc00 [stack 0]
 Dot {
  name Dot25
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 214
  ypos 2514
 }
set N2ad6b800 [stack 0]
 Dot {
  name Dot24
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2514
 }
 Dot {
  name Dot2
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2610
 }
set N2ad6b000 [stack 0]
 Expression {
  expr0 "r * (Ymax - Ymin) + Ymin"
  expr1 "g * (Ymax - Ymin) + Ymin"
  expr2 "b * (Ymax - Ymin) + Ymin"
  name linCV_2_Y_f3_hdr
  label "stretch_black = True"
  xpos 510
  ypos 2672
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
push $N2ad6b000
 Expression {
  expr0 "r * (Ymax - Ymin) + Ymin"
  expr1 "g * (Ymax - Ymin) + Ymin"
  expr2 "b * (Ymax - Ymin) + Ymin"
  name linCV_2_Y_f3_hdr2
  label "stretch_black = False"
  xpos 620
  ypos 2672
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  Ymin {{parent.lum.0}}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
 Switch {
  inputs 2
  which {{parent.stretch_black}}
  name StretchBlacks_Switch
  xpos 620
  ypos 2750
 }
 Clamp {
  channels rgb
  maximum 65535
  name clamp_f3__
  xpos 620
  ypos 2822
 }
 Expression {
  temp_name0 Lm_r
  temp_expr0 "pow((r / pq_C), pq_m1)"
  temp_name1 Lm_g
  temp_expr1 "pow((g / pq_C), pq_m1)"
  temp_name2 Lm_b
  temp_expr2 "pow((b / pq_C), pq_m1)"
  expr0 "pow(( pq_c1 + pq_c2 * Lm_r ) / ( 1.0 + pq_c3 * Lm_r ), pq_m2)"
  expr1 "pow(( pq_c1 + pq_c2 * Lm_g ) / ( 1.0 + pq_c3 * Lm_g ), pq_m2)"
  expr2 "pow(( pq_c1 + pq_c2 * Lm_b ) / ( 1.0 + pq_c3 * Lm_b ), pq_m2)"
  name Y_2_ST2084_
  label "ACESlib.OutputTransforms.ctl : 243 \nACESlib.Utilities_Color.ctl : 425"
  xpos 620
  ypos 2882
  addUserKnob {20 SMPTE_ST2084-2014_Constants_tab l "Constants from SMPTE ST 2084-2014"}
  addUserKnob {7 pq_m1 t " ( 2610.0 / 4096.0 ) / 4.0;" +DISABLED R 0 100}
  pq_m1 0.1593017578
  addUserKnob {7 pq_m2 t " ( 2523.0 / 4096.0 ) * 128.0;" +DISABLED R 0 100}
  pq_m2 78.84375
  addUserKnob {7 pq_c1 t " 3424.0 / 4096.0 or pq_c3 - pq_c2 + 1.0;" +DISABLED R 0 100}
  pq_c1 0.8359375
  addUserKnob {7 pq_c2 t " ( 2413.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c2 18.8515625
  addUserKnob {7 pq_c3 t " ( 2392.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c3 18.6875
  addUserKnob {7 pq_C +DISABLED R 0 100}
  pq_C 10000
 }
set N2ad6a000 [stack 0]
 Dot {
  name Dot5
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 984
  ypos 2514
 }
 Expression {
  temp_name0 Np_r
  temp_expr0 "pow( r, 1.0 / pq_m2 )"
  temp_name1 Np_g
  temp_expr1 "pow( g, 1.0 / pq_m2 )"
  temp_name2 Np_b
  temp_expr2 "pow( b, 1.0 / pq_m2 )"
  expr0 "r < 0 ? 0 : pow((Np_r - pq_c1) / ( pq_c2 - pq_c3 * Np_r ), 1.0/pq_m1) * pq_C"
  expr1 "g < 0 ? 0 : pow((Np_g - pq_c1) / ( pq_c2 - pq_c3 * Np_g ), 1.0/pq_m1) * pq_C"
  expr2 "b < 0 ? 0 : pow((Np_b - pq_c1) / ( pq_c2 - pq_c3 * Np_b ), 1.0/pq_m1) * pq_C"
  name ST2084_2_Y_f3_
  label "ACESlib.Utilities_Color.ctl : 408\n// Converts from the non-linear perceptually quantized space to linear cd/m^2"
  xpos 950
  ypos 2618
  addUserKnob {20 SMPTE_ST2084-2014_Constants_tab l "Constants from SMPTE ST 2084-2014"}
  addUserKnob {7 pq_m1 t " ( 2610.0 / 4096.0 ) / 4.0;" +DISABLED R 0 100}
  pq_m1 0.1593017578
  addUserKnob {7 pq_m2 t " ( 2523.0 / 4096.0 ) * 128.0;" +DISABLED R 0 100}
  pq_m2 78.84375
  addUserKnob {7 pq_c1 t " 3424.0 / 4096.0 or pq_c3 - pq_c2 + 1.0;" +DISABLED R 0 100}
  pq_c1 0.8359375
  addUserKnob {7 pq_c2 t " ( 2413.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c2 18.8515625
  addUserKnob {7 pq_c3 t " ( 2392.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c3 18.6875
  addUserKnob {7 pq_C +DISABLED R 0 100}
  pq_C 10000
 }
 Expression {
  temp_name0 Y_d
  temp_expr0 "0.2627*r + 0.6780*g + 0.0593*b"
  expr0 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((r-c_beta)/c_alpha)"
  expr1 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((g-c_beta)/c_alpha)"
  expr2 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((b-c_beta)/c_alpha)"
  name ST2084_2_HLG_1000nits_f3_3
  label "ACESlib.Utilities_Color.ctl : 469\n// HLG Inverse EOTF (i.e. HLG inverse OOTF followed by the HLG OETF)\n// HLG Inverse OOTF (display linear to scene linear)"
  xpos 950
  ypos 2732
  addUserKnob {20 Constants_tab l Constants}
  addUserKnob {7 L_w +DISABLED}
  L_w 1000
  addUserKnob {7 L_b +DISABLED}
  addUserKnob {7 c_alpha +DISABLED}
  c_alpha {{L_w-L_b}}
  addUserKnob {7 c_beta +DISABLED}
  c_beta {{L_b}}
  addUserKnob {7 c_gamma +DISABLED}
  c_gamma 1.2
 }
 Expression {
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 "r <= 1.0/12 ? sqrt(3.0*r) : c_a * log(12.0 * r - c_b) + c_c"
  expr1 "g <= 1.0/12 ? sqrt(3.0*g) : c_a * log(12.0 * g- c_b) + c_c"
  expr2 "b <= 1.0/12 ? sqrt(3.0*b) : c_a * log(12.0 * b - c_b) + c_c"
  name ST2084_2_HLG_1000nits_f3_
  label "ACESlib.Utilities_Color.ctl : 493\n// HLG OETF (scene linear to non-linear signal value)"
  xpos 950
  ypos 2834
  addUserKnob {20 Constants_tab l Constants}
  addUserKnob {7 c_a +DISABLED}
  c_a 0.17883277
  addUserKnob {7 c_b t 1.-4.*a +DISABLED}
  c_b 0.28466892
  addUserKnob {7 c_c t 0.5-a*log(4.*a) +DISABLED}
  c_c 0.55991073
 }
 Dot {
  name Dot17
  label " HLG"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 984
  ypos 2970
 }
push $N2ad6a000
 Dot {
  name Dot27
  label " PQ"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2970
 }
push $N2ad6b800
 Expression {
  expr0 "pow( (48./52.37) * r, 1./2.6)"
  expr1 "pow( (48./52.37) * g, 1./2.6)"
  expr2 "pow( (48./52.37) * b, 1./2.6)"
  expr3 1
  name dcdm_encode
  xpos 180
  ypos 2702
 }
push $N2ad6bc00
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_26_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.6"
  xpos -40
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.6
 }
push $N2adc4400
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_24_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.4"
  xpos -260
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.4
 }
push $N2adc4800
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_22_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.2"
  xpos -480
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.2
 }
push $N2adc4c00
 Expression {
  temp_name0 c_a
  temp_expr0 "pow( pow( Lw, 1./gamma) - pow( Lb, 1./gamma), gamma)"
  temp_name1 c_b
  temp_expr1 "pow( Lb, 1./gamma) / ( pow( Lw, 1./gamma) - pow( Lb, 1./gamma))"
  expr0 "pow( max( r / c_a, 0.), 1.0/gamma) - c_b"
  expr1 "pow( max( g / c_a, 0.), 1.0/gamma) - c_b"
  expr2 "pow( max( b / c_a, 0.), 1.0/gamma) - c_b"
  name bt1886_r_f3
  label "ACESlib.Utilities_Color.ctl : 301\n// The reference EOTF specified in Rec. ITU-R BT.1886\n// L = a(max\[(V+b),0])^g"
  xpos -700
  ypos 2684
  addUserKnob {20 Luminance}
  addUserKnob {7 Lw R 48 10000}
  Lw 1
  addUserKnob {7 Lb R 0.0001 0.02}
  addUserKnob {7 gamma R 1 4}
  gamma 2.4
 }
push $N2adc5000
 Expression {
  temp_name0 yb
  temp_expr0 "pow( offs * gamma / ( ( gamma - 1.0) * ( 1.0 + offs)), gamma)"
  temp_name1 rs
  temp_expr1 "pow( ( gamma - 1.0) / offs, gamma - 1.0) * pow( ( 1.0 + offs) / gamma, gamma)"
  expr0 "r >= yb ? ( 1.0 + offs) * pow( r, 1.0 / gamma) - offs : r * rs"
  expr1 "g >= yb ? ( 1.0 + offs) * pow( g, 1.0 / gamma) - offs : g * rs"
  expr2 "b >= yb ? ( 1.0 + offs) * pow( b, 1.0 / gamma) - offs : b * rs"
  name moncurve_r_f3_
  label "ACESlib.Utilities_Color.ctl : 260\nmoncurve_r with gamma of 2.4 and offset of 0.055 matches the EOTF found in IEC 61966-2-1:1999 (sRGB)"
  xpos -920
  ypos 2690
  addUserKnob {20 Luminance}
  addUserKnob {7 gamma R 0 4}
  gamma 2.4
  addUserKnob {7 offs}
  offs 0.055
 }
 Switch {
  inputs 10
  which {{parent.eotf}}
  name EOTF_Switch
  xpos -1250
  ypos 2966
 }
 Expression {
  temp_name0 REFBLACK
  temp_expr0 "64 / 1023"
  temp_name1 REFWHITE
  temp_expr1 "940 / 1023"
  expr0 "r * ( REFWHITE - REFBLACK) + REFBLACK"
  expr1 "g * ( REFWHITE - REFBLACK) + REFBLACK"
  expr2 "b * ( REFWHITE - REFBLACK) + REFBLACK"
  name fullRange_to_smpteRange_f3_
  label "ACESlib.OutputTransforms.ctl : 216"
  xpos -1250
  ypos 3224
  disable {{!parent.legal_range}}
 }
 Output {
  name Output
  xpos -1250
  ypos 3446
 }
 StickyNote {
  inputs 0
  name StickyNote1
  tile_color 0x535a61ff
  label "\n<b>ACESlib.RRT_Common.ctl : 135</b>\n<pre>\nfloat\[3] rrt_sweeteners( float in\[3])\n\{\n    float aces\[3] = in;\n    \n    // --- Glow module --- //\n    float saturation = rgb_2_saturation( aces);\n    float ycIn = rgb_2_yc( aces);\n    float s = sigmoid_shaper( (saturation - 0.4) / 0.2);\n    float addedGlow = 1. + glow_fwd( ycIn, RRT_GLOW_GAIN * s, RRT_GLOW_MID);\n\n    aces = mult_f_f3( addedGlow, aces);\n\n    // --- Red modifier --- //\n    float hue = rgb_2_hue( aces);\n    float centeredHue = center_hue( hue, RRT_RED_HUE);\n    float hueWeight = cubic_basis_shaper( centeredHue, RRT_RED_WIDTH);\n\n    aces\[0] = aces\[0] + hueWeight * saturation * (RRT_RED_PIVOT - aces\[0]) * (1. - RRT_RED_SCALE);\n\n    // --- ACES to RGB rendering space --- //\n    aces = clamp_f3( aces, 0., HALF_POS_INF);\n    float rgbPre\[3] = mult_f3_f44( aces, AP0_2_AP1_MAT);\n    rgbPre = clamp_f3( rgbPre, 0., HALF_MAX);\n    \n    // --- Global desaturation --- //\n    rgbPre = mult_f3_f33( rgbPre, RRT_SAT_MAT);\n    return rgbPre;\n\}\n\n\n\n"
  note_font_size 10
  xpos -825
  ypos -1204
 }
 StickyNote {
  inputs 0
  name StickyNote2
  tile_color 0x535a61ff
  label "\n\n<b>ACESlib.SSTS.ctl : 163</b><pre>float ssts\n( \n    varying float x,\n    varying TsParams C\n)\n\{\n    const int N_KNOTS_LOW = 4;\n    const int N_KNOTS_HIGH = 4;\n\n    // Check for negatives or zero before taking the log. If negative or zero,\n    // set to HALF_MIN.\n    float logx = log10( max(x, HALF_MIN )); \n\n    float logy;\n\n    if ( logx <= log10(C.Min.x) ) \{ \n\n        logy = logx * C.Min.slope + ( log10(C.Min.y) - C.Min.slope * log10(C.Min.x) );\n\n    \} else if (( logx > log10(C.Min.x) ) && ( logx < log10(C.Mid.x) )) \{\n\n        float knot_coord = (N_KNOTS_LOW-1) * (logx-log10(C.Min.x))/(log10(C.Mid.x)-log10(C.Min.x));\n        int j = knot_coord;\n        float t = knot_coord - j;\n\n        float cf\[ 3] = \{ C.coefsLow\[ j], C.coefsLow\[ j + 1], C.coefsLow\[ j + 2]\};\n\n        float monomials\[ 3] = \{ t * t, t, 1. \};\n        logy = dot_f3_f3( monomials, mult_f3_f33( cf, M1));\n\n    \} else if (( logx >= log10(C.Mid.x) ) && ( logx < log10(C.Max.x) )) \{\n\n        float knot_coord = (N_KNOTS_HIGH-1) * (logx-log10(C.Mid.x))/(log10(C.Max.x)-log10(C.Mid.x));\n        int j = knot_coord;\n        float t = knot_coord - j;\n\n        float cf\[ 3] = \{ C.coefsHigh\[ j], C.coefsHigh\[ j + 1], C.coefsHigh\[ j + 2]\}; \n\n        float monomials\[ 3] = \{ t * t, t, 1. \};\n        logy = dot_f3_f3( monomials, mult_f3_f33( cf, M1));\n\n    \} else \{ //if ( logIn >= log10(C.Max.x) ) \{ \n\n        logy = logx * C.Max.slope + ( log10(C.Max.y) - C.Max.slope * log10(C.Max.x) );\n\n    \}\n\n    return pow10(logy);\n\n\}"
  note_font_size 10
  xpos -830
  ypos -664
 }
 StickyNote {
  inputs 0
  name StickyNote3
  tile_color 0x535a61ff
  label "\n\n<b>ACESlib.Tonescales.ctl : 271</b><pre>float segmented_spline_c9_fwd\n  ( \n    varying float x,\n    varying SegmentedSplineParams_c9 C = ODT_48nits\n  )\n\{    \n  const int N_KNOTS_LOW = 8;\n  const int N_KNOTS_HIGH = 8;\n\n  // Check for negatives or zero before taking the log. If negative or zero,\n  // set to HALF_MIN.\n  float logx = log10( max(x, HALF_MIN )); \n\n  float logy;\n\n  if ( logx <= log10(C.minPoint.x) ) \{ \n\n    logy = logx * C.slopeLow + ( log10(C.minPoint.y) - C.slopeLow * log10(C.minPoint.x) );\n\n  \} else if (( logx > log10(C.minPoint.x) ) && ( logx < log10(C.midPoint.x) )) \{\n\n    float knot_coord = (N_KNOTS_LOW-1) * (logx-log10(C.minPoint.x))/(log10(C.midPoint.x)-log10(C.minPoint.x));\n    int j = knot_coord;\n    float t = knot_coord - j;\n\n    float cf\[ 3] = \{ C.coefsLow\[ j], C.coefsLow\[ j + 1], C.coefsLow\[ j + 2]\};\n    \n    float monomials\[ 3] = \{ t * t, t, 1. \};\n    logy = dot_f3_f3( monomials, mult_f3_f33( cf, M));\n\n  \} else if (( logx >= log10(C.midPoint.x) ) && ( logx < log10(C.maxPoint.x) )) \{\n\n    float knot_coord = (N_KNOTS_HIGH-1) * (logx-log10(C.midPoint.x))/(log10(C.maxPoint.x)-log10(C.midPoint.x));\n    int j = knot_coord;\n    float t = knot_coord - j;\n\n    float cf\[ 3] = \{ C.coefsHigh\[ j], C.coefsHigh\[ j + 1], C.coefsHigh\[ j + 2]\}; \n\n    float monomials\[ 3] = \{ t * t, t, 1. \};\n    logy = dot_f3_f3( monomials, mult_f3_f33( cf, M));\n\n  \} else \{ //if ( logIn >= log10(C.maxPoint.x) ) \{ \n\n    logy = logx * C.slopeHigh + ( log10(C.maxPoint.y) - C.slopeHigh * log10(C.maxPoint.x) );\n\n  \}\n\n  return pow10(logy);\n  \n\}"
  note_font_size 10
  xpos -200
  ypos -660
 }
push $N15032400
 Reformat {
  type "to box"
  box_width 4
  box_height 4
  box_fixed true
  name Reformat1
  note_font Helvetica
  xpos -1140
  ypos -561
 }
 Fill {
  output rgb
  color {{parent.ssts.mid_lum}}
  name Fill1
  note_font Helvetica
  xpos -1140
  ypos -537
 }
 Group {
  name inv_ssts
  xpos -1140
  ypos -514
  addUserKnob {20 ssts_tab l ssts}
  addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
  lum {{"use_c9 ? 0.0001 : parent.lum"} 4.8 {"use_c9 ? 10000 : parent.lum"}}
  addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
  override_ssts_params {{parent.ACES_SSTS.AcesSSTSKernel_override_curve_params}}
  addUserKnob {7 exposure R -5 5}
  exposure {{parent.exposure}}
  addUserKnob {7 knee}
  knee {{parent.pctLow}}
  addUserKnob {7 shoulder}
  shoulder {{parent.pctHigh}}
  addUserKnob {78 slope n 3}
  slope {{parent.slope} {parent.slope} {parent.slope}}
  addUserKnob {20 TsParams_tab l TsParams}
  addUserKnob {7 expShift R -4 4}
  expShift {{"override_ssts_params ? exposure : 0"}}
  addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  minPoint {{"pow(2, log(0.18*pow(2, MIN_STOP_RRT+((MIN_STOP_SDR-MIN_STOP_RRT)/(log10(MIN_LUM_SDR)-log10(MIN_LUM_RRT)))*(log10(minPoint.y)-log10(MIN_LUM_RRT))))/log(2)-expShift)"} {lum.0} {override_ssts_params?slope.0:0}}
  addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  midPoint {{"pow(2, ((log(0.18)/log(2)-expShift)))"} {lum.1} {override_ssts_params?slope.1:1.55}}
  addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  maxPoint {{"pow(2, log(0.18*pow(2, (MAX_STOP_SDR+(MAX_STOP_RRT-MAX_STOP_SDR)/(log10(MAX_LUM_RRT)-log10(MAX_LUM_SDR))*(log10(maxPoint.y)-log10(MAX_LUM_SDR)))))/log(2)-expShift)"} {lum.2} {override_ssts_params?slope.2:0}}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(midPoint.x) - log10(minPoint.x)) / 3.0"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(maxPoint.x) - log10(midPoint.x)) / 3.0"}}
  addUserKnob {7 pctLow}
  pctLow {{0.18+(0.35-0.18)/(MIN_STOP_SDR-MIN_STOP_RRT)*(log(minPoint.x/0.18)/log(2)-MIN_STOP_RRT)}}
  addUserKnob {7 pctHigh}
  pctHigh {{0.89+(0.90-0.89)/(MAX_STOP_SDR-MAX_STOP_RRT)*(log(maxPoint.x/0.89)/log(2)-MAX_STOP_RRT)}}
  addUserKnob {78 coefsLow n 5}
  coefsLow {{"(minPoint.z * (log10(minPoint.x)-0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {"(minPoint.z * (log10(minPoint.x)+0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {log10(minPoint.y)+pctLow*(log10(midPoint.y)-log10(minPoint.y))} {"(midPoint.z * (log10(midPoint.x)-0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"}}
  addUserKnob {78 coefsHigh n 5}
  coefsHigh {{"(midPoint.z * (log10(midPoint.x)-0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {log10(midPoint.y)+pctHigh*(log10(maxPoint.y)-log10(midPoint.y))} {"(maxPoint.z * (log10(maxPoint.x)-0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"} {"(maxPoint.z * (log10(maxPoint.x)+0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"}}
  addUserKnob {7 KNOT_INC_LOW}
  KNOT_INC_LOW {{"(log10(midPoint.x) - log10(minPoint.x)) / (N_KNOTS_LOW - 1)"}}
  addUserKnob {7 KNOT_INC_HIGH}
  KNOT_INC_HIGH {{"(log10(maxPoint.x) - log10(midPoint.x)) / (N_KNOTS_HIGH - 1)"}}
  addUserKnob {78 KNOT_Y_LOW n 4}
  KNOT_Y_LOW {{"(coefsLow.0 + coefsLow.1) / 2"} {"(coefsLow.1 + coefsLow.2) / 2"} {"(coefsLow.2 + coefsLow.3) / 2"} {"(coefsLow.3 + coefsLow.4) / 2"}}
  addUserKnob {78 KNOT_Y_HIGH n 4}
  KNOT_Y_HIGH {{"(coefsHigh.0 + coefsHigh.1) / 2"} {"(coefsHigh.1 + coefsHigh.2) / 2"} {"(coefsHigh.2 + coefsHigh.3) / 2"} {"(coefsHigh.3 + coefsHigh.4) / 2"}}
  addUserKnob {20 Constants_tab l const}
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
  addUserKnob {7 MIN_STOP_SDR R -20 20}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -20 20}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR R 0 0.1}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 100}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT R 0 0.1}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N2acf8400 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N2acf8400
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N2ac9f800 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N2ac9f400 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N2ac9f000 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N2ac9ec00 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "logr <= log10(minPoint.y)"
   expr1 "logg <= log10(minPoint.y)"
   expr2 "logb <= log10(minPoint.y)"
   name segment_bottom
   xpos -590
   ypos -202
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N2ac9ec00
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N2ac9e000 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 log10(minPoint.x)
   expr1 log10(minPoint.x)
   expr2 log10(minPoint.x)
   expr3 1
   name Expression
   xpos -370
   ypos -202
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N2ac9f000
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "( logr > log10(minPoint.y) ) && ( logr <= log10(midPoint.y) )"
   expr1 "( logg > log10(minPoint.y) ) && ( logg <= log10(midPoint.y) )"
   expr2 "( logb > log10(minPoint.y) ) && ( logb <= log10(midPoint.y) )"
   name segment_low
   xpos -700
   ypos -202
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N2ac9e000
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N2ac9c800 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -174
  }
set N2ac9c400 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -174
  }
set N2ac5fc00 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -174
  }
  Dot {
   name Dot19
   xpos 434
   ypos -78
  }
set N2ac5f400 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(b, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow5
   xpos 290
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low5
   xpos 290
   ypos -34
  }
push $N2ac5f400
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bb, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy5
   xpos 400
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals4
   xpos 400
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
push 0
push $N2ac9c400
  Dot {
   name Dot10
   xpos -6
   ypos -78
  }
set N2ac5e000 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow
   xpos -150
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low
   xpos -150
   ypos -34
  }
push $N2ac5e000
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Br, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy
   xpos -40
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals
   xpos -40
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
push $N2ac5fc00
  Dot {
   name Dot18
   xpos 214
   ypos -78
  }
set N2ac5cc00 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(g, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow4
   xpos 70
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low4
   xpos 70
   ypos -34
  }
push $N2ac5cc00
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bg, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy4
   xpos 180
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals5
   xpos 180
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   name Merge2
   xpos 180
   ypos 134
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N2ac9f400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "( logr >= log10(midPoint.y) ) && ( logr < log10(maxPoint.y) )"
   expr1 "( logg >= log10(midPoint.y) ) && ( logg < log10(maxPoint.y) )"
   expr2 "( logb >= log10(midPoint.y) ) && ( logb < log10(maxPoint.y) )"
   name segment_high
   xpos -810
   ypos -202
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N2ac9c800
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N2abe2000 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -174
  }
set N2abe1c00 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -174
  }
set N2abe1800 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -174
  }
  Dot {
   name Dot16
   xpos 1204
   ypos -78
  }
set N2abe1000 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(b, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow3
   xpos 1060
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low3
   xpos 1060
   ypos -34
  }
push $N2abe1000
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bb, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy3
   xpos 1170
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals3
   xpos 1170
   ypos 14
  }
push 0
push $N2abe1c00
  Dot {
   name Dot11
   xpos 764
   ypos -78
  }
set N2ab93800 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow1
   xpos 620
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low1
   xpos 620
   ypos -34
  }
push $N2ab93800
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Br, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy1
   xpos 730
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals1
   xpos 730
   ypos 14
  }
push $N2abe1800
  Dot {
   name Dot12
   xpos 984
   ypos -78
  }
set N2ab92400 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(g, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow2
   xpos 840
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low2
   xpos 840
   ypos -34
  }
push $N2ab92400
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bg, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy2
   xpos 950
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals2
   xpos 950
   ypos 14
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 950
   ypos 134
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N2ac9f800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "logr >= log10(maxPoint.y) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.y) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.y) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -202
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N2abe2000
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 log10(maxPoint.x)
   expr1 log10(maxPoint.x)
   expr2 log10(maxPoint.x)
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -208
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
 Expression {
  channel0 rgb
  expr0 log(r)/log(2)-log(0.18)/log(2)
  name expShift
  note_font Helvetica
  xpos -1140
  ypos -489
 }
end_group
Group {
 name Write_ResolveACES_ODT_LUT1
 label "\[python nuke.thisNode().knob('file').value().split('/').pop(-1)]"
 xpos 117
 ypos 464
 addUserKnob {20 User}
 addUserKnob {41 file l "output file" T GenerateLUT1.file}
 addUserKnob {41 generate l "Generate and Write LUT File" +INVISIBLE T GenerateLUT1.generate}
 addUserKnob {22 writeCubeDCTL l "Write Cube and DCTL" T "import os\n\nnode = nuke.thisNode()\n\ntemplatePath = os.path.join(nuke.script_directory(),node.knob('dctlTemplate').evaluate())\ncubePath = os.path.join(nuke.script_directory(),node.knob('file').evaluate())\ndctlPath = cubePath.replace('.cube','.dctl')\ncubeName = cubePath.split('/').pop(-1)\n\nnode.knob('generate').execute()\n\nwith open(templatePath) as f:\n    lines = f.readlines()\nnewLines = \[x.replace('replace.cube',cubeName) for x in lines]\n\nwith open(dctlPath, 'w') as f:\n    f.write('\\n'.join(newLines))" +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {2 dctlTemplate}
 dctlTemplate "DaVinci Resolve/ACES_ApplyLUT_Template.dctl"
}
 Input {
  inputs 0
  name Input1
  xpos 411
  ypos 213
 }
 GenerateLUT {
  file "DaVinci Resolve/ACES Transforms/ODT/ACES2.0 Candidates rev001/ACES2.0 CandidateA rev001 Rec2100.cube"
  file_type .cube
  name GenerateLUT1
  selected true
  xpos 411
  ypos 267
 }
 Output {
  name Output1
  xpos 411
  ypos 353
 }
end_group
push $N14e99c00
Dot {
 name Dot3
 xpos 343
 ypos 261
}
set N4b143c00 [stack 0]
Group {
 name OpenDRT
 label Rec709
 xpos 309
 ypos 331
 addUserKnob {20 OpenDRT}
 addUserKnob {26 about_label l " " T "<style> a:link \{ color: #ccc \}</style>\n<font color=#ccc>\n<b>OpenDRT</b> created by Jed Smith\n<br>v0.0.90b4 | <a href=https://github.com/jedypod/open-display-transform>documentation</a><br>"}
 addUserKnob {41 gamut l "in gamut" T InGamut_to_XYZ.gamut}
 addUserKnob {26 spacer l " " T ""}
 addUserKnob {35 presets l " " M {"presets/Rec.1886: 2.4 Power | Rec.709" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 2 display_gamut 4\}" "presets/sRGB Display: 2.2 Power | Rec.709" "knobs this \{Lw 100 su 0 sat 1.2 wp 3 eotf 1 display_gamut 4\}" "presets/Apple Display P3: 2.2 Power | P3D65" "knobs this \{Lw 100 su 0 sat 1.2 wp 3 eotf 1 display_gamut 1\}" "presets/Rec.2020: 2.4 Power | Rec.2020" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 2 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 100 nit" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 600 nit" "knobs this \{Lw 600 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: HLG | Rec.2020 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 5 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 2000 nit" "knobs this \{Lw 2000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 4000 nit" "knobs this \{Lw 4000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Dolby: ST 2084 PQ | P3D65 | 100 nit" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 600 nit" "knobs this \{Lw 600 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 2000 nit" "knobs this \{Lw 2000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 4000 nit" "knobs this \{Lw 4000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/DCI: 2.6 Power | P3 D60" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 2\}" "presets/DCI: 2.6 Power | P3 D65" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 1\}" "presets/DCI: 2.6 Power | P3 DCI" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 3\}" "presets/DCI: 2.6 Power | DCDM XYZ" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 5\}"}}
 addUserKnob {26 ""}
 addUserKnob {26 luminance_label l " " T <b>luminance</b>}
 addUserKnob {41 Lw T ToneScale.Lw}
 addUserKnob {41 su l surround T ToneScale.su}
 addUserKnob {26 chroma_label l " " T "<br/>\n<b>chroma</b>"}
 addUserKnob {41 dch l dechroma T ToneScale.dch}
 addUserKnob {41 sat l saturation T ToneScale.sat}
 addUserKnob {6 pdch l "perceptual dechroma" t "uses a perceptual colorspace to bias hue paths for chroma compression." +STARTLINE}
 pdch true
 addUserKnob {6 gcmp l "gamut compression" t "enable gamut compression" -STARTLINE}
 gcmp true
 addUserKnob {41 wp l whitepoint T Scale.wp}
 addUserKnob {26 ""}
 addUserKnob {26 display_encoding_label l " " T "<b>display encoding</b>"}
 addUserKnob {41 eotf T InverseEOTF.eotf}
 addUserKnob {41 display_gamut l gamut -STARTLINE T XYZ_to_DisplayGamut.gamut}
 addUserKnob {6 clamp t "clamp output to a 0-1 range" -STARTLINE}
 clamp true
 addUserKnob {26 ""}
 addUserKnob {4 direction M {forward inverse}}
}
 Input {
  inputs 0
  name Input
  xpos 180
  ypos -586
 }
set N4b143800 [stack 0]
 Group {
  name EOTF
  xpos 510
  ypos -490
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf l EOTF t "Choose the inverse EOTF to apply for the target display device." M {None "sRGB Display" BT.1886 "Gamma 2.6" PQ HLG ""}}
  eotf {{parent.InverseEOTF.eotf}}
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -130
  }
set N4b143400 [stack 0]
  Expression {
   expr0 r<=0.5?r*r/3:(exp((r-_c)/_a)+_b)/12
   expr1 g<=0.5?g*g/3:(exp((g-_c)/_a)+_b)/12
   expr2 b<=0.5?b*b/3:(exp((b-_c)/_a)+_b)/12
   name HLG_InverseOETF
   xpos 620
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
  Expression {
   temp_name0 Ys
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   expr0 pow(Ys,_g-1)*r
   expr1 pow(Ys,_g-1)*g
   expr2 pow(Ys,_g-1)*b
   name HLG_OOTF
   xpos 620
   ypos -34
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _g t "Gamma: Extended model for gamma variation according to peak display luminance and surround luminance: BT.2390-8 p32" R 0 2}
   _g {{1.2*pow(1.111,log(Lw/1000)/log(2))*pow(0.98,log(max(1e-6,Lamb)/5)/log(2))}}
   addUserKnob {7 Lw R 600 4000}
   Lw 1000
   addUserKnob {7 Lb}
   addUserKnob {7 Lamb t "ambient luminance level in nits" R 0 200}
   Lamb 5
  }
push $N4b143400
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,1/m_2)
   temp_name1 gp
   temp_expr1 pow(g,1/m_2)
   temp_name2 bp
   temp_expr2 pow(b,1/m_2)
   expr0 pow((rp-c_1)/(c_2-c_3*rp),1/m_1)
   expr1 pow((gp-c_1)/(c_2-c_3*gp),1/m_1)
   expr2 pow((bp-c_1)/(c_2-c_3*bp),1/m_1)
   name ST2084_EOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N4b143400
  Expression {
   expr0 sign(r)*pow(fabs(r),p)
   expr1 sign(g)*pow(fabs(g),p)
   expr2 sign(b)*pow(fabs(b),p)
   name Power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos -10
  }
  Output {
   name Output
   xpos 400
   ypos 62
  }
 end_group
 Expression {
  temp_name0 mx
  temp_expr0 dcdm?1:_s
  expr0 parent.clamp?max(0,min(mx,r/_s)):r/_s
  expr1 parent.clamp?max(0,min(mx,g/_s)):g/_s
  expr2 parent.clamp?max(0,min(mx,b/_s)):b/_s
  name InvDisplayScale
  xpos 510
  ypos -442
  addUserKnob {20 Params}
  addUserKnob {6 pq +STARTLINE}
  pq {{eotf==4}}
  addUserKnob {6 hlg -STARTLINE}
  hlg {{eotf==5}}
  addUserKnob {6 dcdm -STARTLINE}
  dcdm {{eotf==3&&display_gamut==5}}
  addUserKnob {7 _s}
  _s {{pq?Lw/10000:hlg?Lw/1000:dcdm?48/52.37:1}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
    }
  invert true
  name Inv_XYZ_to_DisplayGamut
  xpos 510
  ypos -370
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  name Inv_tlms_to_XYZ6
  xpos 510
  ypos -346
 }
 Expression {
  expr0 n*r/w.0
  expr1 n*g/w.1
  expr2 n*b/w.2
  name InvScale
  xpos 510
  ypos -322
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Scale.w} {parent.Scale.w} {parent.Scale.w}}
  addUserKnob {7 n R 0 4}
  n {{parent.Scale.wn}}
 }
set N4b141000 [stack 0]
 Expression {
  expr0 r*w.0
  expr1 g*w.1
  expr2 b*w.2
  name InvNormalize1
  xpos 620
  ypos -178
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Normalize.w} {parent.Normalize.w} {parent.Normalize.w}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name Inv_XYZ_to_tlms1
  xpos 620
  ypos -154
 }
 Group {
  name Colorspace_JzAzBz_Forward4
  xpos 620
  ypos -106
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d -0.56
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p 10000
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
push $N4b141000
 Expression {
  temp_name0 n
  temp_expr0 sqrt(pow(w.0*r,2)+pow(w.1*g,2)+pow(w.2*b,2))/sum
  temp_name1 nt
  temp_expr1 (n+sqrt(n*(4*fl+n)))/2
  temp_name2 ns
  temp_expr2 (pow(nt/sy,1/p)/(1-pow(nt/sy,1/p)))*sx
  temp_name3 ccf
  temp_expr3 pow(ns==0?0:pow(nt,1/p)/(ns/sx),dch)*sat
  expr0 n==0?0:(n*(ccf-1)+r)/ccf*ns/n
  expr1 n==0?0:(n*(ccf-1)+g)/ccf*ns/n
  expr2 n==0?0:(n*(ccf-1)+b)/ccf*ns/n
  expr3 ccf
  name InvToneScale
  xpos 510
  ypos -250
  addUserKnob {20 Params}
  addUserKnob {7 Lw R 100 4000}
  Lw {{parent.ToneScale.Lw}}
  addUserKnob {7 p R 1 2}
  p {{parent.ToneScale.p}}
  addUserKnob {7 fl l flare R 0 0.01}
  fl {{1/Lw}}
  addUserKnob {7 sx R 0 10}
  sx {{0.016*pow(Lw,0.87)-0.17}}
  addUserKnob {7 sy R 0 4}
  sy {{1.036+5e-5*Lw}}
  addUserKnob {7 dch l dechroma}
  dch {{parent.ToneScale.dch}}
  addUserKnob {7 sat l saturation R 0.9 1.6}
  sat {{parent.ToneScale.sat}}
  addUserKnob {78 w n 3}
  w {0.24 0.1 0.09}
  addUserKnob {7 sum t "Normalize so achromatic in=out" R 0 2}
  sum {{sqrt(w.0*w.0+w.1*w.1+w.2*w.2)}}
 }
 Expression {
  expr0 r*w.0
  expr1 g*w.1
  expr2 b*w.2
  name InvNormalize
  xpos 510
  ypos -178
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Normalize.w} {parent.Normalize.w} {parent.Normalize.w}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name Inv_XYZ_to_tlms
  xpos 510
  ypos -154
 }
 Group {
  name Colorspace_JzAzBz_Forward3
  xpos 510
  ypos -106
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward4.d}}
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward4.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy1
  xpos 510
  ypos -64
  disable {{!pdch}}
 }
 Group {
  name Colorspace_JzAzBz_Inverse2
  xpos 510
  ypos -10
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward4.d}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -490
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   channel3 none
   name Expression6
   label "JCh to JzAzBz"
   xpos -40
   ypos -376
   disable {{!parent.JCh}}
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 (r+d_0)/(1+d-d*(r+d_0))
   expr1 g
   expr2 b
   name Expression4
   label Iz
   xpos -40
   ypos -328
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name ColorMatrix4
   label IZAZBZ_TO_LMS_P
   xpos -40
   ypos -280
  }
  Group {
   name eotf_ST2084_
   xpos -40
   ypos -226
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward4.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r, 1/m_2)"
    expr1 "pow(g, 1/m_2)"
    expr2 "pow(b, 1/m_2)"
    name Expression1
    label V_p
    xpos -40
    ypos -256
   }
   Expression {
    expr0 pow(((r-c_1)/(c_2-c_3*r)),1/m_1)*L_p
    expr1 pow(((g-c_1)/(c_2-c_3*g)),1/m_1)*L_p
    expr2 pow(((b-c_1)/(c_2-c_3*b)),1/m_1)*L_p
    name Expression2
    label C
    xpos -40
    ypos -218
   }
   Output {
    name Output
    xpos -40
    ypos -169
   }
  end_group
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name ColorMatrix5
   label LMS_TO_XYZ
   xpos -40
   ypos -184
  }
  Expression {
   expr0 (r+(1.15-1)*b)/1.15
   expr1 (g+(0.66-1)*((r+(1.15-1)*b)/1.15))/0.66
   expr2 b
   name Expression2
   label "X_p Y_p Z"
   xpos -40
   ypos -136
  }
  Output {
   name Output
   xpos -40
   ypos 42
  }
 end_group
 ColorMatrix {
  matrix {
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
    }
  invert true
  name Inv_InGamut_to_XYZ1
  xpos 510
  ypos 38
 }
push $N4b143800
 Group {
  name InGamut_to_XYZ
  tile_color 0x429940ff
  xpos 180
  ypos -514
  addUserKnob {20 InputGamut_to_XYZ_tab l InputGamut_to_XYZ}
  addUserKnob {4 gamut l "in gamut" M {ACES ACEScg P3D65 Rec.2020 Rec.709 "Alexa WideGamut" "Red WideGamutRGB" "Sony SGamut3" "Filmlight E-Gamut" "DaVinci Wide Gamut" "" "" ""}}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -610
  }
  Dot {
   name Dot1
   xpos 324
   ypos -546
  }
set N4b6ed400 [stack 0]
  ColorMatrix {
   matrix {
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
     }
   name ColorMatrix
   xpos 290
   ypos -370
  }
  Output {
   name Output
   xpos 290
   ypos -250
  }
push $N4b6ed400
  Dot {
   name Dot391
   label " *RGB to XYZ D65 CAT: XYZ Scaling"
   xpos 434
   ypos -546
  }
set N4b6ec800 [stack 0]
  ColorMatrix {
   matrix {
       {0.7006223202 0.1487748027 0.101058729}
       {0.2741184831 0.8736317754 -0.1477504224}
       {-0.09896290302 -0.1378953159 1.325916052}
     }
   name ColorMatrix30
   label "DaVinci WG to XYZ D65"
   xpos 1390
   ypos -466
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.705396831 0.1640413404 0.08101775497}
       {0.2801307142 0.8202067018 -0.1003373787}
       {-0.1037815139 -0.07290726155 1.265746593}
     }
   name ColorMatrix29
   label "Filmlight E-Gamut to XYZ D65"
   xpos 1280
   ypos -466
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.5990839005 0.2489254922 0.1024464965}
       {0.2150758207 0.8850684166 -0.1001443192}
       {-0.03206584975 -0.02765838802 1.148782015}
     }
   name ColorMatrix31
   label "SonySGamut3 to XYZ D65"
   xpos 1170
   ypos -465
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.735275209 0.06860940903 0.1465712786}
       {0.2866940796 0.8429790735 -0.1296732426}
       {-0.07968084514 -0.3473432064 1.516081929}
     }
   name ColorMatrix22
   label "REDWideGamutRGB to XYZ D65"
   xpos 1060
   ypos -466
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.6380076408 0.2147038132 0.09774445742}
       {0.2919537723 0.8238408566 -0.1157948226}
       {0.002798279049 -0.06703422219 1.153293848}
     }
   name ColorMatrix21
   label "Arri AlexaWideGamut to XYZ D65"
   xpos 950
   ypos -466
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.4123909175 0.3575843573 0.1804807931}
       {0.2126390785 0.7151687145 0.07219231129}
       {0.01933082566 0.1191947833 0.9505321383}
     }
   name ColorMatrix18
   label "Rec709 to XYZ D65"
   xpos 840
   ypos -466
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.6369581223 0.1446169168 0.1688809693}
       {0.2627002299 0.6779981256 0.05930171534}
       {4.99410725e-17 0.02807269618 1.060985088}
     }
   name ColorMatrix17
   label "Rec2020 to XYZ D65"
   xpos 730
   ypos -466
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.4865711331 0.2656677067 0.1982173175}
       {0.2289746404 0.6917386055 0.07928691804}
       {-3.972076965e-17 0.04511338845 1.043944478}
     }
   name ColorMatrix16
   label "P3D65 to XYZ D65"
   xpos 620
   ypos -466
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.6609312296 0.1336961389 0.1558285803}
       {0.2722287476 0.6740817428 0.05368950963}
       {-0.006018006243 0.004383686464 1.090692043}
     }
   name ColorMatrix1
   label "ACEScg to XYZ D65"
   xpos 510
   ypos -466
  }
push $N4b6ec800
  ColorMatrix {
   matrix {
       {0.9503623843 0 9.346324805e-05}
       {0.3439664543 0.728166163 -0.07213254273}
       {0 0 1.089057803}
     }
   name ColorMatrix2
   label "ACES to XYZ D65"
   xpos 400
   ypos -466
  }
  Switch {
   inputs 10
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -370
  }
 end_group
 ColorMatrix {
  matrix {
      {0.257085 0.859943 -0.031061}
      {-0.394427 1.1758 0.106423}
      {0.064856 -0.07625 0.559067}
    }
  name XYZ_to_tlms
  xpos 180
  ypos -490
 }
 Expression {
  expr0 r/w.0
  expr1 g/w.1
  expr2 b/w.2
  name Normalize
  xpos 180
  ypos -466
  addUserKnob {20 Params}
  addUserKnob {35 presets l "" +STARTLINE M {presets/D50 "knobs this \{w \{1.08221 0.883260 0.447579\}\}" presets/D55 "knobs this \{w \{1.07730 0.896467 0.500927\}\}" presets/D60 "knobs this \{w \{1.07344 0.907523 0.549381\}\}" presets/D65 "knobs this \{w \{1.07046 0.916817 0.594251\}\}" presets/D75 "knobs this \{w \{1.06600 0.931715 0.670839\}\}" presets/D93 "knobs this \{w \{1.06098 0.950462 0.776150\}\}"}}
  addUserKnob {78 w n 3}
  w {1.07046 0.916817 0.594251}
 }
 Dot {
  name Dot1
  xpos 214
  ypos -414
 }
set N4b685000 [stack 0]
 Group {
  name LMS_to_Yrg
  xpos 290
  ypos -418
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -394
  }
  Expression {
   temp_name0 _a
   temp_expr0 r+g+b
   temp_name1 l
   temp_expr1 _a==0?0:r/_a
   temp_name2 m
   temp_expr2 _a==0?0:g/_a
   expr0 0.68990272*r+0.34832189*g
   expr1 1.0671*l-0.6873*m+0.02062-0.14722
   expr2 -0.0362*l+1.7182*m-0.05155-0.50911666
   name LMS_to_Yrg
   xpos 400
   ypos -346
  }
  Expression {
   temp_name0 l
   temp_expr0 1
   expr1 fabs(g)>l?sign(g)*l:g
   expr2 fabs(b)>l?sign(b)*l:b
   name Limiter
   xpos 400
   ypos -311
  }
  Expression {
   expr0 r
   expr1 hypot(g,b)
   expr2 atan2(b,g)
   name cartesian_to_polar1
   xpos 400
   ypos -274
  }
  Output {
   name Output
   xpos 400
   ypos -226
  }
 end_group
push $N4b685000
 MergeExpression {
  inputs 2
  temp_name0 _c
  temp_expr0 Ag
  temp_name1 f
  temp_expr1 (_c<t0?_c:sc*sqrt(_c-ox)+oy)/_c
  temp_name2 ac
  temp_expr2 (r+g+b)/3
  expr0 ac*(1-f)+r*f
  expr1 ac*(1-f)+g*f
  expr2 ac*(1-f)+b*f
  maskChannelMask rgba.red
  name compress_chroma
  xpos 180
  ypos -370
  disable {{!parent.gcmp}}
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 t0 t "threshold to start compression\n" R 0 2}
  t0 0.35
  addUserKnob {7 x0 t "x coordinate to compress to" R 0 2}
  x0 1
  addUserKnob {7 y0 t "y coordinate to compress to" R 0 2}
  y0 0.45
  addUserKnob {7 sc}
  sc {{(y0-t0)/sqrt(x0-y0)}}
  addUserKnob {7 ox R -2 2}
  ox {{t0-sc*sc/4}}
  addUserKnob {7 oy R -2 2}
  oy {{t0-sc*sqrt(sc*sc/4)}}
 }
 Expression {
  temp_name0 n
  temp_expr0 sqrt(max(1e-12,w.0*r)**2+max(1e-12,w.1*g)**2+max(1e-12,w.2*b)**2)/sum
  temp_name1 ns
  temp_expr1 sy*pow(n/(n+sx),p)
  temp_name2 nt
  temp_expr2 ns*ns/(ns+fl)
  temp_name3 ccf
  temp_expr3 pow(sx/(n+sx),dch)*sat
  expr0 nt*(1-ccf)+r*(nt/n)*ccf
  expr1 nt*(1-ccf)+g*(nt/n)*ccf
  expr2 nt*(1-ccf)+b*(nt/n)*ccf
  expr3 nt/n
  name ToneScale
  xpos 180
  ypos -322
  addUserKnob {20 Params}
  addUserKnob {7 Lw R 100 4000}
  Lw 100
  addUserKnob {7 c l contrast R 0.8 2}
  c {{12*pow(Lw,-0.86)+1.17}}
  addUserKnob {4 su l surround t "dark = 1.0\ndim = 0.95\naverage = 0.90" M {average dim dark}}
  su dim
  addUserKnob {7 p R 1 2}
  p {{c*(0.9+0.05*su)}}
  addUserKnob {7 fl l flare R 0 0.01}
  fl {{1/Lw}}
  addUserKnob {7 sx R 0 10}
  sx {{0.016*pow(Lw,0.87)-0.17}}
  addUserKnob {7 sy R 0 4}
  sy {{1.036+5e-5*Lw}}
  addUserKnob {7 dch l dechroma}
  dch 0.5
  addUserKnob {7 sat l saturation R 0.9 1.6}
  sat 1.2
  addUserKnob {78 w n 3}
  w {0.24 0.1 0.09}
  addUserKnob {7 sum t "Normalize so achromatic in=out" R 0 2}
  sum {{sqrt(w.0*w.0+w.1*w.1+w.2*w.2)}}
 }
set N4b60f000 [stack 0]
push $N4b685000
 MergeExpression {
  inputs 2
  temp_name0 s
  temp_expr0 Aa
  expr0 r*s
  expr1 g*s
  expr2 b*s
  name MergeExpression1
  xpos 70
  ypos -322
 }
 Expression {
  expr0 r*w.0/n
  expr1 g*w.1/n
  expr2 b*w.2/n
  expr3 1
  name Scale1
  xpos 70
  ypos -202
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Scale.w} {parent.Scale.w} {parent.Scale.w}}
  addUserKnob {7 n R 0 2}
  n {{parent.Scale.wn}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name tlms_to_XYZ1
  xpos 70
  ypos -178
 }
 Group {
  name Colorspace_JzAzBz_Forward1
  xpos 70
  ypos -130
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward2.d}}
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward2.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
push $N4b60f000
 Expression {
  expr0 r*w.0/wn
  expr1 g*w.1/wn
  expr2 b*w.2/wn
  expr3 1
  name Scale
  xpos 180
  ypos -202
  addUserKnob {20 Params}
  addUserKnob {4 wp M {D50 D55 D60 D65 D75 D93}}
  wp D65
  addUserKnob {78 w n 3}
  w {{curve(wp) 1.08221 1.0773 1.07344 1.07046 1.066 1.06098} {curve(wp) 0.88326 0.896467 0.907523 0.916817 0.931715 0.950462} {curve(wp) 0.447579 0.500927 0.549381 0.594251 0.670839 0.77615}}
  addUserKnob {7 wn R 0 2}
  wn {{curve(wp+6*display_gamut) 1.09063 1.05337 1.02355 1 1.12915 1.30631 1.1408 1.08334 1.037 1 1.13116 1.31116 1.09928 1.04391 1.00028 1.08307 1.22512 1.42007 1.2469 1.18409 1.13345 1.15054 1.30144 1.50853 1.17646 1.10416 1.0461 1 1.14486 1.34374 1 1 1 1 1 1}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name tlms_to_XYZ
  xpos 180
  ypos -178
 }
 Group {
  name Colorspace_JzAzBz_Forward2
  xpos 180
  ypos -130
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d -0.56
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p 10000
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy2
  xpos 180
  ypos -64
  disable {{!pdch}}
 }
 Group {
  name Colorspace_JzAzBz_Inverse1
  xpos 180
  ypos -10
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward2.d}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -490
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   channel3 none
   name Expression6
   label "JCh to JzAzBz"
   xpos -40
   ypos -376
   disable {{!parent.JCh}}
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 (r+d_0)/(1+d-d*(r+d_0))
   expr1 g
   expr2 b
   name Expression4
   label Iz
   xpos -40
   ypos -328
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name ColorMatrix4
   label IZAZBZ_TO_LMS_P
   xpos -40
   ypos -280
  }
  Group {
   name eotf_ST2084_
   xpos -40
   ypos -226
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward2.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r, 1/m_2)"
    expr1 "pow(g, 1/m_2)"
    expr2 "pow(b, 1/m_2)"
    name Expression1
    label V_p
    xpos -40
    ypos -256
   }
   Expression {
    expr0 pow(((r-c_1)/(c_2-c_3*r)),1/m_1)*L_p
    expr1 pow(((g-c_1)/(c_2-c_3*g)),1/m_1)*L_p
    expr2 pow(((b-c_1)/(c_2-c_3*b)),1/m_1)*L_p
    name Expression2
    label C
    xpos -40
    ypos -218
   }
   Output {
    name Output
    xpos -40
    ypos -169
   }
  end_group
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name ColorMatrix5
   label LMS_TO_XYZ
   xpos -40
   ypos -184
  }
  Expression {
   expr0 (r+(1.15-1)*b)/1.15
   expr1 (g+(0.66-1)*((r+(1.15-1)*b)/1.15))/0.66
   expr2 b
   name Expression2
   label "X_p Y_p Z"
   xpos -40
   ypos -136
  }
  Output {
   name Output
   xpos -40
   ypos 42
  }
 end_group
 Group {
  name XYZ_to_DisplayGamut
  tile_color 0x425440ff
  xpos 180
  ypos 38
  addUserKnob {20 XYZ_to_DisplayGamut_tab l XYZ_to_DisplayGamut}
  addUserKnob {4 gamut l "display gamut" t "Choose the target display device chromaticities." M {Rec.2020 "P3 D65" "P3 D60" "P3 DCI" Rec.709 "DCDM X'Y'Z'"}}
  gamut Rec.709
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -580
  }
  Dot {
   name Dot391
   label " "
   xpos 324
   ypos -516
  }
set N4bba3800 [stack 0]
  ColorMatrix {
   matrix {
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
     }
   name ColorMatrix
   xpos 290
   ypos -399
  }
  Output {
   name Output
   xpos 290
   ypos -310
  }
push $N4bba3800
  Dot {
   name Dot1
   label " XYZ D65 to *RGB CAT: XYZ Scaling"
   xpos 434
   ypos -516
  }
set N4bba2c00 [stack 0]
  ColorMatrix {
   matrix {
       {1 0 0}
       {0 1 0}
       {0 0 1}
     }
   name ColorMatrix4
   label "XYZ D65 to XYZ E"
   xpos 950
   ypos -465
  }
push $N4bba2c00
  ColorMatrix {
   matrix {
       {3.240968943 -1.537382722 -0.4986106157}
       {-0.9692435861 1.875967264 0.04155508429}
       {0.05563007668 -0.2039769441 1.056971431}
     }
   name ColorMatrix2
   label "XYZ D65 to Rec709"
   xpos 840
   ypos -465
  }
push $N4bba2c00
  ColorMatrix {
   matrix {
       {2.72539258 -1.01800251 -0.4401629865}
       {-0.795167923 1.689731836 0.02264717408}
       {0.04124189168 -0.08763902634 1.100929379}
     }
   name ColorMatrix12
   label "XYZ D65 to P3DCI"
   xpos 730
   ypos -465
  }
push $N4bba2c00
  ColorMatrix {
   matrix {
       {2.40274024 -0.8974836469 -0.3880532086}
       {-0.8325793743 1.769231319 0.02371269651}
       {0.03882337734 -0.0824996829 1.036368608}
     }
   name ColorMatrix11
   label "XYZ D65 to P3D60"
   xpos 620
   ypos -465
  }
push $N4bba2c00
  ColorMatrix {
   matrix {
       {2.493495464 -0.9313831329 -0.4027105868}
       {-0.8294886947 1.762663484 0.02362468652}
       {0.03584581986 -0.07617236674 0.9568843246}
     }
   name ColorMatrix10
   label "XYZ D65 to P3D65"
   xpos 510
   ypos -465
  }
push $N4bba2c00
  ColorMatrix {
   matrix {
       {1.716650844 -0.3556707203 -0.2533662021}
       {-0.6666842103 1.616480947 0.01576854289}
       {0.01763985492 -0.04277061298 0.9421030283}
     }
   name ColorMatrix5
   label "XYZ D65 to Rec2020"
   xpos 400
   ypos -465
  }
  Switch {
   inputs 6
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -399
  }
 end_group
 Expression {
  temp_name0 mx
  temp_expr0 dcdm?1:_s
  expr0 parent.clamp?max(0,min(mx,r*_s)):r*_s
  expr1 parent.clamp?max(0,min(mx,g*_s)):g*_s
  expr2 parent.clamp?max(0,min(mx,b*_s)):b*_s
  name DisplayScale1
  xpos 180
  ypos 86
  addUserKnob {20 Params}
  addUserKnob {6 pq +STARTLINE}
  pq {{eotf==4}}
  addUserKnob {6 hlg -STARTLINE}
  hlg {{eotf==5}}
  addUserKnob {6 dcdm -STARTLINE}
  dcdm {{eotf==3&&display_gamut==5}}
  addUserKnob {7 _s}
  _s {{pq?Lw/10000:hlg?Lw/1000:dcdm?48/52.37:1}}
 }
 Group {
  name InverseEOTF
  xpos 180
  ypos 110
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf t "Choose the inverse EOTF to apply for the target display device." M {None "sRGB Display" BT.1886 "Gamma 2.6" PQ HLG "" "" ""}}
  eotf BT.1886
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -130
  }
set N4bba0c00 [stack 0]
  Expression {
   temp_name0 Yd
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   expr0 r*pow(Yd,(1-_g)/_g)
   expr1 g*pow(Yd,(1-_g)/_g)
   expr2 b*pow(Yd,(1-_g)/_g)
   name HLG_InverseOOTF
   xpos 620
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _g t "Gamma: Extended model for gamma variation according to peak display luminance and surround luminance: BT.2390-8 p32" R 0 2}
   _g {{1.2*pow(1.111,log(Lw/1000)/log(2))*pow(0.98,log(max(1e-6,Lamb)/5)/log(2))}}
   addUserKnob {7 Lw R 600 4000}
   Lw {{parent.parent.Lw}}
   addUserKnob {7 Lamb t "ambient luminance level in nits" R 0 200}
   Lamb 5
  }
  Expression {
   expr0 r<=1/12?sqrt(3*r):_a*log(12*r-_b)+_c
   expr1 g<=1/12?sqrt(3*g):_a*log(12*g-_b)+_c
   expr2 b<=1/12?sqrt(3*b):_a*log(12*b-_b)+_c
   name HLG_OETF
   xpos 620
   ypos -34
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
push $N4bba0c00
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,m_1)
   temp_name1 gp
   temp_expr1 pow(g,m_1)
   temp_name2 bp
   temp_expr2 pow(b,m_1)
   expr0 pow((c_1+c_2*rp)/(1+c_3*rp),m_2)
   expr1 pow((c_1+c_2*gp)/(1+c_3*gp),m_2)
   expr2 pow((c_1+c_2*bp)/(1+c_3*bp),m_2)
   name ST2084_InverseEOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N4bba0c00
  Expression {
   expr0 sign(r)*pow(fabs(r),1/p)
   expr1 sign(g)*pow(fabs(g),1/p)
   expr2 sign(b)*pow(fabs(b),1/p)
   name power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos 14
  }
  Output {
   name Output
   xpos 400
   ypos 86
  }
 end_group
 Switch {
  inputs 2
  which {{parent.direction}}
  name SwitchDirection
  xpos 180
  ypos 206
 }
 Output {
  name Output
  xpos 180
  ypos 278
 }
end_group
Group {
 name Write_ResolveACES_ODT_LUT2
 label "\[python nuke.thisNode().knob('file').value().split('/').pop(-1)]"
 xpos 309
 ypos 462
 addUserKnob {20 User}
 addUserKnob {41 file l "output file" T GenerateLUT1.file}
 addUserKnob {41 generate l "Generate and Write LUT File" +INVISIBLE T GenerateLUT1.generate}
 addUserKnob {22 writeCubeDCTL l "Write Cube and DCTL" T "import os\n\nnode = nuke.thisNode()\n\ntemplatePath = os.path.join(nuke.script_directory(),node.knob('dctlTemplate').evaluate())\ncubePath = os.path.join(nuke.script_directory(),node.knob('file').evaluate())\ndctlPath = cubePath.replace('.cube','.dctl')\ncubeName = cubePath.split('/').pop(-1)\n\nnode.knob('generate').execute()\n\nwith open(templatePath) as f:\n    lines = f.readlines()\nnewLines = \[x.replace('replace.cube',cubeName) for x in lines]\n\nwith open(dctlPath, 'w') as f:\n    f.write('\\n'.join(newLines))" +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {2 dctlTemplate}
 dctlTemplate "DaVinci Resolve/ACES_ApplyLUT_Template.dctl"
}
 Input {
  inputs 0
  name Input1
  xpos 411
  ypos 213
 }
 GenerateLUT {
  file "DaVinci Resolve/ACES Transforms/ODT/ACES2.0 Candidates rev001/ACES2.0 CandidateB rev001 Rec709.cube"
  file_type .cube
  name GenerateLUT1
  selected true
  xpos 411
  ypos 267
 }
 Output {
  name Output1
  xpos 411
  ypos 353
 }
end_group
push $N4b143c00
Group {
 name OpenDRT1
 label Rec2100
 xpos 423
 ypos 331
 addUserKnob {20 OpenDRT}
 addUserKnob {26 about_label l " " T "<style> a:link \{ color: #ccc \}</style>\n<font color=#ccc>\n<b>OpenDRT</b> created by Jed Smith\n<br>v0.0.90b4 | <a href=https://github.com/jedypod/open-display-transform>documentation</a><br>"}
 addUserKnob {41 gamut l "in gamut" T InGamut_to_XYZ.gamut}
 addUserKnob {26 spacer l " " T ""}
 addUserKnob {35 presets l " " M {"presets/Rec.1886: 2.4 Power | Rec.709" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 2 display_gamut 4\}" "presets/sRGB Display: 2.2 Power | Rec.709" "knobs this \{Lw 100 su 0 sat 1.2 wp 3 eotf 1 display_gamut 4\}" "presets/Apple Display P3: 2.2 Power | P3D65" "knobs this \{Lw 100 su 0 sat 1.2 wp 3 eotf 1 display_gamut 1\}" "presets/Rec.2020: 2.4 Power | Rec.2020" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 2 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 100 nit" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 600 nit" "knobs this \{Lw 600 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: HLG | Rec.2020 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 5 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 2000 nit" "knobs this \{Lw 2000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Rec.2100: ST 2084 PQ | Rec.2020 | 4000 nit" "knobs this \{Lw 4000 su 2 sat 1 wp 3 eotf 4 display_gamut 0\}" "presets/Dolby: ST 2084 PQ | P3D65 | 100 nit" "knobs this \{Lw 100 su 1 sat 1.2 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 600 nit" "knobs this \{Lw 600 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 1000 nit" "knobs this \{Lw 1000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 2000 nit" "knobs this \{Lw 2000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/Dolby: ST 2084 PQ | P3D65 | 4000 nit" "knobs this \{Lw 4000 su 2 sat 1 wp 3 eotf 4 display_gamut 1\}" "presets/DCI: 2.6 Power | P3 D60" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 2\}" "presets/DCI: 2.6 Power | P3 D65" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 1\}" "presets/DCI: 2.6 Power | P3 DCI" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 3\}" "presets/DCI: 2.6 Power | DCDM XYZ" "knobs this \{Lw 100 su 2 sat 1.2 wp 3 eotf 3 display_gamut 5\}"}}
 addUserKnob {26 ""}
 addUserKnob {26 luminance_label l " " T <b>luminance</b>}
 addUserKnob {41 Lw T ToneScale.Lw}
 addUserKnob {41 su l surround T ToneScale.su}
 addUserKnob {26 chroma_label l " " T "<br/>\n<b>chroma</b>"}
 addUserKnob {41 dch l dechroma T ToneScale.dch}
 addUserKnob {41 sat l saturation T ToneScale.sat}
 addUserKnob {6 pdch l "perceptual dechroma" t "uses a perceptual colorspace to bias hue paths for chroma compression." +STARTLINE}
 pdch true
 addUserKnob {6 gcmp l "gamut compression" t "enable gamut compression" -STARTLINE}
 gcmp true
 addUserKnob {41 wp l whitepoint T Scale.wp}
 addUserKnob {26 ""}
 addUserKnob {26 display_encoding_label l " " T "<b>display encoding</b>"}
 addUserKnob {41 eotf T InverseEOTF.eotf}
 addUserKnob {41 display_gamut l gamut -STARTLINE T XYZ_to_DisplayGamut.gamut}
 addUserKnob {6 clamp t "clamp output to a 0-1 range" -STARTLINE}
 clamp true
 addUserKnob {26 ""}
 addUserKnob {4 direction M {forward inverse}}
}
 Input {
  inputs 0
  name Input
  xpos 180
  ypos -586
 }
set N4bb3e000 [stack 0]
 Group {
  name EOTF
  xpos 510
  ypos -490
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf l EOTF t "Choose the inverse EOTF to apply for the target display device." M {None "sRGB Display" BT.1886 "Gamma 2.6" PQ HLG ""}}
  eotf {{parent.InverseEOTF.eotf}}
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -130
  }
set N4bb3dc00 [stack 0]
  Expression {
   expr0 r<=0.5?r*r/3:(exp((r-_c)/_a)+_b)/12
   expr1 g<=0.5?g*g/3:(exp((g-_c)/_a)+_b)/12
   expr2 b<=0.5?b*b/3:(exp((b-_c)/_a)+_b)/12
   name HLG_InverseOETF
   xpos 620
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
  Expression {
   temp_name0 Ys
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   expr0 pow(Ys,_g-1)*r
   expr1 pow(Ys,_g-1)*g
   expr2 pow(Ys,_g-1)*b
   name HLG_OOTF
   xpos 620
   ypos -34
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _g t "Gamma: Extended model for gamma variation according to peak display luminance and surround luminance: BT.2390-8 p32" R 0 2}
   _g {{1.2*pow(1.111,log(Lw/1000)/log(2))*pow(0.98,log(max(1e-6,Lamb)/5)/log(2))}}
   addUserKnob {7 Lw R 600 4000}
   Lw 1000
   addUserKnob {7 Lb}
   addUserKnob {7 Lamb t "ambient luminance level in nits" R 0 200}
   Lamb 5
  }
push $N4bb3dc00
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,1/m_2)
   temp_name1 gp
   temp_expr1 pow(g,1/m_2)
   temp_name2 bp
   temp_expr2 pow(b,1/m_2)
   expr0 pow((rp-c_1)/(c_2-c_3*rp),1/m_1)
   expr1 pow((gp-c_1)/(c_2-c_3*gp),1/m_1)
   expr2 pow((bp-c_1)/(c_2-c_3*bp),1/m_1)
   name ST2084_EOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N4bb3dc00
  Expression {
   expr0 sign(r)*pow(fabs(r),p)
   expr1 sign(g)*pow(fabs(g),p)
   expr2 sign(b)*pow(fabs(b),p)
   name Power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos -10
  }
  Output {
   name Output
   xpos 400
   ypos 62
  }
 end_group
 Expression {
  temp_name0 mx
  temp_expr0 dcdm?1:_s
  expr0 parent.clamp?max(0,min(mx,r/_s)):r/_s
  expr1 parent.clamp?max(0,min(mx,g/_s)):g/_s
  expr2 parent.clamp?max(0,min(mx,b/_s)):b/_s
  name InvDisplayScale
  xpos 510
  ypos -442
  addUserKnob {20 Params}
  addUserKnob {6 pq +STARTLINE}
  pq {{eotf==4}}
  addUserKnob {6 hlg -STARTLINE}
  hlg {{eotf==5}}
  addUserKnob {6 dcdm -STARTLINE}
  dcdm {{eotf==3&&display_gamut==5}}
  addUserKnob {7 _s}
  _s {{pq?Lw/10000:hlg?Lw/1000:dcdm?48/52.37:1}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
      {{parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix} {parent.XYZ_to_DisplayGamut.ColorMatrix.matrix}}
    }
  invert true
  name Inv_XYZ_to_DisplayGamut
  xpos 510
  ypos -370
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  name Inv_tlms_to_XYZ6
  xpos 510
  ypos -346
 }
 Expression {
  expr0 n*r/w.0
  expr1 n*g/w.1
  expr2 n*b/w.2
  name InvScale
  xpos 510
  ypos -322
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Scale.w} {parent.Scale.w} {parent.Scale.w}}
  addUserKnob {7 n R 0 4}
  n {{parent.Scale.wn}}
 }
set N4babf400 [stack 0]
 Expression {
  expr0 r*w.0
  expr1 g*w.1
  expr2 b*w.2
  name InvNormalize1
  xpos 620
  ypos -178
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Normalize.w} {parent.Normalize.w} {parent.Normalize.w}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name Inv_XYZ_to_tlms1
  xpos 620
  ypos -154
 }
 Group {
  name Colorspace_JzAzBz_Forward4
  xpos 620
  ypos -106
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d -0.56
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p 10000
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
push $N4babf400
 Expression {
  temp_name0 n
  temp_expr0 sqrt(pow(w.0*r,2)+pow(w.1*g,2)+pow(w.2*b,2))/sum
  temp_name1 nt
  temp_expr1 (n+sqrt(n*(4*fl+n)))/2
  temp_name2 ns
  temp_expr2 (pow(nt/sy,1/p)/(1-pow(nt/sy,1/p)))*sx
  temp_name3 ccf
  temp_expr3 pow(ns==0?0:pow(nt,1/p)/(ns/sx),dch)*sat
  expr0 n==0?0:(n*(ccf-1)+r)/ccf*ns/n
  expr1 n==0?0:(n*(ccf-1)+g)/ccf*ns/n
  expr2 n==0?0:(n*(ccf-1)+b)/ccf*ns/n
  expr3 ccf
  name InvToneScale
  xpos 510
  ypos -250
  addUserKnob {20 Params}
  addUserKnob {7 Lw R 100 4000}
  Lw {{parent.ToneScale.Lw}}
  addUserKnob {7 p R 1 2}
  p {{parent.ToneScale.p}}
  addUserKnob {7 fl l flare R 0 0.01}
  fl {{1/Lw}}
  addUserKnob {7 sx R 0 10}
  sx {{0.016*pow(Lw,0.87)-0.17}}
  addUserKnob {7 sy R 0 4}
  sy {{1.036+5e-5*Lw}}
  addUserKnob {7 dch l dechroma}
  dch {{parent.ToneScale.dch}}
  addUserKnob {7 sat l saturation R 0.9 1.6}
  sat {{parent.ToneScale.sat}}
  addUserKnob {78 w n 3}
  w {0.24 0.1 0.09}
  addUserKnob {7 sum t "Normalize so achromatic in=out" R 0 2}
  sum {{sqrt(w.0*w.0+w.1*w.1+w.2*w.2)}}
 }
 Expression {
  expr0 r*w.0
  expr1 g*w.1
  expr2 b*w.2
  name InvNormalize
  xpos 510
  ypos -178
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Normalize.w} {parent.Normalize.w} {parent.Normalize.w}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name Inv_XYZ_to_tlms
  xpos 510
  ypos -154
 }
 Group {
  name Colorspace_JzAzBz_Forward3
  xpos 510
  ypos -106
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward4.d}}
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward4.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy1
  xpos 510
  ypos -64
  disable {{!pdch}}
 }
 Group {
  name Colorspace_JzAzBz_Inverse2
  xpos 510
  ypos -10
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward4.d}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -490
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   channel3 none
   name Expression6
   label "JCh to JzAzBz"
   xpos -40
   ypos -376
   disable {{!parent.JCh}}
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 (r+d_0)/(1+d-d*(r+d_0))
   expr1 g
   expr2 b
   name Expression4
   label Iz
   xpos -40
   ypos -328
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name ColorMatrix4
   label IZAZBZ_TO_LMS_P
   xpos -40
   ypos -280
  }
  Group {
   name eotf_ST2084_
   xpos -40
   ypos -226
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward4.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r, 1/m_2)"
    expr1 "pow(g, 1/m_2)"
    expr2 "pow(b, 1/m_2)"
    name Expression1
    label V_p
    xpos -40
    ypos -256
   }
   Expression {
    expr0 pow(((r-c_1)/(c_2-c_3*r)),1/m_1)*L_p
    expr1 pow(((g-c_1)/(c_2-c_3*g)),1/m_1)*L_p
    expr2 pow(((b-c_1)/(c_2-c_3*b)),1/m_1)*L_p
    name Expression2
    label C
    xpos -40
    ypos -218
   }
   Output {
    name Output
    xpos -40
    ypos -169
   }
  end_group
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name ColorMatrix5
   label LMS_TO_XYZ
   xpos -40
   ypos -184
  }
  Expression {
   expr0 (r+(1.15-1)*b)/1.15
   expr1 (g+(0.66-1)*((r+(1.15-1)*b)/1.15))/0.66
   expr2 b
   name Expression2
   label "X_p Y_p Z"
   xpos -40
   ypos -136
  }
  Output {
   name Output
   xpos -40
   ypos 42
  }
 end_group
 ColorMatrix {
  matrix {
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
      {{parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix} {parent.InGamut_to_XYZ.ColorMatrix.matrix}}
    }
  invert true
  name Inv_InGamut_to_XYZ1
  xpos 510
  ypos 38
 }
push $N4bb3e000
 Group {
  name InGamut_to_XYZ
  tile_color 0x429940ff
  xpos 180
  ypos -514
  addUserKnob {20 InputGamut_to_XYZ_tab l InputGamut_to_XYZ}
  addUserKnob {4 gamut l "in gamut" M {ACES ACEScg P3D65 Rec.2020 Rec.709 "Alexa WideGamut" "Red WideGamutRGB" "Sony SGamut3" "Filmlight E-Gamut" "DaVinci Wide Gamut" "" "" ""}}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -610
  }
  Dot {
   name Dot1
   xpos 324
   ypos -546
  }
set N4b953800 [stack 0]
  ColorMatrix {
   matrix {
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
     }
   name ColorMatrix
   xpos 290
   ypos -370
  }
  Output {
   name Output
   xpos 290
   ypos -250
  }
push $N4b953800
  Dot {
   name Dot391
   label " *RGB to XYZ D65 CAT: XYZ Scaling"
   xpos 434
   ypos -546
  }
set N4b952c00 [stack 0]
  ColorMatrix {
   matrix {
       {0.7006223202 0.1487748027 0.101058729}
       {0.2741184831 0.8736317754 -0.1477504224}
       {-0.09896290302 -0.1378953159 1.325916052}
     }
   name ColorMatrix30
   label "DaVinci WG to XYZ D65"
   xpos 1390
   ypos -466
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.705396831 0.1640413404 0.08101775497}
       {0.2801307142 0.8202067018 -0.1003373787}
       {-0.1037815139 -0.07290726155 1.265746593}
     }
   name ColorMatrix29
   label "Filmlight E-Gamut to XYZ D65"
   xpos 1280
   ypos -466
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.5990839005 0.2489254922 0.1024464965}
       {0.2150758207 0.8850684166 -0.1001443192}
       {-0.03206584975 -0.02765838802 1.148782015}
     }
   name ColorMatrix31
   label "SonySGamut3 to XYZ D65"
   xpos 1170
   ypos -465
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.735275209 0.06860940903 0.1465712786}
       {0.2866940796 0.8429790735 -0.1296732426}
       {-0.07968084514 -0.3473432064 1.516081929}
     }
   name ColorMatrix22
   label "REDWideGamutRGB to XYZ D65"
   xpos 1060
   ypos -466
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.6380076408 0.2147038132 0.09774445742}
       {0.2919537723 0.8238408566 -0.1157948226}
       {0.002798279049 -0.06703422219 1.153293848}
     }
   name ColorMatrix21
   label "Arri AlexaWideGamut to XYZ D65"
   xpos 950
   ypos -466
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.4123909175 0.3575843573 0.1804807931}
       {0.2126390785 0.7151687145 0.07219231129}
       {0.01933082566 0.1191947833 0.9505321383}
     }
   name ColorMatrix18
   label "Rec709 to XYZ D65"
   xpos 840
   ypos -466
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.6369581223 0.1446169168 0.1688809693}
       {0.2627002299 0.6779981256 0.05930171534}
       {4.99410725e-17 0.02807269618 1.060985088}
     }
   name ColorMatrix17
   label "Rec2020 to XYZ D65"
   xpos 730
   ypos -466
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.4865711331 0.2656677067 0.1982173175}
       {0.2289746404 0.6917386055 0.07928691804}
       {-3.972076965e-17 0.04511338845 1.043944478}
     }
   name ColorMatrix16
   label "P3D65 to XYZ D65"
   xpos 620
   ypos -466
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.6609312296 0.1336961389 0.1558285803}
       {0.2722287476 0.6740817428 0.05368950963}
       {-0.006018006243 0.004383686464 1.090692043}
     }
   name ColorMatrix1
   label "ACEScg to XYZ D65"
   xpos 510
   ypos -466
  }
push $N4b952c00
  ColorMatrix {
   matrix {
       {0.9503623843 0 9.346324805e-05}
       {0.3439664543 0.728166163 -0.07213254273}
       {0 0 1.089057803}
     }
   name ColorMatrix2
   label "ACES to XYZ D65"
   xpos 400
   ypos -466
  }
  Switch {
   inputs 10
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -370
  }
 end_group
 ColorMatrix {
  matrix {
      {0.257085 0.859943 -0.031061}
      {-0.394427 1.1758 0.106423}
      {0.064856 -0.07625 0.559067}
    }
  name XYZ_to_tlms
  xpos 180
  ypos -490
 }
 Expression {
  expr0 r/w.0
  expr1 g/w.1
  expr2 b/w.2
  name Normalize
  xpos 180
  ypos -466
  addUserKnob {20 Params}
  addUserKnob {35 presets l "" +STARTLINE M {presets/D50 "knobs this \{w \{1.08221 0.883260 0.447579\}\}" presets/D55 "knobs this \{w \{1.07730 0.896467 0.500927\}\}" presets/D60 "knobs this \{w \{1.07344 0.907523 0.549381\}\}" presets/D65 "knobs this \{w \{1.07046 0.916817 0.594251\}\}" presets/D75 "knobs this \{w \{1.06600 0.931715 0.670839\}\}" presets/D93 "knobs this \{w \{1.06098 0.950462 0.776150\}\}"}}
  addUserKnob {78 w n 3}
  w {1.07046 0.916817 0.594251}
 }
 Dot {
  name Dot1
  xpos 214
  ypos -414
 }
set N4b8ff400 [stack 0]
 Group {
  name LMS_to_Yrg
  xpos 290
  ypos -418
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -394
  }
  Expression {
   temp_name0 _a
   temp_expr0 r+g+b
   temp_name1 l
   temp_expr1 _a==0?0:r/_a
   temp_name2 m
   temp_expr2 _a==0?0:g/_a
   expr0 0.68990272*r+0.34832189*g
   expr1 1.0671*l-0.6873*m+0.02062-0.14722
   expr2 -0.0362*l+1.7182*m-0.05155-0.50911666
   name LMS_to_Yrg
   xpos 400
   ypos -346
  }
  Expression {
   temp_name0 l
   temp_expr0 1
   expr1 fabs(g)>l?sign(g)*l:g
   expr2 fabs(b)>l?sign(b)*l:b
   name Limiter
   xpos 400
   ypos -311
  }
  Expression {
   expr0 r
   expr1 hypot(g,b)
   expr2 atan2(b,g)
   name cartesian_to_polar1
   xpos 400
   ypos -274
  }
  Output {
   name Output
   xpos 400
   ypos -226
  }
 end_group
push $N4b8ff400
 MergeExpression {
  inputs 2
  temp_name0 _c
  temp_expr0 Ag
  temp_name1 f
  temp_expr1 (_c<t0?_c:sc*sqrt(_c-ox)+oy)/_c
  temp_name2 ac
  temp_expr2 (r+g+b)/3
  expr0 ac*(1-f)+r*f
  expr1 ac*(1-f)+g*f
  expr2 ac*(1-f)+b*f
  maskChannelMask rgba.red
  name compress_chroma
  xpos 180
  ypos -370
  disable {{!parent.gcmp}}
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 t0 t "threshold to start compression\n" R 0 2}
  t0 0.35
  addUserKnob {7 x0 t "x coordinate to compress to" R 0 2}
  x0 1
  addUserKnob {7 y0 t "y coordinate to compress to" R 0 2}
  y0 0.45
  addUserKnob {7 sc}
  sc {{(y0-t0)/sqrt(x0-y0)}}
  addUserKnob {7 ox R -2 2}
  ox {{t0-sc*sc/4}}
  addUserKnob {7 oy R -2 2}
  oy {{t0-sc*sqrt(sc*sc/4)}}
 }
 Expression {
  temp_name0 n
  temp_expr0 sqrt(max(1e-12,w.0*r)**2+max(1e-12,w.1*g)**2+max(1e-12,w.2*b)**2)/sum
  temp_name1 ns
  temp_expr1 sy*pow(n/(n+sx),p)
  temp_name2 nt
  temp_expr2 ns*ns/(ns+fl)
  temp_name3 ccf
  temp_expr3 pow(sx/(n+sx),dch)*sat
  expr0 nt*(1-ccf)+r*(nt/n)*ccf
  expr1 nt*(1-ccf)+g*(nt/n)*ccf
  expr2 nt*(1-ccf)+b*(nt/n)*ccf
  expr3 nt/n
  name ToneScale
  xpos 180
  ypos -322
  addUserKnob {20 Params}
  addUserKnob {7 Lw R 100 4000}
  Lw 1000
  addUserKnob {7 c l contrast R 0.8 2}
  c {{12*pow(Lw,-0.86)+1.17}}
  addUserKnob {4 su l surround t "dark = 1.0\ndim = 0.95\naverage = 0.90" M {average dim dark}}
  su dark
  addUserKnob {7 p R 1 2}
  p {{c*(0.9+0.05*su)}}
  addUserKnob {7 fl l flare R 0 0.01}
  fl {{1/Lw}}
  addUserKnob {7 sx R 0 10}
  sx {{0.016*pow(Lw,0.87)-0.17}}
  addUserKnob {7 sy R 0 4}
  sy {{1.036+5e-5*Lw}}
  addUserKnob {7 dch l dechroma}
  dch 0.5
  addUserKnob {7 sat l saturation R 0.9 1.6}
  sat 1
  addUserKnob {78 w n 3}
  w {0.24 0.1 0.09}
  addUserKnob {7 sum t "Normalize so achromatic in=out" R 0 2}
  sum {{sqrt(w.0*w.0+w.1*w.1+w.2*w.2)}}
 }
set N4b8fd800 [stack 0]
push $N4b8ff400
 MergeExpression {
  inputs 2
  temp_name0 s
  temp_expr0 Aa
  expr0 r*s
  expr1 g*s
  expr2 b*s
  name MergeExpression1
  xpos 70
  ypos -322
 }
 Expression {
  expr0 r*w.0/n
  expr1 g*w.1/n
  expr2 b*w.2/n
  expr3 1
  name Scale1
  xpos 70
  ypos -202
  addUserKnob {20 Params}
  addUserKnob {78 w n 3}
  w {{parent.Scale.w} {parent.Scale.w} {parent.Scale.w}}
  addUserKnob {7 n R 0 2}
  n {{parent.Scale.wn}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name tlms_to_XYZ1
  xpos 70
  ypos -178
 }
 Group {
  name Colorspace_JzAzBz_Forward1
  xpos 70
  ypos -130
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward2.d}}
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward2.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
push $N4b8fd800
 Expression {
  expr0 r*w.0/wn
  expr1 g*w.1/wn
  expr2 b*w.2/wn
  expr3 1
  name Scale
  xpos 180
  ypos -202
  addUserKnob {20 Params}
  addUserKnob {4 wp M {D50 D55 D60 D65 D75 D93}}
  wp D65
  addUserKnob {78 w n 3}
  w {{curve(wp) 1.08221 1.0773 1.07344 1.07046 1.066 1.06098} {curve(wp) 0.88326 0.896467 0.907523 0.916817 0.931715 0.950462} {curve(wp) 0.447579 0.500927 0.549381 0.594251 0.670839 0.77615}}
  addUserKnob {7 wn R 0 2}
  wn {{curve(wp+6*display_gamut) 1.09063 1.05337 1.02355 1 1.12915 1.30631 1.1408 1.08334 1.037 1 1.13116 1.31116 1.09928 1.04391 1.00028 1.08307 1.22512 1.42007 1.2469 1.18409 1.13345 1.15054 1.30144 1.50853 1.17646 1.10416 1.0461 1 1.14486 1.34374 1 1 1 1 1 1}}
 }
 ColorMatrix {
  matrix {
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
      {{parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix} {parent.XYZ_to_tlms.matrix}}
    }
  invert true
  name tlms_to_XYZ
  xpos 180
  ypos -178
 }
 Group {
  name Colorspace_JzAzBz_Forward2
  xpos 180
  ypos -130
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_inverse_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d -0.56
 }
  StickyNote {
   inputs 0
   name StickyNote1
   tile_color 0x40454aff
   label "<left><b>JzAzBz Colorspace</b>\nSafdar, M., Cui, G., Kim, Y. J., & Luo, M. R. (2017).\n    Perceptually uniform color space for image signals including high dynamic\n    range and wide gamut. Optics Express, 25(13), 15131.\n    doi:10.1364/OE.25.015131\nhttps://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&id=368272\nhttps://observablehq.com/@jrus/jzazbz"
   note_font_size 14
   xpos 107
   ypos -332
  }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -394
  }
  Expression {
   expr0 1.15*r-(1.15-1)*b
   expr1 0.66*g-(0.66-1)*r
   expr2 b
   name Expression3
   label "X_p Y_p Z"
   xpos -40
   ypos -333
  }
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   name ColorMatrix6
   label XYZ_TO_LMS
   xpos -40
   ypos -295
  }
  Group {
   name eotf_inverse_ST2084_
   xpos -40
   ypos -250
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 100 10000}
   L_p 10000
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r/L_p, m_1)"
    expr1 "pow(g/L_p, m_1)"
    expr2 "pow(b/L_p, m_1)"
    name Expression4
    label Y_p
    xpos -40
    ypos -255
   }
   Expression {
    expr0 "pow((c_1+c_2*r)/(c_3*r+1), m_2)"
    expr1 "pow((c_1+c_2*g)/(c_3*g+1), m_2)"
    expr2 "pow((c_1+c_2*b)/(c_3*b+1), m_2)"
    name Expression8
    label N
    xpos -40
    ypos -215
   }
   Output {
    name Output
    xpos -40
    ypos -170
   }
  end_group
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   name ColorMatrix2
   label LMS_P_TO_IZAZBZ
   xpos -40
   ypos -224
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 r*(1+d)/(1+d*r)-d_0
   expr1 g
   expr2 b
   name Expression1
   label Jz
   xpos -40
   ypos -184
  }
  Expression {
   expr0 r
   expr1 sqrt(g*g+b*b)
   expr2 atan2(b,g)
   channel3 none
   name Expression5
   label "JzAzBz to JCh"
   xpos -40
   ypos -136
   disable {{!parent.JCh}}
  }
  Output {
   name Output
   xpos -40
   ypos -58
  }
 end_group
 Copy {
  inputs 2
  from0 rgba.blue
  to0 rgba.blue
  name Copy2
  xpos 180
  ypos -64
  disable {{!pdch}}
 }
 Group {
  name Colorspace_JzAzBz_Inverse1
  xpos 180
  ypos -10
  addUserKnob {20 JzAzBz_tab l JzAzBz}
  addUserKnob {41 L_p T eotf_ST2084_.L_p}
  addUserKnob {6 JCh t "Lightness, Chroma, hue angle" +STARTLINE}
  JCh true
  addUserKnob {35 const_d_presets l "" +STARTLINE M {"const d/JzAzBz" "knobs this \{d -0.56\}" "const d/CAM16-UCS" "knobs this \{d 0\}" "const d/IPT" "knobs this \{d -0.64\}" "const d/ICtCp" "knobs this \{d 1.1\}"}}
  addUserKnob {7 d l "" t "the d constant which can can be adjusted to tune the lightness predictors to different colorspaces:\ndefault: -0.56\nCAM16-UCS: 0\nIPT: -0.64\nICtCp: 1.1" -STARTLINE R -1 1}
  d {{parent.Colorspace_JzAzBz_Forward2.d}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -490
  }
  Expression {
   expr0 r
   expr1 g*cos(b)
   expr2 g*sin(b)
   channel3 none
   name Expression6
   label "JCh to JzAzBz"
   xpos -40
   ypos -376
   disable {{!parent.JCh}}
  }
  Expression {
   temp_name0 d_0
   temp_expr0 1.6295499532821565e-11
   expr0 (r+d_0)/(1+d-d*(r+d_0))
   expr1 g
   expr2 b
   name Expression4
   label Iz
   xpos -40
   ypos -328
  }
  ColorMatrix {
   matrix {
       {0.5 0.5 0}
       {3.524 -4.066708 0.542708}
       {0.199076 1.096799 -1.295875}
     }
   invert true
   name ColorMatrix4
   label IZAZBZ_TO_LMS_P
   xpos -40
   ypos -280
  }
  Group {
   name eotf_ST2084_
   xpos -40
   ypos -226
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{1.7*2523/2**5}}
   addUserKnob {7 c_1}
   c_1 {{3424/4096}}
   addUserKnob {7 c_2}
   c_2 {{2413/4096*32}}
   addUserKnob {7 c_3}
   c_3 {{2392/4096*32}}
   addUserKnob {7 L_p R 0 10000}
   L_p {{parent.parent.Colorspace_JzAzBz_Forward2.eotf_inverse_ST2084_.L_p}}
  }
   Input {
    inputs 0
    name Input
    xpos -40
    ypos -290
   }
   Expression {
    expr0 "pow(r, 1/m_2)"
    expr1 "pow(g, 1/m_2)"
    expr2 "pow(b, 1/m_2)"
    name Expression1
    label V_p
    xpos -40
    ypos -256
   }
   Expression {
    expr0 pow(((r-c_1)/(c_2-c_3*r)),1/m_1)*L_p
    expr1 pow(((g-c_1)/(c_2-c_3*g)),1/m_1)*L_p
    expr2 pow(((b-c_1)/(c_2-c_3*b)),1/m_1)*L_p
    name Expression2
    label C
    xpos -40
    ypos -218
   }
   Output {
    name Output
    xpos -40
    ypos -169
   }
  end_group
  ColorMatrix {
   matrix {
       {0.41478972 0.579999 0.014648}
       {-0.20151 1.120649 0.0531008}
       {-0.0166008 0.2648 0.6684799}
     }
   invert true
   name ColorMatrix5
   label LMS_TO_XYZ
   xpos -40
   ypos -184
  }
  Expression {
   expr0 (r+(1.15-1)*b)/1.15
   expr1 (g+(0.66-1)*((r+(1.15-1)*b)/1.15))/0.66
   expr2 b
   name Expression2
   label "X_p Y_p Z"
   xpos -40
   ypos -136
  }
  Output {
   name Output
   xpos -40
   ypos 42
  }
 end_group
 Group {
  name XYZ_to_DisplayGamut
  tile_color 0x425440ff
  xpos 180
  ypos 38
  addUserKnob {20 XYZ_to_DisplayGamut_tab l XYZ_to_DisplayGamut}
  addUserKnob {4 gamut l "display gamut" t "Choose the target display device chromaticities." M {Rec.2020 "P3 D65" "P3 D60" "P3 DCI" Rec.709 "DCDM X'Y'Z'"}}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {41 invert -STARTLINE T ColorMatrix.invert}
 }
  Input {
   inputs 0
   name Input
   xpos 290
   ypos -580
  }
  Dot {
   name Dot391
   label " "
   xpos 324
   ypos -516
  }
set N4bf92000 [stack 0]
  ColorMatrix {
   matrix {
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
       {{"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"} {"SwitchGamut.input\[value SwitchGamut.which].matrix"}}
     }
   name ColorMatrix
   xpos 290
   ypos -399
  }
  Output {
   name Output
   xpos 290
   ypos -310
  }
push $N4bf92000
  Dot {
   name Dot1
   label " XYZ D65 to *RGB CAT: XYZ Scaling"
   xpos 434
   ypos -516
  }
set N4bf91400 [stack 0]
  ColorMatrix {
   matrix {
       {1 0 0}
       {0 1 0}
       {0 0 1}
     }
   name ColorMatrix4
   label "XYZ D65 to XYZ E"
   xpos 950
   ypos -465
  }
push $N4bf91400
  ColorMatrix {
   matrix {
       {3.240968943 -1.537382722 -0.4986106157}
       {-0.9692435861 1.875967264 0.04155508429}
       {0.05563007668 -0.2039769441 1.056971431}
     }
   name ColorMatrix2
   label "XYZ D65 to Rec709"
   xpos 840
   ypos -465
  }
push $N4bf91400
  ColorMatrix {
   matrix {
       {2.72539258 -1.01800251 -0.4401629865}
       {-0.795167923 1.689731836 0.02264717408}
       {0.04124189168 -0.08763902634 1.100929379}
     }
   name ColorMatrix12
   label "XYZ D65 to P3DCI"
   xpos 730
   ypos -465
  }
push $N4bf91400
  ColorMatrix {
   matrix {
       {2.40274024 -0.8974836469 -0.3880532086}
       {-0.8325793743 1.769231319 0.02371269651}
       {0.03882337734 -0.0824996829 1.036368608}
     }
   name ColorMatrix11
   label "XYZ D65 to P3D60"
   xpos 620
   ypos -465
  }
push $N4bf91400
  ColorMatrix {
   matrix {
       {2.493495464 -0.9313831329 -0.4027105868}
       {-0.8294886947 1.762663484 0.02362468652}
       {0.03584581986 -0.07617236674 0.9568843246}
     }
   name ColorMatrix10
   label "XYZ D65 to P3D65"
   xpos 510
   ypos -465
  }
push $N4bf91400
  ColorMatrix {
   matrix {
       {1.716650844 -0.3556707203 -0.2533662021}
       {-0.6666842103 1.616480947 0.01576854289}
       {0.01763985492 -0.04277061298 0.9421030283}
     }
   name ColorMatrix5
   label "XYZ D65 to Rec2020"
   xpos 400
   ypos -465
  }
  Switch {
   inputs 6
   which {{gamut}}
   name SwitchGamut
   xpos 400
   ypos -399
  }
 end_group
 Expression {
  temp_name0 mx
  temp_expr0 dcdm?1:_s
  expr0 parent.clamp?max(0,min(mx,r*_s)):r*_s
  expr1 parent.clamp?max(0,min(mx,g*_s)):g*_s
  expr2 parent.clamp?max(0,min(mx,b*_s)):b*_s
  name DisplayScale1
  xpos 180
  ypos 86
  addUserKnob {20 Params}
  addUserKnob {6 pq +STARTLINE}
  pq {{eotf==4}}
  addUserKnob {6 hlg -STARTLINE}
  hlg {{eotf==5}}
  addUserKnob {6 dcdm -STARTLINE}
  dcdm {{eotf==3&&display_gamut==5}}
  addUserKnob {7 _s}
  _s {{pq?Lw/10000:hlg?Lw/1000:dcdm?48/52.37:1}}
 }
 Group {
  name InverseEOTF
  xpos 180
  ypos 110
  addUserKnob {20 EOTF_tab l EOTF}
  addUserKnob {4 eotf t "Choose the inverse EOTF to apply for the target display device." M {None "sRGB Display" BT.1886 "Gamma 2.6" PQ HLG "" "" ""}}
  eotf PQ
 }
  Input {
   inputs 0
   name Input
   xpos 400
   ypos -130
  }
set N4bf3f000 [stack 0]
  Expression {
   temp_name0 Yd
   temp_expr0 0.2627*r+0.6780*g+0.0593*b
   expr0 r*pow(Yd,(1-_g)/_g)
   expr1 g*pow(Yd,(1-_g)/_g)
   expr2 b*pow(Yd,(1-_g)/_g)
   name HLG_InverseOOTF
   xpos 620
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _g t "Gamma: Extended model for gamma variation according to peak display luminance and surround luminance: BT.2390-8 p32" R 0 2}
   _g {{1.2*pow(1.111,log(Lw/1000)/log(2))*pow(0.98,log(max(1e-6,Lamb)/5)/log(2))}}
   addUserKnob {7 Lw R 600 4000}
   Lw {{parent.parent.Lw}}
   addUserKnob {7 Lamb t "ambient luminance level in nits" R 0 200}
   Lamb 5
  }
  Expression {
   expr0 r<=1/12?sqrt(3*r):_a*log(12*r-_b)+_c
   expr1 g<=1/12?sqrt(3*g):_a*log(12*g-_b)+_c
   expr2 b<=1/12?sqrt(3*b):_a*log(12*b-_b)+_c
   name HLG_OETF
   xpos 620
   ypos -34
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 _a t alpha}
   _a 0.17883277
   addUserKnob {7 _b t beta}
   _b {{1-4*_a}}
   addUserKnob {7 _c}
   _c {{0.5-_a*log(4*_a)}}
  }
push $N4bf3f000
  Expression {
   temp_name0 rp
   temp_expr0 pow(r,m_1)
   temp_name1 gp
   temp_expr1 pow(g,m_1)
   temp_name2 bp
   temp_expr2 pow(b,m_1)
   expr0 pow((c_1+c_2*rp)/(1+c_3*rp),m_2)
   expr1 pow((c_1+c_2*gp)/(1+c_3*gp),m_2)
   expr2 pow((c_1+c_2*bp)/(1+c_3*bp),m_2)
   name ST2084_InverseEOTF
   xpos 510
   ypos -58
   addUserKnob {20 CONSTANTS_tab l CONSTANTS}
   addUserKnob {7 m_1}
   m_1 {{2610/4096*(1/4)}}
   addUserKnob {7 m_2}
   m_2 {{2523/4096*128}}
   addUserKnob {7 c_1}
   c_1 {{107/128}}
   addUserKnob {7 c_2}
   c_2 {{2413/128}}
   addUserKnob {7 c_3}
   c_3 {{2392/128}}
  }
push $N4bf3f000
  Expression {
   expr0 sign(r)*pow(fabs(r),1/p)
   expr1 sign(g)*pow(fabs(g),1/p)
   expr2 sign(b)*pow(fabs(b),1/p)
   name power
   xpos 400
   ypos -58
   addUserKnob {20 Params_tab l Params}
   addUserKnob {7 p l power R 0.2 2}
   p {{eotf?2+eotf*0.2:1}}
  }
  Switch {
   inputs 3
   which {{eotf-3}}
   name SwitchInverseEOTF
   xpos 400
   ypos 14
  }
  Output {
   name Output
   xpos 400
   ypos 86
  }
 end_group
 Switch {
  inputs 2
  which {{parent.direction}}
  name SwitchDirection
  xpos 180
  ypos 206
 }
 Output {
  name Output
  xpos 180
  ypos 278
 }
end_group
Group {
 name Write_ResolveACES_ODT_LUT3
 label "\[python nuke.thisNode().knob('file').value().split('/').pop(-1)]"
 xpos 423
 ypos 465
 addUserKnob {20 User}
 addUserKnob {41 file l "output file" T GenerateLUT1.file}
 addUserKnob {41 generate l "Generate and Write LUT File" +INVISIBLE T GenerateLUT1.generate}
 addUserKnob {22 writeCubeDCTL l "Write Cube and DCTL" T "import os\n\nnode = nuke.thisNode()\n\ntemplatePath = os.path.join(nuke.script_directory(),node.knob('dctlTemplate').evaluate())\ncubePath = os.path.join(nuke.script_directory(),node.knob('file').evaluate())\ndctlPath = cubePath.replace('.cube','.dctl')\ncubeName = cubePath.split('/').pop(-1)\n\nnode.knob('generate').execute()\n\nwith open(templatePath) as f:\n    lines = f.readlines()\nnewLines = \[x.replace('replace.cube',cubeName) for x in lines]\n\nwith open(dctlPath, 'w') as f:\n    f.write('\\n'.join(newLines))" +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {2 dctlTemplate}
 dctlTemplate "DaVinci Resolve/ACES_ApplyLUT_Template.dctl"
}
 Input {
  inputs 0
  name Input1
  xpos 411
  ypos 213
 }
 GenerateLUT {
  file "DaVinci Resolve/ACES Transforms/ODT/ACES2.0 Candidates rev001/ACES2.0 CandidateB rev001 Rec2100.cube"
  file_type .cube
  name GenerateLUT1
  selected true
  xpos 411
  ypos 267
 }
 Output {
  name Output1
  xpos 411
  ypos 353
 }
end_group
push $N6a263800
Group {
 name Write_ResolveACES_ODT_LUT5
 label "\[python nuke.thisNode().knob('file').value().split('/').pop(-1)]"
 xpos 759
 ypos 459
 addUserKnob {20 User}
 addUserKnob {41 file l "output file" T GenerateLUT1.file}
 addUserKnob {41 generate l "Generate and Write LUT File" +INVISIBLE T GenerateLUT1.generate}
 addUserKnob {22 writeCubeDCTL l "Write Cube and DCTL" T "import os\n\nnode = nuke.thisNode()\n\ntemplatePath = os.path.join(nuke.script_directory(),node.knob('dctlTemplate').evaluate())\ncubePath = os.path.join(nuke.script_directory(),node.knob('file').evaluate())\ndctlPath = cubePath.replace('.cube','.dctl')\ncubeName = cubePath.split('/').pop(-1)\n\nnode.knob('generate').execute()\n\nwith open(templatePath) as f:\n    lines = f.readlines()\nnewLines = \[x.replace('replace.cube',cubeName) for x in lines]\n\nwith open(dctlPath, 'w') as f:\n    f.write('\\n'.join(newLines))" +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {2 dctlTemplate}
 dctlTemplate "DaVinci Resolve/ACES_ApplyLUT_Template.dctl"
}
 Input {
  inputs 0
  name Input1
  xpos 411
  ypos 213
 }
 GenerateLUT {
  file "DaVinci Resolve/ACES Transforms/ODT/ACES2.0 Candidates rev001/ACES2.0 CandidateC rev001 Rec2100.cube"
  file_type .cube
  name GenerateLUT1
  selected true
  xpos 411
  ypos 267
 }
 Output {
  name Output1
  xpos 411
  ypos 353
 }
end_group
push $N14e99800
Group {
 name ACES_OutputTransform_v1_2_
 tile_color 0xa57aaaff
 label "Rec.709\nno glow_module\nno red_modifier\nno global desat"
 xpos -19
 ypos 315
 addUserKnob {20 ACES_OutputTransform_tab l "ACES OutputTransform"}
 addUserKnob {41 gamut l "input gamut" T GamutToXYZ_lite.gamut}
 addUserKnob {26 ""}
 addUserKnob {35 presets t "display output presets." M {display/sRGB "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 0 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"sRGB\"\}" "display/sRGB D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 0 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"sRGB D60 sim.\"\}" display/Rec.709 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 1 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.709\"\}" "display/Rec.709 D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 0 limiting_pri 0 eotf 1 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.709 D60 sim.\"\}" display/Rec.2020 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 1 limiting_pri 1 eotf 1 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 1 legal_range 0 label \"Rec.2020\"\}" display/P3D60 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 4 limiting_pri 4 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D60\"\}" display/P3D65 "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 2 limiting_pri 2 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65\"\}" "display/P3D65 D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 2 limiting_pri 2 eotf 4 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 D60 sim.\"\}" display/P3DCI "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3DCI\"\}" "display/P3DCI D60 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 1 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3DCI D60 sim.\"\}" "display/P3DCI D65 sim." "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 3 limiting_pri 3 eotf 4 stretch_black 0 d60_sim 0 force_d65_cat 1 dark_to_dim 0 legal_range 0 label \"P3DCI D65 sim.\"\}" display/DCDM "knobs this \{lum \{0.02 4.8 48\} override_ssts_params 0 use_c9 1 display_pri 7 limiting_pri 7 eotf 5 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"DCDM\"\}" "display/P3D65 ST2084 108nits 7.2nits" "knobs this \{lum \{0.0001 7.2 108\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 108nits 7.2nits\"\}" "display/P3D65 ST2084 1000nits 15nits" "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 1000nits 15nits\"\}" "display/P3D65 ST2084 2000nits 15nits" "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 2000nits 15nits\"\}" "display/P3D65 ST2084 2000nits 15nits" "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 2000nits 15nits\"\}" "display/P3D65 ST2084 4000nits 15nits" "knobs this \{lum \{0.0001 15 4000\} override_ssts_params 0 use_c9 0 display_pri 2 limiting_pri 2 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"P3D65 ST2084 4000nits 15nits\"\}" display/Rec2020_HLG_1000nits_15nits "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 7 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_HLG_1000nits_15nits\"\}" display/Rec2020_ST2084_1000nits_15nits "knobs this \{lum \{0.0001 15 1000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_1000nits_15nits\"\}" display/Rec2020_ST2084_2000nits_15nits "knobs this \{lum \{0.0001 15 2000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_2000nits_15nits\"\}" display/Rec2020_ST2084_4000nits_15nits "knobs this \{lum \{0.0001 15 4000\} override_ssts_params 0 use_c9 0 display_pri 1 limiting_pri 1 eotf 6 stretch_black 1 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"Rec2020_ST2084_4000nits_15nits\"\}" display/OCES "knobs this \{lum \{0.0001 4.8 10000\} override_ssts_params 0 use_c9 0 display_pri 6 limiting_pri 6 eotf 9 stretch_black 0 d60_sim 0 force_d65_cat 0 dark_to_dim 0 legal_range 0 label \"OCES\"\}" "" ""}}
 addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
 addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
 lum {0.0001 10 100}
 addUserKnob {20 ssts_params_grp l "SSTS Parameters" n 1}
 addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
 addUserKnob {35 presets_ssts_param l presets t "If you want to override the default SSTS parameters and play around, here are some useful starting points." M {contrast/default "knobs this \{override_ssts_params 0 pctLow 0.35 pctHigh 0.89 slope \{0 1.5 0.\} exposure 0.0 use_c9 0\}" contrast/sdr "knobs this \{override_ssts_params 1 pctLow 0.35 pctHigh 0.89 slope \{0.1 1.6 0.01\} exposure 0.0 use_c9 0\}" contrast/high "knobs this \{override_ssts_params 1 pctLow 0.2 pctHigh 0.89 slope \{0.28 1.75 0.01\} exposure 0.0 use_c9 0\}" contrast/med "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.89 slope \{0.38 1.3 0.01\} exposure 0.0 use_c9 0\}" contrast/med-low "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.80 slope \{0.38 1.42 0.01\} exposure 0.0 use_c9 0\}" contrast/low "knobs this \{override_ssts_params 1 pctLow 0.40 pctHigh 0.80 slope \{0.38 1.2 0.01\} exposure 0.0 use_c9 0\}" ""}}
 addUserKnob {7 exposure R -5 5}
 addUserKnob {7 pctLow l knee}
 pctLow 0.35
 addUserKnob {7 pctHigh l shoulder}
 pctHigh 0.89
 addUserKnob {78 slope n 3}
 slope {0.38 1.501 0.01}
 addUserKnob {20 endGroup n -1}
 addUserKnob {6 use_c9 l "use SegmentedSpline_c9" t "In ACES 1.1 the Output Transform was re-written for HDR tonescales. \n\nIn ACES 1.1, HDR transforms use the new SSTS (Single Stage Tone Scale), while SDR transforms continue to use the old SegmentedSpline_c5 -> OCES -> SegmentedSpline_c9 -> ODT transform.\n\nIf this is enabled, the SegmentedSpline_c9 transform is used to maintain compatibility with the ACES SDR output transforms and enable a 1:1 match with the AMPAS CTL.\n\nIf you are curious, turn use_c9 off and play around with the SSTS Parameters." +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {4 display_pri l "display pri" t "Display encoding primaries." M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
 addUserKnob {4 limiting_pri l "limiting pri" t "Limiting primaries for the output transform." -STARTLINE M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
 addUserKnob {4 eotf l EOTF t "Electrical to Optical Transfer Function of the monitor." M {sRGB BT.1886 "Gamma 2.2" "Gamma 2.4" "Gamma 2.6" DCDM "ST-2084 (PQ)" HLG Linear OCES ""}}
 eotf BT.1886
 addUserKnob {6 stretch_black l "stretch black" t "For hdr outputs: stretch black luminance to a PQ code value of 0" +STARTLINE}
 addUserKnob {6 d60_sim l "d60 sim" t "d60 whitepoint simulation." +STARTLINE}
 addUserKnob {6 force_d65_cat l "force d60 to d65 cat" -STARTLINE}
 addUserKnob {6 dark_to_dim l "dark to dim surround" t "Apply gamma adjustment to compensate for \"Dark to Dim\" surround. For SDR outputs only." +STARTLINE}
 dark_to_dim true
 addUserKnob {6 legal_range l "legal range" t "Output legal range." +STARTLINE}
}
 BackdropNode {
  inputs 0
  name Electrical_Optical_Transfer_Function
  tile_color 0x151515ff
  label "ACESlib.OutputTransforms.ctl : 185\n// EOTF"
  note_font_size 12
  xpos -2025
  ypos 2294
  bdwidth 3391
  bdheight 740
  z_order -10
 }
 BackdropNode {
  inputs 0
  name BackdropNode1
  tile_color 0x272727ff
  label "HDR EOTFs"
  note_font_size 42
  xpos 425
  ypos 2379
  bdwidth 910
  bdheight 617
  z_order -5
 }
 BackdropNode {
  inputs 0
  name BackdropNode2
  tile_color 0x272727ff
  label "SDR EOTFs"
  note_font_size 42
  xpos -1158
  ypos 2384
  bdwidth 1436
  bdheight 608
  z_order -5
 }
 BackdropNode {
  inputs 0
  name AP1_to_XYZ
  tile_color 0x555b5cff
  label "ACESlib.OutputTransforms.ctl : 90\n// Rendering primaries to XYZ\n"
  note_font_size 12
  xpos -1400
  ypos 906
  bdwidth 380
  bdheight 156
 }
 BackdropNode {
  inputs 0
  name AP1_to_XYZ1
  tile_color 0x555a5cff
  label "// Apply desaturation to compensate for luminance difference\nlinearCV = mult_f3_f33( linearCV, ODT_SAT_MAT);\n( SDR only)"
  note_font_size 12
  xpos -1412
  ypos 669
  bdwidth 439
  bdheight 186
 }
 BackdropNode {
  inputs 0
  name D60_whitepoint_simulation
  tile_color 0x232323ff
  label "ACESlib.OutputTransforms.ctl : 150\n// Scale to avoid clipping when device calibration is different from D60. \n// To simulate D60, unequal code values are sent to the display.\n"
  note_font_size 12
  xpos -1399
  ypos 176
  bdwidth 818
  bdheight 463
 }
 BackdropNode {
  inputs 0
  name Luminance_to_Linear_Code_Values
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 87\n/*  Scale absolute luminance to linear code value  */\n"
  note_font_size 12
  xpos -1367
  ypos -50
  bdwidth 315
  bdheight 148
 }
 BackdropNode {
  inputs 0
  name Output_Color_Encoding_Specification
  tile_color 0x1d1d1dff
  label "<font size=12>OCES\n<font size=0.1>\n- ACES Output Output Color Encoding Specification \n- An idealized reference display with 0.0001 / 4.8 / 10000 luma\n w/ ACES AP0 Primaries."
  note_font_size 27.4
  xpos -1833
  ypos 2379
  bdwidth 367
  bdheight 377
 }
 BackdropNode {
  inputs 0
  name Output_Legal_Range
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 216\n"
  note_font_size 12
  xpos -1369
  ypos 3128
  bdwidth 318
  bdheight 176
 }
 BackdropNode {
  inputs 0
  name Single_Stage_Tone_Scale
  tile_color 0x272727ff
  label "<b>Single Stage Tone Scale : ACESlib.OutputTransforms.ctl : 82</b><pre>// Apply the tonescale independently in rendering-space RGB\nfloat rgbPost\[3] = ssts_f3( rgbPre, PARAMS);\n\nIf output is SDR, output OCES from SSTS and use SegmentedSpline_c9."
  note_font_size 12
  xpos -1502
  ypos -653
  bdwidth 609
  bdheight 533
 }
 BackdropNode {
  inputs 0
  name clamp_negatives
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 174\n// Clip values < 0 (i.e. projecting outside the display primaries)\nNote: Also clamping values > 1 here."
  note_font_size 12
  xpos -1393
  ypos 2087
  bdwidth 386
  bdheight 120
 }
 BackdropNode {
  inputs 0
  name dim_surround_gamma_adjustment
  tile_color 0x272727ff
  label "ACESlib.OutputTransforms.ctl : 92\n// Apply gamma adjustment to compensate for dim surround\n"
  note_font_size 12
  xpos -1407
  ypos 1063
  bdwidth 395
  bdheight 258
 }
 BackdropNode {
  inputs 0
  name limit_primaries
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 130\n// Gamut limit to limiting primaries\n"
  note_font_size 12
  xpos -1408
  ypos 1655
  bdwidth 396
  bdheight 194
 }
 BackdropNode {
  inputs 0
  name limit_primaries1
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 144\n// CIE XYZ to display encoding primaries\n"
  note_font_size 12
  xpos -1402
  ypos 1892
  bdwidth 384
  bdheight 151
 }
 BackdropNode {
  inputs 0
  name limit_primaries2
  tile_color 0x555a5cff
  label "ACESlib.OutputTransforms.ctl : 130\n    // Apply CAT from ACES white point to assumed observer adapted white point\n    // TODO: Needs to expand from just supporting D60 sim to allow for any\n    // observer adapted white point.\n"
  note_font_size 12
  xpos -1407
  ypos 1337
  bdwidth 467
  bdheight 301
 }
 BackdropNode {
  inputs 0
  name rrt_sweeteners_
  tile_color 0x555a5cff
  label "<b>RRT Sweeteners : ACESlib.OutputTransforms.ctl : 79</b><pre>// RRT sweeteners\nfloat rgbPre\[3] = rrt_sweeteners( in);\n"
  note_font_size 18
  xpos -1469
  ypos -1234
  bdwidth 519
  bdheight 548
 }
 Input {
  inputs 0
  name Input
  xpos -1250
  ypos -1450
 }
 AddChannels {
  channels rgba
  name AddChannels
  xpos -1250
  ypos -1415
 }
 Group {
  name GamutToXYZ_lite
  xpos -1250
  ypos -1373
  addUserKnob {20 GamutToXYZ_lite_tab l GamutToXYZ_lite}
  addUserKnob {4 gamut t "Choose gamut" M {XYZ ACES ACEScg "Filmlight E-Gamut" "DaVinci WG" Rec709 Rec2020 P3D60 P3D65 P3DCI "Arri AlexaWideGamut" REDDRAGONcolor REDDRAGONcolor2 REDcolor REDcolor2 REDcolor3 REDcolor4 REDWideGamutRGB "GoPro Protune Native" CanonCinemaGamut SonySGamut SonySGamut3Cine PanasonicVGamut "DJI D-Gamut" "Fujifilm F-Gamut" BMDFilmV1 BMD4kFilmV1 BMD4kFilmV3 BMD46kFilmV1 BMD46kFilmV3 BMDWideGamutV4 "AdobeRGB\t" AdobeWideGamutRGB ROMM RIMM ERIMM ProPhotoRGB RusselRGB SharpRGB AppleRGB BestRGB}}
  gamut ACES
  addUserKnob {6 invert +STARTLINE}
  addUserKnob {26 ""}
  addUserKnob {26 chromaticity_coordinates_label l " " T "<b>Chromaticity Coordinates</b>"}
  addUserKnob {20 chromaticities_grp l "" +STARTLINE n 1}
  addUserKnob {41 rxy T ColorMatrix.rxy}
  addUserKnob {41 gxy T ColorMatrix.gxy}
  addUserKnob {41 bxy T ColorMatrix.bxy}
  addUserKnob {41 wxy T ColorMatrix.wxy}
  addUserKnob {41 matrix T ColorMatrix.matrix}
  addUserKnob {20 endGroup n -1}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  ColorMatrix {
   matrix {
       {{curve(which) 1 0.9525524378 0.6624541879 0.7053968906 0.4123907983 0.6369580626 0.5049495697 0.4865709841 0.4451698363 0.6380076408 0.5070186853 0.4462202489 0.4300414324 0.4581649601 0.4878340662 0.4517004192 0.7352752686 0.5022571683 0.7160496712 0.7064827085 0.5990839601 0.6796444654 0.6481720209 0.6369580626 0.6390493512 0.6141571999 0.3724023998 0.60689044 0.4017650783 0.6065810919 0.5766690373 0.7165006995 0.797760427 0.797760427 0.797760427 0.7976718545 0.7015837431 0.8156226277 0.4496616423 0.6318944097} {curve(which) 0 0 0.1340042055 0.1640413404 0.3575843275 0.1446169019 0.2646814585 0.2656676769 0.2771343887 0.2147038579 0.3587769568 0.3157556653 0.3700728714 0.3832037449 0.3432727158 0.3178463876 0.06860940903 0.2929667532 0.1296834797 0.1288010478 0.2489254922 0.1522114277 0.1940581352 0.1446169019 0.1578372866 0.2825684249 0.4324877858 0.2193847299 0.4560420811 0.2203479856 0.1855582297 0.1010205746 0.1351858526 0.1351858526 0.1351858526 0.1351878047 0.1554162204 0.04716260359 0.3162561059 0.2053879201} {curve(which) 0 9.367863095e-05 0.1561876982 0.08101774752 0.180480808 0.1688809693 0.1830150485 0.1982172877 0.1722826511 0.09774444997 0.0868505761 0.190669477 0.152531758 0.1112773567 0.1215386018 0.1830992699 0.1465712637 0.1552320272 0.1047228053 0.1151721701 0.1024464965 0.1186000481 0.108225815 0.1688809693 0.1516760886 0.05183707923 0.1436725408 0.124180764 0.09264881909 0.123526901 0.1882286519 0.1467743814 0.03134934977 0.03134934977 0.03134934977 0.03133957833 0.09979832917 0.1372147948 0.1845382005 0.1270133406}}
       {{curve(which) 0 0.3439664543 0.2722287476 0.2801307142 0.2126390189 0.2627002299 0.237623319 0.2289745659 0.209491685 0.2919537723 0.2207257152 0.1942579001 0.2022213936 0.1694435924 0.2289056629 0.2119505703 0.2866941094 0.1387997568 0.2612613738 0.2709796727 0.2150758505 0.2606855333 0.2830046713 0.2627002299 0.1743051857 0.2365771234 0.1383759677 0.1973138005 0.1721783578 0.2680045366 0.2973450124 0.258728236 0.2880711257 0.2880711257 0.2880711257 0.2880405784 0.3152042925 0.3790788651 0.2446159422 0.2276017666} {curve(which) 1 0.7281661034 0.6740817428 0.8202066422 0.7151686549 0.6779980659 0.6891706586 0.6917385459 0.7215952873 0.8238410354 0.839184761 0.7385566831 0.7585275769 0.8648257852 0.7808576822 0.7230190039 0.8429791331 0.910841465 0.8696421385 0.786606431 0.8850684762 0.7748944759 0.8131960034 0.6779980659 0.951146543 0.8896810412 0.911518693 0.943950057 0.8553914428 0.8326833844 0.6273635626 0.7246823311 0.7118432522 0.7118432522 0.7118432522 0.7118694782 0.6648360491 0.5769088268 0.6720442176 0.7383946776} {curve(which) 0 -0.07213255018 0.05368951708 -0.1003373638 0.07219231874 0.05930171534 0.07320601493 0.07928691059 0.06891305745 -0.1157948226 -0.05991046131 0.06718540192 0.03925102949 -0.03426937759 -0.009763340466 0.06503042579 -0.1296732277 -0.04964122549 -0.1309035122 -0.05758608505 -0.1001443192 -0.03558001295 -0.09620071948 0.05930171534 -0.1254517138 -0.1262581497 -0.04989464581 -0.1412638426 -0.02756982669 -0.1006879359 0.07529145479 0.01658944227 8.565396274e-05 8.565396274e-05 8.565396274e-05 8.991353388e-05 0.01995966583 0.04401229322 0.08333983272 0.0340035744}}
       {{curve(which) 0 -3.863927134e-08 -0.005574660841 -0.1037815213 0.01933082007 0 0 0 0 0.0027982709 -0.0544523783 -0.04792318866 -0.0176958181 -0.1061859056 -0.02100777067 -0.01945115253 -0.07968087494 0.07801423222 -0.009676366113 -0.009677864611 -0.03206583485 -0.009310216643 -0.01825834997 0 -0.11669112 -0.02325225808 -0.1602820009 -0.1427432895 -0.10720893 -0.02941203304 0.02703136392 -2.906408625e-08 -3.236030111e-08 -3.236030111e-08 -3.236030111e-08 0 0 -0.01229703799 0.02518104948 0} {curve(which) 0 0 0.004060741514 -0.07290724665 0.1191947311 0.0280726999 0.0449459292 0.04511339962 0.04706057906 -0.06703422964 -0.0003228379355 -0.0002844714036 0.08768811822 0.02554347552 0.01782695204 0.01650637016 -0.3473432064 -0.3148325086 -0.2364816219 0.004600019194 -0.02765839547 -0.004612449091 -0.08316776901 0.0280726999 -0.5518454909 -0.4897170365 -0.171635136 -0.4278847873 0.07809129357 -0.08659287542 0.07068887353 0.05121183768 1.2621717e-08 1.2621717e-08 1.2621717e-08 -1.262213711e-08 0.04317118227 0.01672476344 0.1411857158 0.01001892332} {curve(which) 1 1.008825183 1.010339141 1.265746474 0.950532198 1.060985088 0.9638792276 1.043944359 0.9073553085 1.153293729 1.063571215 1.057001948 0.9388025999 1.089437366 1.01197505 1.011739731 1.51608181 1.325875998 1.335215807 1.094135642 1.148782015 1.102980375 1.190483928 1.060985088 1.745692492 1.590125084 1.409072995 1.65968585 1.118175387 1.205062628 0.9913375378 0.7738927603 0.8251045942 0.8251045942 0.8251045942 0.8248898983 0.8782252669 0.9955722094 0.9226909876 0.8150856495}}
     }
   invert {{parent.invert}}
   name ColorMatrix
   label "RGB to XYZ"
   xpos -40
   ypos 32
   addUserKnob {20 Gamut}
   addUserKnob {3 which}
   which {{parent.gamut}}
   addUserKnob {12 rxy}
   rxy {{curve(which) 1 0.7347 0.713 0.8 0.8 0.64 0.708 0.68 0.68 0.68 0.684 0.7530442228 0.7530444911 0.6997470013 0.8786825105 0.7011810359 0.7011805919 0.780308 0.69848046 0.74 0.73 0.766 0.73 0.71 0.708 0.9173 0.7422 1.0625 0.9175 0.8608 0.7177 0.64 0.7347 0.7347 0.7347 0.7347 0.734699 0.69 0.6898 0.625 0.7351916376} {curve(which) 0 0.2653 0.293 0.3177 0.313 0.33 0.292 0.32 0.32 0.32 0.313 0.3278305767 0.3278310295 0.3290469303 0.3249640074 0.3290141556 0.3290136991 0.304253 0.19302645 0.27 0.28 0.275 0.28 0.31 0.292 0.2502 0.2859 0.3948 0.2983 0.3689 0.3171 0.33 0.2653 0.2653 0.2653 0.2653 0.265301 0.31 0.3206 0.34 0.2648083624}}
   addUserKnob {12 gxy}
   gxy {{curve(which) 0 0 0.165 0.18 0.1682 0.3 0.17 0.265 0.265 0.265 0.221 0.2995702285 0.2995704905 0.304264039 0.3008887144 0.3006003047 0.3006003955 0.121595 0.32955538 0.17 0.14 0.225 0.165 0.21 0.17 0.2833 0.414 0.3689 0.2983 0.3282 0.228 0.21 0.1152 0.1596 0.1596 0.1596 0.159597 0.18 0.0736 0.28 0.2153361345} {curve(which) 1 1 0.83 0.9 0.9877 0.6 0.797 0.69 0.69 0.69 0.848 0.700699322 0.7006994156 0.6236411451 0.6790547558 0.6837888343 0.6837888243 1.493994 1.02459662 1.14 0.855 0.8 0.84 0.88 0.797 1.7072 1.3035 0.7775 1.2835 0.6156 0.8616 0.71 0.8264 0.8404 0.8404 0.8404 0.840403 0.77 0.9003 0.595 0.7741596639}}
   addUserKnob {12 bxy}
   bxy {{curve(which) 0 0.0001 0.128 0.065 0.079 0.15 0.131 0.15 0.15 0.15 0.0861 0.07964206674 0.1450115843 0.1349139613 0.09539869461 0.1081544556 0.1453319462 0.095612 0.10844263 0.08 0.1 0.089 0.1 0.09 0.131 0.0856 0.0342 0.0956 0.0756 0.0783 0.1006 0.15 0.1566 0.0366 0.0366 0.0366 0.036598 0.1 0.1166 0.155 0.1301229508} {curve(which) 0 -0.077 0.044 -0.0805 -0.1155 0.06 0.046 0.06 0.06 0.06 -0.102 -0.05493795109 0.05109712509 0.03471744128 -0.02937932683 -0.008688175787 0.05161680362 -0.084589 -0.03467857 -0.1 -0.05 -0.087 -0.03 -0.08 0.046 -0.0708 -0.0833 -0.0332 -0.086 -0.0233 -0.082 0.06 0.0177 0.0001 0.0001 0.0001 0.000105 0.02 0.0374 0.07 0.03483606557}}
   addUserKnob {12 wxy}
   wxy {{curve(which) 0.33333333 0.32168 0.32168 0.3127 0.3127 0.3127 0.3127 0.32168 0.3127 0.314 0.3127 0.3216831877 0.3216832104 0.3216832894 0.3216832894 0.3216832104 0.3216832894 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3127 0.3135 0.3135 0.3135 0.3127 0.3127 0.3127 0.3127 0.3457 0.3457 0.3457 0.3457 0.345704 0.33243 0.33333333 0.3127 0.3457} {curve(which) 0.33333333 0.33767 0.33767 0.329 0.329 0.329 0.329 0.33767 0.329 0.351 0.329 0.337673316 0.3376736101 0.3376734472 0.3376734472 0.3376736101 0.3376734472 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.329 0.3305 0.3305 0.3305 0.329 0.329 0.329 0.329 0.3585 0.3585 0.3585 0.3585 0.35854 0.34744 0.33333333 0.329 0.3585}}
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 ColorMatrix {
  matrix {
      {1.049811006 0 -9.748453158e-05}
      {-0.4959030151 1.373313069 0.09824004024}
      {4.020908051e-08 0 0.9912520051}
    }
  name ColorMatrix4
  label "XYZ to ACES"
  note_font Helvetica
  xpos -1250
  ypos -1338
 }
 Dot {
  name Dot7
  label " ACES 2065-1 IN"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -1268
 }
 Group {
  name glow_module1
  note_font Helvetica
  xpos -1250
  ypos -1089
  disable true
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 RRT_GLOW_GAIN}
  RRT_GLOW_GAIN 0.05
  addUserKnob {7 RRT_GLOW_MID}
  RRT_GLOW_MID 0.08
  addUserKnob {6 invert +STARTLINE}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -562
  }
  Dot {
   name Dot2
   xpos -6
   ypos -510
  }
set N2ae6e400 [stack 0]
  Dot {
   name Dot4
   xpos -116
   ypos -510
  }
set N2ae6e000 [stack 0]
  Expression {
   temp_name0 chroma
   temp_expr0 sqrt(b*(b-g)+g*(g-r)+r*(r-b))
   temp_name1 ycRadiusWeight
   temp_expr1 1.75
   channel0 {-rgba.red rgba.green -rgba.blue none}
   expr0 "( b + g + r + ycRadiusWeight * chroma) / 3.0"
   channel1 {rgba.red -rgba.green -rgba.blue none}
   expr1 0
   expr2 0
   name rgb_2_yc1
   xpos -150
   ypos -466
  }
push 0
push $N2ae6e000
  Dot {
   name Dot3
   xpos -226
   ypos -510
  }
  Expression {
   temp_name0 TINY
   temp_expr0 1e-10
   temp_name1 min_f3
   temp_expr1 min(r,min(g,b))
   temp_name2 max_f3
   temp_expr2 max(r,max(g,b))
   expr0 "(max( max_f3, TINY) - max( min_f3, TINY)) / max( max_f3, 1e-2)"
   expr1 0
   expr2 0
   name rgb_2_saturation1
   xpos -260
   ypos -466
  }
set N2ae6d400 [stack 0]
  Expression {
   channel0 {rgba.red rgba.green rgba.blue none}
   expr0 "(r - 0.4) / 0.2"
   name Expression1
   xpos -370
   ypos -466
  }
  Expression {
   temp_name0 t
   temp_expr0 "max( 1.0 - fabs( r / 2.0), 0.0)"
   temp_name1 sign
   temp_expr1 r>0?1:r<0?-1:0
   temp_name2 valy
   temp_expr2 "1.0 + sign * (1.0 - t * t)"
   channel0 {-rgba.red -rgba.green rgba.blue none}
   expr0 "valy / 2"
   channel1 {rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red rgba.green rgba.blue none}
   expr2 0
   name sigmoid_shaper1
   xpos -370
   ypos -442
  }
push $N2ae6d400
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   note_font Helvetica
   xpos -260
   ypos -393
  }
set N2ae6c800 [stack 0]
  Expression {
   temp_name0 ycOut
   temp_expr0 g
   temp_name1 glowGainIn
   temp_expr1 "RRT_GLOW_GAIN * b"
   temp_name2 glowMid
   temp_expr2 RRT_GLOW_MID
   channel0 rgb
   expr0 "1 + ((ycOut <= ((1 + glowGainIn) * 2./3. * glowMid)) ? -glowGainIn / (1 + glowGainIn) : ( ycOut >= (2. * glowMid)) ? 0 : glowGainIn * (glowMid / ycOut - 1./2.) / (glowGainIn / 2. - 1.))"
   channel1 none
   channel2 none
   name glow_inv
   xpos -150
   ypos -346
  }
push $N2ae6c800
  Expression {
   temp_name0 ycIn
   temp_expr0 g
   temp_name1 glowGainIn
   temp_expr1 "RRT_GLOW_GAIN * b"
   temp_name2 glowMid
   temp_expr2 RRT_GLOW_MID
   channel0 rgb
   expr0 "1 + ( ycIn <= 2./3. * glowMid ? glowGainIn : ycIn >= 2. * glowMid ? 0 : glowGainIn * (glowMid / ycIn - 1./2.) )"
   channel1 none
   channel2 none
   name glow_fwd
   xpos -370
   ypos -346
  }
  Switch {
   inputs 2
   which {{parent.invert}}
   name Switch_direction
   note_font Helvetica
   xpos -260
   ypos -297
  }
  Dot {
   name Dot5
   xpos -226
   ypos -246
  }
push $N2ae6e400
  Merge2 {
   inputs 2
   operation multiply
   bbox B
   output rgb
   name Merge3
   note_font Helvetica
   xpos -40
   ypos -249
  }
  Output {
   name Output
   xpos -40
   ypos -178
  }
 end_group
 Group {
  name red_modifier1
  note_font Helvetica
  xpos -1250
  ypos -1041
  disable true
  addUserKnob {20 Params_tab l Params}
  addUserKnob {7 RRT_RED_SCALE}
  RRT_RED_SCALE 0.82
  addUserKnob {7 RRT_RED_PIVOT}
  RRT_RED_PIVOT 0.03
  addUserKnob {7 RRT_RED_HUE}
  addUserKnob {7 RRT_RED_WIDTH R 0 360}
  RRT_RED_WIDTH 135
  addUserKnob {6 invert +STARTLINE}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -10
  }
  Dot {
   name Dot1
   xpos -6
   ypos 42
  }
set N2b202800 [stack 0]
  Dot {
   name Dot2
   xpos -226
   ypos 42
  }
set N2b202400 [stack 0]
  Expression {
   temp_name0 TINY
   temp_expr0 1e-10
   temp_name1 min_f3
   temp_expr1 min(r,min(g,b))
   temp_name2 max_f3
   temp_expr2 max(r,max(g,b))
   channel0 rgb
   expr0 "(max( max_f3, TINY) - max( min_f3, TINY)) / max( max_f3, 1e-2)"
   channel1 none
   expr1 0
   channel2 none
   expr2 0
   name rgb_2_saturation
   xpos -260
   ypos 86
  }
push $N2b202400
  Dot {
   name Dot3
   xpos -336
   ypos 42
  }
  Expression {
   temp_name0 hue
   temp_expr0 "(r==g&&g==b)?0:(180/pi) * atan2( sqrt(3)*(g-b), 2*r-g-b)"
   channel0 {rgba.red -rgba.green -rgba.blue -rgba.alpha}
   expr0 "hue < 0 ? hue + 360 : hue"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   expr2 0
   name rgb_2_hue
   xpos -370
   ypos 86
  }
  Expression {
   temp_name0 hue
   temp_expr0 r
   temp_name1 centerH
   temp_expr1 RRT_RED_HUE
   temp_name2 hueCentered
   temp_expr2 hue-centerH
   channel0 {-rgba.red rgba.green -rgba.blue -rgba.alpha}
   expr0 "hueCentered < -180.0 ? hueCentered + 360.0 : (hueCentered > 180.0) ? hueCentered - 360.0 : hueCentered"
   name center_hue
   xpos -370
   ypos 134
  }
  Expression {
   temp_name0 centeredHue
   temp_expr0 g
   temp_name1 knot_coord
   temp_expr1 "(centeredHue - knots.0) * 4.0/w"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   channel0 {rgba.red -rgba.green -rgba.blue -rgba.alpha}
   expr0 "(min((centeredHue > knots.0?1:0) , (centeredHue < knots.4?1:0)) ? j == 3 ? t*t*t * -1./6 + t*t * 3./6 +  t * -3./6 + 1 * 1./6 : j == 2 ? t*t*t * 3./6 + t*t * -6./6 + t * 0./6 + 1. *4./6 : j == 1 ? t*t*t * -3./6 + t*t * 3./6 + t * 3./6 + 1. * 1./6 : j == 0 ? t*t*t * 1./6 + t*t * 0./6 + t * 0./6 + 1. * 0./6 : 0 : 0) * 3/2"
   channel1 none
   channel2 none
   name cubic_basis_shaper
   xpos -370
   ypos 182
   addUserKnob {20 param}
   addUserKnob {7 w R 0 360}
   w {{parent.RRT_RED_WIDTH}}
   addUserKnob {78 knots n 5}
   knots {{-w/2} {-w/4} 0 {w/4} {w/2}}
  }
  Dot {
   name Dot4
   xpos -336
   ypos 234
  }
  Copy {
   inputs 2
   from0 rgba.blue
   to0 rgba.blue
   name Copy4
   note_font Helvetica
   xpos -260
   ypos 226
  }
  Dot {
   name Dot6
   label " r : hueWeight\n g : centeredHue\n b : saturation"
   note_font "Helvetica \[pyrs]"
   note_font_size 12
   note_font_color 0xff
   xpos -226
   ypos 282
  }
  Dot {
   name Dot7
   xpos -226
   ypos 330
  }
set N2b1afc00 [stack 0]
push $N2b202800
  Dot {
   name Dot8
   xpos -6
   ypos 258
  }
set N2b1af800 [stack 0]
  MergeExpression {
   inputs 2
   temp_name0 minChan
   temp_expr0 "Ag < 0 ? Bg : Bb"
   temp_name1 a_
   temp_expr1 "Ar * (1. - RRT_RED_SCALE) - 1."
   temp_name2 b
   temp_expr2 "Br - Ar* (RRT_RED_PIVOT + minChan) * (1. - RRT_RED_SCALE)"
   temp_name3 c
   temp_expr3 "Ar * RRT_RED_PIVOT * minChan * (1. - RRT_RED_SCALE)"
   expr0 "( -b - sqrt( b * b - 4. * a_ * c)) / ( 2. * a_)"
   name red_modifier_rev
   note_font Helvetica
   xpos -150
   ypos 351
  }
push $N2b1afc00
push $N2b1af800
  MergeExpression {
   inputs 2
   expr0 "r + Ar * Ab * (RRT_RED_PIVOT - r) * (1. - RRT_RED_SCALE)"
   name red_modifier_fwd
   note_font Helvetica
   xpos -40
   ypos 327
  }
  Switch {
   inputs 2
   which {{parent.invert}}
   name Switch_direction
   note_font Helvetica
   xpos -40
   ypos 423
  }
  Output {
   name Output
   xpos -40
   ypos 494
  }
 end_group
 Clamp {
  channels rgb
  maximum_enable false
  name clamp_f3_min
  label "Clamp Negative Values"
  xpos -1250
  ypos -976
 }
 ColorMatrix {
  matrix {
      {1.451439381 -0.2365107685 -0.2149285674}
      {-0.07655383646 1.176229835 -0.09967593104}
      {0.008316127583 -0.0060324613 0.997716248}
    }
  name ColorMatrix15
  label "ACES to ACEScg"
  xpos -1250
  ypos -928
 }
 Clamp {
  channels rgb
  maximum 65535
  name clamp_f3_
  label "clamp to HALF_MAX"
  xpos -1250
  ypos -880
 }
 ColorMatrix {
  matrix {
      {{"(1.0 - sat) * rgb2Y.x + sat"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y + sat"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z + sat"}}
    }
  name ColorMatrix
  label "// --- Global desaturation --- //\nrgbPre = mult_f3_f33( rgbPre, RRT_SAT_MAT);"
  selected true
  xpos -1250
  ypos -790
  disable true
  addUserKnob {20 params}
  addUserKnob {13 rgb2Y}
  rgb2Y {0.27222875 0.67408174 0.05368952}
  addUserKnob {7 sat}
  sat 0.96
 }
 Dot {
  name Dot29
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xff
  xpos -1216
  ypos -558
 }
set N2b1ad800 [stack 0]
 Group {
  name ssts
  xpos -1250
  ypos -514
  addUserKnob {20 ssts_tab l ssts}
  addUserKnob {26 display_label l " " T "<b>Display Settings</b>"}
  addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
  lum {{"use_c9 ? 0.0001 : parent.lum"} {parent.lum} {"use_c9 ? 10000 : parent.lum"}}
  addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
  override_ssts_params {{parent.override_ssts_params}}
  addUserKnob {7 exposure R -5 5}
  exposure {{parent.exposure}}
  addUserKnob {7 knee}
  knee {{parent.pctLow}}
  addUserKnob {7 shoulder}
  shoulder {{parent.pctHigh}}
  addUserKnob {78 slope n 3}
  slope {{parent.slope} {parent.slope} {parent.slope}}
  addUserKnob {20 TsParams_tab l TsParams}
  addUserKnob {7 mid_lum l "mid lum" R 0 20}
  mid_lum {{parent.lum.1}}
  addUserKnob {7 expShift R -4 4}
  expShift {{"(parent.override_ssts_params ? exposure : 0) + (mid_lum<= 4.8 ? 0 : \[sample parent.expShift r 0 0] )"}}
  addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  minPoint {{"pow(2, log(0.18*pow(2, MIN_STOP_RRT+((MIN_STOP_SDR-MIN_STOP_RRT)/(log10(MIN_LUM_SDR)-log10(MIN_LUM_RRT)))*(log10(minPoint.y)-log10(MIN_LUM_RRT))))/log(2)-expShift)"} {lum.0} {override_ssts_params?slope.0:0}}
  addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  midPoint {{"pow(2, ((log(0.18)/log(2)-expShift)))"} 4.8 {override_ssts_params?slope.1:1.55}}
  addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  maxPoint {{"pow(2, log(0.18*pow(2, (MAX_STOP_SDR + (MAX_STOP_RRT-MAX_STOP_SDR) / (log10(MAX_LUM_RRT)-log10(MAX_LUM_SDR)) * (log10(maxPoint.y)-log10(MAX_LUM_SDR)))))/log(2)-expShift)"} {lum.2} {override_ssts_params?slope.2:0}}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(midPoint.x) - log10(minPoint.x)) / 3.0"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(maxPoint.x) - log10(midPoint.x)) / 3.0"}}
  addUserKnob {7 pctLow}
  pctLow {{0.18+(0.35-0.18)/(MIN_STOP_SDR-MIN_STOP_RRT)*(log(minPoint.x/0.18)/log(2)-MIN_STOP_RRT)}}
  addUserKnob {7 pctHigh}
  pctHigh {{0.89+(0.90-0.89)/(MAX_STOP_SDR-MAX_STOP_RRT)*(log(maxPoint.x/0.89)/log(2)-MAX_STOP_RRT)}}
  addUserKnob {78 coefsLow n 5}
  coefsLow {{"(minPoint.z * (log10(minPoint.x)-0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {"(minPoint.z * (log10(minPoint.x)+0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {log10(minPoint.y)+pctLow*(log10(midPoint.y)-log10(minPoint.y))} {"(midPoint.z * (log10(midPoint.x)-0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"}}
  addUserKnob {78 coefsHigh n 5}
  coefsHigh {{"(midPoint.z * (log10(midPoint.x)-0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {log10(midPoint.y)+pctHigh*(log10(maxPoint.y)-log10(midPoint.y))} {"(maxPoint.z * (log10(maxPoint.x)-0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"} {"(maxPoint.z * (log10(maxPoint.x)+0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"}}
  addUserKnob {20 Constants_tab l const}
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
  addUserKnob {7 MIN_STOP_SDR R -20 20}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -20 20}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR R 0 0.1}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 100}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT R 0 0.1}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N2b1ad000 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N2b1ad000
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N2b1ac800 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N2b1ac400 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N2b14fc00 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N2b14f800 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr <= log10(minPoint.x)"
   expr1 "logg <= log10(minPoint.x)"
   expr2 "logb <= log10(minPoint.x)"
   name segment_bottom
   xpos -590
   ypos -178
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N2b14f800
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N2b14ec00 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr1 "logg * minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr2 "logb* minPoint.z + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x) )"
   expr3 1
   name Expression
   xpos -370
   ypos -178
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N2b14fc00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
   expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
   expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
   name segment_low
   xpos -700
   ypos -178
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N2b14ec00
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N2b14d400 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -198
  }
set N2b14d000 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -198
  }
set N2b14cc00 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -198
  }
  Dot {
   name Dot12
   label " "
   xpos 434
   ypos -78
  }
set N2b14c400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression5
   xpos 290
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix3
   label "mult_f3_f33( cf, M)"
   xpos 290
   ypos 8
  }
push $N2b14c400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression6
   xpos 400
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f2
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 400
   ypos 8
  }
push 0
push $N2b14cc00
  Dot {
   name Dot11
   label " "
   xpos 214
   ypos -78
  }
set N2b106c00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression3
   xpos 70
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix1
   label "mult_f3_f33( cf, M)"
   xpos 70
   ypos 8
  }
push $N2b106c00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression4
   xpos 180
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f7
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 180
   ypos 8
  }
push $N2b14d000
  Dot {
   name Dot10
   label " "
   xpos -6
   ypos -78
  }
set N2b105800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : 0"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.4 : 0"
   name Expression1
   xpos -150
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix2
   label "mult_f3_f33( cf, M)"
   xpos -150
   ypos 8
  }
push $N2b105800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression2
   xpos -40
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f1
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos -40
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 180
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N2b1ac400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
   expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
   expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
   name segment_high
   xpos -810
   ypos -178
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N2b14d400
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N2b08ec00 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -198
  }
set N2b08e800 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -198
  }
set N2b08e400 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -198
  }
  Dot {
   name Dot19
   label " "
   xpos 1204
   ypos -78
  }
set N2b08dc00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression11
   xpos 1060
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix6
   label "mult_f3_f33( cf, M)"
   xpos 1060
   ypos 8
  }
push $N2b08dc00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression12
   xpos 1170
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f6
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 1170
   ypos 8
  }
push 0
push $N2b08e400
  Dot {
   name Dot18
   label " "
   xpos 984
   ypos -78
  }
set N2b08c800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression9
   xpos 840
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix5
   label "mult_f3_f33( cf, M)"
   xpos 840
   ypos 8
  }
push $N2b08c800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression10
   xpos 950
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f5
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 950
   ypos 8
  }
push $N2b08e800
  Dot {
   name Dot16
   label " "
   xpos 764
   ypos -78
  }
set N2b03f000 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : 0"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.4 : 0"
   expr3 j
   name Expression7
   xpos 620
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix4
   label "mult_f3_f33( cf, M)"
   xpos 620
   ypos 8
  }
push $N2b03f000
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression8
   xpos 730
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f4
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 730
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   xpos 950
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N2b1ac800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -178
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N2b08ec00
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr1 "logg * maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr2 "logb* maxPoint.z + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x) )"
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -160
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Dot {
   name Dot30
   xpos 1534
   ypos 810
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
 Dot {
  name Dot23
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -462
 }
set N2afca400 [stack 0]
 Dot {
  name Dot22
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1656
  ypos -462
 }
 ColorMatrix {
  matrix {
      {0.6954522133 0.1406786889 0.163869068}
      {0.04479461163 0.8596711159 0.09553432465}
      {-0.005525866989 0.004025223665 1.001500726}
    }
  name ColorMatrix7
  label "ACEScg to ACES"
  note_font Helvetica
  xpos -1690
  ypos -398
 }
 Dot {
  name Dot21
  label " OCES"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1656
  ypos 2658
 }
push $N2afca400
 Dot {
  name Dot28
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos -342
 }
set N2afc9400 [stack 0]
 Group {
  name segmented_spline_c9_fwd
  xpos -1140
  ypos -346
  addUserKnob {20 SegmentedSplineParams_c9_tab l SegmentedSplineParams_c9}
  addUserKnob {78 coefsLow n 10}
  coefsLow {-1.698970004 -1.698970004 -1.4779 -1.2291 -0.8648 -0.448 0.00518 0.4511080334 0.9113744414 0.9113744414}
  addUserKnob {78 coefsHigh n 10}
  coefsHigh {0.5154386965 0.8470437783 1.1358 1.3802 1.5197 1.5985 1.6467 1.674609136 1.687873339 1.687873339}
  addUserKnob {12 minPoint}
  minPoint {0.0028799 0.02}
  addUserKnob {12 midPoint}
  midPoint {4.79999924 4.8}
  addUserKnob {12 maxPoint}
  maxPoint {1005.719116 48}
  addUserKnob {7 slopeLow}
  addUserKnob {7 slopeHigh}
  slopeHigh 0.04
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 8
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 8
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N2afc8c00 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N2afc8c00
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N2afc8400 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N2af7bc00 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N2af7b800 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N2af7b400 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr <= log10(minPoint.x)"
   expr1 "logg <= log10(minPoint.x)"
   expr2 "logb <= log10(minPoint.x)"
   name segment_bottom
   xpos -590
   ypos -178
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N2af7b400
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N2af7a800 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr1 "logg * slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr2 "logb* slopeLow + ( log10(minPoint.y) - slopeLow * log10(minPoint.x) )"
   expr3 1
   name Expression
   xpos -370
   ypos -178
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N2af7b800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr > log10(minPoint.x) ) * ( logr < log10(midPoint.x) )"
   expr1 "( logg > log10(minPoint.x) ) * ( logg < log10(midPoint.x) )"
   expr2 "( logb > log10(minPoint.x) ) * ( logb < log10(midPoint.x) )"
   name segment_low
   xpos -700
   ypos -178
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N2af7a800
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N2af79000 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -198
  }
set N2af78c00 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -198
  }
set N2af78800 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -198
  }
  Dot {
   name Dot12
   label " "
   xpos 434
   ypos -78
  }
set N2af3fc00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression15
   xpos 290
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix3
   label "mult_f3_f33( cf, M)"
   xpos 290
   ypos 8
  }
push $N2af3fc00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression6
   xpos 400
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f2
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 400
   ypos 8
  }
push 0
push $N2af78800
  Dot {
   name Dot11
   label " "
   xpos 214
   ypos -78
  }
set N2af3e800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression14
   xpos 70
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix1
   label "mult_f3_f33( cf, M)"
   xpos 70
   ypos 8
  }
push $N2af3e800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression4
   xpos 180
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f7
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 180
   ypos 8
  }
push $N2af78c00
  Dot {
   name Dot10
   label " "
   xpos -6
   ypos -78
  }
set N2af3d400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsLow.0 : j == 1 ? coefsLow.1 : j == 2 ? coefsLow.2 :j == 3 ? coefsLow.3 : j == 4 ? coefsLow.4 : j == 5 ? coefsLow.5 : j == 6 ? coefsLow.6 : j == 7 ? coefsLow.7 : j == 8 ? coefsLow.8 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr1 "j == 0 ? coefsLow.1 : j == 1 ? coefsLow.2 : j == 2 ? coefsLow.3 :j == 3 ? coefsLow.4 : j == 4 ? coefsLow.5 : j == 5 ? coefsLow.6 : j == 6 ? coefsLow.7 : j == 7 ? coefsLow.8 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr2 "j == 0 ? coefsLow.2 : j == 1 ? coefsLow.3 : j == 2 ? coefsLow.4 :j == 3 ? coefsLow.5 : j == 4 ? coefsLow.6 : j == 5 ? coefsLow.7 : j == 6 ? coefsLow.8 : j == 7 ? coefsLow.9 : j == 8 ? coefsLow.9 : j == 9 ? coefsLow.9 : coefsLow.9"
   expr3 j
   name Expression1
   xpos -150
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix2
   label "mult_f3_f33( cf, M)"
   xpos -150
   ypos 8
  }
push $N2af3d400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_LOW-1) * (logx-log10(minPoint.x))/(log10(midPoint.x)-log10(minPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression2
   xpos -40
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f1
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos -40
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 180
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N2af7bc00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "( logr >= log10(midPoint.x) ) * ( logr < log10(maxPoint.x) )"
   expr1 "( logg >= log10(midPoint.x) ) * ( logg < log10(maxPoint.x) )"
   expr2 "( logb >= log10(midPoint.x) ) * ( logb < log10(maxPoint.x) )"
   name segment_high
   xpos -810
   ypos -178
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N2af79000
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N2b3b6800 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -198
  }
set N2b3b6400 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -198
  }
set N2b3b6000 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -198
  }
  Dot {
   name Dot19
   label " "
   xpos 1204
   ypos -78
  }
set N2b3b5800 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression3
   xpos 1060
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix6
   label "mult_f3_f33( cf, M)"
   xpos 1060
   ypos 8
  }
push $N2b3b5800
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(b, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression12
   xpos 1170
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 0
   expr2 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   name dot_f3_f6
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 1170
   ypos 8
  }
push 0
push $N2b3b6000
  Dot {
   name Dot18
   label " "
   xpos 984
   ypos -78
  }
set N2b3b4400 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression5
   xpos 840
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix5
   label "mult_f3_f33( cf, M)"
   xpos 840
   ypos 8
  }
push $N2b3b4400
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(g, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression10
   xpos 950
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 0
   expr1 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr2 0
   name dot_f3_f5
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 950
   ypos 8
  }
push $N2b3b6400
  Dot {
   name Dot16
   label " "
   xpos 764
   ypos -78
  }
set N2b36ec00 [stack 0]
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 "j == 0 ? coefsHigh.0 : j == 1 ? coefsHigh.1 : j == 2 ? coefsHigh.2 :j == 3 ? coefsHigh.3 : j == 4 ? coefsHigh.4 : j == 5 ? coefsHigh.5 : j == 6 ? coefsHigh.6 : j == 7 ? coefsHigh.7 : j == 8 ? coefsHigh.8 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr1 "j == 0 ? coefsHigh.1 : j == 1 ? coefsHigh.2 : j == 2 ? coefsHigh.3 :j == 3 ? coefsHigh.4 : j == 4 ? coefsHigh.5 : j == 5 ? coefsHigh.6 : j == 6 ? coefsHigh.7 : j == 7 ? coefsHigh.8 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr2 "j == 0 ? coefsHigh.2 : j == 1 ? coefsHigh.3 : j == 2 ? coefsHigh.4 :j == 3 ? coefsHigh.5 : j == 4 ? coefsHigh.6 : j == 5 ? coefsHigh.7 : j == 6 ? coefsHigh.8 : j == 7 ? coefsHigh.9 : j == 8 ? coefsHigh.9 : j == 9 ? coefsHigh.9 : coefsHigh.9"
   expr3 j
   name Expression16
   xpos 620
   ypos -34
  }
  ColorMatrix {
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name ColorMatrix4
   label "mult_f3_f33( cf, M)"
   xpos 620
   ypos 8
  }
push $N2b36ec00
  Expression {
   temp_name0 logx
   temp_expr0 "(log10( max(r, 5.96046448e-08 )))"
   temp_name1 knot_coord
   temp_expr1 "(N_KNOTS_HIGH-1) * (logx-log10(midPoint.x))/(log10(maxPoint.x)-log10(midPoint.x))"
   temp_name2 j
   temp_expr2 int(knot_coord)
   temp_name3 t
   temp_expr3 "knot_coord - j"
   expr0 t*t
   expr1 t
   expr2 1
   expr3 1
   name Expression8
   xpos 730
   ypos -34
  }
  MergeExpression {
   inputs 2
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 (Ar*Br)+(Ag*Bg)+(Ab*Bb)
   expr1 0
   expr2 0
   name dot_f3_f4
   label "logy = dot_f3_f3( monomials, mult_f3_f33( cf, M))"
   xpos 730
   ypos 8
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge2
   xpos 950
   ypos 158
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N2afc8400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   expr0 "logr >= log10(maxPoint.x) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.x) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.x) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -178
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N2b3b6800
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 5.96046448e-08 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 5.96046448e-08 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 5.96046448e-08 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 "logr * slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr1 "logg * slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr2 "logb* slopeHigh + ( log10(maxPoint.y) - slopeHigh * log10(maxPoint.x) )"
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -202
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
push $N2afc9400
 Switch {
  inputs 2
  which {{parent.use_c9}}
  name Switch_c9
  xpos -1250
  ypos -298
 }
 Expression {
  expr0 "(r - Ymin) / (Ymax - Ymin)"
  expr1 "(g - Ymin) / (Ymax - Ymin)"
  expr2 "(b - Ymin) / (Ymax - Ymin)"
  expr3 1
  name Y_2_linCV_f3_
  xpos -1250
  ypos 38
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  Ymin {{parent.lum.0}}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
 Dot {
  name Dot12
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 282
 }
set N4956a000 [stack 0]
 Dot {
  name Dot15
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 282
 }
set N49569c00 [stack 0]
 Dot {
  name Dot13
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 282
 }
 Dot {
  name Dot16
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 354
 }
set N49569400 [stack 0]
 Expression {
  temp_name0 tr
  temp_expr0 "(-r - c_x_0) / (c_x_1 - c_x_0)"
  temp_name1 tg
  temp_expr1 "(-g - c_x_0) / (c_x_1 - c_x_0)"
  temp_name2 tb
  temp_expr2 "(-b - c_x_0) / (c_x_1 - c_x_0)"
  expr0 "tr < 0.0 ? -(tr * c_b + c_c) : tr > 1.0 ? r : -(( tr * c_a + c_b) * tr + c_c)"
  expr1 "tg < 0.0 ? -(tg * c_b + c_c) : tg > 1.0 ? g : -(( tg * c_a + c_b) * tg + c_c)"
  expr2 "tb < 0.0 ? -(tb * c_b + c_c) : tb > 1.0 ? b : -(( tb * c_a + c_b) * tb + c_c)"
  name roll_white_fwd_1
  xpos -920
  ypos 398
  addUserKnob {20 Params}
  addUserKnob {7 new_wht}
  new_wht 0.918
  addUserKnob {7 c_width}
  c_width 0.5
  addUserKnob {7 c_x_0 +DISABLED}
  c_x_0 -1
  addUserKnob {7 c_x_1 +DISABLED}
  c_x_1 {{"c_x_0 + c_width"}}
  addUserKnob {7 c_y0 +DISABLED}
  c_y0 {{-new_wht}}
  addUserKnob {7 c_y1 +DISABLED}
  c_y1 {{c_x_1}}
  addUserKnob {7 c_m1 +DISABLED}
  c_m1 {{"(c_x_1 - c_x_0)"}}
  addUserKnob {7 c_a +DISABLED}
  c_a {{"c_y0 - c_y1 + c_m1"}}
  addUserKnob {7 c_b +DISABLED}
  c_b {{"2 * (c_y1 - c_y0) - c_m1"}}
  addUserKnob {7 c_c +DISABLED}
  c_c {{c_y0}}
 }
 Expression {
  temp_name0 SCALE
  temp_expr0 0.96
  temp_name1 NEW_WHT
  temp_expr1 0.918
  expr0 "min( r, NEW_WHT) * SCALE"
  expr1 "min( g, NEW_WHT) * SCALE"
  expr2 "min( b, NEW_WHT) * SCALE"
  name Expression2
  label "// Scale and clamp white to avoid casted highlights due to D60 simulation"
  xpos -920
  ypos 440
 }
 Dot {
  name Dot11
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 498
 }
push $N49569400
 Expression {
  temp_name0 SCALE
  temp_expr0 0.96362
  expr0 "r * SCALE"
  expr1 "g * SCALE"
  expr2 "b * SCALE"
  name mult_f_f3_
  label D65
  xpos -1030
  ypos 344
 }
push $N49569c00
 Switch {
  inputs 2
  which {{"parent.display_pri < 3"}}
  name switch_wp_is_d65_
  xpos -1140
  ypos 350
 }
 Dot {
  name Dot14
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 426
 }
push $N4956a000
 Switch {
  inputs 2
  which {{parent.d60_sim}}
  name d60_sim_switch1
  xpos -1250
  ypos 422
 }
 Switch {
  inputs 2
  which {{"parent.display_pri == 3"}}
  name switch_wp_is_dci_
  xpos -1250
  ypos 494
 }
 Dot {
  name Dot26
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 762
 }
set N494ef800 [stack 0]
 ColorMatrix {
  matrix {
      {{"(1.0 - sat) * rgb2Y.x + sat"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y + sat"} {"(1.0 - sat) * rgb2Y.z"}}
      {{"(1.0 - sat) * rgb2Y.x"} {"(1.0 - sat) * rgb2Y.y"} {"(1.0 - sat) * rgb2Y.z + sat"}}
    }
  name ColorMatrix3
  label "// Apply desaturation to compensate \nfor luminance difference"
  xpos -1140
  ypos 746
  addUserKnob {20 params}
  addUserKnob {13 rgb2Y}
  rgb2Y {0.27222875 0.67408174 0.05368952}
  addUserKnob {7 sat}
  sat 0.93
 }
push $N494ef800
 Switch {
  inputs 2
  which {{"parent.eotf < 5 && display_pri < 2"}}
  name Switch_eotf
  label "Use if output is SDR"
  xpos -1250
  ypos 800
 }
 ColorMatrix {
  matrix {
      {0.6624541879 0.1340042055 0.1561876982}
      {0.2722287476 0.6740817428 0.05368951708}
      {-0.005574660841 0.004060741514 1.010339141}
    }
  name ColorMatrix1
  label "ACES AP1 to XYZ"
  xpos -1250
  ypos 968
 }
 Dot {
  name Dot8
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 1146
 }
set N494eec00 [stack 0]
 Colorspace {
  colorspace_in CIE-XYZ
  colorspace_out CIE-Yxy
  name Colorspace2
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1140
  ypos 1136
 }
 Clamp {
  channels {rgba.red -rgba.green -rgba.blue none}
  maximum_enable false
  name ClampMin4
  xpos -1140
  ypos 1190
 }
 Expression {
  expr0 "pow(r, DIM_SURROUND_GAMMA)"
  expr1 g
  expr2 b
  channel3 none
  name dark_to_dim3
  xpos -1140
  ypos 1214
  addUserKnob {20 Params}
  addUserKnob {7 DIM_SURROUND_GAMMA}
  DIM_SURROUND_GAMMA 0.9811
 }
 Colorspace {
  colorspace_in CIE-Yxy
  colorspace_out CIE-XYZ
  name Colorspace4
  label "\[value colorspace_in] -> \[value colorspace_out]"
  xpos -1140
  ypos 1256
 }
push $N494eec00
 Switch {
  inputs 2
  which {{"(parent.eotf <= 4) ? parent.dark_to_dim : 0"}}
  name DarkToDim_Switch
  label "enable if sdr\nand dark_to_dim enabled"
  xpos -1250
  ypos 1250
 }
 Dot {
  name Dot19
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 1434
 }
set N494ed800 [stack 0]
 Dot {
  name Dot9
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1106
  ypos 1434
 }
set N494ed400 [stack 0]
 ColorMatrix {
  matrix {
      {0.9872254133 -0.006114810705 0.01592640579}
      {-0.007603884675 1.001874804 0.005322027951}
      {0.003066040576 -0.005084238946 1.081519246}
    }
  name ColorMatrix2
  label "CAT: Bradford\n D60 to D65"
  xpos -1140
  ypos 1466
 }
set N494ed000 [stack 0]
push $N494ed400
 Dot {
  name Dot10
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -996
  ypos 1434
 }
push $N494ed000
 Switch {
  inputs 2
  which {{parent.d60_sim}}
  name d60_sim_switch
  xpos -1140
  ypos 1550
 }
push $N494ed800
 Switch {
  inputs 2
  which {{"parent.display_pri < 3"}}
  name switch_wp_is_d65_1
  xpos -1250
  ypos 1550
 }
 Switch {
  inputs 2
  which {{parent.force_d65_cat}}
  name switch_force_d65_cat
  xpos -1250
  ypos 1598
 }
 Group {
  name limit_to_primaries
  label "Only enabled when display_pri != limiting_pri"
  xpos -1250
  ypos 1760
  disable {{"!(parent.display_pri != parent.limiting_pri)"}}
  addUserKnob {20 limit_to_primaries}
  addUserKnob {4 limiting_pri l "limiting pri" M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
  limiting_pri {{parent.limiting_pri}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -298
  }
  Dot {
   name Dot1
   label " XYZ to limiting primaries"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos -198
  }
set N494ec400 [stack 0]
push $N494ec400
  ColorMatrix {
   matrix {
       {1.049811006 0 -9.748453158e-05}
       {-0.4959030151 1.373313069 0.09824004024}
       {4.020908051e-08 0 0.9912520051}
     }
   name ColorMatrix5
   label "XYZ to ACES"
   xpos 730
   ypos -136
  }
push $N494ec400
  ColorMatrix {
   matrix {
       {1.641023397 -0.3248033226 -0.2364246994}
       {-0.6636629701 1.615331769 0.01675636508}
       {0.01172191743 -0.008284457959 0.9883947968}
     }
   name ColorMatrix21
   label "XYZ to ACEScg"
   xpos 620
   ypos -136
  }
push $N494ec400
  ColorMatrix {
   matrix {
       {2.402741432 -0.8974840641 -0.3880533576}
       {-0.8325796723 1.769231915 0.02371272631}
       {0.03882339597 -0.08249972761 1.036368608}
     }
   name ColorMatrix15
   label "XYZ to P3D60"
   xpos 510
   ypos -136
  }
push $N494ec400
  ColorMatrix {
   matrix {
       {2.725393534 -1.018002748 -0.4401631057}
       {-0.795167923 1.689731717 0.02264718339}
       {0.04124190658 -0.0876390487 1.100929499}
     }
   name ColorMatrix19
   label "XYZ to P3DCI"
   xpos 400
   ypos -136
  }
push $N494ec400
  ColorMatrix {
   matrix {
       {2.493496418 -0.9313833117 -0.4027107358}
       {-0.8294888139 1.762663841 0.02362467349}
       {0.03584583849 -0.07617240399 0.9568845034}
     }
   name ColorMatrix17
   label "XYZ to P3D65"
   xpos 290
   ypos -136
  }
push $N494ec400
  ColorMatrix {
   matrix {
       {1.71665132 -0.3556708097 -0.2533662617}
       {-0.6666844487 1.616481304 0.01576855592}
       {0.01763986237 -0.04277062416 0.9421030879}
     }
   name ColorMatrix12
   label "XYZ to Rec2020"
   xpos 180
   ypos -136
  }
push $N494ec400
  ColorMatrix {
   matrix {
       {3.240970135 -1.537383318 -0.4986107945}
       {-0.9692437053 1.875967622 0.04155509174}
       {0.0556300357 -0.2039768547 1.056971431}
     }
   name ColorMatrix2
   label "XYZ to Rec709"
   xpos 70
   ypos -136
  }
  Switch {
   inputs 8
   which {{parent.limiting_pri}}
   name limiting_primary_switch
   xpos -40
   ypos -34
  }
  Clamp {
   channels rgb
   name clamp_f3
   label "Clip any values outside the limiting primaries"
   xpos -40
   ypos 56
  }
  Dot {
   name Dot2
   label " Convert limited RGB to XYZ"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos 162
  }
set N2b5f9c00 [stack 0]
push $N2b5f9c00
  ColorMatrix {
   matrix {
       {0.9525524378 0 9.367863095e-05}
       {0.3439664543 0.7281661034 -0.07213255018}
       {-3.863927134e-08 0 1.008825183}
     }
   name ColorMatrix4
   label "ACES to XYZ"
   xpos 730
   ypos 224
  }
push $N2b5f9c00
  ColorMatrix {
   matrix {
       {0.6624541879 0.1340042055 0.1561876982}
       {0.2722287476 0.6740817428 0.05368951708}
       {-0.005574660841 0.004060741514 1.010339141}
     }
   name ColorMatrix20
   label "ACEScg to XYZ"
   xpos 620
   ypos 224
  }
push $N2b5f9c00
  ColorMatrix {
   matrix {
       {0.5049495697 0.2646814585 0.1830150485}
       {0.237623319 0.6891706586 0.07320601493}
       {0 0.0449459292 0.9638792276}
     }
   name ColorMatrix13
   label "P3D60 to XYZ"
   xpos 510
   ypos 224
  }
push $N2b5f9c00
  ColorMatrix {
   matrix {
       {0.4451698363 0.2771343887 0.1722826511}
       {0.209491685 0.7215952873 0.06891305745}
       {0 0.04706057906 0.9073553085}
     }
   name ColorMatrix18
   label "P3DCI to XYZ"
   xpos 400
   ypos 224
  }
push $N2b5f9c00
  ColorMatrix {
   matrix {
       {0.4865709841 0.2656676769 0.1982172877}
       {0.2289745659 0.6917385459 0.07928691059}
       {0 0.04511339962 1.043944359}
     }
   name ColorMatrix16
   label "P3D65 to XYZ"
   xpos 290
   ypos 224
  }
push $N2b5f9c00
  ColorMatrix {
   matrix {
       {0.6369580626 0.1446169019 0.1688809693}
       {0.2627002299 0.6779980659 0.05930171534}
       {0 0.0280726999 1.060985088}
     }
   name ColorMatrix3
   label "Rec2020 to XYZ"
   xpos 180
   ypos 224
  }
push $N2b5f9c00
  ColorMatrix {
   matrix {
       {0.4123907983 0.3575843275 0.180480808}
       {0.2126390189 0.7151686549 0.07219231874}
       {0.01933082007 0.1191947311 0.950532198}
     }
   name ColorMatrix1
   label "Rec709 to XYZ"
   xpos 70
   ypos 224
  }
  Switch {
   inputs 8
   which {{parent.limiting_pri}}
   name limiting_primary_switch1
   xpos -40
   ypos 326
  }
  Output {
   name Output
   xpos -40
   ypos 446
  }
 end_group
 Group {
  name XYZ_2_DISPLAY_PRI
  label "CIE XYZ to display encoding primaries"
  xpos -1250
  ypos 1976
  addUserKnob {20 XYZ_2_DISPLAY_PRI_tab l XYZ_2_DISPLAY_PRI}
  addUserKnob {4 display_pri l "display pri" M {Rec709 Rec2020 P3D65 P3DCI P3D60 ACEScg ACES XYZ}}
  display_pri {{parent.display_pri}}
 }
  Input {
   inputs 0
   name Input
   xpos -40
   ypos -298
  }
  Dot {
   name Dot1
   label " XYZ to display primaries"
   note_font "Helvetica Bold"
   note_font_size 24
   note_font_color 0xa5a5a501
   xpos -6
   ypos -198
  }
set N2b593000 [stack 0]
push $N2b593000
  ColorMatrix {
   matrix {
       {1.049811006 0 -9.748453158e-05}
       {-0.4959030151 1.373313069 0.09824004024}
       {4.020908051e-08 0 0.9912520051}
     }
   name ColorMatrix3
   label "XYZ to ACES"
   xpos 730
   ypos -136
  }
push $N2b593000
  ColorMatrix {
   matrix {
       {1.641023397 -0.3248033226 -0.2364246994}
       {-0.6636629701 1.615331769 0.01675636508}
       {0.01172191743 -0.008284457959 0.9883947968}
     }
   name ColorMatrix21
   label "XYZ to ACEScg"
   xpos 620
   ypos -136
  }
push $N2b593000
  ColorMatrix {
   matrix {
       {2.402741432 -0.8974840641 -0.3880533576}
       {-0.8325796723 1.769231915 0.02371272631}
       {0.03882339597 -0.08249972761 1.036368608}
     }
   name ColorMatrix15
   label "XYZ to P3D60"
   xpos 510
   ypos -136
  }
push $N2b593000
  ColorMatrix {
   matrix {
       {2.725393534 -1.018002748 -0.4401631057}
       {-0.795167923 1.689731717 0.02264718339}
       {0.04124190658 -0.0876390487 1.100929499}
     }
   name ColorMatrix19
   label "XYZ to P3DCI"
   xpos 400
   ypos -136
  }
push $N2b593000
  ColorMatrix {
   matrix {
       {2.493496418 -0.9313833117 -0.4027107358}
       {-0.8294888139 1.762663841 0.02362467349}
       {0.03584583849 -0.07617240399 0.9568845034}
     }
   name ColorMatrix17
   label "XYZ to P3D65"
   xpos 290
   ypos -136
  }
push $N2b593000
  ColorMatrix {
   matrix {
       {1.71665132 -0.3556708097 -0.2533662617}
       {-0.6666844487 1.616481304 0.01576855592}
       {0.01763986237 -0.04277062416 0.9421030879}
     }
   name ColorMatrix12
   label "XYZ to Rec2020"
   xpos 180
   ypos -136
  }
push $N2b593000
  ColorMatrix {
   matrix {
       {3.240970135 -1.537383318 -0.4986107945}
       {-0.9692437053 1.875967622 0.04155509174}
       {0.0556300357 -0.2039768547 1.056971431}
     }
   name ColorMatrix2
   label "XYZ to Rec709"
   xpos 70
   ypos -136
  }
  Switch {
   inputs 8
   which {{parent.display_pri}}
   name limiting_primary_switch
   xpos -40
   ypos -34
  }
  Output {
   name Output
   xpos -40
   ypos 86
  }
 end_group
 Clamp {
  channels rgb
  name clamp_f3_all
  xpos -1250
  ypos 2164
 }
 Dot {
  name Dot1
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -1216
  ypos 2514
 }
set N2b590800 [stack 0]
push $N2b590800
 Dot {
  name Dot3
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -886
  ypos 2514
 }
set N2b590400 [stack 0]
 Dot {
  name Dot4
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -666
  ypos 2514
 }
set N2b537c00 [stack 0]
 Dot {
  name Dot6
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -446
  ypos 2514
 }
set N2b537800 [stack 0]
 Dot {
  name Dot18
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -226
  ypos 2514
 }
set N2b537400 [stack 0]
 Dot {
  name Dot20
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos -6
  ypos 2514
 }
set N2b537000 [stack 0]
 Dot {
  name Dot25
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 214
  ypos 2514
 }
set N2b536c00 [stack 0]
 Dot {
  name Dot24
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2514
 }
 Dot {
  name Dot2
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2610
 }
set N2b536400 [stack 0]
 Expression {
  expr0 "r * (Ymax - Ymin) + Ymin"
  expr1 "g * (Ymax - Ymin) + Ymin"
  expr2 "b * (Ymax - Ymin) + Ymin"
  name linCV_2_Y_f3_hdr
  label "stretch_black = True"
  xpos 510
  ypos 2672
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
push $N2b536400
 Expression {
  expr0 "r * (Ymax - Ymin) + Ymin"
  expr1 "g * (Ymax - Ymin) + Ymin"
  expr2 "b * (Ymax - Ymin) + Ymin"
  name linCV_2_Y_f3_hdr2
  label "stretch_black = False"
  xpos 620
  ypos 2672
  addUserKnob {20 Luminance}
  addUserKnob {7 Ymin R 0.0001 0.02}
  Ymin {{parent.lum.0}}
  addUserKnob {7 Ymax R 48 10000}
  Ymax {{parent.lum.2}}
 }
 Switch {
  inputs 2
  which {{parent.stretch_black}}
  name StretchBlacks_Switch
  xpos 620
  ypos 2750
 }
 Clamp {
  channels rgb
  maximum 65535
  name clamp_f3__
  xpos 620
  ypos 2822
 }
 Expression {
  temp_name0 Lm_r
  temp_expr0 "pow((r / pq_C), pq_m1)"
  temp_name1 Lm_g
  temp_expr1 "pow((g / pq_C), pq_m1)"
  temp_name2 Lm_b
  temp_expr2 "pow((b / pq_C), pq_m1)"
  expr0 "pow(( pq_c1 + pq_c2 * Lm_r ) / ( 1.0 + pq_c3 * Lm_r ), pq_m2)"
  expr1 "pow(( pq_c1 + pq_c2 * Lm_g ) / ( 1.0 + pq_c3 * Lm_g ), pq_m2)"
  expr2 "pow(( pq_c1 + pq_c2 * Lm_b ) / ( 1.0 + pq_c3 * Lm_b ), pq_m2)"
  name Y_2_ST2084_
  label "ACESlib.OutputTransforms.ctl : 243 \nACESlib.Utilities_Color.ctl : 425"
  xpos 620
  ypos 2882
  addUserKnob {20 SMPTE_ST2084-2014_Constants_tab l "Constants from SMPTE ST 2084-2014"}
  addUserKnob {7 pq_m1 t " ( 2610.0 / 4096.0 ) / 4.0;" +DISABLED R 0 100}
  pq_m1 0.1593017578
  addUserKnob {7 pq_m2 t " ( 2523.0 / 4096.0 ) * 128.0;" +DISABLED R 0 100}
  pq_m2 78.84375
  addUserKnob {7 pq_c1 t " 3424.0 / 4096.0 or pq_c3 - pq_c2 + 1.0;" +DISABLED R 0 100}
  pq_c1 0.8359375
  addUserKnob {7 pq_c2 t " ( 2413.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c2 18.8515625
  addUserKnob {7 pq_c3 t " ( 2392.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c3 18.6875
  addUserKnob {7 pq_C +DISABLED R 0 100}
  pq_C 10000
 }
set N2b535400 [stack 0]
 Dot {
  name Dot5
  label " "
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 984
  ypos 2514
 }
 Expression {
  temp_name0 Np_r
  temp_expr0 "pow( r, 1.0 / pq_m2 )"
  temp_name1 Np_g
  temp_expr1 "pow( g, 1.0 / pq_m2 )"
  temp_name2 Np_b
  temp_expr2 "pow( b, 1.0 / pq_m2 )"
  expr0 "r < 0 ? 0 : pow((Np_r - pq_c1) / ( pq_c2 - pq_c3 * Np_r ), 1.0/pq_m1) * pq_C"
  expr1 "g < 0 ? 0 : pow((Np_g - pq_c1) / ( pq_c2 - pq_c3 * Np_g ), 1.0/pq_m1) * pq_C"
  expr2 "b < 0 ? 0 : pow((Np_b - pq_c1) / ( pq_c2 - pq_c3 * Np_b ), 1.0/pq_m1) * pq_C"
  name ST2084_2_Y_f3_
  label "ACESlib.Utilities_Color.ctl : 408\n// Converts from the non-linear perceptually quantized space to linear cd/m^2"
  xpos 950
  ypos 2618
  addUserKnob {20 SMPTE_ST2084-2014_Constants_tab l "Constants from SMPTE ST 2084-2014"}
  addUserKnob {7 pq_m1 t " ( 2610.0 / 4096.0 ) / 4.0;" +DISABLED R 0 100}
  pq_m1 0.1593017578
  addUserKnob {7 pq_m2 t " ( 2523.0 / 4096.0 ) * 128.0;" +DISABLED R 0 100}
  pq_m2 78.84375
  addUserKnob {7 pq_c1 t " 3424.0 / 4096.0 or pq_c3 - pq_c2 + 1.0;" +DISABLED R 0 100}
  pq_c1 0.8359375
  addUserKnob {7 pq_c2 t " ( 2413.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c2 18.8515625
  addUserKnob {7 pq_c3 t " ( 2392.0 / 4096.0 ) * 32.0;" +DISABLED R 0 100}
  pq_c3 18.6875
  addUserKnob {7 pq_C +DISABLED R 0 100}
  pq_C 10000
 }
 Expression {
  temp_name0 Y_d
  temp_expr0 "0.2627*r + 0.6780*g + 0.0593*b"
  expr0 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((r-c_beta)/c_alpha)"
  expr1 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((g-c_beta)/c_alpha)"
  expr2 "Y_d == 0 ? 0 : pow( (Y_d-c_beta)/c_alpha, (1-c_gamma)/c_gamma) * ((b-c_beta)/c_alpha)"
  name ST2084_2_HLG_1000nits_f3_3
  label "ACESlib.Utilities_Color.ctl : 469\n// HLG Inverse EOTF (i.e. HLG inverse OOTF followed by the HLG OETF)\n// HLG Inverse OOTF (display linear to scene linear)"
  xpos 950
  ypos 2732
  addUserKnob {20 Constants_tab l Constants}
  addUserKnob {7 L_w +DISABLED}
  L_w 1000
  addUserKnob {7 L_b +DISABLED}
  addUserKnob {7 c_alpha +DISABLED}
  c_alpha {{L_w-L_b}}
  addUserKnob {7 c_beta +DISABLED}
  c_beta {{L_b}}
  addUserKnob {7 c_gamma +DISABLED}
  c_gamma 1.2
 }
 Expression {
  channel0 {rgba.red -rgba.green -rgba.blue none}
  expr0 "r <= 1.0/12 ? sqrt(3.0*r) : c_a * log(12.0 * r - c_b) + c_c"
  expr1 "g <= 1.0/12 ? sqrt(3.0*g) : c_a * log(12.0 * g- c_b) + c_c"
  expr2 "b <= 1.0/12 ? sqrt(3.0*b) : c_a * log(12.0 * b - c_b) + c_c"
  name ST2084_2_HLG_1000nits_f3_
  label "ACESlib.Utilities_Color.ctl : 493\n// HLG OETF (scene linear to non-linear signal value)"
  xpos 950
  ypos 2834
  addUserKnob {20 Constants_tab l Constants}
  addUserKnob {7 c_a +DISABLED}
  c_a 0.17883277
  addUserKnob {7 c_b t 1.-4.*a +DISABLED}
  c_b 0.28466892
  addUserKnob {7 c_c t 0.5-a*log(4.*a) +DISABLED}
  c_c 0.55991073
 }
 Dot {
  name Dot17
  label " HLG"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 984
  ypos 2970
 }
push $N2b535400
 Dot {
  name Dot27
  label " PQ"
  note_font "Helvetica Bold"
  note_font_size 24
  note_font_color 0xa5a5a501
  xpos 654
  ypos 2970
 }
push $N2b536c00
 Expression {
  expr0 "pow( (48./52.37) * r, 1./2.6)"
  expr1 "pow( (48./52.37) * g, 1./2.6)"
  expr2 "pow( (48./52.37) * b, 1./2.6)"
  expr3 1
  name dcdm_encode
  xpos 180
  ypos 2702
 }
push $N2b537000
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_26_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.6"
  xpos -40
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.6
 }
push $N2b537400
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_24_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.4"
  xpos -260
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.4
 }
push $N2b537800
 Expression {
  expr0 pow(r,1/gamma)
  expr1 pow(g,1/gamma)
  expr2 pow(b,1/gamma)
  name pow_f3_gamma_22_
  label "ACESlib.Utilities_Color.ctl : 260\n// Gamma 2.2"
  xpos -480
  ypos 2690
  addUserKnob {20 Gamma_tab l Gamma}
  addUserKnob {7 gamma R 0 4}
  gamma 2.2
 }
push $N2b537c00
 Expression {
  temp_name0 c_a
  temp_expr0 "pow( pow( Lw, 1./gamma) - pow( Lb, 1./gamma), gamma)"
  temp_name1 c_b
  temp_expr1 "pow( Lb, 1./gamma) / ( pow( Lw, 1./gamma) - pow( Lb, 1./gamma))"
  expr0 "pow( max( r / c_a, 0.), 1.0/gamma) - c_b"
  expr1 "pow( max( g / c_a, 0.), 1.0/gamma) - c_b"
  expr2 "pow( max( b / c_a, 0.), 1.0/gamma) - c_b"
  name bt1886_r_f3
  label "ACESlib.Utilities_Color.ctl : 301\n// The reference EOTF specified in Rec. ITU-R BT.1886\n// L = a(max\[(V+b),0])^g"
  xpos -700
  ypos 2684
  addUserKnob {20 Luminance}
  addUserKnob {7 Lw R 48 10000}
  Lw 1
  addUserKnob {7 Lb R 0.0001 0.02}
  addUserKnob {7 gamma R 1 4}
  gamma 2.4
 }
push $N2b590400
 Expression {
  temp_name0 yb
  temp_expr0 "pow( offs * gamma / ( ( gamma - 1.0) * ( 1.0 + offs)), gamma)"
  temp_name1 rs
  temp_expr1 "pow( ( gamma - 1.0) / offs, gamma - 1.0) * pow( ( 1.0 + offs) / gamma, gamma)"
  expr0 "r >= yb ? ( 1.0 + offs) * pow( r, 1.0 / gamma) - offs : r * rs"
  expr1 "g >= yb ? ( 1.0 + offs) * pow( g, 1.0 / gamma) - offs : g * rs"
  expr2 "b >= yb ? ( 1.0 + offs) * pow( b, 1.0 / gamma) - offs : b * rs"
  name moncurve_r_f3_
  label "ACESlib.Utilities_Color.ctl : 260\nmoncurve_r with gamma of 2.4 and offset of 0.055 matches the EOTF found in IEC 61966-2-1:1999 (sRGB)"
  xpos -920
  ypos 2690
  addUserKnob {20 Luminance}
  addUserKnob {7 gamma R 0 4}
  gamma 2.4
  addUserKnob {7 offs}
  offs 0.055
 }
 Switch {
  inputs 10
  which {{parent.eotf}}
  name EOTF_Switch
  xpos -1250
  ypos 2966
 }
 Expression {
  temp_name0 REFBLACK
  temp_expr0 "64 / 1023"
  temp_name1 REFWHITE
  temp_expr1 "940 / 1023"
  expr0 "r * ( REFWHITE - REFBLACK) + REFBLACK"
  expr1 "g * ( REFWHITE - REFBLACK) + REFBLACK"
  expr2 "b * ( REFWHITE - REFBLACK) + REFBLACK"
  name fullRange_to_smpteRange_f3_
  label "ACESlib.OutputTransforms.ctl : 216"
  xpos -1250
  ypos 3224
  disable {{!parent.legal_range}}
 }
 Output {
  name Output
  xpos -1250
  ypos 3446
 }
 StickyNote {
  inputs 0
  name StickyNote1
  tile_color 0x535a61ff
  label "\n<b>ACESlib.RRT_Common.ctl : 135</b>\n<pre>\nfloat\[3] rrt_sweeteners( float in\[3])\n\{\n    float aces\[3] = in;\n    \n    // --- Glow module --- //\n    float saturation = rgb_2_saturation( aces);\n    float ycIn = rgb_2_yc( aces);\n    float s = sigmoid_shaper( (saturation - 0.4) / 0.2);\n    float addedGlow = 1. + glow_fwd( ycIn, RRT_GLOW_GAIN * s, RRT_GLOW_MID);\n\n    aces = mult_f_f3( addedGlow, aces);\n\n    // --- Red modifier --- //\n    float hue = rgb_2_hue( aces);\n    float centeredHue = center_hue( hue, RRT_RED_HUE);\n    float hueWeight = cubic_basis_shaper( centeredHue, RRT_RED_WIDTH);\n\n    aces\[0] = aces\[0] + hueWeight * saturation * (RRT_RED_PIVOT - aces\[0]) * (1. - RRT_RED_SCALE);\n\n    // --- ACES to RGB rendering space --- //\n    aces = clamp_f3( aces, 0., HALF_POS_INF);\n    float rgbPre\[3] = mult_f3_f44( aces, AP0_2_AP1_MAT);\n    rgbPre = clamp_f3( rgbPre, 0., HALF_MAX);\n    \n    // --- Global desaturation --- //\n    rgbPre = mult_f3_f33( rgbPre, RRT_SAT_MAT);\n    return rgbPre;\n\}\n\n\n\n"
  note_font_size 10
  xpos -825
  ypos -1204
 }
 StickyNote {
  inputs 0
  name StickyNote2
  tile_color 0x535a61ff
  label "\n\n<b>ACESlib.SSTS.ctl : 163</b><pre>float ssts\n( \n    varying float x,\n    varying TsParams C\n)\n\{\n    const int N_KNOTS_LOW = 4;\n    const int N_KNOTS_HIGH = 4;\n\n    // Check for negatives or zero before taking the log. If negative or zero,\n    // set to HALF_MIN.\n    float logx = log10( max(x, HALF_MIN )); \n\n    float logy;\n\n    if ( logx <= log10(C.Min.x) ) \{ \n\n        logy = logx * C.Min.slope + ( log10(C.Min.y) - C.Min.slope * log10(C.Min.x) );\n\n    \} else if (( logx > log10(C.Min.x) ) && ( logx < log10(C.Mid.x) )) \{\n\n        float knot_coord = (N_KNOTS_LOW-1) * (logx-log10(C.Min.x))/(log10(C.Mid.x)-log10(C.Min.x));\n        int j = knot_coord;\n        float t = knot_coord - j;\n\n        float cf\[ 3] = \{ C.coefsLow\[ j], C.coefsLow\[ j + 1], C.coefsLow\[ j + 2]\};\n\n        float monomials\[ 3] = \{ t * t, t, 1. \};\n        logy = dot_f3_f3( monomials, mult_f3_f33( cf, M1));\n\n    \} else if (( logx >= log10(C.Mid.x) ) && ( logx < log10(C.Max.x) )) \{\n\n        float knot_coord = (N_KNOTS_HIGH-1) * (logx-log10(C.Mid.x))/(log10(C.Max.x)-log10(C.Mid.x));\n        int j = knot_coord;\n        float t = knot_coord - j;\n\n        float cf\[ 3] = \{ C.coefsHigh\[ j], C.coefsHigh\[ j + 1], C.coefsHigh\[ j + 2]\}; \n\n        float monomials\[ 3] = \{ t * t, t, 1. \};\n        logy = dot_f3_f3( monomials, mult_f3_f33( cf, M1));\n\n    \} else \{ //if ( logIn >= log10(C.Max.x) ) \{ \n\n        logy = logx * C.Max.slope + ( log10(C.Max.y) - C.Max.slope * log10(C.Max.x) );\n\n    \}\n\n    return pow10(logy);\n\n\}"
  note_font_size 10
  xpos -830
  ypos -664
 }
 StickyNote {
  inputs 0
  name StickyNote3
  tile_color 0x535a61ff
  label "\n\n<b>ACESlib.Tonescales.ctl : 271</b><pre>float segmented_spline_c9_fwd\n  ( \n    varying float x,\n    varying SegmentedSplineParams_c9 C = ODT_48nits\n  )\n\{    \n  const int N_KNOTS_LOW = 8;\n  const int N_KNOTS_HIGH = 8;\n\n  // Check for negatives or zero before taking the log. If negative or zero,\n  // set to HALF_MIN.\n  float logx = log10( max(x, HALF_MIN )); \n\n  float logy;\n\n  if ( logx <= log10(C.minPoint.x) ) \{ \n\n    logy = logx * C.slopeLow + ( log10(C.minPoint.y) - C.slopeLow * log10(C.minPoint.x) );\n\n  \} else if (( logx > log10(C.minPoint.x) ) && ( logx < log10(C.midPoint.x) )) \{\n\n    float knot_coord = (N_KNOTS_LOW-1) * (logx-log10(C.minPoint.x))/(log10(C.midPoint.x)-log10(C.minPoint.x));\n    int j = knot_coord;\n    float t = knot_coord - j;\n\n    float cf\[ 3] = \{ C.coefsLow\[ j], C.coefsLow\[ j + 1], C.coefsLow\[ j + 2]\};\n    \n    float monomials\[ 3] = \{ t * t, t, 1. \};\n    logy = dot_f3_f3( monomials, mult_f3_f33( cf, M));\n\n  \} else if (( logx >= log10(C.midPoint.x) ) && ( logx < log10(C.maxPoint.x) )) \{\n\n    float knot_coord = (N_KNOTS_HIGH-1) * (logx-log10(C.midPoint.x))/(log10(C.maxPoint.x)-log10(C.midPoint.x));\n    int j = knot_coord;\n    float t = knot_coord - j;\n\n    float cf\[ 3] = \{ C.coefsHigh\[ j], C.coefsHigh\[ j + 1], C.coefsHigh\[ j + 2]\}; \n\n    float monomials\[ 3] = \{ t * t, t, 1. \};\n    logy = dot_f3_f3( monomials, mult_f3_f33( cf, M));\n\n  \} else \{ //if ( logIn >= log10(C.maxPoint.x) ) \{ \n\n    logy = logx * C.slopeHigh + ( log10(C.maxPoint.y) - C.slopeHigh * log10(C.maxPoint.x) );\n\n  \}\n\n  return pow10(logy);\n  \n\}"
  note_font_size 10
  xpos -200
  ypos -660
 }
push $N2b1ad800
 Reformat {
  type "to box"
  box_width 4
  box_height 4
  box_fixed true
  name Reformat1
  note_font Helvetica
  xpos -1140
  ypos -561
 }
 Fill {
  output rgb
  color {{parent.ssts.mid_lum}}
  name Fill1
  note_font Helvetica
  xpos -1140
  ypos -537
 }
 Group {
  name inv_ssts
  xpos -1140
  ypos -514
  addUserKnob {20 ssts_tab l ssts}
  addUserKnob {78 lum l luminance t "<b>SSTS Display Luminance</b>: \ny_min y_mid y_max\n\nAccording to Zach Lewis's ACES_OT\nhttps://gist.github.com/zachlewis/786c0be941868644c993fde1c3515c2c\n\n<b>Standard Cinema</b>: \n0.02 4.8 48\n<b>Dolby Cinema</b>: \n0.0001 7.2 108\n<b>Dolby Pulsar</b>: \n0.005 15 4000\n<b>Dolby PRR-4220</b>: \n0.005 10 600\n<b>Sony BVM-X300</b>: \n0.0001 10 1000\n<b>ACES OCES</b>: \n0.0001 4.8 10000\n\n" n 3}
  lum {{"use_c9 ? 0.0001 : parent.lum"} 4.8 {"use_c9 ? 10000 : parent.lum"}}
  addUserKnob {6 override_ssts_params l "override ssts params" t "Enable overrides of SSTS params.\n\nOtherwise the values will be calculated automatically by the algorithm." +STARTLINE}
  override_ssts_params {{parent.ACES_SSTS.AcesSSTSKernel_override_curve_params}}
  addUserKnob {7 exposure R -5 5}
  exposure {{parent.exposure}}
  addUserKnob {7 knee}
  knee {{parent.pctLow}}
  addUserKnob {7 shoulder}
  shoulder {{parent.pctHigh}}
  addUserKnob {78 slope n 3}
  slope {{parent.slope} {parent.slope} {parent.slope}}
  addUserKnob {20 TsParams_tab l TsParams}
  addUserKnob {7 expShift R -4 4}
  expShift {{"override_ssts_params ? exposure : 0"}}
  addUserKnob {13 minPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  minPoint {{"pow(2, log(0.18*pow(2, MIN_STOP_RRT+((MIN_STOP_SDR-MIN_STOP_RRT)/(log10(MIN_LUM_SDR)-log10(MIN_LUM_RRT)))*(log10(minPoint.y)-log10(MIN_LUM_RRT))))/log(2)-expShift)"} {lum.0} {override_ssts_params?slope.0:0}}
  addUserKnob {13 midPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  midPoint {{"pow(2, ((log(0.18)/log(2)-expShift)))"} {lum.1} {override_ssts_params?slope.1:1.55}}
  addUserKnob {13 maxPoint t "x;        // ACES\ny;        // luminance\nz;        // slope"}
  maxPoint {{"pow(2, log(0.18*pow(2, (MAX_STOP_SDR+(MAX_STOP_RRT-MAX_STOP_SDR)/(log10(MAX_LUM_RRT)-log10(MAX_LUM_SDR))*(log10(maxPoint.y)-log10(MAX_LUM_SDR)))))/log(2)-expShift)"} {lum.2} {override_ssts_params?slope.2:0}}
  addUserKnob {7 knotIncLow}
  knotIncLow {{"(log10(midPoint.x) - log10(minPoint.x)) / 3.0"}}
  addUserKnob {7 knotIncHigh}
  knotIncHigh {{"(log10(maxPoint.x) - log10(midPoint.x)) / 3.0"}}
  addUserKnob {7 pctLow}
  pctLow {{0.18+(0.35-0.18)/(MIN_STOP_SDR-MIN_STOP_RRT)*(log(minPoint.x/0.18)/log(2)-MIN_STOP_RRT)}}
  addUserKnob {7 pctHigh}
  pctHigh {{0.89+(0.90-0.89)/(MAX_STOP_SDR-MAX_STOP_RRT)*(log(maxPoint.x/0.89)/log(2)-MAX_STOP_RRT)}}
  addUserKnob {78 coefsLow n 5}
  coefsLow {{"(minPoint.z * (log10(minPoint.x)-0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {"(minPoint.z * (log10(minPoint.x)+0.5*knotIncLow)) + ( log10(minPoint.y) - minPoint.z * log10(minPoint.x))"} {log10(minPoint.y)+pctLow*(log10(midPoint.y)-log10(minPoint.y))} {"(midPoint.z * (log10(midPoint.x)-0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncLow)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"}}
  addUserKnob {78 coefsHigh n 5}
  coefsHigh {{"(midPoint.z * (log10(midPoint.x)-0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {"(midPoint.z * (log10(midPoint.x)+0.5*knotIncHigh)) + ( log10(midPoint.y) - midPoint.z * log10(midPoint.x))"} {log10(midPoint.y)+pctHigh*(log10(maxPoint.y)-log10(midPoint.y))} {"(maxPoint.z * (log10(maxPoint.x)-0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"} {"(maxPoint.z * (log10(maxPoint.x)+0.5*knotIncHigh)) + ( log10(maxPoint.y) - maxPoint.z * log10(maxPoint.x))"}}
  addUserKnob {7 KNOT_INC_LOW}
  KNOT_INC_LOW {{"(log10(midPoint.x) - log10(minPoint.x)) / (N_KNOTS_LOW - 1)"}}
  addUserKnob {7 KNOT_INC_HIGH}
  KNOT_INC_HIGH {{"(log10(maxPoint.x) - log10(midPoint.x)) / (N_KNOTS_HIGH - 1)"}}
  addUserKnob {78 KNOT_Y_LOW n 4}
  KNOT_Y_LOW {{"(coefsLow.0 + coefsLow.1) / 2"} {"(coefsLow.1 + coefsLow.2) / 2"} {"(coefsLow.2 + coefsLow.3) / 2"} {"(coefsLow.3 + coefsLow.4) / 2"}}
  addUserKnob {78 KNOT_Y_HIGH n 4}
  KNOT_Y_HIGH {{"(coefsHigh.0 + coefsHigh.1) / 2"} {"(coefsHigh.1 + coefsHigh.2) / 2"} {"(coefsHigh.2 + coefsHigh.3) / 2"} {"(coefsHigh.3 + coefsHigh.4) / 2"}}
  addUserKnob {20 Constants_tab l const}
  addUserKnob {3 N_KNOTS_LOW}
  N_KNOTS_LOW 4
  addUserKnob {3 N_KNOTS_HIGH}
  N_KNOTS_HIGH 4
  addUserKnob {7 MIN_STOP_SDR R -20 20}
  MIN_STOP_SDR -6.5
  addUserKnob {7 MAX_STOP_SDR R -20 20}
  MAX_STOP_SDR 6.5
  addUserKnob {7 MIN_STOP_RRT R -20 20}
  MIN_STOP_RRT -15
  addUserKnob {7 MAX_STOP_RRT R -20 20}
  MAX_STOP_RRT 18
  addUserKnob {7 MIN_LUM_SDR R 0 0.1}
  MIN_LUM_SDR 0.02
  addUserKnob {7 MAX_LUM_SDR R 0 100}
  MAX_LUM_SDR 48
  addUserKnob {7 MIN_LUM_RRT R 0 0.1}
  MIN_LUM_RRT 0.0001
  addUserKnob {7 MAX_LUM_RRT R 0 10000}
  MAX_LUM_RRT 10000
 }
  Input {
   inputs 0
   name Input
   xpos -1030
   ypos -634
  }
  Dot {
   name Dot25
   label " "
   xpos -996
   ypos -318
  }
set N2b467400 [stack 0]
  Dot {
   name Dot26
   label " "
   xpos -996
   ypos 1506
  }
push $N2b467400
  Dot {
   name Dot4
   label " "
   xpos -886
   ypos -318
  }
set N2b466c00 [stack 0]
  Dot {
   name Dot5
   label " "
   xpos -776
   ypos -318
  }
set N2b466800 [stack 0]
  Dot {
   name Dot2
   label " "
   xpos -666
   ypos -318
  }
set N2b466400 [stack 0]
  Dot {
   name Dot3
   label " "
   xpos -556
   ypos -318
  }
set N2b466000 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "logr <= log10(minPoint.y)"
   expr1 "logg <= log10(minPoint.y)"
   expr2 "logb <= log10(minPoint.y)"
   name segment_bottom
   xpos -590
   ypos -202
  }
  Dot {
   name Dot1
   label " "
   xpos -556
   ypos 162
  }
push $N2b466000
  Dot {
   name Dot7
   label " "
   xpos -336
   ypos -318
  }
set N2b465400 [stack 0]
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 log10(minPoint.x)
   expr1 log10(minPoint.x)
   expr2 log10(minPoint.x)
   expr3 1
   name Expression
   xpos -370
   ypos -202
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply3
   xpos -370
   ypos 158
  }
  Dot {
   name Dot27
   label " "
   xpos -336
   ypos 786
  }
push $N2b466400
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "( logr > log10(minPoint.y) ) && ( logr <= log10(midPoint.y) )"
   expr1 "( logg > log10(minPoint.y) ) && ( logg <= log10(midPoint.y) )"
   expr2 "( logb > log10(minPoint.y) ) && ( logb <= log10(midPoint.y) )"
   name segment_low
   xpos -700
   ypos -202
  }
  Dot {
   name Dot22
   label " "
   xpos -666
   ypos 354
  }
push $N2b465400
  Dot {
   name Dot9
   label " "
   xpos -6
   ypos -318
  }
set N2b413800 [stack 0]
  Dot {
   name Dot6
   label " "
   xpos -6
   ypos -174
  }
set N2b413400 [stack 0]
  Dot {
   name Dot8
   label " "
   xpos 214
   ypos -174
  }
set N2b413000 [stack 0]
  Dot {
   name Dot13
   label " "
   xpos 434
   ypos -174
  }
  Dot {
   name Dot19
   xpos 434
   ypos -78
  }
set N2b412800 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(b, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow5
   xpos 290
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low5
   xpos 290
   ypos -34
  }
push $N2b412800
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bb, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy5
   xpos 400
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals4
   xpos 400
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
push 0
push $N2b413400
  Dot {
   name Dot10
   xpos -6
   ypos -78
  }
set N2b411400 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow
   xpos -150
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low
   xpos -150
   ypos -34
  }
push $N2b411400
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Br, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy
   xpos -40
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals
   xpos -40
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
push $N2b413000
  Dot {
   name Dot18
   xpos 214
   ypos -78
  }
set N4ae73c00 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(g, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_LOW.0) && (logy <= KNOT_Y_LOW.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_LOW.1) && (logy <= KNOT_Y_LOW.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_LOW.2) && (logy <= KNOT_Y_LOW.3)"
   expr0 "low ? coefsLow.0 : mid ? coefsLow.1 : coefsLow.2"
   expr1 "low ? coefsLow.1 : mid ? coefsLow.2 : coefsLow.3"
   expr2 "low ? coefsLow.2 : mid ? coefsLow.3 : coefsLow.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow4
   xpos 70
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low4
   xpos 70
   ypos -34
  }
push $N4ae73c00
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bg, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy4
   xpos 180
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b)/(-sqrt(g*g - 4*r*b)-g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 "log10(minPoint.x) + (t +j) * KNOT_INC_LOW"
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals5
   xpos 180
   ypos 14
   addUserKnob {20 User}
   addUserKnob {7 knotIncLow}
   knotIncLow {{parent.knotIncLow}}
   addUserKnob {13 min l Min}
   min {{parent.min.x} {parent.min.y} {parent.minSlope}}
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   name Merge2
   xpos 180
   ypos 134
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply1
   xpos 180
   ypos 350
  }
  Dot {
   name Dot28
   label " "
   xpos 214
   ypos 786
  }
push 0
push $N2b466800
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "( logr >= log10(midPoint.y) ) && ( logr < log10(maxPoint.y) )"
   expr1 "( logg >= log10(midPoint.y) ) && ( logg < log10(maxPoint.y) )"
   expr2 "( logb >= log10(midPoint.y) ) && ( logb < log10(maxPoint.y) )"
   name segment_high
   xpos -810
   ypos -202
  }
  Dot {
   name Dot23
   label " "
   xpos -776
   ypos 474
  }
push $N2b413800
  Dot {
   name Dot14
   label " "
   xpos 764
   ypos -318
  }
set N4ae71400 [stack 0]
  Dot {
   name Dot15
   label " "
   xpos 764
   ypos -174
  }
set N4ae71000 [stack 0]
  Dot {
   name Dot17
   label " "
   xpos 984
   ypos -174
  }
set N4ae70c00 [stack 0]
  Dot {
   name Dot20
   label " "
   xpos 1204
   ypos -174
  }
  Dot {
   name Dot16
   xpos 1204
   ypos -78
  }
set N4ae70400 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(b, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow3
   xpos 1060
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low3
   xpos 1060
   ypos -34
  }
push $N4ae70400
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bb, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy3
   xpos 1170
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals3
   xpos 1170
   ypos 14
  }
push 0
push $N4ae71000
  Dot {
   name Dot11
   xpos 764
   ypos -78
  }
set N4ae12c00 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow1
   xpos 620
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low1
   xpos 620
   ypos -34
  }
push $N4ae12c00
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Br, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy1
   xpos 730
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 0
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals1
   xpos 730
   ypos 14
  }
push $N4ae70c00
  Dot {
   name Dot12
   xpos 984
   ypos -78
  }
set N4ae11800 [stack 0]
  Expression {
   temp_name0 logy
   temp_expr0 "log10( max(g, 1e-10 ))"
   temp_name1 low
   temp_expr1 "(logy > KNOT_Y_HIGH.0) && (logy <= KNOT_Y_HIGH.1)"
   temp_name2 mid
   temp_expr2 "(logy > KNOT_Y_HIGH.1) && (logy <= KNOT_Y_HIGH.2)"
   temp_name3 high
   temp_expr3 "(logy > KNOT_Y_HIGH.2) && (logy <= KNOT_Y_HIGH.3)"
   expr0 "low ? coefsHigh.0 : mid ? coefsHigh.1 : coefsHigh.2"
   expr1 "low ? coefsHigh.1 : mid ? coefsHigh.2 : coefsHigh.3"
   expr2 "low ? coefsHigh.2 : mid ? coefsHigh.3 : coefsHigh.4"
   expr3 "low ? 0 : mid ? 1 : high ? 2 : 0"
   name inv_cfLow2
   xpos 840
   ypos -82
  }
  ColorMatrix {
   channels {rgba.red rgba.green rgba.blue -rgba.alpha}
   matrix {
       {0.5 -1 0.5}
       {-1 1 0}
       {0.5 0.5 0}
     }
   name inv_basis_low2
   xpos 840
   ypos -34
  }
push $N4ae11800
  MergeExpression {
   inputs 2
   temp_name0 logy
   temp_expr0 "log10(max(Bg, 1e-10))"
   expr0 Ar
   expr1 Ag
   expr2 Ab-logy
   expr3 Aa
   name c_minus_logy2
   xpos 950
   ypos -34
  }
  Expression {
   temp_name0 j
   temp_expr0 a
   temp_name1 d
   temp_expr1 "sqrt(g*g - 4*r*b)"
   temp_name2 t
   temp_expr2 "(2.*b) / (-sqrt(g*g - 4*r*b) - g)"
   expr0 0
   channel1 {-rgba.red rgba.green -rgba.blue none}
   expr1 "log10(midPoint.x) + (t +j) * KNOT_INC_HIGH"
   channel2 {-rgba.red -rgba.green rgba.blue none}
   expr2 0
   expr3 1
   maskChannelInput -rgba.alpha
   unpremult -rgba.alpha
   name inv_knot_vals2
   xpos 950
   ypos 14
  }
  Merge2 {
   inputs 3+1
   operation plus
   bbox B
   output rgb
   name Merge1
   xpos 950
   ypos 134
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply2
   xpos 950
   ypos 470
  }
  Dot {
   name Dot29
   label " "
   xpos 984
   ypos 786
  }
push $N2b466c00
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   expr0 "logr >= log10(maxPoint.y) ? 1 : 0"
   expr1 "logg >= log10(maxPoint.y) ? 1 : 0"
   expr2 "logb >= log10(maxPoint.y) ? 1 : 0"
   name segment_peak
   xpos -920
   ypos -202
  }
  Dot {
   name Dot24
   label " "
   xpos -886
   ypos 618
  }
push $N4ae71400
  Dot {
   name Dot21
   label " "
   xpos 1534
   ypos -318
  }
  Expression {
   temp_name0 logr
   temp_expr0 "log10( max(r, 1e-10 ))"
   temp_name1 logg
   temp_expr1 "log10( max(g, 1e-10 ))"
   temp_name2 logb
   temp_expr2 "log10( max(b, 1e-10 ))"
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 log10(maxPoint.x)
   expr1 log10(maxPoint.x)
   expr2 log10(maxPoint.x)
   expr3 1
   name proc_low1
   label Expression
   xpos 1500
   ypos -208
  }
  Merge2 {
   inputs 2
   operation multiply
   also_merge all
   name Multiply4
   xpos 1500
   ypos 614
  }
  Merge2 {
   inputs 4+1
   operation plus
   bbox B
   output rgb
   name Merge3
   xpos 510
   ypos 1118
  }
  Expression {
   channel0 {rgba.red -rgba.green -rgba.blue none}
   expr0 pow(10,r)
   expr1 pow(10,g)
   expr2 pow(10,b)
   name Expression13
   xpos 510
   ypos 1238
  }
  Copy {
   inputs 2
   from0 rgba.alpha
   to0 rgba.alpha
   name Copy1
   xpos 510
   ypos 1496
  }
  Output {
   name Output1
   xpos 510
   ypos 1814
  }
 end_group
 Expression {
  channel0 rgb
  expr0 log(r)/log(2)-log(0.18)/log(2)
  name expShift
  note_font Helvetica
  xpos -1140
  ypos -489
 }
end_group
Group {
 name Write_ResolveACES_ODT_LUT
 label "\[python nuke.thisNode().knob('file').value().split('/').pop(-1)]"
 xpos -19
 ypos 466
 addUserKnob {20 User}
 addUserKnob {41 file l "output file" T GenerateLUT1.file}
 addUserKnob {41 generate l "Generate and Write LUT File" +INVISIBLE T GenerateLUT1.generate}
 addUserKnob {22 writeCubeDCTL l "Write Cube and DCTL" T "import os\n\nnode = nuke.thisNode()\n\ntemplatePath = os.path.join(nuke.script_directory(),node.knob('dctlTemplate').evaluate())\ncubePath = os.path.join(nuke.script_directory(),node.knob('file').evaluate())\ndctlPath = cubePath.replace('.cube','.dctl')\ncubeName = cubePath.split('/').pop(-1)\n\nnode.knob('generate').execute()\n\nwith open(templatePath) as f:\n    lines = f.readlines()\nnewLines = \[x.replace('replace.cube',cubeName) for x in lines]\n\nwith open(dctlPath, 'w') as f:\n    f.write('\\n'.join(newLines))" +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {2 dctlTemplate}
 dctlTemplate "DaVinci Resolve/ACES_ApplyLUT_Template.dctl"
}
 Input {
  inputs 0
  name Input1
  xpos 411
  ypos 213
 }
 GenerateLUT {
  file "DaVinci Resolve/ACES Transforms/ODT/ACES2.0 Candidates rev001/ACES2.0 CandidateA rev001 Rec709.cube"
  file_type .cube
  name GenerateLUT1
  selected true
  xpos 411
  ypos 267
 }
 Output {
  name Output1
  xpos 411
  ypos 353
 }
end_group
